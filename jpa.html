<!DOCTYPE html>
<!-- saved from url=(0075)https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#reference -->
<html lang="zh-CN" class="translated-ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.2">
<meta name="author" content="Oliver Gierke, Thomas Darimont, Christoph Strobl, Mark Paluch, Jay Bryant">
<title>Spring Data JPA - 参考文档</title>
<link rel="stylesheet" href="./jpa_files/spring.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link type="text/css" rel="stylesheet" charset="UTF-8" href="./jpa_files/translateelement.css"></head>
<body class="book toc2 toc-left is-position-fixed"><div><div id="header-spring">
<h1>
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0" y="0" viewBox="0 0 245.8 45.3" style="enable-background:new 0 0 245.8 45.3;" xml:space="preserve">
<g id="logos">
<g>
<path class="st0" d="M39.4,3.7c-0.6,1.5-1.4,2.8-2.3,4c-3.9-4-9.3-6.4-15.2-6.4c-11.7,0-21.3,9.5-21.3,21.3
c0,6.2,2.6,11.7,6.8,15.6l0.8,0.7c3.7,3.1,8.5,5,13.7,5c11.2,0,20.4-8.7,21.2-19.8C43.7,18.7,42.1,11.8,39.4,3.7z M10.5,38.3
c-0.6,0.8-1.8,0.9-2.6,0.3C7.1,37.9,7,36.8,7.6,36c0.6-0.8,1.8-0.9,2.6-0.3C11,36.4,11.1,37.5,10.5,38.3z M39.3,31.9
c-5.2,7-16.5,4.6-23.6,5c0,0-1.3,0.1-2.6,0.3c0,0,0.5-0.2,1.1-0.4c5-1.7,7.4-2.1,10.5-3.7c5.8-3,11.5-9.4,12.7-16.1
c-2.2,6.4-8.9,12-14.9,14.2c-4.2,1.5-11.7,3-11.7,3c0,0-0.3-0.2-0.3-0.2c-5.1-2.5-5.3-13.6,4-17.1c4.1-1.6,8-0.7,12.4-1.8
C31.6,14.1,37,10.6,39.2,6C41.7,13.3,44.7,24.8,39.3,31.9z"></path>
<g>
<path class="st0" d="M55.2,30.9c-0.5-0.3-0.9-0.9-0.9-1.6c0-1.1,0.8-1.9,1.9-1.9c0.4,0,0.7,0.1,1,0.3c2,1.3,4.1,2,5.9,2
c2,0,3.2-0.9,3.2-2.2v-0.1c0-1.6-2.2-2.2-4.6-2.9c-3-0.9-6.5-2.1-6.5-6.1v-0.1c0-3.9,3.2-6.3,7.4-6.3c2.2,0,4.5,0.6,6.5,1.7
c0.7,0.4,1.1,1,1.1,1.8c0,1.1-0.9,1.9-2,1.9c-0.4,0-0.6-0.1-0.9-0.2c-1.7-0.9-3.4-1.4-4.9-1.4c-1.8,0-2.9,0.9-2.9,2v0.1
c0,1.5,2.2,2.2,4.7,2.9c3,0.9,6.4,2.3,6.4,6v0.1c0,4.3-3.4,6.5-7.7,6.5C60.4,33.3,57.6,32.5,55.2,30.9z"></path>
<path class="st0" d="M72.5,14.3c0-1.3,1-2.4,2.3-2.4c1.3,0,2.4,1.1,2.4,2.4v1.4c1.5-2.2,3.7-3.9,7-3.9c4.8,0,9.6,3.8,9.6,10.7
v0.1c0,6.8-4.7,10.7-9.6,10.7c-3.4,0-5.6-1.7-7-3.6V37c0,1.3-1.1,2.4-2.4,2.4c-1.3,0-2.3-1-2.3-2.4V14.3z M89.1,22.7L89.1,22.7
c0-4.1-2.7-6.7-5.9-6.7c-3.2,0-6,2.7-6,6.6v0.1c0,4,2.8,6.6,6,6.6C86.4,29.3,89.1,26.7,89.1,22.7z"></path>
<path class="st0" d="M95.7,14.3c0-1.3,1-2.4,2.3-2.4c1.3,0,2.4,1.1,2.4,2.4v1.1c0.2-1.8,3.1-3.5,5.2-3.5c1.5,0,2.3,1,2.3,2.3
c0,1.3-0.8,2.1-1.9,2.3c-3.4,0.6-5.7,3.5-5.7,7.6V31c0,1.3-1.1,2.3-2.4,2.3c-1.3,0-2.3-1-2.3-2.3V14.3z"></path>
<path class="st0" d="M109.7,14.3c0-1.3,1-2.4,2.3-2.4c1.3,0,2.4,1.1,2.4,2.4V31c0,1.3-1.1,2.3-2.4,2.3c-1.3,0-2.3-1-2.3-2.3V14.3
z"></path>
<path class="st0" d="M116.9,14.3c0-1.3,1-2.4,2.3-2.4c1.3,0,2.4,1.1,2.4,2.4v1c1.3-1.9,3.2-3.4,6.5-3.4c4.7,0,7.4,3.1,7.4,7.9V31
c0,1.3-1,2.3-2.3,2.3c-1.3,0-2.4-1-2.4-2.3v-9.7c0-3.2-1.6-5-4.4-5c-2.7,0-4.7,1.9-4.7,5.1V31c0,1.3-1.1,2.3-2.4,2.3
c-1.3,0-2.3-1-2.3-2.3V14.3z"></path>
<path class="st0" d="M156.2,11.9c-1.3,0-2.4,1.1-2.4,2.4v1.4c-1.5-2.2-3.7-3.9-7-3.9c-4.9,0-9.6,3.8-9.6,10.7v0.1
c0,6.8,4.7,10.7,9.6,10.7c3.4,0,5.6-1.7,7-3.6c-0.2,3.7-2.5,5.7-6.5,5.7c-2.4,0-4.5-0.6-6.3-1.6c-0.2-0.1-0.5-0.2-0.9-0.2
c-1.1,0-2,0.9-2,2c0,0.9,0.5,1.6,1.3,1.9c2.5,1.2,5.1,1.8,8,1.8c3.7,0,6.6-0.9,8.5-2.8c1.7-1.7,2.7-4.3,2.7-7.8V14.3
C158.5,13,157.5,11.9,156.2,11.9z M147.9,29.2c-3.2,0-5.9-2.5-5.9-6.6v-0.1c0-4,2.7-6.6,5.9-6.6c3.2,0,6,2.7,6,6.6v0.1
C153.9,26.6,151.1,29.2,147.9,29.2z"></path>
<path class="st0" d="M114.5,6.3c0,1.3-1.1,2.4-2.4,2.4c-1.3,0-2.4-1.1-2.4-2.4c0-1.3,1.1-2.4,2.4-2.4
C113.4,3.9,114.5,4.9,114.5,6.3z"></path>
</g>
</g>
<g class="st1">
<g>
<g>
<g>
<path class="st2" d="M200.1,21.1H198V19h2.1V21.1z M200.1,32.9H198V22.6h2.1V32.9z"></path>
</g>
<g>
<g>
<path class="st2" d="M212.5,22.6l-3,8.9c-0.5,1.5-1.4,1.6-2.2,1.6c-1.1,0-1.8-0.5-2.2-1.6l-2.5-7.4h-1v-1.5h2.6l2.6,8.3
c0.1,0.4,0.2,0.6,0.5,0.6c0.3,0,0.4-0.2,0.5-0.6l2.6-8.3H212.5z"></path>
<path class="st2" d="M217.8,22.6c2.8,0,4.7,1.8,4.7,4.5v1.6c0,2.6-1.9,4.5-4.7,4.5c-2.8,0-4.7-1.8-4.7-4.5v-1.6
C213,24.4,215,22.6,217.8,22.6 M217.8,31.4c1.7,0,2.7-1.3,2.7-2.8v-1.6c0-1.5-1-2.8-2.7-2.8c-1.8,0-2.7,1.3-2.7,2.8v1.6
C215.1,30.2,216,31.4,217.8,31.4"></path>
<path class="st2" d="M239.6,22.9c-1.1-0.3-2.7-0.5-4-0.5c-2.8,0-4.6,1.8-4.6,4.6v1.1c0,2.9,1.7,4.7,4.6,4.7c0.1,0,0.6,0,0.8,0
v-1.7c-0.1,0-0.7,0-0.8,0c-1.5,0-2.6-1.2-2.6-2.9v-1.1c0-1.8,1-2.9,2.6-2.9c0.7,0,1.7,0.1,2.1,0.1l0.1,0l0,8.6h2.1v-9.6
C240,23.1,240,23,239.6,22.9"></path>
<rect x="242.1" y="19" class="st2" width="2.1" height="13.9"></rect>
<path class="st2" d="M190.5,19h-3.8v13.9h2.2V20.9h1.3c0.3,0,0.5,0,0.8,0c1.9,0,2.9,0.8,2.9,2.3c0,0.1,0,0.1,0,0.2
c0,1.4-0.8,2.3-2.9,2.3c-0.2,0-0.4,0-0.6,0c0,0.5,0,1.5,0,1.9c0.2,0,0.4,0,0.6,0c3,0,5.2-1.2,5.2-4.2c0-0.1,0-0.1,0-0.2
C196.2,20.2,193.9,19,190.5,19"></path>
<path class="st2" d="M226.3,20.4v2.2h3.5v1.7h-3.5v6c0,0.9,0.6,1,1.5,1h2v1.7H227c-2,0-2.9-0.8-2.9-2.6v-9.6L226.3,20.4z"></path>
</g>
</g>
</g>
</g>
<g>
<path class="st2" d="M167.7,32.9v-10h1.1v3.8c0.6-0.8,1.5-1.3,2.4-1.3c1.9,0,3.2,1.5,3.2,3.8c0,2.4-1.3,3.8-3.2,3.8
c-1,0-1.9-0.5-2.4-1.3v1.1H167.7z M171,32.1c1.5,0,2.3-1.2,2.3-2.8c0-1.6-0.9-2.8-2.3-2.8c-0.9,0-1.8,0.5-2.2,1.2v3.3
C169.2,31.6,170.1,32.1,171,32.1z"></path>
<path class="st2" d="M175.9,34.7c0.2,0.1,0.4,0.1,0.6,0.1c0.5,0,0.8-0.2,1.1-0.8l0.5-1.1l-3-7.3h1.2l2.4,5.9l2.4-5.9h1.2
l-3.6,8.7c-0.4,1-1.2,1.5-2.1,1.5c-0.2,0-0.6,0-0.8-0.1L175.9,34.7z"></path>
</g>
</g>
</g>
</svg>

</h1>
</div></div>
<div id="header">
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data JPA - 参考文档</font></font></h1>
<div class="details">
<span id="author" class="author"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">奥利弗·吉尔克</font></font></span><br>
<span id="author2" class="author"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">托马斯·达里蒙</font></font></span><br>
<span id="author3" class="author"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">克里斯托夫·斯特罗布尔</font></font></span><br>
<span id="author4" class="author"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">马克·帕鲁奇</font></font></span><br>
<span id="author5" class="author"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">杰伊·布莱恩特</font></font></span><br>
<span id="revnumber"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本 2.5.4，</font></font></span>
<span id="revdate"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2021-08-12</font></font></span>
</div>
<div id="toc" class="toc2">
<div id="toctitle"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录</font></font></div>
<ul class="mobile-toc">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#preface"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一、前言</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#project"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1. </font><font style="vertical-align: inherit;">项目元数据</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#new-features"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 新的和值得注意的</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#new-features.1-11-0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1. </font><font style="vertical-align: inherit;">Spring Data JPA 1.11 的新增功能</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#new-features.1-10-0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2. </font><font style="vertical-align: inherit;">Spring Data JPA 1.10 的新增功能</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#dependencies"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 依赖</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#dependencies.spring-boot"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1. </font><font style="vertical-align: inherit;">使用 Spring Boot 进行依赖管理</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#dependencies.spring-framework"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2. </font><font style="vertical-align: inherit;">弹簧框架</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 使用 Spring Data Repositories</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.core-concepts"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1. </font><font style="vertical-align: inherit;">核心概念</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2. </font><font style="vertical-align: inherit;">查询方法</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.definition"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3. </font><font style="vertical-align: inherit;">定义存储库接口</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.definition-tuning"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3.1. </font><font style="vertical-align: inherit;">微调存储库定义</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.multiple-modules"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3.2. </font><font style="vertical-align: inherit;">使用具有多个 Spring 数据模块的存储库</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods.details"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4. </font><font style="vertical-align: inherit;">定义查询方法</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods.query-lookup-strategies"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.1. </font><font style="vertical-align: inherit;">查询查找策略</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods.query-creation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.2. </font><font style="vertical-align: inherit;">查询创建</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods.query-property-expressions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.3. </font><font style="vertical-align: inherit;">属性表达式</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.special-parameters"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.4. </font><font style="vertical-align: inherit;">特殊参数处理</font></font></a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.paging-and-sorting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分页和排序</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.limit-query-result"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.5. </font><font style="vertical-align: inherit;">限制查询结果</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.collections-and-iterables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.6. </font><font style="vertical-align: inherit;">返回集合或可迭代对象的存储库方法</font></font></a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.collections-and-iterables.streamable">Using Streamable as Query Method Return Type</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.collections-and-iterables.streamable-wrapper">Returning Custom Streamable Wrapper Types</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.collections-and-iterables.vavr">Support for Vavr Collections</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.nullability">4.4.7. Null Handling of Repository Methods</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.nullability.annotations">Nullability Annotations</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.nullability.kotlin">Nullability in Kotlin-based Repositories</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-streaming">4.4.8. Streaming Query Results</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-async">4.4.9. Asynchronous Query Results</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances">4.5. Creating Repository Instances</a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances.spring">4.5.1. XML Configuration</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.using-filters">Using Filters</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances.java-config">4.5.2. Java Configuration</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances.standalone">4.5.3. Standalone Usage</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.custom-implementations">4.6. Custom Implementations for Spring Data Repositories</a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.single-repository-behavior">4.6.1. Customizing Individual Repositories</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.configuration">Configuration</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.customize-base-repository">4.6.2. Customize the Base Repository</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.domain-events">4.7. Publishing Events from Aggregate Roots</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.extensions">4.8. Spring Data Extensions</a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.extensions.querydsl">4.8.1. Querydsl Extension</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web">4.8.2. Web support</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.basic">Basic Web Support</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.pageables">Hypermedia Support for Pageables</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.basic.jackson-mappers">Spring Data Jackson Modules</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.binding">Web Databinding Support</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.type-safe">Querydsl Web Support</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.repository-populators">4.8.3. Repository Populators</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#reference">5. Reference Documentation</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.repositories">5.1. JPA Repositories</a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.introduction">5.1.1. Introduction</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.namespace">Spring Namespace</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.java-config">Annotation-based Configuration</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.bootstrap-mode">Bootstrap Mode</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.entity-persistence">5.1.2. Persisting Entities</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.entity-persistence.saving-entites">Saving Entities</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods">5.1.3. Query Methods</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.sample-app.finders.strategies">Query Lookup Strategies</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.query-creation">Query Creation</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.named-queries">Using JPA Named Queries</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.at-query">Using <code>@Query</code></a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.sorting">Using Sort</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.named-parameters">Using Named Parameters</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query.spel-expressions">Using SpEL Expressions</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.modifying-queries">Modifying Queries</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-hints">Applying Query Hints</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.entity-graph">Configuring Fetch- and LoadGraphs</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#projections">Projections</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.stored-procedures">5.1.4. Stored Procedures</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#specifications">5.1.5. Specifications</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example">5.1.6. Query by Example</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example.introduction">Introduction</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example.usage">Usage</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example.matchers">Example Matchers</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example.running">Running an Example</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#transactions">5.1.7. Transactionality</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#transactional-query-methods">Transactional query methods</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#locking">5.1.8. Locking</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#auditing">5.1.9. Auditing</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#auditing.basics">Basics</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.auditing">JPA Auditing</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.misc">5.1.10. Miscellaneous Considerations</a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.misc.jpa-context">Using <code>JpaContext</code> in Custom Implementations</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.misc.merging-persistence-units">Merging persistence units</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpd.misc.cdi-integration">CDI Integration</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#appendix">6. Appendix</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.namespace-reference">Appendix A: Namespace reference</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#populator.namespace-dao-config">The <code>&lt;repositories /&gt;</code> Element</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#populator.namespace-reference">Appendix B: Populators namespace reference</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#namespace-dao-config">The &lt;populator /&gt; element</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repository-query-keywords">Appendix C: Repository query keywords</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#appendix.query.method.subject">Supported query method subject keywords</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#appendix.query.method.predicate">Supported query method predicate keywords and modifiers</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repository-query-return-types">Appendix D: Repository query return types</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#appendix.query.return.types">Supported Query Return Types</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#faq">Appendix E: Frequently Asked Questions</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#faq.common">Common</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#faq.infrastructure">Infrastructure</a></li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#faq.auditing">Auditing</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#glossary">Appendix F: Glossary</a></li>
</ul>
<div id="tocbot" class="js-toc desktop-toc"><ol class="toc-list "><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#preface" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一、前言</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#project" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1. </font><font style="vertical-align: inherit;">项目元数据</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#new-features" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 新的和值得注意的</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#new-features.1-11-0" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1. </font><font style="vertical-align: inherit;">Spring Data JPA 1.11 的新增功能</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#new-features.1-10-0" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2. </font><font style="vertical-align: inherit;">Spring Data JPA 1.10 的新增功能</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#dependencies" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 依赖</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#dependencies.spring-boot" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1. </font><font style="vertical-align: inherit;">使用 Spring Boot 进行依赖管理</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#dependencies.spring-framework" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2. </font><font style="vertical-align: inherit;">弹簧框架</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 使用 Spring Data Repositories</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.core-concepts" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1. </font><font style="vertical-align: inherit;">核心概念</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2. </font><font style="vertical-align: inherit;">查询方法</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.definition" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3. </font><font style="vertical-align: inherit;">定义存储库接口</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.definition-tuning" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3.1. </font><font style="vertical-align: inherit;">微调存储库定义</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.multiple-modules" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3.2. </font><font style="vertical-align: inherit;">使用具有多个 Spring 数据模块的存储库</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods.details" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4. </font><font style="vertical-align: inherit;">定义查询方法</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods.query-lookup-strategies" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.1. </font><font style="vertical-align: inherit;">查询查找策略</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods.query-creation" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.2. </font><font style="vertical-align: inherit;">查询创建</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods.query-property-expressions" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.3. </font><font style="vertical-align: inherit;">属性表达式</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.special-parameters" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.4. </font><font style="vertical-align: inherit;">特殊参数处理</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.paging-and-sorting" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分页和排序</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.limit-query-result" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.5. </font><font style="vertical-align: inherit;">限制查询结果</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.collections-and-iterables" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.6. </font><font style="vertical-align: inherit;">返回集合或可迭代对象的存储库方法</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.collections-and-iterables.streamable" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Streamable 作为查询方法返回类型</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.collections-and-iterables.streamable-wrapper" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回自定义流包装器类型</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.collections-and-iterables.vavr" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持 Vavr 集合</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.nullability" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.7. </font><font style="vertical-align: inherit;">存储库方法的空处理</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.nullability.annotations" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可空性注释</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.nullability.kotlin" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 Kotlin 的存储库中的可空性</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-streaming" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.8. </font><font style="vertical-align: inherit;">流式查询结果</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-async" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.9. </font><font style="vertical-align: inherit;">异步查询结果</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5. </font><font style="vertical-align: inherit;">创建存储库实例</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances.spring" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5.1. </font><font style="vertical-align: inherit;">XML 配置</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.using-filters" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用过滤器</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances.java-config" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5.2. </font><font style="vertical-align: inherit;">Java配置</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances.standalone" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5.3. </font><font style="vertical-align: inherit;">独立使用</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.custom-implementations" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6. </font><font style="vertical-align: inherit;">Spring Data Repositories 的自定义实现</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.single-repository-behavior" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6.1. </font><font style="vertical-align: inherit;">自定义单个存储库</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.configuration" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.customize-base-repository" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6.2. </font><font style="vertical-align: inherit;">自定义基础存储库</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.domain-events" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.7. </font><font style="vertical-align: inherit;">从聚合根发布事件</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.extensions" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8. </font><font style="vertical-align: inherit;">Spring 数据扩展</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.extensions.querydsl" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8.1. </font><font style="vertical-align: inherit;">Querydsl 扩展</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8.2. </font><font style="vertical-align: inherit;">网络支持</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.basic" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本网络支持</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.pageables" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对可分页的超媒体支持</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.basic.jackson-mappers" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Jackson 模块</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.binding" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网页数据绑定支持</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.type-safe" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Querydsl 网络支持</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.repository-populators" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8.3. </font><font style="vertical-align: inherit;">存储库填充器</font></font></a></li></ol></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#reference" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. 参考文档</font></font></a><ol class="toc-list  is-collapsible"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.repositories" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1. </font><font style="vertical-align: inherit;">JPA 存储库</font></font></a><ol class="toc-list  is-collapsible"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.introduction" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.1. </font><font style="vertical-align: inherit;">介绍</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.namespace" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring 命名空间</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.java-config" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于注解的配置</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.bootstrap-mode" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引导模式</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.entity-persistence" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.2. </font><font style="vertical-align: inherit;">持久实体</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.entity-persistence.saving-entites" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存实体</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.3. </font><font style="vertical-align: inherit;">查询方法</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.sample-app.finders.strategies" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询查找策略</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.query-creation" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询创建</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.named-queries" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 JPA 命名查询</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.at-query" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用@Query</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.sorting" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用排序</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.named-parameters" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用命名参数</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query.spel-expressions" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 SpEL 表达式</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.modifying-queries" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修改查询</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-hints" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用查询提示</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.entity-graph" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置 Fetch- 和 LoadGraphs</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#projections" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预测</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.stored-procedures" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.4. </font><font style="vertical-align: inherit;">存储过程</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#specifications" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.5. </font><font style="vertical-align: inherit;">规格</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.6. </font><font style="vertical-align: inherit;">按示例查询</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example.introduction" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example.usage" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example.matchers" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例匹配器</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example.running" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行示例</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#transactions" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.7. </font><font style="vertical-align: inherit;">交易性</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#transactional-query-methods" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事务查询方法</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#locking" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.8. </font><font style="vertical-align: inherit;">锁定</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#auditing" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.9. </font><font style="vertical-align: inherit;">审计</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#auditing.basics" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.auditing" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPA审计</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.misc" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.10. </font><font style="vertical-align: inherit;">其他注意事项</font></font></a><ol class="toc-list  is-collapsible"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.misc.jpa-context" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在自定义实现中使用 JpaContext</font></font></a></li><li class="toc-list-item is-active-li"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.misc.merging-persistence-units" class="toc-link node-name--H5  is-active-link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合并持久化单元</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpd.misc.cdi-integration" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CDI集成</font></font></a></li></ol></li></ol></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#appendix" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. 附录</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.namespace-reference" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 A：命名空间参考</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#populator.namespace-dao-config" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;repositories /&gt; 元素</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#populator.namespace-reference" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 B：Populators 命名空间参考</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#namespace-dao-config" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;populator /&gt; 元素</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repository-query-keywords" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 C：存储库查询关键字</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#appendix.query.method.subject" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的查询方法主题关键字</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#appendix.query.method.predicate" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的查询方法谓词关键字和修饰符</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repository-query-return-types" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 D：存储库查询返回类型</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#appendix.query.return.types" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的查询返回类型</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#faq" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 E：常见问题</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#faq.common" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常见的</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#faq.infrastructure" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基础设施</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#faq.auditing" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#glossary" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 F：词汇表</font></font></a></li></ol></div></div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">© 2008-2021 原作者。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本文档的副本可以供您自己使用和分发给他人，前提是您不对此类副本收取任何费用，并且每份副本均包含本版权声明，无论是印刷版还是电子版。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preface"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#preface"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一、前言</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data JPA 为 Java Persistence API (JPA) 提供存储库支持。</font><font style="vertical-align: inherit;">它简化了需要访问 JPA 数据源的应用程序的开发。</font></font></p>
</div>
<div class="sect2">
<h3 id="project"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#project"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1. </font><font style="vertical-align: inherit;">项目元数据</font></font></h3>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本控制：</font><a href="https://github.com/spring-projects/spring-data-jpa" class="bare"><font style="vertical-align: inherit;">https</font></a><font style="vertical-align: inherit;"> : </font></font><a href="https://github.com/spring-projects/spring-data-jpa" class="bare"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//github.com/spring-projects/spring-data-jpa</font></font></a></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误追踪器：</font><a href="https://github.com/spring-projects/spring-data-jpa/issues" class="bare"><font style="vertical-align: inherit;">https</font></a><font style="vertical-align: inherit;"> : </font></font><a href="https://github.com/spring-projects/spring-data-jpa/issues" class="bare"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//github.com/spring-projects/spring-data-jpa/issues</font></font></a></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布仓库：</font><a href="https://repo.spring.io/libs-release" class="bare"><font style="vertical-align: inherit;">https</font></a><font style="vertical-align: inherit;"> : </font></font><a href="https://repo.spring.io/libs-release" class="bare"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//repo.spring.io/libs-release</font></font></a></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">里程碑存储库：</font><a href="https://repo.spring.io/libs-milestone" class="bare"><font style="vertical-align: inherit;">https</font></a><font style="vertical-align: inherit;"> : </font></font><a href="https://repo.spring.io/libs-milestone" class="bare"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//repo.spring.io/libs-milestone</font></font></a></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快照存储库：</font><a href="https://repo.spring.io/libs-snapshot" class="bare"><font style="vertical-align: inherit;">https</font></a><font style="vertical-align: inherit;"> : </font></font><a href="https://repo.spring.io/libs-snapshot" class="bare"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//repo.spring.io/libs-snapshot</font></font></a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="new-features"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#new-features"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 新的和值得注意的</font></font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="new-features.1-11-0"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#new-features.1-11-0"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1. </font><font style="vertical-align: inherit;">Spring Data JPA 1.11 的新增功能</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data JPA 1.11 添加了以下功能：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改进了与 Hibernate 5.2 的兼容性。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Query by Example 的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任意匹配模式</font><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分页查询优化。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持</font></font><code>exists</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库查询派生中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">投影。</font></font></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="new-features.1-10-0"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#new-features.1-10-0"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2. </font><font style="vertical-align: inherit;">Spring Data JPA 1.10 的新增功能</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data JPA 1.10 添加了以下功能：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持</font><font style="vertical-align: inherit;">存储库查询方法中的</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#projections"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投影</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Query by Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下注解已启用的基础上组成的注释：</font></font><code>@EntityGraph</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>@Lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>@Modifying</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>@Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>@QueryHints</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code>@Procedure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持</font></font><code>Contains</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合表达式上</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">关键字。</font></font></p>
</li>
<li>
<p><code>AttributeConverter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现为</font></font><code>ZoneId</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR-310和ThreeTenBP的。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升级到 Querydsl 4、Hibernate 5、OpenJPA 2.4 和 EclipseLink 2.6.1。</font></font></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dependencies"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#dependencies"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 依赖</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于各个 Spring Data 模块的启动日期不同，它们中的大多数带有不同的主要和次要版本号。</font><font style="vertical-align: inherit;">找到兼容版本的最简单方法是依赖我们随定义的兼容版本一起提供的 Spring Data Release Train BOM。</font><font style="vertical-align: inherit;">在 Maven 项目中，您将在</font></font><code>&lt;dependencyManagement /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">POM</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">部分中</font><font style="vertical-align: inherit;">声明此依赖项，</font><font style="vertical-align: inherit;">如下所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 1. 使用 Spring Data 发布系列 BOM</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.data<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-data-bom<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2021.0.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div id="dependencies.train-version" class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前的发布系列版本是</font></font><code>2021.0.4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">火车版本使用</font><font style="vertical-align: inherit;">带有图案的</font></font><a href="https://calver.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calver</font></font></a><font style="vertical-align: inherit;"></font><code>YYYY.MINOR.MICRO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code>${calver}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GA 版本和服务版本</font><font style="vertical-align: inherit;">的版本名称遵循</font><font style="vertical-align: inherit;">以下模式，所有其他版本遵循以下模式：</font></font><code>${calver}-${modifier}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中</font></font><code>modifier</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以是以下之一：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SNAPSHOT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：当前快照</font></font></p>
</li>
<li>
<p><code>M1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>M2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, 等等：里程碑</font></font></p>
</li>
<li>
<p><code>RC1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>RC2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, 等等：发布候选</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以在我们的</font></font><a href="https://github.com/spring-projects/spring-data-examples/tree/master/bom"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data 示例存储库中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到使用 BOM 的工作示例</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有了它，您就可以在块中声明要使用的 Spring Data 模块，而无需在</font></font><code>&lt;dependencies /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块中</font><font style="vertical-align: inherit;">指定版本</font><font style="vertical-align: inherit;">，如下所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 2. 声明对 Spring Data 模块的依赖</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.data<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dependencies.spring-boot"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#dependencies.spring-boot"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1. </font><font style="vertical-align: inherit;">使用 Spring Boot 进行依赖管理</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Boot 会为您选择最新版本的 Spring Data 模块。</font><font style="vertical-align: inherit;">如果您仍想升级到更新的版本，请将</font></font><code>spring-data-releasetrain.version</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">设置为</font><font style="vertical-align: inherit;">您想要使用</font><font style="vertical-align: inherit;">的</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#dependencies.train-version"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">训练版本和迭代</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="dependencies.spring-framework"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#dependencies.spring-framework"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2. </font><font style="vertical-align: inherit;">弹簧框架</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前版本的 Spring Data 模块需要 Spring Framework 5.3.9 或更高版本。</font><font style="vertical-align: inherit;">这些模块也可能与该次要版本的较旧错误修复版本一起使用。</font><font style="vertical-align: inherit;">但是，强烈建议使用该代中的最新版本。</font></font></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repositories"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 使用 Spring Data Repositories</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data repository 抽象的目标是显着减少为各种持久性存储实现数据访问层所需的样板代码量。</font></font></p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要的"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data 存储库文档和您的模块</font></font></em></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本章解释了 Spring Data 存储库的核心概念和接口。</font><font style="vertical-align: inherit;">本章中的信息来自 Spring Data Commons 模块。</font><font style="vertical-align: inherit;">它使用 Java Persistence API (JPA) 模块的配置和代码示例。</font><font style="vertical-align: inherit;">您应该将 XML 命名空间声明和要扩展的类型调整为您使用的特定模块的等效项。</font><font style="vertical-align: inherit;">“</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.namespace-reference"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名空间参考</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”涵盖了所有支持存储库 API 的 Spring Data 模块都支持的 XML 配置。</font><font style="vertical-align: inherit;">“</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repository-query-keywords"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库查询关键字</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”涵盖了存储库抽象支持的查询方法关键字。</font><font style="vertical-align: inherit;">有关模块特定功能的详细信息，请参阅本文档中有关该模块的章节。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="repositories.core-concepts"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.core-concepts"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1. </font><font style="vertical-align: inherit;">核心概念</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data 存储库抽象中的中心接口是</font></font><code>Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">它需要域类来管理以及域类的 ID 类型作为类型参数。</font><font style="vertical-align: inherit;">此接口主要用作标记接口，以捕获要使用的类型并帮助您发现扩展此接口的接口。</font><font style="vertical-align: inherit;">该</font></font><a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/CrudRepository.html"><code>CrudRepository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口为正在管理的实体类提供复杂的 CRUD 功能。</font></font></p>
</div>
<div id="repositories.repository" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 3.</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{<font></font>
<font></font>
  &lt;S extends T&gt; <span class="hljs-function">S <span class="hljs-title">save</span><span class="hljs-params">(S entity)</span></span>;      <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
<font></font>
  <span class="hljs-function">Optional&lt;T&gt; <span class="hljs-title">findById</span><span class="hljs-params">(ID primaryKey)</span></span>; <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
  <span class="hljs-function">Iterable&lt;T&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;               <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">count</span><span class="hljs-params">()</span></span>;                        <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(T entity)</span></span>;               <i class="conum" data-value="5"></i><b>(<span class="hljs-number">5</span>)</b><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">existsById</span><span class="hljs-params">(ID primaryKey)</span></span>;   <i class="conum" data-value="6"></i><b>(<span class="hljs-number">6</span>)</b><font></font>
<font></font>
  <span class="hljs-comment">// … more functionality omitted.</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存给定的实体。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回由给定 ID 标识的实体。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回所有实体。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回实体的数量。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除给定的实体。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示具有给定 ID 的实体是否存在。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们还提供特定于持久性技术的抽象，例如</font></font><code>JpaRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>MongoRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些接口扩展</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并露出下面的持久化技术在另外的能力，以比较通用的持久性与技术无关的接口，如</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 之上</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，有一个</font></font><a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/PagingAndSortingRepository.html"><code>PagingAndSortingRepository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">抽象，它添加了额外的方法来简化对实体的分页访问：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 4.</font></font><code>PagingAndSortingRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">界面</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PagingAndSortingRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function">Iterable&lt;T&gt; <span class="hljs-title">findAll</span><span class="hljs-params">(Sort sort)</span></span>;<font></font>
<font></font>
  <span class="hljs-function">Page&lt;T&gt; <span class="hljs-title">findAll</span><span class="hljs-params">(Pageable pageable)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要访问</font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">页面大小为 20</font><font style="vertical-align: inherit;">的第二页</font><font style="vertical-align: inherit;">，您可以执行以下操作：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">PagingAndSortingRepository&lt;User, Long&gt; repository = <span class="hljs-comment">// … get access to a bean</span>
Page&lt;User&gt; users = repository.findAll(PageRequest.of(<span class="hljs-number">1</span>, <span class="hljs-number">20</span>));</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了查询方法，计数和删除查询的查询派生也是可用的。</font><font style="vertical-align: inherit;">以下列表显示了派生计数查询的接口定义：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 5. 派生计数查询</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">countByLastname</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下清单显示了派生删除查询的接口定义：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 6. 派生删除查询</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">deleteByLastname</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
<font></font>
  <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">removeByLastname</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories.query-methods"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2. </font><font style="vertical-align: inherit;">查询方法</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准 CRUD 功能存储库通常对底层数据存储进行查询。</font><font style="vertical-align: inherit;">使用 Spring Data，声明这些查询变成了一个四步过程：</font></font></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明一个扩展 Repository 或其子接口之一的接口，并将其键入它应该处理的域类和 ID 类型，如以下示例所示：</font></font></p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在接口上声明查询方法。</font></font></p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 Spring 以使用</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances.java-config"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaConfig</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML 配置</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为这些接口创建代理实例</font><font style="vertical-align: inherit;">。</font></font></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用 Java 配置，请创建一个类似于以下内容的类：</font></font></p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.config.EnableJpaRepositories;<font></font>
<font></font>
<span class="hljs-meta">@EnableJpaRepositories</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{ … }</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用 XML 配置，请定义一个类似于以下内容的 bean：</font></font></p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
   <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
   <span class="hljs-attr">xmlns:jpa</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/jpa"</span>
   <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
     https://www.springframework.org/schema/beans/spring-beans.xsd
     http://www.springframework.org/schema/data/jpa
     https://www.springframework.org/schema/data/jpa/spring-jpa.xsd"</span>&gt;</span><font></font>
<font></font>
   <span class="hljs-tag">&lt;<span class="hljs-name">jpa:repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repositories"</span>/&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本示例中使用了 JPA 命名空间。</font><font style="vertical-align: inherit;">如果您对任何其他商店使用存储库抽象，则需要将其更改为商店模块的适当命名空间声明。</font><font style="vertical-align: inherit;">换句话说，您应该交换</font></font><code>jpa</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以支持，例如</font></font><code>mongodb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另请注意，JavaConfig 变体并未显式配置包，因为默认情况下使用带注释的类的包。</font><font style="vertical-align: inherit;">要自定义要扫描的包，请使用</font></font><code>basePackage…</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定于数据存储的存储库的 -</font></font><code>@Enable${store}Repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">属性之一</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注入存储库实例并使用它，如以下示例所示：</font></font></p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeClient</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> PersonRepository repository;<font></font>
<font></font>
  SomeClient(PersonRepository repository) {<font></font>
    <span class="hljs-keyword">this</span>.repository = repository;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span> </span>{<font></font>
    List&lt;Person&gt; persons = repository.findByLastname(<span class="hljs-string">"Matthews"</span>);<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下部分详细解释了每个步骤：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.definition"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义存储库接口</font></font></a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods.details"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义查询方法</font></font></a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建存储库实例</font></font></a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.custom-implementations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Repositories 的自定义实现</font></font></a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="repositories.definition"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.definition"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3. </font><font style="vertical-align: inherit;">定义存储库接口</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要定义存储库接口，首先需要定义特定于域类的存储库接口。</font><font style="vertical-align: inherit;">接口必须扩展</font></font><code>Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并键入域类和 ID 类型。</font><font style="vertical-align: inherit;">如果要公开该域类型的 CRUD 方法，请使用扩展</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是</font></font><code>Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
<div class="sect3">
<h4 id="repositories.definition-tuning"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.definition-tuning"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3.1. </font><font style="vertical-align: inherit;">微调存储库定义</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常情况下，你的资料库接口扩展</font></font><code>Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>PagingAndSortingRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">或者，如果您不想扩展 Spring Data 接口，也可以使用</font></font><code>@RepositoryDefinition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">扩展</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公开了一套完整的方法来操作您的实体。</font><font style="vertical-align: inherit;">如果您更愿意选择公开的方法，请将要公开的方法复制</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到域存储库中。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这样做可以让您在提供的 Spring Data Repositories 功能之上定义自己的抽象。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的示例示出了如何以选择性地露出CRUD方法（</font></font><code>findById</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在这种情况下）：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 7. 有选择地公开 CRUD 方法</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@NoRepositoryBean</span>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function">Optional&lt;T&gt; <span class="hljs-title">findById</span><span class="hljs-params">(ID id)</span></span>;<font></font>
<font></font>
  &lt;S extends T&gt; <span class="hljs-function">S <span class="hljs-title">save</span><span class="hljs-params">(S entity)</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{
  <span class="hljs-function">User <span class="hljs-title">findByEmailAddress</span><span class="hljs-params">(EmailAddress emailAddress)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在前面的例子，你定义为所有站点库一个共同的基础界面和暴露</font></font><code>findById(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以及</font></font><code>save(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这些方法被发送到基础信息库实现你所选择的由Spring提供的数据（例如，如果使用JPA商店，实现是</font></font><code>SimpleJpaRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)，因为它们匹配 中的方法签名</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所以</font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在可以保存用户，通过 ID 查找单个用户，并触发查询以</font></font><code>Users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过电子邮件地址</font><font style="vertical-align: inherit;">查找</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
中间存储库接口用</font></font><code>@NoRepositoryBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">确保将该注释添加到 Spring Data 不应在运行时为其创建实例的所有存储库接口。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="repositories.multiple-modules"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.multiple-modules"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3.2. </font><font style="vertical-align: inherit;">使用具有多个 Spring 数据模块的存储库</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在您的应用程序中使用唯一的 Spring Data 模块会使事情变得简单，因为定义范围内的所有存储库接口都绑定到 Spring Data 模块。</font><font style="vertical-align: inherit;">有时，应用程序需要使用多个 Spring Data 模块。</font><font style="vertical-align: inherit;">在这种情况下，存储库定义必须区分持久性技术。</font><font style="vertical-align: inherit;">当在类路径上检测到多个存储库工厂时，Spring Data 进入严格的存储库配置模式。</font><font style="vertical-align: inherit;">严格配置使用存储库或域类的详细信息来决定存储库定义的 Spring Data 模块绑定：</font></font></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果存储库定义</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.multiple-modules.types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展了特定于模块的存储库</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则它是特定 Spring Data 模块的有效候选者。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果域类</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.multiple-modules.annotations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用特定于模块的类型注释进行注释</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则它是特定 Spring Data 模块的有效候选者。</font><font style="vertical-align: inherit;">Spring Data 模块接受第三方注解（例如 JPA's </font></font><code>@Entity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）或提供自己的注解（例如</font></font><code>@Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data MongoDB 和 Spring Data Elasticsearch）。</font></font></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了使用特定于模块的接口（在本例中为 JPA）的存储库：</font></font></p>
</div>
<div id="repositories.multiple-modules.types" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 8. 使用模块特定接口的存储库定义</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{ }<font></font>
<font></font>
<span class="hljs-meta">@NoRepositoryBean</span>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{ … }<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>MyRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font><font style="vertical-align: inherit;">在它们的类型层次结构中</font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展</font></font><code>JpaRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它们是 Spring Data JPA 模块的有效候选者。</font></font></p>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了使用通用接口的存储库：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 9. 使用通用接口的存储库定义</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AmbiguousRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }<font></font>
<font></font>
<span class="hljs-meta">@NoRepositoryBean</span>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{ … }<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AmbiguousUserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>AmbiguousRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>AmbiguousUserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅延伸</font></font><code>Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在他们的类型层次。</font><font style="vertical-align: inherit;">虽然这在使用唯一的 Spring Data 模块时很好，但多个模块无法区分这些存储库应该绑定到哪个特定的 Spring Data。</font></font></p>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了使用带注释的域类的存储库：</font></font></p>
</div>
<div id="repositories.multiple-modules.annotations" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 10. 使用带有注释的域类的存储库定义</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }<font></font>
<font></font>
<span class="hljs-meta">@Entity</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{ … }<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }<font></font>
<font></font>
<span class="hljs-meta">@Document</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{ … }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>PersonRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">References </font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它用 JPA</font></font><code>@Entity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">进行了</font><font style="vertical-align: inherit;">注释，所以这个存储库显然属于 Spring Data JPA。</font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">References </font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使用 Spring Data MongoDB 的</font></font><code>@Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注解进行注解。</font></font></p>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下错误示例显示了使用具有混合注释的域类的存储库：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 11. 使用带有混合注释的域类的存储库定义</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">JpaPersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MongoDBPersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }<font></font>
<font></font>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Document</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{ … }</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例显示使用 JPA 和 Spring Data MongoDB 注释的域类。</font><font style="vertical-align: inherit;">它定义了两个存储库，</font></font><code>JpaPersonRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><code>MongoDBPersonRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">一个用于 JPA，另一个用于 MongoDB。</font><font style="vertical-align: inherit;">Spring Data 不再能够区分存储库，这会导致未定义的行为。</font></font></p>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.multiple-modules.types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库类型详细信息</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.multiple-modules.annotations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">区分域类注释</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于严格的存储库配置，以识别特定 Spring Data 模块的存储库候选者。</font><font style="vertical-align: inherit;">在同一域类型上使用多个特定于持久性技术的注释是可能的，并且允许跨多个持久性技术重用域类型。</font><font style="vertical-align: inherit;">但是，Spring Data 无法再确定与存储库绑定的唯一模块。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">区分存储库的最后一种方法是确定存储库基础包的范围。</font><font style="vertical-align: inherit;">基础包定义了扫描存储库接口定义的起点，这意味着存储库定义位于适当的包中。</font><font style="vertical-align: inherit;">默认情况下，注解驱动的配置使用配置类的包。</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances.spring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 XML 的配置中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances.spring"><font style="vertical-align: inherit;">基本包</font></a><font style="vertical-align: inherit;">是必需的。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了基础包的注释驱动配置：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 12. 基础包的注解驱动配置</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@EnableJpaRepositories(basePackages = "com.acme.repositories.jpa")</span>
<span class="hljs-meta">@EnableMongoRepositories(basePackages = "com.acme.repositories.mongo")</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Configuration</span> </span>{ … }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories.query-methods.details"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods.details"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4. </font><font style="vertical-align: inherit;">定义查询方法</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库代理有两种方法可以从方法名称派生特定于商店的查询：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过直接从方法名称派生查询。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过使用手动定义的查询。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用选项取决于实际商店。</font><font style="vertical-align: inherit;">但是，必须有一个策略来决定创建什么实际查询。</font><font style="vertical-align: inherit;">下一节描述了可用的选项。</font></font></p>
</div>
<div class="sect3">
<h4 id="repositories.query-methods.query-lookup-strategies"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods.query-lookup-strategies"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.1. </font><font style="vertical-align: inherit;">查询查找策略</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下策略可用于存储库基础结构来解析查询。</font><font style="vertical-align: inherit;">通过 XML 配置，您可以通过</font></font><code>query-lookup-strategy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">在命名空间配置策略</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于 Java 配置，您可以使用</font><font style="vertical-align: inherit;">注解</font><font style="vertical-align: inherit;">的</font></font><code>queryLookupStrategy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font><code>Enable${store}Repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">特定数据存储可能不支持某些策略。</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CREATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试从查询方法名称构造特定于商店的查询。</font><font style="vertical-align: inherit;">一般的方法是从方法名称中删除一组给定的众所周知的前缀并解析方法的其余部分。</font><font style="vertical-align: inherit;">您可以在“</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods.query-creation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询创建</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”中</font><font style="vertical-align: inherit;">阅读有关查询构造的更多信息</font><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><code>USE_DECLARED_QUERY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试查找已声明的查询，如果找不到则抛出异常。</font><font style="vertical-align: inherit;">查询可以由某个地方的注释定义或通过其他方式声明。</font><font style="vertical-align: inherit;">请参阅特定商店的文档以查找该商店​​的可用选项。</font><font style="vertical-align: inherit;">如果存储库基础结构在引导时未找到该方法的声明查询，则它会失败。</font></font></p>
</li>
<li>
<p><code>CREATE_IF_NOT_FOUND</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认）结合</font></font><code>CREATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>USE_DECLARED_QUERY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它首先查找声明的查询，如果没有找到声明的查询，它会创建一个自定义的基于方法名称的查询。</font><font style="vertical-align: inherit;">这是默认的查找策略，因此，如果您没有明确配置任何内容，就会使用它。</font><font style="vertical-align: inherit;">它允许按方法名称快速定义查询，还允许通过根据需要引入声明的查询来自定义这些查询。</font></font></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="repositories.query-methods.query-creation"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods.query-creation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.2. </font><font style="vertical-align: inherit;">查询创建</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data 存储库基础结构中内置的查询构建器机制对于构建对存储库实体的约束查询非常有用。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了如何创建多个查询：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 13. 从方法名称创建查询</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByEmailAddressAndLastname</span><span class="hljs-params">(EmailAddress emailAddress, String lastname)</span></span>;<font></font>
<font></font>
  <span class="hljs-comment">// Enables the distinct flag for the query</span>
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findDistinctPeopleByLastnameOrFirstname</span><span class="hljs-params">(String lastname, String firstname)</span></span>;
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findPeopleDistinctByLastnameOrFirstname</span><span class="hljs-params">(String lastname, String firstname)</span></span>;<font></font>
<font></font>
  <span class="hljs-comment">// Enabling ignoring case for an individual property</span>
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByLastnameIgnoreCase</span><span class="hljs-params">(String lastname)</span></span>;
  <span class="hljs-comment">// Enabling ignoring case for all suitable properties</span>
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByLastnameAndFirstnameAllIgnoreCase</span><span class="hljs-params">(String lastname, String firstname)</span></span>;<font></font>
<font></font>
  <span class="hljs-comment">// Enabling static ORDER BY for a query</span>
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByLastnameOrderByFirstnameAsc</span><span class="hljs-params">(String lastname)</span></span>;
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByLastnameOrderByFirstnameDesc</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析查询方法名称分为主语和谓语。</font><font style="vertical-align: inherit;">第一部分 ( </font></font><code>find…By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>exists…By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) 定义查询的主题，第二部分构成谓词。</font><font style="vertical-align: inherit;">介绍从句（主语）可以包含进一步的表达。</font></font><code>find</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或其他引入关键字）和</font><font style="vertical-align: inherit;">之间的任何文本都</font></font><code>By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被认为是描述性的，除非使用结果限制关键字之一，例如</font></font><code>Distinct</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在要创建的查询上设置不同的标志或</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.limit-query-result"><code>Top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font><code>First</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以限制查询结果</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录包含</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#appendix.query.method.subject"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询方法主题关键字</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#appendix.query.method.predicate"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询方法谓词关键字</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#appendix.query.method.subject"><font style="vertical-align: inherit;">完整列表，</font></a><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#appendix.query.method.predicate"><font style="vertical-align: inherit;">包括排序和字母大小写修饰符</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，第一个</font></font><code>By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">充当分隔符以指示实际条件谓词的开始。</font><font style="vertical-align: inherit;">在非常基础的层面上，您可以定义实体属性的条件并将它们与</font></font><code>And</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">连接起来</font></font><code>Or</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析方法的实际结果取决于您为其创建查询的持久性存储。</font><font style="vertical-align: inherit;">但是，有一些一般的事情需要注意：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式通常是与可以连接的运算符相结合的属性遍历。</font><font style="vertical-align: inherit;">您可以将属性表达式与</font></font><code>AND</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">结合使用</font></font><code>OR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您还可以得到这样的运营商为支撑</font></font><code>Between</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>LessThan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>GreaterThan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code>Like</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该属性的表达式。</font><font style="vertical-align: inherit;">受支持的运算符可能因数据存储而异，因此请参阅参考文档的相应部分。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法解析器支持</font></font><code>IgnoreCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为单个属性（例如</font></font><code>findByLastnameIgnoreCase(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）或支持忽略大小写的类型（通常是</font></font><code>String</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例，例如</font></font><code>findByLastnameAndFirstnameAllIgnoreCase(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">所有属性</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">标志</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">是否支持忽略大小写可能因商店而异，因此请参阅参考文档中的相关部分以了解商店特定的查询方法。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以通过将</font></font><code>OrderBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">附加</font><font style="vertical-align: inherit;">到引用属性的查询方法并提供排序方向（</font></font><code>Asc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>Desc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">来应用静态排序</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要创建支持动态排序的查询方法，请参阅“</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.special-parameters"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特殊参数处理</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”。</font></font></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="repositories.query-methods.query-property-expressions"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods.query-property-expressions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.3. </font><font style="vertical-align: inherit;">属性表达式</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性表达式只能引用托管实体的直接属性，如前面的示例所示。</font><font style="vertical-align: inherit;">在创建查询时，您已经确保解析的属性是托管域类的属性。</font><font style="vertical-align: inherit;">但是，您也可以通过遍历嵌套属性来定义约束。</font><font style="vertical-align: inherit;">考虑以下方法签名：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByAddressZipCode</span><span class="hljs-params">(ZipCode zipCode)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设 a</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有</font></font><code>Address</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code>ZipCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，该方法会创建</font></font><code>x.address.zipCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性遍历。</font><font style="vertical-align: inherit;">解析算法首先将整个部分 ( </font></font><code>AddressZipCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font><font style="vertical-align: inherit;">解释</font><font style="vertical-align: inherit;">为属性并检查具有该名称（未大写）的属性的域类。</font><font style="vertical-align: inherit;">如果算法成功，它将使用该属性。</font><font style="vertical-align: inherit;">如果不是，则算法将来自右侧的驼峰式部分的源分成头部和尾部，并尝试找到相应的属性 - 在我们的示例中，</font></font><code>AddressZip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Code</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果算法找到具有该头部的属性，它会取尾部并继续从那里向下构建树，以刚才描述的方式将尾部拆分。</font><font style="vertical-align: inherit;">如果第一个分割不匹配，算法将分割点向左移动 ( </font></font><code>Address</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>ZipCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) 并继续。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管这应该适用于大多数情况，但算法可能会选择错误的属性。</font><font style="vertical-align: inherit;">假设这个</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类也有一个</font></font><code>addressZip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性。</font><font style="vertical-align: inherit;">该算法将在第一个分割轮中匹配，选择错误的属性，并失败（因为 的类型</font></font><code>addressZip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能没有</font></font><code>code</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性）。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要解决这种歧义，您可以</font></font><code>_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在方法名称中使用手动定义遍历点。</font><font style="vertical-align: inherit;">所以我们的方法名称如下：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByAddress_ZipCode</span><span class="hljs-params">(ZipCode zipCode)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为我们将下划线字符视为保留字符，所以我们强烈建议遵循标准的 Java 命名约定（即，不要在属性名称中使用下划线，而是使用驼峰式大小写）。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="repositories.special-parameters"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.special-parameters"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.4. </font><font style="vertical-align: inherit;">特殊参数处理</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要处理查询中的参数，请定义方法参数，如前面示例中所示。</font><font style="vertical-align: inherit;">除此之外，基础设施识别某些特定类型，如</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以动态地将分页和排序应用于您的查询。</font><font style="vertical-align: inherit;">以下示例演示了这些功能：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 14.</font><font style="vertical-align: inherit;">在查询方法中</font><font style="vertical-align: inherit;">使用</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>Slice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Sort</code><font style="vertical-align: inherit;"></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">Page&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;<font></font>
<font></font>
<span class="hljs-function">Slice&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;<font></font>
<font></font>
<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Sort sort)</span></span>;<font></font>
<font></font>
<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要的"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
API 接受</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">期望将非</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值传递给方法。</font><font style="vertical-align: inherit;">如果您不想应用任何排序或分页，请使用</font></font><code>Sort.unsorted()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Pageable.unpaged()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一种方法允许您将</font></font><code>org.springframework.data.domain.Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">传递</font><font style="vertical-align: inherit;">给查询方法，以将分页动态添加到静态定义的查询中。</font><font style="vertical-align: inherit;">A</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知道可用的元素和页面的总数。</font><font style="vertical-align: inherit;">它通过基础结构触发计数查询来计算总数。</font><font style="vertical-align: inherit;">由于这可能很昂贵（取决于使用的商店），您可以改为返回</font></font><code>Slice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">A</font></font><code>Slice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只知道下一个</font></font><code>Slice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是否可用，这在遍历更大的结果集时可能就足够了。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">排序选项也通过</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">处理</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您只需要排序，请</font></font><code>org.springframework.data.domain.Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在您的方法中</font><font style="vertical-align: inherit;">添加一个</font><font style="vertical-align: inherit;">参数。</font><font style="vertical-align: inherit;">如您所见，返回 a</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也是可能的。</font><font style="vertical-align: inherit;">在这种情况下，</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会创建</font><font style="vertical-align: inherit;">构建实际</font><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">所需的额外元数据</font><font style="vertical-align: inherit;">（这意味着不会发出本来需要的额外计数查询）。</font><font style="vertical-align: inherit;">相反，它限制查询仅查找给定范围的实体。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要了解整个查询获得了多少页，您必须触发额外的计数查询。</font><font style="vertical-align: inherit;">默认情况下，此查询源自您实际触发的查询。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="repositories.paging-and-sorting"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.paging-and-sorting"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分页和排序</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用属性名称定义简单的排序表达式。</font><font style="vertical-align: inherit;">您可以连接表达式以将多个条件收集到一个表达式中。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 15. 定义排序表达式</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Sort sort = Sort.by(<span class="hljs-string">"firstname"</span>).ascending()<font></font>
  .and(Sort.by(<span class="hljs-string">"lastname"</span>).descending());</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于定义排序表达式的更类型安全的方法，从定义排序表达式的类型开始，并使用方法引用来定义排序的属性。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 16. 使用类型安全 API 定义排序表达式</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">TypedSort&lt;Person&gt; person = Sort.sort(Person.class);<font></font>
<font></font>
Sort sort = person.by(Person::getFirstname).ascending()<font></font>
  .and(person.by(Person::getLastname).descending());</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content">
<code>TypedSort.by(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 通过（通常）使用 CGlib 来使用运行时代理，这可能会在使用 Graal VM Native 等工具时干扰本机映像编译。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您的商店实现支持 Querydsl，您还可以使用生成的元模型类型来定义排序表达式：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 17. 使用 Querydsl API 定义排序表达式</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">QSort sort = QSort.by(QPerson.firstname.asc())<font></font>
  .and(QSort.by(QPerson.lastname.desc()));</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.limit-query-result"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.limit-query-result"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.5. </font><font style="vertical-align: inherit;">限制查询结果</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用</font></font><code>first</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键字</font><font style="vertical-align: inherit;">来限制查询方法的结果</font><font style="vertical-align: inherit;">，这两个关键字可以互换使用。</font><font style="vertical-align: inherit;">您可以将一个可选的数值附加到</font></font><code>top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>first</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定要返回的最大结果大小。</font><font style="vertical-align: inherit;">如果忽略该数字，则假定结果大小为 1。</font><font style="vertical-align: inherit;">以下示例显示了如何限制查询大小：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 18. 使用</font></font><code>Top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">限制查询的结果大小</font></font><code>First</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">User <span class="hljs-title">findFirstByOrderByLastnameAsc</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
<span class="hljs-function">User <span class="hljs-title">findTopByOrderByAgeDesc</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
<span class="hljs-function">Page&lt;User&gt; <span class="hljs-title">queryFirst10ByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;<font></font>
<font></font>
<span class="hljs-function">Slice&lt;User&gt; <span class="hljs-title">findTop3ByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;<font></font>
<font></font>
<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findFirst10ByLastname</span><span class="hljs-params">(String lastname, Sort sort)</span></span>;<font></font>
<font></font>
<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findTop10ByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制表达式还支持</font></font><code>Distinct</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持不同查询的数据存储</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">关键字。</font><font style="vertical-align: inherit;">此外，对于将结果集限制为一个实例的查询，</font></font><code>Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持</font><font style="vertical-align: inherit;">将结果用</font><font style="vertical-align: inherit;">关键字</font><font style="vertical-align: inherit;">包装</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果分页或切片应用于限制查询分页（以及可用页数的计算），则在受限结果内应用。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过使用</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">限制结果与动态排序相结合，</font><font style="vertical-align: inherit;">您可以表达“K”最小元素和“K”最大元素的查询方法。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="repositories.collections-and-iterables"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.collections-and-iterables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.6. </font><font style="vertical-align: inherit;">返回集合或可迭代对象的存储库方法</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询方法，返回多个结果可以使用标准的Java </font></font><code>Iterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除此之外，我们还支持返回 Spring Data 的</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、 的自定义扩展</font></font><code>Iterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><a href="https://www.vavr.io/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vavr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供的集合类型</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅解释所有可能的</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#appendix.query.return.types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询方法返回类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的附录</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect4">
<h5 id="repositories.collections-and-iterables.streamable"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.collections-and-iterables.streamable"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Streamable 作为查询方法返回类型</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用</font><font style="vertical-align: inherit;">任何集合类型的</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">替代</font></font><code>Iterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">品。</font><font style="vertical-align: inherit;">它提供了访问非并行</font></font><code>Stream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（缺少 from </font></font><code>Iterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">便捷方法，</font><font style="vertical-align: inherit;">以及直接</font></font><code>….filter(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>….map(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">覆盖元素并将其连接</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到其他</font><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">的能力</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 19. 使用 Streamable 组合查询方法结果</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{
  <span class="hljs-function">Streamable&lt;Person&gt; <span class="hljs-title">findByFirstnameContaining</span><span class="hljs-params">(String firstname)</span></span>;
  <span class="hljs-function">Streamable&lt;Person&gt; <span class="hljs-title">findByLastnameContaining</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
}<font></font>
<font></font>
Streamable&lt;Person&gt; result = repository.findByFirstnameContaining(<span class="hljs-string">"av"</span>)<font></font>
  .and(repository.findByLastnameContaining(<span class="hljs-string">"ea"</span>));</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="repositories.collections-and-iterables.streamable-wrapper"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.collections-and-iterables.streamable-wrapper"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回自定义流包装器类型</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为集合提供专用包装器类型是一种常用模式，用于为返回多个元素的查询结果提供 API。</font><font style="vertical-align: inherit;">通常，通过调用存储库方法返回类集合类型并手动创建包装器类型的实例来使用这些类型。</font><font style="vertical-align: inherit;">您可以避免该额外步骤，因为 Spring Data 允许您将这些包装器类型用作查询方法返回类型，前提是它们满足以下条件：</font></font></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型实现</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的类型公开任一个构造或命名静态工厂法</font></font><code>of(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>valueOf(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该取</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为参数。</font></font></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下清单显示了一个示例：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Product</span> </span>{                                         <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
  <span class="hljs-function">MonetaryAmount <span class="hljs-title">getPrice</span><span class="hljs-params">()</span> </span>{ … }<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@RequiredArgsConstructor(staticName = "of")</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Products</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Streamable</span>&lt;<span class="hljs-title">Product</span>&gt; </span>{         <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Streamable&lt;Product&gt; streamable;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> MonetaryAmount <span class="hljs-title">getTotal</span><span class="hljs-params">()</span> </span>{                    <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
    <span class="hljs-keyword">return</span> streamable.stream()<font></font>
      .map(Priced::getPrice)<font></font>
      .reduce(Money.of(<span class="hljs-number">0</span>), MonetaryAmount::add);<font></font>
  }<font></font>
<font></font>
<font></font>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> Iterator&lt;Product&gt; <span class="hljs-title">iterator</span><span class="hljs-params">()</span> </span>{                 <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b>
    <span class="hljs-keyword">return</span> streamable.iterator();<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ProductRepository</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Product</span>, <span class="hljs-title">Long</span>&gt; </span>{
  <span class="hljs-function">Products <span class="hljs-title">findAllByDescriptionContaining</span><span class="hljs-params">(String text)</span></span>; <i class="conum" data-value="5"></i><b>(<span class="hljs-number">5</span>)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code>Product</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">暴露的API来访问产品的价格实体。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><font style="vertical-align: inherit;"></font><code>Streamable&lt;Product&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过使用</font></font><code>Products.of(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（使用 Lombok 注释创建的工厂方法）</font><font style="vertical-align: inherit;">构造的</font><font style="vertical-align: inherit;">的包装器类型</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">采用</font></font><code>Streamable&lt;Product&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will 的</font><font style="vertical-align: inherit;">标准构造函数</font><font style="vertical-align: inherit;">也可以。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包装器类型公开了一个额外的 API，在</font></font><code>Streamable&lt;Product&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口并委托给实际结果。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该包装器类型</font></font><code>Products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以直接用作查询方法返回类型。</font><font style="vertical-align: inherit;">您不需要</font></font><code>Streamable&lt;Product&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在存储库客户端中的查询之后</font><font style="vertical-align: inherit;">返回</font><font style="vertical-align: inherit;">并手动包装它。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="repositories.collections-and-iterables.vavr"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.collections-and-iterables.vavr"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持 Vavr 集合</font></font></h5>
<div class="paragraph">
<p><a href="https://www.vavr.io/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vavr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个包含 Java 函数式编程概念的库。</font><font style="vertical-align: inherit;">它附带一组自定义集合类型，您可以将其用作查询方法返回类型，如下表所示：</font></font></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vavr 集合类型</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用的 Vavr 实现类型</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效的 Java 源类型</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.Seq</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Iterable</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.Set</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.LinkedHashSet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Iterable</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.Map</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.LinkedHashMap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Map</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用第一列（或其子类型）中的类型作为查询方法返回类型，并根据实际查询结果（第三列）的 Java 类型获取第二列中的类型作为实现类型。</font><font style="vertical-align: inherit;">或者，您可以声明</font></font><code>Traversable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><code>Iterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相当于</font><font style="vertical-align: inherit;">Vavr </font><font style="vertical-align: inherit;">），然后我们从实际返回值派生实现类。</font><font style="vertical-align: inherit;">也就是说， a</font></font><code>java.util.List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变成了 Vavr</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>Seq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">， a</font></font><code>java.util.Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变成了 Vavr </font></font><code>LinkedHashSet</code> <code>Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，依此类推。</font></font></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.nullability"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.nullability"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.7. </font><font style="vertical-align: inherit;">存储库方法的空处理</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 Spring Data 2.0 开始，返回单个聚合实例的存储库 CRUD 方法使用 Java 8</font></font><code>Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来指示可能缺少值。</font><font style="vertical-align: inherit;">除此之外，Spring Data 支持在查询方法上返回以下包装器类型：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>com.google.common.base.Optional</code></p>
</li>
<li>
<p><code>scala.Option</code></p>
</li>
<li>
<p><code>io.vavr.control.Option</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，查询方法可以选择根本不使用包装器类型。</font><font style="vertical-align: inherit;">然后通过返回来指示不存在查询结果</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">返回集合、集合替代、包装器和流的存储库方法保证永远不会返回</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而是</font><font style="vertical-align: inherit;">返回</font><font style="vertical-align: inherit;">相应的空表示。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息，</font><font style="vertical-align: inherit;">请参阅“</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repository-query-return-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库查询返回类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”。</font></font></p>
</div>
<div class="sect4">
<h5 id="repositories.nullability.annotations"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.nullability.annotations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可空性注释</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用</font></font><a href="https://docs.spring.io/spring-framework/docs/5.3.9/reference/html/core.html#null-safety"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Framework 的可空性注释</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来表达存储库方法的可空性约束</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它们</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在运行时</font><font style="vertical-align: inherit;">提供了一种工具友好的方法和选择加入</font><font style="vertical-align: inherit;">检查，如下所示：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.9/javadoc-api/org/springframework/lang/NonNullApi.html"><code>@NonNullApi</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 在包级别上用于声明参数和返回值的默认行为分别是既不接受也不产生</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。</font></font></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.9/javadoc-api/org/springframework/lang/NonNull.html"><code>@NonNull</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 用于不得为的参数或返回值</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在</font></font><code>@NonNullApi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用</font><font style="vertical-align: inherit;">的参数和返回值上不需要</font><font style="vertical-align: inherit;">）。</font></font></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.9/javadoc-api/org/springframework/lang/Nullable.html"><code>@Nullable</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 用于可以是的参数或返回值</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring 注释使用</font></font><a href="https://jcp.org/en/jsr/detail?id=305"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 305</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释（一种休眠但广泛使用的 JSR）</font><font style="vertical-align: inherit;">进行元注释</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">JSR 305 元注释让工具供应商（例如</font></font><a href="https://www.jetbrains.com/help/idea/nullable-and-notnull-annotations.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDEA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://help.eclipse.org/oxygen/index.jsp?topic=/org.eclipse.jdt.doc.user/tasks/task-using_external_null_annotations.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eclipse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://kotlinlang.org/docs/reference/java-interop.html#null-safety-and-platform-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kotlin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）以通用方式提供空安全支持，而无需对 Spring 注释进行硬编码支持。</font><font style="vertical-align: inherit;">要为查询方法启用可空性约束的运行时检查，您需要使用 Spring 的</font></font><code>@NonNullApi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in</font><font style="vertical-align: inherit;">在包级别激活非可空性</font></font><code>package-info.java</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 20. 在 </font></font><code>package-info.java</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@org</span>.springframework.lang.NonNullApi
<span class="hljs-keyword">package</span> com.acme;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦非空默认设置到位，存储库查询方法调用将在运行时验证为可空性约束。</font><font style="vertical-align: inherit;">如果查询结果违反了定义的约束，则抛出异常。</font><font style="vertical-align: inherit;">当该方法将返回</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但被声明为不可为空时（在存储库所在的包上定义的默认注释），</font><font style="vertical-align: inherit;">就会发生这种情况</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您想再次选择可空结果，请有选择地使用</font></font><code>@Nullable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单个方法。</font><font style="vertical-align: inherit;">使用本节开头提到的结果包装器类型继续按预期工作：空结果被转换为表示不存在的值。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了刚刚描述的许多技术：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 21. 使用不同的可空性约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">package</span> com.acme;                                                       <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
<font></font>
<span class="hljs-keyword">import</span> org.springframework.lang.Nullable;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function">User <span class="hljs-title">getByEmailAddress</span><span class="hljs-params">(EmailAddress emailAddress)</span></span>;                    <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
  <span class="hljs-meta">@Nullable</span>
  <span class="hljs-function">User <span class="hljs-title">findByEmailAddress</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> EmailAddress emailAdress)</span></span>;          <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b><font></font>
<font></font>
  <span class="hljs-function">Optional&lt;User&gt; <span class="hljs-title">findOptionalByEmailAddress</span><span class="hljs-params">(EmailAddress emailAddress)</span></span>; <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库驻留在我们定义了非空行为的包（或子包）中。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><font style="vertical-align: inherit;"></font><code>EmptyResultDataAccessException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当查询未产生结果时</font><font style="vertical-align: inherit;">抛出</font><font style="vertical-align: inherit;">。</font></font><code>IllegalArgumentException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当</font></font><code>emailAddress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递给方法是</font><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">抛出</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><font style="vertical-align: inherit;"></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当查询未产生结果时</font><font style="vertical-align: inherit;">返回</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">也接受</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为 的值</font></font><code>emailAddress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><font style="vertical-align: inherit;"></font><code>Optional.empty()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当查询未产生结果时</font><font style="vertical-align: inherit;">返回</font><font style="vertical-align: inherit;">。</font></font><code>IllegalArgumentException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当</font></font><code>emailAddress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递给方法是</font><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">抛出</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="repositories.nullability.kotlin"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.nullability.kotlin"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 Kotlin 的存储库中的可空性</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kotlin</font><font style="vertical-align: inherit;">在语言中</font><font style="vertical-align: inherit;">定义了可</font></font><a href="https://kotlinlang.org/docs/reference/null-safety.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空性约束</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Kotlin 代码编译为字节码，它不通过方法签名而是通过编译元数据来表达可空性约束。</font><font style="vertical-align: inherit;">确保</font></font><code>kotlin-reflect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在您的项目中</font><font style="vertical-align: inherit;">包含</font><font style="vertical-align: inherit;">JAR 以启用对 Kotlin 的可空性约束的内省。</font><font style="vertical-align: inherit;">Spring Data 存储库使用语言机制来定义这些约束以应用相同的运行时检查，如下所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 22.在 Kotlin 存储库上使用可空性约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> : <span class="hljs-type">Repository</span>&lt;<span class="hljs-type">User, String</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">findByUsername</span><span class="hljs-params">(username: <span class="hljs-type">String</span>)</span></span>: User     <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">findByFirstname</span><span class="hljs-params">(firstname: <span class="hljs-type">String</span>?)</span></span>: User? <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该方法将参数和结果都定义为不可为空（Kotlin 默认值）。</font><font style="vertical-align: inherit;">Kotlin 编译器拒绝传递</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给方法的</font><font style="vertical-align: inherit;">方法调用</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果查询产生空结果，</font></font><code>EmptyResultDataAccessException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则抛出</font><font style="vertical-align: inherit;">an </font><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该方法接受</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>firstname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数，并返回</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果查询不产生结果。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.query-streaming"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-streaming"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.8. </font><font style="vertical-align: inherit;">流式查询结果</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用 Java 8</font></font><code>Stream&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为返回类型以</font><font style="vertical-align: inherit;">增量方式处理查询方法的结果</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">不是将查询结果包装在 a 中</font></font><code>Stream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而是使用数据存储特定的方法来执行流式传输，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 23. 使用 Java 8 流式传输查询结果 </font></font><code>Stream&lt;T&gt;</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Query("select u from User u")</span>
<span class="hljs-function">Stream&lt;User&gt; <span class="hljs-title">findAllByCustomQueryAndStream</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
<span class="hljs-function">Stream&lt;User&gt; <span class="hljs-title">readAllByFirstnameNotNull</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
<span class="hljs-meta">@Query("select u from User u")</span>
<span class="hljs-function">Stream&lt;User&gt; <span class="hljs-title">streamAllPaged</span><span class="hljs-params">(Pageable pageable)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A</font></font><code>Stream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">潜在地包装了底层数据存储特定的资源，因此必须在使用后关闭。</font><font style="vertical-align: inherit;">您可以</font></font><code>Stream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>close()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法或使用 Java 7</font></font><code>try-with-resources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块</font><font style="vertical-align: inherit;">手动关闭</font><font style="vertical-align: inherit;">，如以下示例所示：
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 24.</font></font><code>Stream&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>try-with-resources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块中处理</font><font style="vertical-align: inherit;">结果</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">try</span> (Stream&lt;User&gt; stream = repository.findAllByCustomQueryAndStream()) {<font></font>
  stream.forEach(…);<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
并非所有 Spring Data 模块当前都支持</font></font><code>Stream&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为返回类型。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="repositories.query-async"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-async"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.9. </font><font style="vertical-align: inherit;">异步查询结果</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用</font></font><a href="https://docs.spring.io/spring-framework/docs/5.3.9/reference/html/integration.html#scheduling"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring 的异步方法运行能力异步</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行存储库查询</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这意味着该方法在调用时立即返回，而实际查询发生在已提交给 Spring 的任务中</font></font><code>TaskExecutor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">异步查询不同于反应式查询，不应混合使用。</font><font style="vertical-align: inherit;">有关反应式支持的更多详细信息，请参阅商店特定的文档。</font><font style="vertical-align: inherit;">以下示例显示了一些异步查询：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Async</span>
<span class="hljs-function">Future&lt;User&gt; <span class="hljs-title">findByFirstname</span><span class="hljs-params">(String firstname)</span></span>;               <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
<font></font>
<span class="hljs-meta">@Async</span>
<span class="hljs-function">CompletableFuture&lt;User&gt; <span class="hljs-title">findOneByFirstname</span><span class="hljs-params">(String firstname)</span></span>; <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
<span class="hljs-meta">@Async</span>
<span class="hljs-function">ListenableFuture&lt;User&gt; <span class="hljs-title">findOneByLastname</span><span class="hljs-params">(String lastname)</span></span>;    <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>java.util.concurrent.Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为返回类型。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Java 8</font></font><code>java.util.concurrent.CompletableFuture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为返回类型。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 a</font></font><code>org.springframework.util.concurrent.ListenableFuture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为返回类型。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories.create-instances"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5. </font><font style="vertical-align: inherit;">创建存储库实例</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节介绍如何为定义的存储库接口创建实例和 bean 定义。一种方法是使用支持存储库机制的每个 Spring Data 模块附带的 Spring 命名空间，尽管我们通常建议使用 Java 配置。</font></font></p>
</div>
<div class="sect3">
<h4 id="repositories.create-instances.spring"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances.spring"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5.1. </font><font style="vertical-align: inherit;">XML 配置</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个 Spring Data 模块都包含一个</font></font><code>repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素，可让您定义 Spring 为您扫描的基本包，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 25. 通过 XML 启用 Spring Data 存储库</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans:beans</span> <span class="hljs-attr">xmlns:beans</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/jpa"</span>
  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/jpa
    https://www.springframework.org/schema/data/jpa/spring-jpa.xsd"</span>&gt;</span><font></font>
<font></font>
  <span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repositories"</span> /&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans:beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在前面的示例中，指示 Spring 扫描</font></font><code>com.acme.repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">及其所有子包以查找扩展</font></font><code>Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的接口或其子接口之一。</font><font style="vertical-align: inherit;">对于找到的每个接口，基础结构注册特定</font></font><code>FactoryBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">于</font><font style="vertical-align: inherit;">持久性技术</font><font style="vertical-align: inherit;">以创建处理查询方法调用的适当代理。</font><font style="vertical-align: inherit;">每个 bean 都在从接口名称派生的 bean 名称下注册，因此 的接口</font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将在 下注册</font></font><code>userRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">嵌套存储库接口的 Bean 名称以其封闭的类型名称为前缀。</font><font style="vertical-align: inherit;">该</font></font><code>base-package</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性允许使用通配符，以便您可以定义扫描包的模式。</font></font></p>
</div>
<div class="sect4">
<h5 id="repositories.using-filters"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.using-filters"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用过滤器</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，基础设施会选择每个接口，这些接口扩展</font></font><code>Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于配置的基本包下的</font><font style="vertical-align: inherit;">持久性技术特定的</font><font style="vertical-align: inherit;">子接口，并为其创建一个 bean 实例。</font><font style="vertical-align: inherit;">但是，您可能希望更精细地控制哪些接口为其创建了 bean 实例。</font><font style="vertical-align: inherit;">为此，请</font><font style="vertical-align: inherit;">在元素内</font><font style="vertical-align: inherit;">使用</font></font><code>&lt;include-filter /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>&lt;exclude-filter /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font></font><code>&lt;repositories /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">语义完全等同于 Spring 上下文命名空间中的元素。</font><font style="vertical-align: inherit;">有关详细信息，请参阅</font><font style="vertical-align: inherit;">这些元素</font><font style="vertical-align: inherit;">的</font></font><a href="https://docs.spring.io/spring-framework/docs/5.3.9/reference/html/core.html#beans-scanning-filters"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring 参考文档</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，要将某些接口从实例化中排除为存储库 bean，您可以使用以下配置：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 26. 使用 exclude-filter 元素</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repositories"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">context:exclude-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"regex"</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">".*SomeRepository"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面的示例排除了所有以</font></font><code>SomeRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例化</font><font style="vertical-align: inherit;">结尾的接口</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.create-instances.java-config"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances.java-config"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5.2. </font><font style="vertical-align: inherit;">Java配置</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您还可以通过</font></font><code>@Enable${store}Repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Java 配置类上</font><font style="vertical-align: inherit;">使用特定</font><font style="vertical-align: inherit;">于</font><font style="vertical-align: inherit;">商店的</font><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">来触发存储库基础</font><font style="vertical-align: inherit;">结构。有关 Spring 容器的基于 Java 的配置的介绍，请参阅</font></font><a href="https://docs.spring.io/spring-framework/docs/5.3.9/reference/html/core.html#beans-java"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring 参考文档中的 JavaConfig</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用 Spring Data 存储库的示例配置类似于以下内容：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 27. 基于注解的存储库配置示例</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableJpaRepositories("com.acme.repositories")</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfiguration</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Bean</span>
  <span class="hljs-function">EntityManagerFactory <span class="hljs-title">entityManagerFactory</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// …</span><font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前面的示例使用特定于 JPA 的注释，您可以根据实际使用的商店模块对其进行更改。这同样适用于</font></font><code>EntityManagerFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bean 的</font><font style="vertical-align: inherit;">定义。请</font><font style="vertical-align: inherit;">参阅涵盖商店特定配置的部分。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="repositories.create-instances.standalone"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances.standalone"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5.3. </font><font style="vertical-align: inherit;">独立使用</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您还可以在 Spring 容器之外使用存储库基础结构 — 例如，在 CDI 环境中。您的类路径中仍然需要一些 Spring 库，但是，通常，您也可以通过编程方式设置存储库。提供存储库的 Spring Data 模块支持附带</font></font><code>RepositoryFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用</font><font style="vertical-align: inherit;">的特定</font><font style="vertical-align: inherit;">于</font><font style="vertical-align: inherit;">持久性技术的技术</font><font style="vertical-align: inherit;">，如下所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 28. 存储库工厂的独立使用</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">RepositoryFactorySupport factory = … <span class="hljs-comment">// Instantiate factory here</span>
UserRepository repository = factory.getRepository(UserRepository.class);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories.custom-implementations"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.custom-implementations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6. </font><font style="vertical-align: inherit;">Spring Data Repositories 的自定义实现</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data 提供了各种选项来创建只需很少编码的查询方法。</font><font style="vertical-align: inherit;">但是当这些选项不符合您的需求时，您还可以为存储库方法提供您自己的自定义实现。</font><font style="vertical-align: inherit;">本节介绍如何做到这一点。</font></font></p>
</div>
<div class="sect3">
<h4 id="repositories.single-repository-behavior"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.single-repository-behavior"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6.1. </font><font style="vertical-align: inherit;">自定义单个存储库</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用自定义功能丰富存储库，您必须首先定义片段接口和自定义功能的实现，如下所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 29. 自定义存储库功能的接口</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CustomizedUserRepository</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">someCustomMethod</span><span class="hljs-params">(User user)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 30. 自定义存储库功能的实现</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomizedUserRepositoryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CustomizedUserRepository</span> </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">someCustomMethod</span><span class="hljs-params">(User user)</span> </span>{
    <span class="hljs-comment">// Your custom implementation</span><font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与片段接口对应的类名中最重要的部分是</font></font><code>Impl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后缀。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现本身不依赖于Spring Data，可以是一个普通的Spring bean。因此，你可以使用标准的依赖注入行为来注入对其他bean（例如a </font></font><code>JdbcTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">引用</font><font style="vertical-align: inherit;">，参与方面等等。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后你可以让你的repository接口扩展fragment接口，如下：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 31. 对存储库界面的更改</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt;, <span class="hljs-title">CustomizedUserRepository</span> </span>{<font></font>
<font></font>
  <span class="hljs-comment">// Declare query methods here</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用您的存储库接口扩展片段接口结合了 CRUD 和自定义功能，并使其可供客户端使用。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data 存储库是通过使用形成存储库组合的片段来实现的。片段是基础存储库、功能方面（例如</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.extensions.querydsl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QueryDsl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）和自定义接口及其实现。</font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.extensions.querydsl"><font style="vertical-align: inherit;">每次</font></a><font style="vertical-align: inherit;">向存储库接口添加接口时，您都可以增强通过添加片段来组合。基本存储库和存储库方面实现由每个 Spring Data 模块提供。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了自定义接口及其实现：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 32. 片段及其实现</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">HumanRepository</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">someHumanMethod</span><span class="hljs-params">(User user)</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HumanRepositoryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HumanRepository</span> </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">someHumanMethod</span><span class="hljs-params">(User user)</span> </span>{
    <span class="hljs-comment">// Your custom implementation</span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ContactRepository</span> </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">someContactMethod</span><span class="hljs-params">(User user)</span></span>;<font></font>
<font></font>
  <span class="hljs-function">User <span class="hljs-title">anotherContactMethod</span><span class="hljs-params">(User user)</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContactRepositoryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ContactRepository</span> </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">someContactMethod</span><span class="hljs-params">(User user)</span> </span>{
    <span class="hljs-comment">// Your custom implementation</span><font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">anotherContactMethod</span><span class="hljs-params">(User user)</span> </span>{
    <span class="hljs-comment">// Your custom implementation</span><font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了扩展的自定义存储库的界面</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 33. 对存储库界面的更改</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt;, <span class="hljs-title">HumanRepository</span>, <span class="hljs-title">ContactRepository</span> </span>{<font></font>
<font></font>
  <span class="hljs-comment">// Declare query methods here</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库可能由按声明顺序导入的多个自定义实现组成。自定义实现比基本实现和存储库方面具有更高的优先级。此顺序允许您覆盖基本存储库和方面方法，并在两个片段贡献相同的方法签名。存储库片段不限于在单个存储库接口中使用。多个存储库可以使用片段接口，让您可以跨不同存储库重用自定义。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了存储库片段及其实现：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 34. 片段覆盖 </font></font><code>save(…)</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CustomizedSave</span>&lt;<span class="hljs-title">T</span>&gt; </span>{<font></font>
  &lt;S extends T&gt; <span class="hljs-function">S <span class="hljs-title">save</span><span class="hljs-params">(S entity)</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomizedSaveImpl</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">CustomizedSave</span>&lt;<span class="hljs-title">T</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-keyword">public</span> &lt;S extends T&gt; <span class="hljs-function">S <span class="hljs-title">save</span><span class="hljs-params">(S entity)</span> </span>{
    <span class="hljs-comment">// Your custom implementation</span><font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了使用上述存储库片段的存储库：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 35. 自定义存储库接口</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt;, <span class="hljs-title">CustomizedSave</span>&lt;<span class="hljs-title">User</span>&gt; </span>{<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt;, <span class="hljs-title">CustomizedSave</span>&lt;<span class="hljs-title">Person</span>&gt; </span>{<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="repositories.configuration"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您使用命名空间配置，存储库基础结构会尝试通过扫描它在其中找到存储库的包下的类来自动检测自定义实现片段。</font><font style="vertical-align: inherit;">这些类需要遵循将命名空间元素的</font></font><code>repository-impl-postfix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">附加</font><font style="vertical-align: inherit;">到片段接口名称</font><font style="vertical-align: inherit;">的命名约定</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此后缀默认为</font></font><code>Impl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">以下示例显示了一个使用默认后缀的存储库和一个为后缀设置自定义值的存储库：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 36. 配置示例</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repository"</span> /&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repository"</span> <span class="hljs-attr">repository-impl-postfix</span>=<span class="hljs-string">"MyPostfix"</span> /&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面示例中的第一个配置尝试查找一个称为</font></font><code>com.acme.repository.CustomizedUserRepositoryImpl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为自定义存储库实现的类。</font><font style="vertical-align: inherit;">第二个示例尝试查找</font></font><code>com.acme.repository.CustomizedUserRepositoryMyPostfix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
<div class="sect5">
<h6 id="repositories.single-repository-behaviour.ambiguity"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.single-repository-behaviour.ambiguity"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解决歧义</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果在不同的包中找到多个具有匹配类名的实现，Spring Data 使用 bean 名称来标识使用哪个。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鉴于</font></font><code>CustomizedUserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面显示</font><font style="vertical-align: inherit;">的以下两个自定义实现</font><font style="vertical-align: inherit;">，使用第一个实现。</font><font style="vertical-align: inherit;">它的 bean 名称是</font></font><code>customizedUserRepositoryImpl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它与片段 interface( </font></font><code>CustomizedUserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) 加上后缀的</font><font style="vertical-align: inherit;">名称</font><font style="vertical-align: inherit;">相匹配</font></font><code>Impl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 37. 解决不明确的实现</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">package</span> com.acme.impl.one;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomizedUserRepositoryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CustomizedUserRepository</span> </span>{<font></font>
<font></font>
  <span class="hljs-comment">// Your custom implementation</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">package</span> com.acme.impl.two;<font></font>
<font></font>
<span class="hljs-meta">@Component("specialCustomImpl")</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomizedUserRepositoryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CustomizedUserRepository</span> </span>{<font></font>
<font></font>
  <span class="hljs-comment">// Your custom implementation</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您使用 注释</font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font></font><code>@Component("specialCustom")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么 bean 名称加号</font></font><code>Impl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与 中为存储库实现定义的</font><font style="vertical-align: inherit;">名称</font><font style="vertical-align: inherit;">相匹配</font></font><code>com.acme.impl.two</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并使用它代替第一个名称。</font></font></p>
</div>
</div>
<div class="sect5">
<h6 id="repositories.manual-wiring"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.manual-wiring"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动接线</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您的自定义实现仅使用基于注解的配置和自动装配，则前面显示的方法效果很好，因为它被视为任何其他 Spring bean。</font><font style="vertical-align: inherit;">如果您的实现片段 bean 需要特殊连接，您可以根据上</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.single-repository-behaviour.ambiguity"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一节中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的约定声明 bean 并为其命名</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后，基础结构按名称引用手动定义的 bean 定义，而不是自己创建一个。</font><font style="vertical-align: inherit;">以下示例显示了如何手动连接自定义实现：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 38. 自定义实现的手动接线</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repository"</span> /&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">beans:bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userRepositoryImpl"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"…"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- further configuration --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans:bean</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.customize-base-repository"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.customize-base-repository"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6.2. </font><font style="vertical-align: inherit;">自定义基础存储库</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当您想要自定义基本存储库行为以便影响所有存储库时</font><font style="vertical-align: inherit;">，上</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.manual-wiring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一节中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的方法</font><font style="vertical-align: inherit;">需要自定义每个存储库接口。</font><font style="vertical-align: inherit;">要改为更改所有存储库的行为，您可以创建一个扩展持久性技术特定存储库基类的实现。</font><font style="vertical-align: inherit;">然后，此类充当存储库代理的自定义基类，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 39.自定义存储库基类</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyRepositoryImpl</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt;
  <span class="hljs-keyword">extends</span> <span class="hljs-title">SimpleJpaRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> EntityManager entityManager;<font></font>
<font></font>
  MyRepositoryImpl(JpaEntityInformation entityInformation,<font></font>
                          EntityManager entityManager) {<font></font>
    <span class="hljs-keyword">super</span>(entityInformation, entityManager);<font></font>
<font></font>
    <span class="hljs-comment">// Keep the EntityManager around to used from the newly introduced methods.</span>
    <span class="hljs-keyword">this</span>.entityManager = entityManager;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@Transactional</span>
  <span class="hljs-keyword">public</span> &lt;S extends T&gt; <span class="hljs-function">S <span class="hljs-title">save</span><span class="hljs-params">(S entity)</span> </span>{
    <span class="hljs-comment">// implementation goes here</span><font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="警告"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该类需要具有特定于商店的存储库工厂实现使用的超类的构造函数。</font><font style="vertical-align: inherit;">如果存储库基类有多个构造函数，则覆盖一个</font></font><code>EntityInformation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加上存储特定基础结构对象（例如一个</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或模板类）的</font><font style="vertical-align: inherit;">构造函数</font><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后一步是让 Spring Data 基础设施知道定制的存储库基类。</font><font style="vertical-align: inherit;">在 Java 配置中，您可以使用</font><font style="vertical-align: inherit;">注解</font><font style="vertical-align: inherit;">的</font></font><code>repositoryBaseClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性来实现</font></font><code>@Enable${store}Repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 40. 使用 JavaConfig 配置自定义存储库基类</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableJpaRepositories(repositoryBaseClass = MyRepositoryImpl.class)</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfiguration</span> </span>{ … }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML 命名空间中提供了相应的属性，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 41. 使用 XML 配置自定义存储库基类</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repository"</span>
     <span class="hljs-attr">base-class</span>=<span class="hljs-string">"….MyRepositoryImpl"</span> /&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="core.domain-events"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.domain-events"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.7. </font><font style="vertical-align: inherit;">从聚合根发布事件</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库管理的实体是聚合根。</font><font style="vertical-align: inherit;">在域驱动设计应用程序中，这些聚合根通常发布域事件。</font><font style="vertical-align: inherit;">Spring Data 提供了一个名为的注释</font></font><code>@DomainEvents</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以在聚合根的方法上使用</font><font style="vertical-align: inherit;">该注释</font><font style="vertical-align: inherit;">，以使该发布尽可能简单，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 42. 从聚合根公开域事件</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnAggregateRoot</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@DomainEvents</span> <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
    <span class="hljs-function">Collection&lt;Object&gt; <span class="hljs-title">domainEvents</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// … return events you want to get published here</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@AfterDomainEventPublication</span> <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">callbackMethod</span><span class="hljs-params">()</span> </span>{
       <span class="hljs-comment">// … potentially clean up domain events list</span><font></font>
    }<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用的方法</font></font><code>@DomainEvents</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以返回单个事件实例或事件集合。</font><font style="vertical-align: inherit;">它不能接受任何论据。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布所有事件后，我们就有了一个用</font></font><code>@AfterDomainEventPublication</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">您可以使用它潜在地清理要发布的事件列表（以及其他用途）。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该方法被称为一个Spring数据存储库的每一次一个</font></font><code>save(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>saveAll(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>delete(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>deleteAll(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法被调用。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="core.extensions"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.extensions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8. </font><font style="vertical-align: inherit;">Spring 数据扩展</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节记录了一组 Spring Data 扩展，这些扩展支持在各种上下文中使用 Spring Data。</font><font style="vertical-align: inherit;">目前，大部分集成都针对 Spring MVC。</font></font></p>
</div>
<div class="sect3">
<h4 id="core.extensions.querydsl"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.extensions.querydsl"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8.1. </font><font style="vertical-align: inherit;">Querydsl 扩展</font></font></h4>
<div class="paragraph">
<p><a href="http://www.querydsl.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Querydsl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个框架，可以通过其流畅的 API 构建静态类型的 SQL 类查询。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">几个 Spring Data 模块通过 提供与 Querydsl 的集成</font></font><code>QuerydslPredicateExecutor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例 43.QuerydslPredicateExecutor 接口</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">QuerydslPredicateExecutor</span>&lt;<span class="hljs-title">T</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function">Optional&lt;T&gt; <span class="hljs-title">findById</span><span class="hljs-params">(Predicate predicate)</span></span>;  <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
<font></font>
  <span class="hljs-function">Iterable&lt;T&gt; <span class="hljs-title">findAll</span><span class="hljs-params">(Predicate predicate)</span></span>;   <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">count</span><span class="hljs-params">(Predicate predicate)</span></span>;            <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">exists</span><span class="hljs-params">(Predicate predicate)</span></span>;        <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b><font></font>
<font></font>
  <span class="hljs-comment">// … more functionality omitted.</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查找并返回与 匹配的单个实体</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查找并返回与 匹配的所有实体</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回与 匹配的实体数</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回匹配的实体是否</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存在。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用 Querydsl 支持，请扩展</font></font><code>QuerydslPredicateExecutor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的存储库界面，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 44. 存储库上的 Querydsl 集成</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt;, <span class="hljs-title">QuerydslPredicateExecutor</span>&lt;<span class="hljs-title">User</span>&gt; </span>{<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面的示例允许您使用 Querydsl</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">编写类型安全的查询</font><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Predicate predicate = user.firstname.equalsIgnoreCase(<span class="hljs-string">"dave"</span>)<font></font>
	.and(user.lastname.startsWithIgnoreCase(<span class="hljs-string">"mathews"</span>));<font></font>
<font></font>
userRepository.findAll(predicate);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="core.web"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8.2. </font><font style="vertical-align: inherit;">网络支持</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持存储库编程模型的 Spring Data 模块附带了各种 Web 支持。</font><font style="vertical-align: inherit;">Web 相关组件要求 Spring MVC JAR 位于类路径上。</font><font style="vertical-align: inherit;">其中一些甚至提供与</font></font><a href="https://github.com/spring-projects/spring-hateoas"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring HATEOAS 的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集成</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通常，通过使用</font></font><code>@EnableSpringDataWebSupport</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaConfig 配置类中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">来启用集成支持</font><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 45.启用 Spring Data Web 支持</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebMvc</span>
<span class="hljs-meta">@EnableSpringDataWebSupport</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfiguration</span> </span>{}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>@EnableSpringDataWebSupport</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">批注注册几个组件。</font><font style="vertical-align: inherit;">我们将在本节后面讨论这些。</font><font style="vertical-align: inherit;">它还检测类路径上的 Spring HATEOAS 并为其注册集成组件（如果存在）。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，如果您使用 XML 配置，请注册</font></font><code>SpringDataWebConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>HateoasAwareSpringDataWebConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为 Spring bean，如以下示例所示（对于</font></font><code>SpringDataWebConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 46. 在 XML 中启用 Spring Data Web 支持</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.data.web.config.SpringDataWebConfiguration"</span> /&gt;</span><font></font>
<font></font>
<span class="hljs-comment">&lt;!-- If you use Spring HATEOAS, register this one *instead* of the former --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.data.web.config.HateoasAwareSpringDataWebConfiguration"</span> /&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="core.web.basic"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.basic"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本网络支持</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一节中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示的配置</font><font style="vertical-align: inherit;">注册了一些基本组件：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.basic.domain-class-converter"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>DomainClassConverter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让 Spring MVC 从请求参数或路径变量解析存储库管理的域类的实例。</font></font></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.basic.paging-and-sorting"><code>HandlerMethodArgumentResolver</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让 Spring MVC</font><font style="vertical-align: inherit;">从请求参数</font><font style="vertical-align: inherit;">解析</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例的</font><font style="vertical-align: inherit;">实现</font><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.basic.jackson-mappers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jackson Modules</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于反/序列化</font></font><code>Point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和 等</font><font style="vertical-align: inherit;">类型</font></font><code>Distance</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或存储特定</font><font style="vertical-align: inherit;">类型</font><font style="vertical-align: inherit;">，具体取决于所使用的 Spring 数据模块。</font></font></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="core.web.basic.domain-class-converter"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.basic.domain-class-converter"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>DomainClassConverter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本</font></font><code>DomainClassConverter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类让你在Spring MVC中的控制器方法签名使用域类型直接使您不必手动通过资源库查找的情况下，如下例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 47. 在方法签名中使用域类型的 Spring MVC 控制器</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping("/users")</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@RequestMapping("/{id}")</span>
  <span class="hljs-function">String <span class="hljs-title">showUserForm</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable("id")</span> User user, Model model)</span> </span>{<font></font>
<font></font>
    model.addAttribute(<span class="hljs-string">"user"</span>, user);
    <span class="hljs-keyword">return</span> <span class="hljs-string">"userForm"</span>;<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该方法</font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接</font><font style="vertical-align: inherit;">接收一个</font><font style="vertical-align: inherit;">实例，不需要进一步查找。</font><font style="vertical-align: inherit;">可以通过让 Spring MVC</font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">先将</font><font style="vertical-align: inherit;">路径变量转换为</font><font style="vertical-align: inherit;">域类</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">类型，最终通过调用</font></font><code>findById(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为域类型注册的存储库实例来</font><font style="vertical-align: inherit;">访问</font><font style="vertical-align: inherit;">实例来解析</font><font style="vertical-align: inherit;">实例。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目前，存储库必须实现</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">才能被发现进行转换。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="core.web.basic.paging-and-sorting"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.basic.paging-and-sorting"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于可分页和排序的 HandlerMethodArgumentResolvers</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的配置片段中，在示出</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.basic.domain-class-converter"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前一节</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还注册一个</font></font><code>PageableHandlerMethodArgumentResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以及实例</font></font><code>SortHandlerMethodArgumentResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">注册启用</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为有效的控制器方法参数，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 48.使用 Pageable 作为控制器方法参数</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping("/users")</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserRepository repository;<font></font>
<font></font>
  UserController(UserRepository repository) {<font></font>
    <span class="hljs-keyword">this</span>.repository = repository;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@RequestMapping</span>
  <span class="hljs-function">String <span class="hljs-title">showUsers</span><span class="hljs-params">(Model model, Pageable pageable)</span> </span>{<font></font>
<font></font>
    model.addAttribute(<span class="hljs-string">"users"</span>, repository.findAll(pageable));
    <span class="hljs-keyword">return</span> <span class="hljs-string">"users"</span>;<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面的方法签名导致 Spring MVC 尝试</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以下默认配置从请求参数</font><font style="vertical-align: inherit;">派生</font><font style="vertical-align: inherit;">实例：</font></font></p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 1. 为</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">评估的请求参数</font></font></caption>
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>page</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您要检索的页面。</font><font style="vertical-align: inherit;">0 索引，默认为 0。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要检索的页面大小。</font><font style="vertical-align: inherit;">默认为 20。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应按格式排序的属性</font></font><code>property,property(,ASC|DESC)(,IgnoreCase)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认排序方向是区分大小写的升序。</font></font><code>sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果要切换方向或区分大小写，</font><font style="vertical-align: inherit;">请使用多个</font><font style="vertical-align: inherit;">参数 - 例如，</font></font><code>?sort=firstname&amp;sort=lastname,asc&amp;sort=city,ignorecase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要自定义此行为，请分别注册一个实现</font></font><code>PageableHandlerMethodArgumentResolverCustomizer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口或</font></font><code>SortHandlerMethodArgumentResolverCustomizer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font><font style="vertical-align: inherit;">的 bean </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它的</font></font><code>customize()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法被调用，让您更改设置，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Bean</span> <span class="hljs-function">SortHandlerMethodArgumentResolverCustomizer <span class="hljs-title">sortCustomizer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> s -&gt; s.setPropertyDelimiter(<span class="hljs-string">"&lt;--&gt;"</span>);<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果设置现有的属性</font></font><code>MethodArgumentResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不足以满足您的目的，请扩展</font></font><code>SpringDataWebConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或启用 HATEOAS 的等效项，覆盖</font></font><code>pageableResolver()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>sortResolver()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法，并导入您的自定义配置文件而不是使用</font></font><code>@Enable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您需要</font><font style="vertical-align: inherit;">从请求中解析</font><font style="vertical-align: inherit;">多个</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">多个</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例（例如，对于多个表），您可以使用 Spring 的</font></font><code>@Qualifier</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注解来区分一个和另一个。</font><font style="vertical-align: inherit;">请求参数必须以 为前缀</font></font><code>${qualifier}_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下示例显示了生成的方法签名：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">String <span class="hljs-title">showUsers</span><span class="hljs-params">(Model model,
      <span class="hljs-meta">@Qualifier("thing1")</span> Pageable first,
      <span class="hljs-meta">@Qualifier("thing2")</span> Pageable second)</span> </span>{ … }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您必须填充</font></font><code>thing1_page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>thing2_page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递给方法</font><font style="vertical-align: inherit;">的默认值</font><font style="vertical-align: inherit;">等效于 a </font></font><code>PageRequest.of(0, 20)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但您可以使用</font><font style="vertical-align: inherit;">参数</font></font><code>@PageableDefault</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上的注释</font><font style="vertical-align: inherit;">对其进行自定义</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="core.web.pageables"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.pageables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对可分页的超媒体支持</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring HATEOAS 附带了一个表示模型类 ( </font></font><code>PagedResources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)，它允许</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用必要的</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元数据和链接来</font><font style="vertical-align: inherit;">丰富</font><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">的内容，</font><font style="vertical-align: inherit;">让客户端轻松导航页面。</font><font style="vertical-align: inherit;">a</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到 a</font><font style="vertical-align: inherit;">的转换</font></font><code>PagedResources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是由 Spring HATEOAS</font></font><code>ResourceAssembler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font><font style="vertical-align: inherit;">的实现完成的</font><font style="vertical-align: inherit;">，称为</font></font><code>PagedResourcesAssembler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">以下示例显示了如何使用 a</font></font><code>PagedResourcesAssembler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为控制器方法参数：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 49.使用 PagedResourcesAssembler 作为控制器方法参数</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Controller</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonController</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Autowired</span> PersonRepository repository;<font></font>
<font></font>
  <span class="hljs-meta">@RequestMapping(value = "/persons", method = RequestMethod.GET)</span><font></font>
  HttpEntity&lt;PagedResources&lt;Person&gt;&gt; persons(Pageable pageable,<font></font>
    PagedResourcesAssembler assembler) {<font></font>
<font></font>
    Page&lt;Person&gt; persons = repository.findAll(pageable);<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseEntity&lt;&gt;(assembler.toResources(persons), HttpStatus.OK);<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用配置，如前面的示例所示，可以</font></font><code>PagedResourcesAssembler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将 用作控制器方法参数。</font><font style="vertical-align: inherit;">调用</font></font><code>toResources(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它有以下效果：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的内容</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成为</font></font><code>PagedResources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">的内容</font><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>PagedResources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font></font><code>PageMetadata</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附加</font><font style="vertical-align: inherit;">了一个</font><font style="vertical-align: inherit;">实例，并填充了来自</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和底层 的信息</font></font><code>PageRequest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><code>PagedResources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会</font></font><code>prev</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>next</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接链路，根据页面的状态。</font><font style="vertical-align: inherit;">链接指向方法映射到的 URI。</font><font style="vertical-align: inherit;">添加到该方法的分页参数与 的设置相匹配，</font></font><code>PageableHandlerMethodArgumentResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以确保稍后可以解析链接。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设我们</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在数据库中</font><font style="vertical-align: inherit;">有 30 个</font><font style="vertical-align: inherit;">实例。</font><font style="vertical-align: inherit;">您现在可以触发请求 ( </font><font style="vertical-align: inherit;">) 并看到类似于以下内容的输出：</font></font><code>GET <a href="http://localhost:8080/persons" class="bare">http://localhost:8080/persons</a></code><font style="vertical-align: inherit;"></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">{ <span class="hljs-string">"links"</span> : [ { <span class="hljs-string">"rel"</span> : <span class="hljs-string">"next"</span>,
                <span class="hljs-string">"href"</span> : <span class="hljs-string">"http://localhost:8080/persons?page=1&amp;size=20"</span> }<font></font>
  ],<font></font>
  <span class="hljs-string">"content"</span> : [<font></font>
     … <span class="hljs-comment">// 20 Person instances rendered here</span><font></font>
  ],<font></font>
  <span class="hljs-string">"pageMetadata"</span> : {
    <span class="hljs-string">"size"</span> : <span class="hljs-number">20</span>,
    <span class="hljs-string">"totalElements"</span> : <span class="hljs-number">30</span>,
    <span class="hljs-string">"totalPages"</span> : <span class="hljs-number">2</span>,
    <span class="hljs-string">"number"</span> : <span class="hljs-number">0</span><font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组装器生成了正确的 URI 并选择了默认配置，以将参数解析</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为即将到来的请求。</font><font style="vertical-align: inherit;">这意味着，如果您更改该配置，链接将自动遵守更改。</font><font style="vertical-align: inherit;">默认情况下，汇编器指向调用它的控制器方法，但您可以通过传递一个自定义</font></font><code>Link</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自</font><font style="vertical-align: inherit;">定义它，该自定义</font><font style="vertical-align: inherit;">用作构建分页链接的基础，这会重载该</font></font><code>PagedResourcesAssembler.toResource(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法。</font></font></p>
</div>
</div>
<div class="sect4">
<h5 id="core.web.basic.jackson-mappers"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.basic.jackson-mappers"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Jackson 模块</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心模块和一些特定于商店的模块附带一组 Jackson 模块</font><font style="vertical-align: inherit;">，用于 Spring Data 域使用的</font><font style="vertical-align: inherit;">类型，例如</font></font><code>org.springframework.data.geo.Distance</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>org.springframework.data.geo.Point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一旦</font><font style="vertical-align: inherit;">启用</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web 支持</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并可用，</font></font><code>com.fasterxml.jackson.databind.ObjectMapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就会</font><font style="vertical-align: inherit;">导入这些模块</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在初始化期间</font></font><code>SpringDataJacksonModules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，像 一样</font></font><code>SpringDataJacksonConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，被基础设施接收，以便声明的</font></font><code>com.fasterxml.jackson.databind.Module</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s 可供 Jackson 使用</font></font><code>ObjectMapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下域类型的数据绑定混合由公共基础结构注册。</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">org.springframework.data.geo.Distance</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
org.springframework.data.geo.Point</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
org.springframework.data.geo.Box</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
org.springframework.data.geo.Circle</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
org.springframework.data.geo.Polygon</font></font></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单个模块可能会提供额外的</font></font><code>SpringDataJacksonModules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有关更多详细信息，请参阅商店特定部分。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="core.web.binding"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.binding"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网页数据绑定支持</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用 Spring Data 投影（在</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#projections"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projections 中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font><font style="vertical-align: inherit;">）通过使用</font></font><a href="https://goessner.net/articles/JsonPath/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSONPath</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式（需要</font></font><a href="https://github.com/json-path/JsonPath"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jayway JsonPath</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a href="https://www.w3.org/TR/xpath-31/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XPath</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式（需要</font></font><a href="https://xmlbeam.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XmlBeam</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">来绑定传入的请求有效负载</font><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 50.使用 JSONPath 或 XPath 表达式的 HTTP 负载绑定</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@ProjectedPayload</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserPayload</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@XBRead("//firstname")</span>
  <span class="hljs-meta">@JsonPath("$..firstname")</span>
  <span class="hljs-function">String <span class="hljs-title">getFirstname</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
  <span class="hljs-meta">@XBRead("/lastname")</span>
  <span class="hljs-meta">@JsonPath({ "$.lastname", "$.user.lastname" })</span>
  <span class="hljs-function">String <span class="hljs-title">getLastname</span><span class="hljs-params">()</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用在前面的例子中为一个Spring MVC处理程序方法参数或通过使用所示类型</font></font><code>ParameterizedTypeReference</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上的方法之一</font></font><code>RestTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">前面的方法声明将尝试查找</font></font><code>firstname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给定文档中的任何位置。</font><font style="vertical-align: inherit;">该</font></font><code>lastname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML查询是对输入文档的顶层进行。</font><font style="vertical-align: inherit;">其 JSON 变体</font></font><code>lastname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先</font><font style="vertical-align: inherit;">尝试顶级，</font><font style="vertical-align: inherit;">但</font><font style="vertical-align: inherit;">如果前者不返回值，</font><font style="vertical-align: inherit;">也会尝试</font></font><code>lastname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嵌套在</font></font><code>user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子文档中。</font><font style="vertical-align: inherit;">这样，无需客户端调用公开的方法（通常是基于类的有效负载绑定的缺点）即可轻松缓解源文档结构的更改。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#projections"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projections 中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述，支持嵌套</font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#projections"><font style="vertical-align: inherit;">投影</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果该方法返回复杂的非接口类型，</font></font><code>ObjectMapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则使用</font><font style="vertical-align: inherit;">Jackson</font><font style="vertical-align: inherit;">来映射最终值。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于 Spring MVC，必要的转换器一旦</font></font><code>@EnableSpringDataWebSupport</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处于活动状态</font><font style="vertical-align: inherit;">就会自动注册，</font><font style="vertical-align: inherit;">并且所需的依赖项在类路径上可用。</font><font style="vertical-align: inherit;">对于使用</font></font><code>RestTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，注册</font></font><code>ProjectingJackson2HttpMessageConverter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON）或</font></font><code>XmlBeamHttpMessageConverter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关更多信息，请参阅</font><font style="vertical-align: inherit;">规范</font><a href="https://github.com/spring-projects/spring-data-examples"><font style="vertical-align: inherit;">Spring 数据示例存储库中</font></a><font style="vertical-align: inherit;">的</font></font><a href="https://github.com/spring-projects/spring-data-examples/tree/master/web/projection"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web 投影示例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><a href="https://github.com/spring-projects/spring-data-examples"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</div>
</div>
<div class="sect4">
<h5 id="core.web.type-safe"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.web.type-safe"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Querydsl 网络支持</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于那些具有</font></font><a href="http://www.querydsl.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QueryDSL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集成的</font><font style="vertical-align: inherit;">商店</font><font style="vertical-align: inherit;">，您可以从</font></font><code>Request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询字符串中</font><font style="vertical-align: inherit;">包含的属性派生查询</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑以下查询字符串：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs plaintext">?firstname=Dave&amp;lastname=Matthews</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给定</font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面示例中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">对象，您可以使用 将查询字符串解析为以下值</font></font><code>QuerydslPredicateArgumentResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs plaintext">QUser.user.firstname.eq("Dave").and(QUser.user.lastname.eq("Matthews"))</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"></font><code>@EnableSpringDataWebSupport</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当在类路径上找到 Querydsl 时</font><font style="vertical-align: inherit;">
，会自动启用该功能以及</font><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将 a 添加</font></font><code>@QuerydslPredicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到方法签名提供了一个随时可用的</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以使用</font></font><code>QuerydslPredicateExecutor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="提示"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
类型信息通常从方法的返回类型解析。</font><font style="vertical-align: inherit;">由于该信息不一定与域类型匹配，因此使用 的</font></font><code>root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">可能是一个好主意</font></font><code>QuerydslPredicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了如何</font></font><code>@QuerydslPredicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在方法签名中使用：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Controller</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Autowired</span> UserRepository repository;<font></font>
<font></font>
  <span class="hljs-meta">@RequestMapping(value = "/", method = RequestMethod.GET)</span>
  <span class="hljs-function">String <span class="hljs-title">index</span><span class="hljs-params">(Model model, <span class="hljs-meta">@QuerydslPredicate(root = User.class)</span> Predicate predicate,    </span></span><i class="conum" data-value="1"></i><b><span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">1</span>)</span></span></b><span class="hljs-function">
          Pageable pageable, @RequestParam MultiValueMap&lt;String, String&gt; parameters) </span>{<font></font>
<font></font>
    model.addAttribute(<span class="hljs-string">"users"</span>, repository.findAll(predicate, pageable));<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"index"</span>;<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将查询字符串参数解析为匹配</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认绑定如下：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在简单的属性上</font></font><code>eq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在像属性一样的集合上</font></font><code>contains</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><code>Collection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在简单的属性上</font></font><code>in</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以通过</font><font style="vertical-align: inherit;">Java 8</font><font style="vertical-align: inherit;">的</font></font><code>bindings</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font><code>@QuerydslPredicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或通过使用 Java 8</font></font><code>default methods</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并将</font></font><code>QuerydslBinderCustomizer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">添加</font><font style="vertical-align: inherit;">到存储库接口来自</font><font style="vertical-align: inherit;">定义这些绑定</font><font style="vertical-align: inherit;">，如下所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">String</span>&gt;,
                                 <span class="hljs-title">QuerydslPredicateExecutor</span>&lt;<span class="hljs-title">User</span>&gt;,                </span><i class="conum" data-value="1"></i><b><span class="hljs-class">(1)</span></b><span class="hljs-class">
                                 <span class="hljs-title">QuerydslBinderCustomizer</span>&lt;<span class="hljs-title">QUser</span>&gt; </span>{               <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title">customize</span><span class="hljs-params">(QuerydslBindings bindings, QUser user)</span> </span>{<font></font>
<font></font>
    bindings.bind(user.username).first((path, value) -&gt; path.contains(value))    <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b><font></font>
    bindings.bind(String.class)<font></font>
      .first((StringPath path, String value) -&gt; path.containsIgnoreCase(value)); <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b>
    bindings.excluding(user.password);                                           <i class="conum" data-value="5"></i><b>(<span class="hljs-number">5</span>)</b><font></font>
  }<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>QuerydslPredicateExecutor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供对特定 finder 方法的访问</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>QuerydslBinderCustomizer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库界面上定义的自动拾取和快捷方式</font></font><code>@QuerydslPredicate(bindings=…​)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><code>username</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">的绑定定义为</font><font style="vertical-align: inherit;">简单</font></font><code>contains</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绑定。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><code>String</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">的默认绑定定义为</font><font style="vertical-align: inherit;">不区分大小写的</font></font><code>contains</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><font style="vertical-align: inherit;"></font><code>password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析中</font><font style="vertical-align: inherit;">排除该</font><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="提示"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
你可以注册一个</font></font><code>QuerydslBinderCustomizerDefaults</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从资源库或应用特定的绑定之前豆保持默认Querydsl绑定</font></font><code>@QuerydslPredicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="core.repository-populators"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#core.repository-populators"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8.3. </font><font style="vertical-align: inherit;">存储库填充器</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您使用 Spring JDBC 模块，您可能熟悉</font></font><code>DataSource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 SQL 脚本</font><font style="vertical-align: inherit;">填充 a 的支持</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">类似的抽象在存储库级别可用，尽管它不使用 SQL 作为数据定义语言，因为它必须与存储无关。</font><font style="vertical-align: inherit;">因此，填充器支持 XML（通过 Spring 的 OXM 抽象）和 JSON（通过 Jackson）来定义用于填充存储库的数据。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设您有一个包含</font></font><code>data.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下内容</font><font style="vertical-align: inherit;">的文件</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 51. JSON 中定义的数据</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">[ { <span class="hljs-string">"_class"</span> : <span class="hljs-string">"com.acme.Person"</span>,
 <span class="hljs-string">"firstname"</span> : <span class="hljs-string">"Dave"</span>,
  <span class="hljs-string">"lastname"</span> : <span class="hljs-string">"Matthews"</span> },<font></font>
  { <span class="hljs-string">"_class"</span> : <span class="hljs-string">"com.acme.Person"</span>,
 <span class="hljs-string">"firstname"</span> : <span class="hljs-string">"Carter"</span>,
  <span class="hljs-string">"lastname"</span> : <span class="hljs-string">"Beauford"</span> } ]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用 Spring Data Commons 中提供的存储库命名空间的 populator 元素来填充存储库。</font><font style="vertical-align: inherit;">要将前面的数据填充到您的</font></font><code>PersonRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请声明一个类似于以下内容的</font><font style="vertical-align: inherit;">填充器</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 52. 声明一个 Jackson 存储库填充器</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hljs-attr">xmlns:repository</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/repository"</span>
  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/repository
    https://www.springframework.org/schema/data/repository/spring-repository.xsd"</span>&gt;</span><font></font>
<font></font>
  <span class="hljs-tag">&lt;<span class="hljs-name">repository:jackson2-populator</span> <span class="hljs-attr">locations</span>=<span class="hljs-string">"classpath:data.json"</span> /&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面的声明导致</font></font><code>data.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件被 Jackson 读取和反序列化</font></font><code>ObjectMapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON 对象解组的类型是通过检查</font></font><code>_class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON 文档</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">来确定的</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">基础架构最终会选择合适的存储库来处理反序列化的对象。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要改为使用 XML 定义应填充存储库的数据，您可以使用该</font></font><code>unmarshaller-populator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素。</font><font style="vertical-align: inherit;">您将其配置为使用 Spring OXM 中可用的 XML marshaller 选项之一。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息，</font><font style="vertical-align: inherit;">请参阅</font></font><a href="https://docs.spring.io/spring-framework/docs/5.3.9/reference/html/data-access.html#oxm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring 参考文档</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下示例显示如何使用 JAXB 解组存储库填充器：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 53. 声明解组存储库填充器（使用 JAXB）</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hljs-attr">xmlns:repository</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/repository"</span>
  <span class="hljs-attr">xmlns:oxm</span>=<span class="hljs-string">"http://www.springframework.org/schema/oxm"</span>
  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/repository
    https://www.springframework.org/schema/data/repository/spring-repository.xsd
    http://www.springframework.org/schema/oxm
    https://www.springframework.org/schema/oxm/spring-oxm.xsd"</span>&gt;</span><font></font>
<font></font>
  <span class="hljs-tag">&lt;<span class="hljs-name">repository:unmarshaller-populator</span> <span class="hljs-attr">locations</span>=<span class="hljs-string">"classpath:data.json"</span>
    <span class="hljs-attr">unmarshaller-ref</span>=<span class="hljs-string">"unmarshaller"</span> /&gt;</span><font></font>
<font></font>
  <span class="hljs-tag">&lt;<span class="hljs-name">oxm:jaxb2-marshaller</span> <span class="hljs-attr">contextPath</span>=<span class="hljs-string">"com.acme"</span> /&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reference"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#reference"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. 参考文档</font></font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="jpa.repositories"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.repositories"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1. </font><font style="vertical-align: inherit;">JPA 存储库</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本章指出了 JPA 存储库支持的特点。</font><font style="vertical-align: inherit;">这建立在“</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Spring 数据存储库</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”中</font><font style="vertical-align: inherit;">解释的核心存储库支持之上</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">确保您对那里解释的基本概念有充分的理解。</font></font></p>
</div>
<div class="sect3">
<h4 id="jpa.introduction"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.introduction"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.1. </font><font style="vertical-align: inherit;">介绍</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节描述了通过以下任一方式配置 Spring Data JPA 的基础知识：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.namespace"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Namespace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”（XML 配置）</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.java-config"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于注解的配置</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”（Java配置）</font></font></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="jpa.namespace"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.namespace"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring 命名空间</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data 的 JPA 模块包含一个允许定义存储库 bean 的自定义命名空间。</font><font style="vertical-align: inherit;">它还包含 JPA 特有的某些功能和元素属性。</font><font style="vertical-align: inherit;">通常，可以使用</font></font><code>repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">设置 JPA 存储库</font><font style="vertical-align: inherit;">，如下例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 54. 使用命名空间设置 JPA 存储库</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hljs-attr">xmlns:jpa</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/jpa"</span>
  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/jpa
    https://www.springframework.org/schema/data/jpa/spring-jpa.xsd"</span>&gt;</span><font></font>
<font></font>
  <span class="hljs-tag">&lt;<span class="hljs-name">jpa:repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repositories"</span> /&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用该</font></font><code>repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素查找 Spring Data 存储库，如“</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建存储库实例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”中所述。</font><font style="vertical-align: inherit;">除此之外，它还为所有用 注释的 bean 激活持久性异常转换</font></font><code>@Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，让 JPA 持久性提供者抛出的异常转换为 Spring 的</font></font><code>DataAccessException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">层次结构。</font></font></p>
</div>
<div class="sect5">
<h6 id="jpa.namespace.custom-namespace-attributes"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.namespace.custom-namespace-attributes"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自定义命名空间属性</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了</font></font><code>repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">的默认属性之外</font><font style="vertical-align: inherit;">，JPA 命名空间还提供其他属性，让您可以更详细地控制存储库的设置：</font></font></p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 2.</font></font><code>repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素的</font><font style="vertical-align: inherit;">自定义 JPA 特定属性</font></font></caption>
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entity-manager-factory-ref</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显式</font></font><code>EntityManagerFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接要与</font></font><code>repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">检测到的存储库一起使用的</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通常</font></font><code>EntityManagerFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在应用程序中使用</font><font style="vertical-align: inherit;">多个</font><font style="vertical-align: inherit;">bean 时使用。</font><font style="vertical-align: inherit;">如果未配置，春数据自动查找了</font></font><code>EntityManagerFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名为豆</font></font><code>entityManagerFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中</font></font><code>ApplicationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>transaction-manager-ref</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显式</font></font><code>PlatformTransactionManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接要与</font></font><code>repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">检测到的存储库一起使用的</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通常只有</font></font><code>EntityManagerFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在配置了</font><font style="vertical-align: inherit;">多个事务管理器或</font><font style="vertical-align: inherit;">bean</font><font style="vertical-align: inherit;">时才需要</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认为</font></font><code>PlatformTransactionManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 current 中</font><font style="vertical-align: inherit;">定义的单个</font></font><code>ApplicationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font><font style="vertical-align: inherit;">未定义</font><font style="vertical-align: inherit;">显式，</font><font style="vertical-align: inherit;">
Spring Data JPA 需要一个</font></font><code>PlatformTransactionManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名为 bean 的 bean </font><font style="vertical-align: inherit;">。
</font></font><code>transactionManager</code><font style="vertical-align: inherit;"></font><code>transaction-manager-ref</code><font style="vertical-align: inherit;"></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jpa.java-config"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.java-config"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于注解的配置</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data JPA 存储库支持不仅可以通过 XML 命名空间激活，还可以通过 JavaConfig 使用注释激活，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 55. 使用 JavaConfig 的 Spring Data JPA 存储库</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableJpaRepositories</span>
<span class="hljs-meta">@EnableTransactionManagement</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfig</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Bean</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource <span class="hljs-title">dataSource</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
    EmbeddedDatabaseBuilder builder = <span class="hljs-keyword">new</span> EmbeddedDatabaseBuilder();
    <span class="hljs-keyword">return</span> builder.setType(EmbeddedDatabaseType.HSQL).build();<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@Bean</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> LocalContainerEntityManagerFactoryBean <span class="hljs-title">entityManagerFactory</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
    HibernateJpaVendorAdapter vendorAdapter = <span class="hljs-keyword">new</span> HibernateJpaVendorAdapter();<font></font>
    vendorAdapter.setGenerateDdl(<span class="hljs-keyword">true</span>);<font></font>
<font></font>
    LocalContainerEntityManagerFactoryBean factory = <span class="hljs-keyword">new</span> LocalContainerEntityManagerFactoryBean();<font></font>
    factory.setJpaVendorAdapter(vendorAdapter);<font></font>
    factory.setPackagesToScan(<span class="hljs-string">"com.acme.domain"</span>);<font></font>
    factory.setDataSource(dataSource());<font></font>
    <span class="hljs-keyword">return</span> factory;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@Bean</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> PlatformTransactionManager <span class="hljs-title">transactionManager</span><span class="hljs-params">(EntityManagerFactory entityManagerFactory)</span> </span>{<font></font>
<font></font>
    JpaTransactionManager txManager = <span class="hljs-keyword">new</span> JpaTransactionManager();<font></font>
    txManager.setEntityManagerFactory(entityManagerFactory);<font></font>
    <span class="hljs-keyword">return</span> txManager;<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您必须创建</font></font><code>LocalContainerEntityManagerFactoryBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是</font></font><code>EntityManagerFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接</font><font style="vertical-align: inherit;">创建</font><font style="vertical-align: inherit;">，因为前者除了创建</font></font><code>EntityManagerFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前述配置类，通过使用设置了一个嵌入式HSQL数据库</font></font><code>EmbeddedDatabaseBuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的API </font></font><code>spring-jdbc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后 Spring Data 设置</font></font><code>EntityManagerFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并使用 Hibernate 作为示例持久性提供程序。</font><font style="vertical-align: inherit;">此处声明的最后一个基础结构组件是</font></font><code>JpaTransactionManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">最后，该示例通过使用</font></font><code>@EnableJpaRepositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">激活 Spring Data JPA 存储库，</font><font style="vertical-align: inherit;">注释本质上带有与 XML 命名空间相同的属性。</font><font style="vertical-align: inherit;">如果没有配置基础包，它使用配置类所在的包。</font></font></p>
</div>
</div>
<div class="sect4">
<h5 id="jpa.bootstrap-mode"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.bootstrap-mode"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引导模式</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，Spring Data JPA 存储库是默认的 Spring bean。</font><font style="vertical-align: inherit;">它们是单例范围的并且急切地初始化。</font><font style="vertical-align: inherit;">在启动期间，他们已经与 JPA 交互以</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行验证和元数据分析。</font><font style="vertical-align: inherit;">Spring Framework 支持</font></font><code>EntityManagerFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在后台线程中</font><font style="vertical-align: inherit;">初始化 JPA </font><font style="vertical-align: inherit;">，因为该进程通常会在 Spring 应用程序中占用大量启动时间。</font><font style="vertical-align: inherit;">为了有效地利用后台初始化，我们需要确保 JPA 存储库尽可能晚地初始化。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 Spring Data JPA 2.1 开始，您现在可以配置一个</font></font><code>BootstrapMode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（通过</font></font><code>@EnableJpaRepositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释或 XML 命名空间）采用以下值：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DEFAULT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认）— 除非明确用</font></font><code>@Lazy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">仅当没有客户端 bean 需要存储库的实例时，延迟化才有效，因为这将需要存储库 bean 的初始化。</font></font></p>
</li>
<li>
<p><code>LAZY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> — 隐式声明所有存储库 bean 为惰性，并导致创建惰性初始化代理以将其注入客户端 bean。</font><font style="vertical-align: inherit;">这意味着，如果客户端 bean 只是将实例存储在一个字段中并且在初始化期间没有使用存储库，那么存储库将不会被实例化。</font><font style="vertical-align: inherit;">存储库实例将在第一次与存储库交互时进行初始化和验证。</font></font></p>
</li>
<li>
<p><code>DEFERRED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> — 与 基本相同的操作模式</font></font><code>LAZY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但触发存储库初始化以响应 ，</font></font><code>ContextRefreshedEvent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以便在应用程序完全启动之前验证存储库。</font></font></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="jpa.bootstrap-mode.recommendations"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.bootstrap-mode.recommendations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建议</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您不使用具有默认引导模式的异步 JPA 引导棒。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您异步引导 JPA，这</font></font><code>DEFERRED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个合理的默认值，因为它将确保 Spring Data JPA 引导程序仅在</font></font><code>EntityManagerFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置本身比初始化所有其他应用程序组件花费的时间更长的情况</font><font style="vertical-align: inherit;">下等待</font><font style="vertical-align: inherit;">设置。</font><font style="vertical-align: inherit;">尽管如此，它仍可确保在应用程序发出信号之前正确初始化和验证存储库。</font></font></p>
</div>
<div class="paragraph">
<p><code>LAZY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是测试场景和本地开发的不错选择。</font><font style="vertical-align: inherit;">一旦您非常确定存储库可以正确引导，或者在您测试应用程序的其他部分的情况下，对所有存储库运行验证可能会不必要地增加启动时间。</font><font style="vertical-align: inherit;">这同样适用于本地开发，其中您只能访问可能需要初始化单个存储库的应用程序部分。</font></font></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jpa.entity-persistence"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.entity-persistence"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.2. </font><font style="vertical-align: inherit;">持久实体</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节介绍如何使用 Spring Data JPA 持久化（保存）实体。</font></font></p>
</div>
<div class="sect4">
<h5 id="jpa.entity-persistence.saving-entites"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.entity-persistence.saving-entites"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存实体</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用该</font></font><code>CrudRepository.save(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">执行保存实体</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它通过使用底层 JPA 来持久化或合并给定的实体</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果实体尚未持久化，Spring Data JPA 会通过调用该</font></font><code>entityManager.persist(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">来保存实体</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">否则，它调用该</font></font><code>entityManager.merge(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法。</font></font></p>
</div>
<div class="sect5">
<h6 id="jpa.entity-persistence.saving-entites.strategies"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.entity-persistence.saving-entites.strategies"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实体状态检测策略</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data JPA 提供以下策略来检测实体是否为新实体：</font></font></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Version-Property 和 Id-Property 检查（</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：默认情况下，Spring Data JPA 首先检查是否存在非原始类型的 Version-property。</font><font style="vertical-align: inherit;">如果存在，并且该属性的值为 ，则该实体被视为新实体</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果没有这样的 Version-property Spring Data JPA 检查给定实体的 identifier 属性。</font><font style="vertical-align: inherit;">如果标识符属性是</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则假定实体是新的。</font><font style="vertical-align: inherit;">否则，它被认为不是新的。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现</font></font><code>Persistable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：如果实体实现了</font></font><code>Persistable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，Spring Data JPA 将新的检测委托给</font></font><code>isNew(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实体</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">方法。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息，</font><font style="vertical-align: inherit;">请参阅</font></font><a href="https://docs.spring.io/spring-data/data-commons/docs/current/api/index.html?org/springframework/data/domain/Persistable.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaDoc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现</font></font><code>EntityInformation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：您可以</font><font style="vertical-align: inherit;">通过创建子类</font><font style="vertical-align: inherit;">并相应地覆盖</font><font style="vertical-align: inherit;">方法来自</font><font style="vertical-align: inherit;">定义</font><font style="vertical-align: inherit;">实现中</font></font><code>EntityInformation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">抽象</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后，您必须将 的自定义实现注册</font><font style="vertical-align: inherit;">为 Spring bean。</font><font style="vertical-align: inherit;">请注意，这应该很少需要。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息，</font><font style="vertical-align: inherit;">请参阅</font><a href="https://docs.spring.io/spring-data/data-jpa/docs/current/api/index.html?org/springframework/data/jpa/repository/support/JpaRepositoryFactory.html"><font style="vertical-align: inherit;">JavaDoc</font></a><font style="vertical-align: inherit;">。</font></font><code>SimpleJpaRepository</code><font style="vertical-align: inherit;"></font><code>JpaRepositoryFactory</code><font style="vertical-align: inherit;"></font><code>getEntityInformation(…)</code><font style="vertical-align: inherit;"></font><code>JpaRepositoryFactory</code><font style="vertical-align: inherit;"></font><a href="https://docs.spring.io/spring-data/data-jpa/docs/current/api/index.html?org/springframework/data/jpa/repository/support/JpaRepositoryFactory.html"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于使用手动分配的标识符且没有版本属性的实体，选项 1 不是一个选项，因为标识符将始终为非</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，一个常见的模式是使用一个公共基类，它带有一个默认的瞬态标志来指示一个新实例，并使用 JPA 生命周期回调在持久化操作中翻转该标志：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 56. 具有手动分配标识符的实体的基类</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@MappedSuperclass</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbstractEntity</span>&lt;<span class="hljs-title">ID</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">Persistable</span>&lt;<span class="hljs-title">ID</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Transient</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> isNew = <span class="hljs-keyword">true</span>; <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
<font></font>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isNew</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> isNew; <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@PrePersist</span> <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
  <span class="hljs-meta">@PostLoad</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">markNotNew</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.isNew = <span class="hljs-keyword">false</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// More code…</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明一个标志来保持新状态。</font><font style="vertical-align: inherit;">瞬态，以便它不会持久化到数据库。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回实现中的标志，</font></font><code>Persistable.isNew()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以便 Spring Data 存储库知道是否调用</font></font><code>EntityManager.persist()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>….merge()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明一个使用 JPA 实体回调的方法，以便</font></font><code>save(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在持久性提供程序</font><font style="vertical-align: inherit;">调用存储库</font><font style="vertical-align: inherit;">或创建实例</font><font style="vertical-align: inherit;">后切换标志以指示现有实体</font><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jpa.query-methods"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.3. </font><font style="vertical-align: inherit;">查询方法</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节介绍使用 Spring Data JPA 创建查询的各种方法。</font></font></p>
</div>
<div class="sect4">
<h5 id="jpa.sample-app.finders.strategies"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.sample-app.finders.strategies"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询查找策略</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPA 模块支持将查询手动定义为字符串或从方法名称派生。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与谓词派生查询</font></font><code>IsStartingWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>StartingWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>StartsWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>IsEndingWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>EndingWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>EndsWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><code>IsNotContaining</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>NotContaining</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>NotContains</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>IsContaining</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>Containing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>Contains</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些查询的各个参数将得到消毒。</font><font style="vertical-align: inherit;">这意味着如果参数实际上包含被识别</font></font><code>LIKE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为通配符的</font><font style="vertical-align: inherit;">字符，</font><font style="vertical-align: inherit;">这些</font><font style="vertical-align: inherit;">字符</font><font style="vertical-align: inherit;">将被转义，因此它们仅作为文字匹配。</font><font style="vertical-align: inherit;">所使用的转义字符可以通过设置来配置</font></font><code>escapeCharacter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述的</font></font><code>@EnableJpaRepositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释。</font><font style="vertical-align: inherit;">与</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query.spel-expressions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 SpEL 表达式</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行比较</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect5">
<h6 id="jpa.query-methods.declared-queries"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.declared-queries"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明的查询</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然从方法名获取查询是很方便的，但人们可能会面临这样的情况，即方法名解析器不支持想要使用的关键字，或者方法名会变得不必要地丑陋。</font><font style="vertical-align: inherit;">因此，您可以通过命名约定</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.named-queries"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 JPA 命名查询（</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关详细信息，</font><font style="vertical-align: inherit;">请参阅</font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.named-queries"><font style="vertical-align: inherit;">使用 JPA 命名查询</font></a><font style="vertical-align: inherit;">），或者使用注释您的查询方法</font></font><code>@Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font><font style="vertical-align: inherit;">有关详细信息，</font><font style="vertical-align: inherit;">请参阅</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.at-query"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>@Query</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jpa.query-methods.query-creation"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.query-creation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询创建</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常，JPA 的查询创建机制按照“</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”中的</font><font style="vertical-align: inherit;">描述工作</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下示例显示了 JPA 查询方法转换为的内容：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 57. 根据方法名称创建查询</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公共接口 UserRepository extends Repository&lt;User, Long&gt; {</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  List&lt;User&gt; findByEmailAddressAndLastname(String emailAddress, String lastname);</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们使用 JPA 标准 API 从中创建一个查询，但本质上，这会转换为以下查询：</font></font><code>select u from User u where u.emailAddress = ?1 and u.lastname = ?2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Spring Data JPA 执行属性检查并遍历嵌套属性，如“</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods.query-property-expressions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性表达式</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”中所述。</font></font></p>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下表描述了 JPA 支持的关键字以及包含该关键字的方法转换为什么：</font></font></p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 3. 方法名称中支持的关键字</font></font></caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键词</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">样本</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPQL 片段</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Distinct</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findDistinctByLastnameAndFirstname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>select distinct …​ where x.lastname = ?1 and x.firstname = ?2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>And</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByLastnameAndFirstname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.lastname = ?1 and x.firstname = ?2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Or</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByLastnameOrFirstname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.lastname = ?1 or x.firstname = ?2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Is</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Equals</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>findByFirstnameIs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>findByFirstnameEquals</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname = ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Between</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByStartDateBetween</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.startDate between ?1 and ?2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeLessThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age &lt; ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThanEqual</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeLessThanEqual</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age &lt;= ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeGreaterThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age &gt; ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThanEqual</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeGreaterThanEqual</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age &gt;= ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>After</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByStartDateAfter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.startDate &gt; ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Before</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByStartDateBefore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.startDate &lt; ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAge(Is)Null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age is null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>NotNull</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAge(Is)NotNull</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age not null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Like</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameLike</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname like ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotLike</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameNotLike</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname not like ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StartingWith</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameStartingWith</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname like ?1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（参数绑定了 append </font></font><code>%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EndingWith</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameEndingWith</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname like ?1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（参数绑定 prepended </font></font><code>%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Containing</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameContaining</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname like ?1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（参数绑定包裹在</font></font><code>%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OrderBy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeOrderByLastnameDesc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age = ?1 order by x.lastname desc</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Not</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByLastnameNot</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.lastname &lt;&gt; ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>In</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeIn(Collection&lt;Age&gt; ages)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age in ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotIn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeNotIn(Collection&lt;Age&gt; ages)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age not in ?1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>True</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByActiveTrue()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.active = true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>False</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByActiveFalse()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.active = false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IgnoreCase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameIgnoreCase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where UPPER(x.firstname) = UPPER(?1)</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content">
<code>In</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且</font></font><code>NotIn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还可以将任何子类</font></font><code>Collection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为参数以及数组或可变参数。</font><font style="vertical-align: inherit;">对于相同逻辑运算符的其他语法版本，请检查“</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repository-query-keywords"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库查询关键字</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="jpa.query-methods.named-queries"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.named-queries"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 JPA 命名查询</font></font></h5>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这些示例使用</font></font><code>&lt;named-query /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素和</font></font><code>@NamedQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释。</font><font style="vertical-align: inherit;">这些配置元素的查询必须在 JPA 查询语言中定义。</font><font style="vertical-align: inherit;">当然，您也可以使用</font></font><code>&lt;named-native-query /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>@NamedNativeQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通过失去数据库平台独立性，这些元素使您可以在本机 SQL 中定义查询。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="sect5">
<h6 id="jpa.query-methods.named-queries.xml-named-query-definition"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.named-queries.xml-named-query-definition"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML 命名查询定义</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用 XML 配置，请将必要的</font></font><code>&lt;named-query /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">添加</font><font style="vertical-align: inherit;">到</font></font><code>orm.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于</font></font><code>META-INF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类路径文件夹中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">JPA 配置文件中</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通过使用一些定义的命名约定来启用命名查询的自动调用。</font><font style="vertical-align: inherit;">有关更多详细信息，请参见下文。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 58. XML 命名查询配置</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">named-query</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"User.findByLastname"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">query</span>&gt;</span>select u from User u where u.lastname = ?1<span class="hljs-tag">&lt;/<span class="hljs-name">query</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">named-query</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询有一个特殊的名称，用于在运行时解析它。</font></font></p>
</div>
</div>
<div class="sect5">
<h6 id="jpa.query-methods.named-queries.annotation-based-configuration"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.named-queries.annotation-based-configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于注解的配置</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于注解的配置的优点是不需要编辑另一个配置文件，减少维护工作。</font><font style="vertical-align: inherit;">您需要为每个新的查询声明重新编译域类，从而为获得这种好处付出代价。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 59.基于注解的命名查询配置</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@NamedQuery(name = "User.findByEmailAddress",
  query = "select u from User u where u.emailAddress = ?1")</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{<font></font>
<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="jpa.query-methods.named-queries.declaring-interfaces"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.named-queries.declaring-interfaces"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明接口</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要允许这些命名查询，请指定</font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 60. UserRepository 中的查询方法声明</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
<font></font>
  <span class="hljs-function">User <span class="hljs-title">findByEmailAddress</span><span class="hljs-params">(String emailAddress)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data 尝试将对这些方法的调用解析为命名查询，从配置的域类的简单名称开始，然后是用点分隔的方法名称。</font><font style="vertical-align: inherit;">因此，前面的示例将使用之前定义的命名查询，而不是尝试从方法名称创建查询。</font></font></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jpa.query-methods.at-query"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.at-query"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 </font></font><code>@Query</code></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用命名查询来声明实体查询是一种有效的方法，并且适用于少量查询。</font><font style="vertical-align: inherit;">由于查询本身与运行它们的 Java 方法相关联，因此您实际上可以通过使用 Spring Data JPA</font></font><code>@Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">直接绑定它们，</font><font style="vertical-align: inherit;">而不是将它们注释到域类。</font><font style="vertical-align: inherit;">这将域类从持久性特定信息中解放出来，并将查询共同定位到存储库接口。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释到查询方法的查询优先于使用中定义的</font></font><code>@NamedQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询或在 中声明的命名查询</font></font><code>orm.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了使用</font></font><code>@Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">创建的查询</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 61. 在查询方法中声明查询使用 </font></font><code>@Query</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Query("select u from User u where u.emailAddress = ?1")</span>
  <span class="hljs-function">User <span class="hljs-title">findByEmailAddress</span><span class="hljs-params">(String emailAddress)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="jpa.query-methods.at-query.advanced-like"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.at-query.advanced-like"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用高级</font></font><code>LIKE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用创建的手动定义查询的查询运行机制</font></font><code>@Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许</font></font><code>LIKE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在查询定义中定义</font><font style="vertical-align: inherit;">高级</font><font style="vertical-align: inherit;">表达式，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 62. </font></font><code>like</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Query 中的</font><font style="vertical-align: inherit;">高级</font><font style="vertical-align: inherit;">表达式</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Query("select u from User u where u.firstname like %?1")</span>
  <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByFirstnameEndsWith</span><span class="hljs-params">(String firstname)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在前面的示例中，</font></font><code>LIKE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分隔符 ( </font></font><code>%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) 被识别，并将查询转换为有效的 JPQL 查询（删除</font></font><code>%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">运行查询时，传递给方法调用的参数将使用先前识别的</font></font><code>LIKE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式</font><font style="vertical-align: inherit;">进行扩充</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="sect5">
<h6 id="jpa.query-methods.at-query.native"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.at-query.native"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本机查询</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>@Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释允许通过将</font></font><code>nativeQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为 true</font><font style="vertical-align: inherit;">来运行本机查询</font><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 63. 使用 @Query 在查询方法中声明本机查询</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Query(value = "SELECT * FROM USERS WHERE EMAIL_ADDRESS = ?1", nativeQuery = true)</span>
  <span class="hljs-function">User <span class="hljs-title">findByEmailAddress</span><span class="hljs-params">(String emailAddress)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Spring Data JPA 目前不支持对原生查询进行动态排序，因为它必须操作声明的实际查询，而对于原生 SQL，它不能可靠地做到这一点。</font><font style="vertical-align: inherit;">但是，您可以通过自己指定计数查询来使用本机查询进行分页，如下例所示：
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 64.在查询方法中声明用于分页的原生计数查询，使用 </font></font><code>@Query</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Query(value = "SELECT * FROM USERS WHERE LASTNAME = ?1",
    countQuery = "SELECT count(*) FROM USERS WHERE LASTNAME = ?1",
    nativeQuery = true)</span>
  <span class="hljs-function">Page&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过将</font></font><code>.count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后缀</font><font style="vertical-align: inherit;">添加</font><font style="vertical-align: inherit;">到查询的副本，</font><font style="vertical-align: inherit;">类似的方法也适用于命名的本机</font><font style="vertical-align: inherit;">查询。</font><font style="vertical-align: inherit;">不过，您可能需要为计数查询注册一个结果集映射。</font></font></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jpa.query-methods.sorting"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.sorting"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用排序</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">排序可以通过提供 a</font></font><code>PageRequest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">来完成</font><font style="vertical-align: inherit;">。</font></font><code>Order</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例中</font><font style="vertical-align: inherit;">实际使用的属性</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要匹配您的域模型，这意味着它们需要解析为查询中使用的属性或别名。</font><font style="vertical-align: inherit;">JPQL 将其定义为状态字段路径表达式。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用任何不可引用的路径表达式会导致</font></font><code>Exception</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与 with 一起使用</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-methods.at-query"><code>@Query</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以让您潜入</font></font><code>Order</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含</font></font><code>ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">中函数的</font><font style="vertical-align: inherit;">非路径检查</font><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是可能的，因为</font></font><code>Order</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附加到给定的查询字符串。</font><font style="vertical-align: inherit;">默认情况下，Spring Data JPA 拒绝任何</font></font><code>Order</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含函数调用的实例，但您可以使用</font></font><code>JpaSort.unsafe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加潜在的不安全排序。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例使用</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>JpaSort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，包括一个不安全的选项 on </font></font><code>JpaSort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 65. 使用</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>JpaSort</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Query("select u from User u where u.lastname like ?1%")</span>
  <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByAndSort</span><span class="hljs-params">(String lastname, Sort sort)</span></span>;<font></font>
<font></font>
  <span class="hljs-meta">@Query("select u.id, LENGTH(u.firstname) as fn_len from User u where u.lastname like ?1%")</span><font></font>
  List&lt;Object[]&gt; findByAsArrayAndSort(String lastname, Sort sort);<font></font>
}<font></font>
<font></font>
repo.findByAndSort(<span class="hljs-string">"lannister"</span>, Sort.by(<span class="hljs-string">"firstname"</span>));                <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
repo.findByAndSort(<span class="hljs-string">"stark"</span>, Sort.by(<span class="hljs-string">"LENGTH(firstname)"</span>));            <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
repo.findByAndSort(<span class="hljs-string">"targaryen"</span>, JpaSort.unsafe(<span class="hljs-string">"LENGTH(firstname)"</span>)); <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
repo.findByAsArrayAndSort(<span class="hljs-string">"bolton"</span>, Sort.by(<span class="hljs-string">"fn_len"</span>));               <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><font style="vertical-align: inherit;"></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指向域模型中属性的</font><font style="vertical-align: inherit;">有效</font><font style="vertical-align: inherit;">表达式。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无效的</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含函数调用。</font><font style="vertical-align: inherit;">抛出异常。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含显式</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不安全</font></font></em> <code>Order</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><font style="vertical-align: inherit;"></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指向别名函数的</font><font style="vertical-align: inherit;">有效</font><font style="vertical-align: inherit;">表达式。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jpa.named-parameters"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.named-parameters"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用命名参数</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，Spring Data JPA 使用基于位置的参数绑定，如前面所有示例中所述。</font><font style="vertical-align: inherit;">这使得在重构参数位置时查询方法有点容易出错。</font><font style="vertical-align: inherit;">为了解决这个问题，您可以使用</font></font><code>@Param</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注解给方法参数一个具体的名称并在查询中绑定名称，如下例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 66.使用命名参数</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Query("select u from User u where u.firstname = :firstname or u.lastname = :lastname")</span>
  <span class="hljs-function">User <span class="hljs-title">findByLastnameOrFirstname</span><span class="hljs-params">(<span class="hljs-meta">@Param("lastname")</span> String lastname,
                                 <span class="hljs-meta">@Param("firstname")</span> String firstname)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法参数根据它们在定义的查询中的顺序进行切换。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从 version 4 开始，Spring 完全支持 Java 8 的基于</font></font><code>-parameters</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编译器标志</font><font style="vertical-align: inherit;">的参数名称发现</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通过在构建中使用此标志作为调试信息的替代方法，您可以省略</font></font><code>@Param</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名参数</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">注释。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="jpa.query.spel-expressions"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query.spel-expressions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 SpEL 表达式</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 Spring Data JPA 版本 1.4 开始，我们支持在使用</font></font><code>@Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">在运行查询时，这些表达式会根据一组预定义的变量进行评估。</font><font style="vertical-align: inherit;">Spring Data JPA 支持一个名为</font></font><code>entityName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">它的用法是</font></font><code>select x from #{#entityName} x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它插入</font></font><code>entityName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与给定存储库关联的域类型的 。</font><font style="vertical-align: inherit;">该</font></font><code>entityName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解决如下：如果域类型已设置的name属性</font></font><code>@Entity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的注释，它被使用。</font><font style="vertical-align: inherit;">否则，将使用域类型的简单类名。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例演示</font></font><code>#{#entityName}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了查询字符串中表达式的</font><font style="vertical-align: inherit;">一个用例</font><font style="vertical-align: inherit;">，您希望使用查询方法和手动定义的查询定义存储库接口：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 67.在存储库查询方法中使用 SpEL 表达式 - entityName</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Id</span>
  <span class="hljs-meta">@GeneratedValue</span><font></font>
  Long id;<font></font>
<font></font>
  String lastname;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>,<span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Query("select u from #{#entityName} u where u.lastname = ?1")</span>
  <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了避免在</font></font><code>@Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">的查询字符串中声明实际的实体名称</font><font style="vertical-align: inherit;">，您可以使用该</font></font><code>#{#entityName}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该</font></font><code>entityName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过使用定制</font></font><code>@Entity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的注释。</font></font><code>orm.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SpEL 表达式不支持</font><font style="vertical-align: inherit;">自定义</font><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当然，您可以</font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接在查询声明中使用，但这也需要您更改查询。</font><font style="vertical-align: inherit;">对 的引用将</font></font><code>#entityName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未来可能的</font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">重新映射</font><font style="vertical-align: inherit;">到不同的实体名称（例如，通过使用</font></font><code>@Entity(name = "MyUser")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>#{#entityName}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询字符串中表达式的</font><font style="vertical-align: inherit;">另一个用例</font><font style="vertical-align: inherit;">是，如果您想为具体域类型定义具有专用存储库接口的通用存储库接口。</font><font style="vertical-align: inherit;">为避免在具体接口上重复自定义查询方法的定义，可以</font></font><code>@Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在通用存储库接口</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">注解</font><font style="vertical-align: inherit;">的查询字符串中使用实体名称表达式，</font><font style="vertical-align: inherit;">如下例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 68.在存储库查询方法中使用 SpEL 表达式 - entityName 与继承</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@MappedSuperclass</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbstractMappedType</span> </span>{<font></font>
  …<font></font>
  String attribute<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConcreteType</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractMappedType</span> </span>{ … }<font></font>
<font></font>
<span class="hljs-meta">@NoRepositoryBean</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MappedTypeRepository</span>&lt;<span class="hljs-title">T</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractMappedType</span>&gt;
  <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Query("select t from #{#entityName} t where t.attribute = ?1")</span>
  <span class="hljs-function">List&lt;T&gt; <span class="hljs-title">findAllByAttribute</span><span class="hljs-params">(String attribute)</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ConcreteRepository</span>
  <span class="hljs-keyword">extends</span> <span class="hljs-title">MappedTypeRepository</span>&lt;<span class="hljs-title">ConcreteType</span>&gt; </span>{ … }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在前面的示例中，该</font></font><code>MappedTypeRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口是一些扩展</font></font><code>AbstractMappedType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">它还定义了通用</font></font><code>findAllByAttribute(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法，可用于专用存储库接口的实例。</font><font style="vertical-align: inherit;">如果您现在调用</font></font><code>findByAllAttribute(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on </font></font><code>ConcreteRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，查询将变为</font></font><code>select t from ConcreteType t where t.attribute = ?1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作参数的 SpEL 表达式也可用于操作方法参数。</font><font style="vertical-align: inherit;">在这些 SpEL 表达式中，实体名称不可用，但参数可用。</font><font style="vertical-align: inherit;">可以通过名称或索引访问它们，如下例所示。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 69.在存储库查询方法中使用 SpEL 表达式 - 访问参数。</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Query("select u from User u where u.firstname = ?1 and u.firstname=?#{[0]} and u.emailAddress = ?#{principal.emailAddress}")</span>
<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByFirstnameAndCurrentUserWithCustomQuery</span><span class="hljs-params">(String firstname)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于</font></font><code>like</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-conditions，人们通常希望附加</font></font><code>%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到字符串值参数的开头或结尾。</font><font style="vertical-align: inherit;">这可以通过附加或前缀绑定参数标记或 SpEL 表达式来完成</font></font><code>%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">下面的例子再次证明了这一点。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 70.在存储库查询方法中使用 SpEL 表达式 - 通配符快捷方式。</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Query("select u from User u where u.lastname like %:#{[0]}% and u.lastname like %:lastname%")</span>
<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByLastnameWithSpelExpression</span><span class="hljs-params">(<span class="hljs-meta">@Param("lastname")</span> String lastname)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当</font></font><code>like</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对来自不安全来源的值</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">-conditions 时，应该对值进行清理，这样它们就不能包含任何通配符，从而允许攻击者选择比他们应该能够选择的更多的数据。</font><font style="vertical-align: inherit;">为此，该</font></font><code>escape(String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法在 SpEL 上下文中可用。</font><font style="vertical-align: inherit;">它将</font><font style="vertical-align: inherit;">第一个参数中</font><font style="vertical-align: inherit;">的</font></font><code>_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和 的</font><font style="vertical-align: inherit;">所有实例</font></font><code>%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加上第二个参数中的单个字符作为</font><font style="vertical-align: inherit;">前缀</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">结合</font><font style="vertical-align: inherit;">JPQL 和标准 SQL 中可用</font></font><code>escape</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>like</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式</font><font style="vertical-align: inherit;">子句，</font><font style="vertical-align: inherit;">这可以轻松清理绑定参数。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 71.在存储库查询方法中使用 SpEL 表达式 - 清理输入值。</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Query("select u from User u where u.firstname like %?#{escape([0])}% escape ?#{escapeCharacter()}")</span>
<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findContainingEscaped</span><span class="hljs-params">(String namePart)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鉴于存储库接口中的此方法声明</font></font><code>findContainingEscaped("Peter_")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将找到</font></font><code>Peter_Parker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但不是</font></font><code>Peter Parker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">所使用的转义字符可以通过设置来配置</font></font><code>escapeCharacter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述的</font></font><code>@EnableJpaRepositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释。</font><font style="vertical-align: inherit;">请注意，</font></font><code>escape(String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SpEL 上下文中可用</font><font style="vertical-align: inherit;">的方法</font><font style="vertical-align: inherit;">只会转义 SQL 和 JPQL 标准通配符</font></font><code>_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">如果底层数据库或 JPA 实现支持额外的通配符，这些将不会被转义。</font></font></p>
</div>
</div>
<div class="sect4">
<h5 id="jpa.modifying-queries"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.modifying-queries"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修改查询</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面的所有部分都描述了如何声明查询以访问给定的实体或实体集合。</font><font style="vertical-align: inherit;">您可以使用“ </font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.custom-implementations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Repositories 的自定义实现</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”中描述的自定义方法工具添加自定义修改行为</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由于这种方法对于全面的自定义功能是可行的，您可以通过使用 注释查询方法来修改只需要参数绑定的查询</font></font><code>@Modifying</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 72. 声明操作查询</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Modifying</span>
<span class="hljs-meta">@Query("update User u set u.firstname = ?1 where u.lastname = ?2")</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">setFixedFirstnameFor</span><span class="hljs-params">(String firstname, String lastname)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样做会触发注释到方法的查询作为更新查询而不是选择查询。</font><font style="vertical-align: inherit;">作为</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能的修改查询执行后包含过时的实体，我们不会自动清除它（见</font></font><a href="https://docs.oracle.com/javaee/7/api/javax/persistence/EntityManager.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的JavaDoc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>EntityManager.clear()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">详细内容），因为这有效地删除所有非刷新的变化仍悬而未决的</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您希望</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动清除 ，可以将</font></font><code>@Modifying</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释的</font></font><code>clearAutomatically</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>@Modifying</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释是唯一与组合相关的</font></font><code>@Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释。</font><font style="vertical-align: inherit;">派生查询方法或自定义方法不需要此注释。</font></font></p>
</div>
<div class="sect5">
<h6 id="jpa.modifying-queries.derived-delete"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.modifying-queries.derived-delete"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">派生删除查询</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data JPA 还支持派生删除查询，让您不必显式声明 JPQL 查询，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 73.使用派生的删除查询</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteByRoleId</span><span class="hljs-params">(<span class="hljs-keyword">long</span> roleId)</span></span>;<font></font>
<font></font>
  <span class="hljs-meta">@Modifying</span>
  <span class="hljs-meta">@Query("delete from User u where u.role.id = ?1")</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteInBulkByRoleId</span><span class="hljs-params">(<span class="hljs-keyword">long</span> roleId)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管该</font></font><code>deleteByRoleId(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法看起来基本上产生与 相同的结果</font></font><code>deleteInBulkByRoleId(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但在运行方式方面，这两个方法声明之间存在重要差异。</font><font style="vertical-align: inherit;">顾名思义，后一种方法针对数据库发出单个 JPQL 查询（在注释中定义的查询）。</font><font style="vertical-align: inherit;">这意味着即使当前加载的实例</font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也看不到调用的生命周期回调。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了确保生命周期查询被实际调用，调用</font></font><code>deleteByRoleId(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行一个查询，然后一个一个删除返回的实例，这样持久化提供者就可以实际调用</font></font><code>@PreRemove</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些实体的回调。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事实上，派生删除查询是运行查询，然后调用快捷</font></font><code>CrudRepository.delete(Iterable&lt;User&gt; users)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的结果，并保持行为的同步与其他的实现</font></font><code>delete(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的方法</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jpa.query-hints"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.query-hints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用查询提示</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要将 JPA 查询提示应用于存储库接口中声明的查询，您可以使用</font></font><code>@QueryHints</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释。</font><font style="vertical-align: inherit;">它需要一组 JPA</font></font><code>@QueryHint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释加上一个布尔标志来潜在地禁用应用于应用分页时触发的附加计数查询的提示，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 74. 将 QueryHints 与存储库方法一起使用</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-meta">@QueryHints(value = { @QueryHint(name = "name", value = "value")},
              forCounting = false)</span>
  <span class="hljs-function">Page&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面的声明将应用</font></font><code>@QueryHint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为该实际查询</font><font style="vertical-align: inherit;">配置的配置</font><font style="vertical-align: inherit;">，但省略将其应用于触发以计算总页数的计数查询。</font></font></p>
</div>
</div>
<div class="sect4">
<h5 id="jpa.entity-graph"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.entity-graph"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置 Fetch- 和 LoadGraphs</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPA 2.1 规范引入了对指定 Fetch- 和 LoadGraphs 的支持，我们也支持</font></font><code>@EntityGraph</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释，它允许您引用</font></font><code>@NamedEntityGraph</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义。</font><font style="vertical-align: inherit;">您可以在实体上使用该注释来配置结果查询的获取计划。</font><font style="vertical-align: inherit;">获取的类型（</font></font><code>Fetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>Load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）可以通过使用</font><font style="vertical-align: inherit;">注释</font></font><code>type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上的属性</font><font style="vertical-align: inherit;">进行配置</font></font><code>@EntityGraph</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅 JPA 2.1 规范 3.7.4 以获取进一步参考。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示如何在实体上定义命名实体图：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 75. 在实体上定义命名实体图。</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@NamedEntityGraph(name = "GroupInfo.detail",
  attributeNodes = @NamedAttributeNode("members"))</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GroupInfo</span> </span>{<font></font>
<font></font>
  <span class="hljs-comment">// default fetch mode is lazy.</span>
  <span class="hljs-meta">@ManyToMany</span>
  List&lt;GroupMember&gt; members = <span class="hljs-keyword">new</span> ArrayList&lt;GroupMember&gt;();<font></font>
<font></font>
  …<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示如何在存储库查询方法上引用命名实体图：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 76.在存储库查询方法上引用命名实体图定义。</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">GroupRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">GroupInfo</span>, <span class="hljs-title">String</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-meta">@EntityGraph(value = "GroupInfo.detail", type = EntityGraphType.LOAD)</span>
  <span class="hljs-function">GroupInfo <span class="hljs-title">getByGroupName</span><span class="hljs-params">(String name)</span></span>;<font></font>
<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以使用 来定义临时实体图</font></font><code>@EntityGraph</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">提供的</font></font><code>attributePaths</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被翻译成对应</font></font><code>EntityGraph</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而无需显式添加</font></font><code>@NamedEntityGraph</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到您的域类型，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 77.在存储库查询方法上使用 AD-HOC 实体图定义。</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">GroupRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">GroupInfo</span>, <span class="hljs-title">String</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-meta">@EntityGraph(attributePaths = { "members" })</span>
  <span class="hljs-function">GroupInfo <span class="hljs-title">getByGroupName</span><span class="hljs-params">(String name)</span></span>;<font></font>
<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="projections"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#projections"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预测</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data 查询方法通常返回存储库管理的聚合根的一个或多个实例。</font><font style="vertical-align: inherit;">但是，有时可能需要根据这些类型的某些属性创建投影。</font><font style="vertical-align: inherit;">Spring Data 允许对专用返回类型进行建模，以更有选择地检索托管聚合的部分视图。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">想象一个存储库和聚合根类型，例如以下示例：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 78. 示例聚合和存储库</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Id</span> UUID id;<font></font>
  String firstname, lastname;<font></font>
  Address address;<font></font>
<font></font>
  <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span> </span>{<font></font>
    String zipCode, city, street;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">UUID</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function">Collection&lt;Person&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在假设我们只想检索此人的姓名属性。</font><font style="vertical-align: inherit;">Spring Data 提供什么方法​​来实现这一目标？</font><font style="vertical-align: inherit;">本章的其余部分回答了这个问题。</font></font></p>
</div>
<div class="sect5">
<h6 id="projections.interfaces"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#projections.interfaces"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于界面的投影</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将查询结果限制为仅名称属性的最简单方法是声明一个接口，该接口公开要读取的属性的访问器方法，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 79. 用于检索属性子集的投影接口</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NamesOnly</span> </span>{<font></font>
<font></font>
  <span class="hljs-function">String <span class="hljs-title">getFirstname</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function">String <span class="hljs-title">getLastname</span><span class="hljs-params">()</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里的重要一点是这里定义的属性与聚合根中的属性完全匹配。</font><font style="vertical-align: inherit;">这样做可以添加一个查询方法，如下所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 80. 使用基于接口的投影和查询方法的存储库</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">UUID</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function">Collection&lt;NamesOnly&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询执行引擎在运行时为每个返回的元素创建该接口的代理实例，并将对公开方法的调用转发到目标对象。</font></font></p>
</div>
<div id="projections.interfaces.nested" class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以递归地使用投影。</font><font style="vertical-align: inherit;">如果您还想包含一些</font></font><code>Address</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息，请为其创建一个投影接口，并从 的声明中返回该接口</font></font><code>getAddress()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 81. 用于检索属性子集的投影接口</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonSummary</span> </span>{<font></font>
<font></font>
  <span class="hljs-function">String <span class="hljs-title">getFirstname</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function">String <span class="hljs-title">getLastname</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function">AddressSummary <span class="hljs-title">getAddress</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
  <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AddressSummary</span> </span>{
    <span class="hljs-function">String <span class="hljs-title">getCity</span><span class="hljs-params">()</span></span>;<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在方法调用时，</font></font><code>address</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取目标实例</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">属性并依次包装到投影代理中。</font></font></p>
</div>
<div class="sect6">
<h7 id="projections.interfaces.closed"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#projections.interfaces.closed"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">封闭式投影</font></font></h7>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其访问器方法都与目标聚合的属性匹配的投影接口被认为是封闭投影。</font><font style="vertical-align: inherit;">以下示例（我们在本章前面也使用过）是一个封闭投影：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 82. 闭合投影</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NamesOnly</span> </span>{<font></font>
<font></font>
  <span class="hljs-function">String <span class="hljs-title">getFirstname</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function">String <span class="hljs-title">getLastname</span><span class="hljs-params">()</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果使用封闭投影，Spring Data 可以优化查询执行，因为我们知道支持投影代理所需的所有属性。</font><font style="vertical-align: inherit;">有关更多详细信息，请参阅参考文档中特定于模块的部分。</font></font></p>
</div>
</div>
<div class="sect6">
<h7 id="projections.interfaces.open"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#projections.interfaces.open"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开投影</font></font></h7>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投影接口中的访问器方法也可用于通过使用</font></font><code>@Value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">计算新值</font><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div id="projections.interfaces.open.simple" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例 83. 一个开放的投影</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NamesOnly</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Value("#{target.firstname + ' ' + target.lastname}")</span>
  <span class="hljs-function">String <span class="hljs-title">getFullName</span><span class="hljs-params">()</span></span>;<font></font>
  …<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持投影的聚合根在</font></font><code>target</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量中</font><font style="vertical-align: inherit;">可用</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用的投影界面</font></font><code>@Value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是开放式投影。</font><font style="vertical-align: inherit;">在这种情况下，Spring Data 无法应用查询执行优化，因为 SpEL 表达式可以使用聚合根的任何属性。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中使用的表达式</font></font><code>@Value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不应太复杂——您希望避免在</font></font><code>String</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量中</font><font style="vertical-align: inherit;">编程</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于非常简单的表达式，一种选择可能是采用默认方法（在 Java 8 中引入），如以下示例所示：</font></font></p>
</div>
<div id="projections.interfaces.open.default" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 84. 使用自定义逻辑的默认方法的投影界面</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NamesOnly</span> </span>{<font></font>
<font></font>
  <span class="hljs-function">String <span class="hljs-title">getFirstname</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function">String <span class="hljs-title">getLastname</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">default</span> String <span class="hljs-title">getFullName</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> getFirstname().concat(<span class="hljs-string">" "</span>).concat(getLastname());<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种方法要求您能够纯粹基于投影接口上公开的其他访问器方法来实现逻辑。</font><font style="vertical-align: inherit;">第二个更灵活的选择是在 Spring bean 中实现自定义逻辑，然后从 SpEL 表达式调用它，如以下示例所示：</font></font></p>
</div>
<div id="projections.interfaces.open.bean-reference" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 85. 示例 Person 对象</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Component</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBean</span> </span>{<font></font>
<font></font>
  <span class="hljs-function">String <span class="hljs-title">getFullName</span><span class="hljs-params">(Person person)</span> </span>{<font></font>
    …<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NamesOnly</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Value("#{@myBean.getFullName(target)}")</span>
  <span class="hljs-function">String <span class="hljs-title">getFullName</span><span class="hljs-params">()</span></span>;<font></font>
  …<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意 SpEL 表达式如何引用</font></font><code>myBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和调用该</font></font><code>getFullName(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法并将投影目标作为方法参数转发。</font><font style="vertical-align: inherit;">由 SpEL 表达式评估支持的方法也可以使用方法参数，然后可以从表达式中引用这些参数。</font><font style="vertical-align: inherit;">方法参数可通过</font></font><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名为</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">数组获得</font></font><code>args</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下示例显示了如何从</font></font><code>args</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组中</font><font style="vertical-align: inherit;">获取方法参数</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 86. 示例 Person 对象</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NamesOnly</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Value("#{args[0] + ' ' + target.firstname + '!'}")</span>
  <span class="hljs-function">String <span class="hljs-title">getSalutation</span><span class="hljs-params">(String prefix)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同样，对于更复杂的表达式，您应该使用 Spring bean 并让表达式调用一个方法，</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#projections.interfaces.open.bean-reference"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如前所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="sect6">
<h7 id="projections.interfaces.nullable-wrappers"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#projections.interfaces.nullable-wrappers"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可空包装器</font></font></h7>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投影接口中的 getter 可以使用可为空的包装器来提高空安全性。</font><font style="vertical-align: inherit;">当前支持的包装器类型有：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.util.Optional</code></p>
</li>
<li>
<p><code>com.google.common.base.Optional</code></p>
</li>
<li>
<p><code>scala.Option</code></p>
</li>
<li>
<p><code>io.vavr.control.Option</code></p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 87. 使用可为空包装器的投影接口</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NamesOnly</span> </span>{<font></font>
<font></font>
  <span class="hljs-function">Optional&lt;String&gt; <span class="hljs-title">getFirstname</span><span class="hljs-params">()</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果基础投影值不是</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则使用包装器类型的当前表示返回值。</font><font style="vertical-align: inherit;">如果支持值是</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则 getter 方法返回所用包装器类型的空表示。</font></font></p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="projections.dtos"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#projections.dtos"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于类的预测 (DTO)</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义投影的另一种方法是使用值类型 DTO（数据传输对象），这些 DTO 包含应该检索的字段的属性。</font><font style="vertical-align: inherit;">这些 DTO 类型可以以与使用投影接口完全相同的方式使用，除了不发生代理并且不可以应用嵌套投影。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果存储通过限制要加载的字段来优化查询执行，则要加载的字段由公开的构造函数的参数名称确定。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了一个投影 DTO：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例 88. 一个投影 DTO</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NamesOnly</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String firstname, lastname;<font></font>
<font></font>
  NamesOnly(String firstname, String lastname) {<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.firstname = firstname;
    <span class="hljs-keyword">this</span>.lastname = lastname;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function">String <span class="hljs-title">getFirstname</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.firstname;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function">String <span class="hljs-title">getLastname</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.lastname;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// equals(…) and hashCode() implementations</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="提示"></i>
</td>
<td class="content">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">避免投影 DTO 的样板代码</font></font></div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用</font></font><a href="https://projectlombok.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project Lombok</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显着简化 DTO 的代码</font><font style="vertical-align: inherit;">，它提供了一个</font></font><code>@Value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注解（不要与</font></font><code>@Value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面的接口示例中显示的</font><font style="vertical-align: inherit;">Spring 的</font><font style="vertical-align: inherit;">注解</font><font style="vertical-align: inherit;">混淆</font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">如果使用 Project Lombok 的</font></font><code>@Value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注解，之前显示的示例 DTO 将变为以下内容：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Value</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NamesOnly</span> </span>{<font></font>
	String firstname, lastname;<font></font>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段是</font></font><code>private final</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认的，该类公开了一个构造函数，该构造函数接受所有字段并自动获取</font></font><code>equals(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>hashCode()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现方法。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基于类的投影不适用于本机查询。</font><font style="vertical-align: inherit;">作为一种解决方法，您可以使用命名查询</font></font><code>ResultSetMapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或 Hibernate 特定的</font></font><a href="https://docs.jboss.org/hibernate/orm/6.0/javadocs/org/hibernate/transform/ResultTransformer.html"><code>ResultTransformer</code></a>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="projection.dynamic"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#projection.dynamic"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态投影</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，我们已经使用投影类型作为集合的返回类型或元素类型。</font><font style="vertical-align: inherit;">但是，您可能希望选择在调用时使用的类型（这使其成为动态的）。</font><font style="vertical-align: inherit;">要应用动态投影，请使用如下例所示的查询方法：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 89. 使用动态投影参数的存储库</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">UUID</span>&gt; </span>{<font></font>
<font></font>
  &lt;T&gt; <span class="hljs-function">Collection&lt;T&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Class&lt;T&gt; type)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样，该方法可用于按原样或应用投影获取聚合，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 90.使用具有动态投影的存储库</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">someMethod</span><span class="hljs-params">(PersonRepository people)</span> </span>{<font></font>
<font></font>
  Collection&lt;Person&gt; aggregates =<font></font>
    people.findByLastname(<span class="hljs-string">"Matthews"</span>, Person.class);<font></font>
<font></font>
  Collection&lt;NamesOnly&gt; aggregates =<font></font>
    people.findByLastname(<span class="hljs-string">"Matthews"</span>, NamesOnly.class);<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jpa.stored-procedures"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.stored-procedures"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.4. </font><font style="vertical-align: inherit;">存储过程</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPA 2.1 规范引入了对使用 JPA 条件查询 API 调用存储过程的支持。</font><font style="vertical-align: inherit;">我们引入了</font></font><code>@Procedure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于在存储库方法上声明存储过程元数据</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">注释。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例使用以下存储过程：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example 91. </font></font><code>plus1inout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HSQL DB 中过程</font><font style="vertical-align: inherit;">的定义</font><font style="vertical-align: inherit;">。</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sql" class="language-sql hljs">/;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">procedure</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> plus1inout<font></font>
/;<font></font>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">procedure</span> plus1inout (<span class="hljs-keyword">IN</span> arg <span class="hljs-built_in">int</span>, <span class="hljs-keyword">OUT</span> res <span class="hljs-built_in">int</span>)
<span class="hljs-keyword">BEGIN</span> ATOMIC
 <span class="hljs-keyword">set</span> res = arg + <span class="hljs-number">1</span>;
<span class="hljs-keyword">END</span>
/;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过使用</font></font><code>NamedStoredProcedureQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实体类型上</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">来配置存储过程的元数据</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="jpa.stored-procedure-entity-metadata" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 92.实体上的 StoredProcedure 元数据定义。</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@NamedStoredProcedureQuery(name = "User.plus1", procedureName = "plus1inout", parameters = {
  @StoredProcedureParameter(mode = ParameterMode.IN, name = "arg", type = Integer.class),
  @StoredProcedureParameter(mode = ParameterMode.OUT, name = "res", type = Integer.class) })</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，</font></font><code>@NamedStoredProcedureQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储过程有两个不同的名称。
</font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 JPA 使用的名称。</font></font><code>procedureName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是存储过程在数据库中的名称。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以通过多种方式从存储库方法中引用存储过程。</font><font style="vertical-align: inherit;">要调用的存储过程可以直接使用</font><font style="vertical-align: inherit;">注解</font><font style="vertical-align: inherit;">的</font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>procedureName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">定义</font></font><code>@Procedure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这直接引用数据库中的存储过程，并忽略通过</font></font><code>@NamedStoredProcedureQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，您可以将</font></font><code>@NamedStoredProcedureQuery.name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">指定</font><font style="vertical-align: inherit;">为</font></font><code>@Procedure.name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性。</font><font style="vertical-align: inherit;">如果没有</font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>procedureName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也没有</font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被配置，存储库方法的名称被用作</font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了如何引用显式映射的过程：</font></font></p>
</div>
<div id="jpa.stored-procedure-reference" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 93. 引用数据库中名称为“plus1inout”的显式映射过程。</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Procedure("plus1inout")</span>
<span class="hljs-function">Integer <span class="hljs-title">explicitlyNamedPlus1inout</span><span class="hljs-params">(Integer arg)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例与前一个示例等效，但使用</font></font><code>procedureName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">别名：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 94. 通过</font></font><code>procedureName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">别名</font><font style="vertical-align: inherit;">在数据库中引用名为“plus1inout”的隐式映射过程</font><font style="vertical-align: inherit;">。</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Procedure(procedureName = "plus1inout")</span>
<span class="hljs-function">Integer <span class="hljs-title">callPlus1InOut</span><span class="hljs-params">(Integer arg)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下再次等效于前两个，但使用方法名称而不是显式注释属性。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 95.</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用方法名称</font><font style="vertical-align: inherit;">引用隐式映射的命名存储过程“User.plus1” </font><font style="vertical-align: inherit;">。</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Procedure</span>
<span class="hljs-function">Integer <span class="hljs-title">plus1inout</span><span class="hljs-params">(<span class="hljs-meta">@Param("arg")</span> Integer arg)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示如何通过引用</font></font><code>@NamedStoredProcedureQuery.name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">来引用存储过程</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 96.在</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Procedure(name = "User.plus1IO")</span>
<span class="hljs-function">Integer <span class="hljs-title">entityAnnotatedCustomNamedProcedurePlus1IO</span><span class="hljs-params">(<span class="hljs-meta">@Param("arg")</span> Integer arg)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果被调用的存储过程有一个单出参数，则该参数可以作为方法的返回值返回。</font><font style="vertical-align: inherit;">如果在</font></font><code>@NamedStoredProcedureQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释中</font><font style="vertical-align: inherit;">指定了多个输出参数，则</font><font style="vertical-align: inherit;">这些</font><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">可以作为 a 返回，</font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键是</font></font><code>@NamedStoredProcedureQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释中</font><font style="vertical-align: inherit;">给出的参数名称</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="specifications"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#specifications"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.5. </font><font style="vertical-align: inherit;">规格</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPA 2 引入了一个标准 API，您可以使用它以编程方式构建查询。</font><font style="vertical-align: inherit;">通过编写</font></font><code>criteria</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以定义域类查询的 where 子句。</font><font style="vertical-align: inherit;">再退一步，这些标准可以被视为对 JPA 标准 API 约束所描述的实体的谓词。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data JPA 从 Eric Evans 的书“Domain Driven Design”中采用了规范的概念，遵循相同的语义并提供 API 以使用 JPA 标准 API 定义此类规范。</font><font style="vertical-align: inherit;">为了支持规范，您可以使用该</font></font><code>JpaSpecificationExecutor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font><font style="vertical-align: inherit;">扩展您的存储库</font><font style="vertical-align: inherit;">接口，如下所示：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CustomerRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">Customer</span>, <span class="hljs-title">Long</span>&gt;, <span class="hljs-title">JpaSpecificationExecutor</span>&lt;<span class="hljs-title">Customer</span>&gt; </span>{<font></font>
 …<font></font>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附加接口的方法可以让您以多种方式运行规范。</font><font style="vertical-align: inherit;">例如，该</font></font><code>findAll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法返回与规范匹配的所有实体，如以下示例所示：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">List&lt;T&gt; <span class="hljs-title">findAll</span><span class="hljs-params">(Specification&lt;T&gt; spec)</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>Specification</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口被定义为如下：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Specification</span>&lt;<span class="hljs-title">T</span>&gt; </span>{
  <span class="hljs-function">Predicate <span class="hljs-title">toPredicate</span><span class="hljs-params">(Root&lt;T&gt; root, CriteriaQuery&lt;?&gt; query,
            CriteriaBuilder builder)</span></span>;<font></font>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规范可以很容易地用于在实体之上构建一组可扩展的谓词，然后可以组合和使用这些谓词，</font></font><code>JpaRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而无需为每个需要的组合声明查询（方法），如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 97. 客户规格</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomerSpecs</span> </span>{<font></font>
<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Specification&lt;Customer&gt; <span class="hljs-title">isLongTermCustomer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> (root, query, builder) -&gt; {<font></font>
      LocalDate date = LocalDate.now().minusYears(<span class="hljs-number">2</span>);
      <span class="hljs-keyword">return</span> builder.lessThan(root.get(Customer_.createdAt), date);<font></font>
    };<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Specification&lt;Customer&gt; <span class="hljs-title">hasSalesOfMoreThan</span><span class="hljs-params">(MonetaryAmount value)</span> </span>{
    <span class="hljs-keyword">return</span> (root, query, builder) -&gt; {
      <span class="hljs-comment">// build query here</span><font></font>
    };<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>Customer_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型是使用 JPA 元模型生成器生成的元模型类型（</font></font><a href="https://docs.jboss.org/hibernate/jpamodelgen/1.0/reference/en-US/html_single/#whatisit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关示例，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参阅</font><a href="https://docs.jboss.org/hibernate/jpamodelgen/1.0/reference/en-US/html_single/#whatisit"><font style="vertical-align: inherit;">Hibernate 实现的文档</font></a><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">因此表达式 ,</font></font><code>Customer_.createdAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假定</font></font><code>Customer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有</font></font><code>createdAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">属性</font></font><code>Date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除此之外，我们在业务需求抽象级别上表达了一些标准并创建了可执行文件</font></font><code>Specifications</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所以客户端可能会使用 a</font></font><code>Specification</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 98. 使用简单的规范</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">List&lt;Customer&gt; customers = customerRepository.findAll(isLongTermCustomer());</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为什么不为这种数据访问创建查询？</font></font><code>Specification</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与普通的查询声明相比，</font><font style="vertical-align: inherit;">使用单个</font><font style="vertical-align: inherit;">并没有太大的好处。</font><font style="vertical-align: inherit;">当您将规范组合起来创建新</font></font><code>Specification</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font><font style="vertical-align: inherit;">时，规范的力量会真正发挥作用</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以通过</font></font><code>Specification</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们提供</font><font style="vertical-align: inherit;">的默认方法来实现这一点，</font><font style="vertical-align: inherit;">以构建类似于以下内容的表达式：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 99. 组合规格</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">MonetaryAmount amount = <span class="hljs-keyword">new</span> MonetaryAmount(<span class="hljs-number">200.0</span>, Currencies.DOLLAR);<font></font>
List&lt;Customer&gt; customers = customerRepository.findAll(<font></font>
  isLongTermCustomer().or(hasSalesOfMoreThan(amount)));</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Specification</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供了一些“胶水代码”默认方法来链接和组合</font></font><code>Specification</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例。</font><font style="vertical-align: inherit;">这些方法让您可以通过创建新的</font></font><code>Specification</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现并将它们与现有的实现相结合来</font><font style="vertical-align: inherit;">扩展数据访问层</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="query-by-example"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.6. </font><font style="vertical-align: inherit;">按示例查询</font></font></h4>
<div class="sect4">
<h5 id="query-by-example.introduction"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example.introduction"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本章介绍了 Query by Example 并解释了如何使用它。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例查询 (QBE) 是一种用户友好的查询技术，具有简单的界面。</font><font style="vertical-align: inherit;">它允许动态创建查询，并且不需要您编写包含字段名称的查询。</font><font style="vertical-align: inherit;">事实上，Query by Example 根本不需要您使用特定于商店的查询语言编写查询。</font></font></p>
</div>
</div>
<div class="sect4">
<h5 id="query-by-example.usage"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example.usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Query by Example API 由三部分组成：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">探针：具有填充字段的域对象的实际示例。</font></font></p>
</li>
<li>
<p><code>ExampleMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><code>ExampleMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含有关如何匹配特定字段的详细信息。</font><font style="vertical-align: inherit;">它可以在多个示例中重复使用。</font></font></p>
</li>
<li>
<p><code>Example</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: An</font></font><code>Example</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由探针和</font></font><code>ExampleMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">它用于创建查询。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Query by Example 非常适合以下几个用例：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用一组静态或动态约束查询您的数据存储。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">频繁重构域对象而不必担心破坏现有查询。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">独立于底层数据存储 API 工作。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Query by Example 也有几个限制：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不支持嵌套或分组的属性约束，例如</font></font><code>firstname = ?0 or (firstname = ?1 and lastname = ?2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅支持字符串的开始/包含/结束/正则表达式匹配以及其他属性类型的精确匹配。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在开始使用 Query by Example 之前，您需要有一个域对象。</font><font style="vertical-align: inherit;">首先，为您的存储库创建一个接口，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 100. 示例 Person 对象</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Id</span>
  <span class="hljs-keyword">private</span> String id;
  <span class="hljs-keyword">private</span> String firstname;
  <span class="hljs-keyword">private</span> String lastname;
  <span class="hljs-keyword">private</span> Address address;<font></font>
<font></font>
  <span class="hljs-comment">// … getters and setters omitted</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面的示例显示了一个简单的域对象。</font><font style="vertical-align: inherit;">您可以使用它来创建</font></font><code>Example</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">默认情况下，</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">忽略</font><font style="vertical-align: inherit;">具有</font><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">字段</font><font style="vertical-align: inherit;">，并使用商店特定的默认值匹配字符串。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将属性包含在 Query by Example 标准中是基于可空性。</font><font style="vertical-align: inherit;">除非</font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example.matchers"><font style="vertical-align: inherit;">忽略属性路径，</font></a><font style="vertical-align: inherit;">否则始终包含</font><font style="vertical-align: inherit;">使用原始类型 ( </font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>double</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ...)</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example.matchers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的属性</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用</font></font><code>of</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工厂方法或使用</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example.matchers"><code>ExampleMatcher</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>Example</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是不可变的。</font><font style="vertical-align: inherit;">以下清单显示了一个简单的示例：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 101. 简单示例</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Person person = <span class="hljs-keyword">new</span> Person();                         <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
person.setFirstname(<span class="hljs-string">"Dave"</span>);                          <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
Example&lt;Person&gt; example = Example.of(person);         <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建域对象的新实例。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置要查询的属性。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建</font></font><code>Example</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用存储库运行示例查询。</font><font style="vertical-align: inherit;">为此，让您的存储库接口扩展</font></font><code>QueryByExampleExecutor&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">以下清单显示了</font></font><code>QueryByExampleExecutor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">界面</font><font style="vertical-align: inherit;">的摘录</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例 102. </font></font><code>QueryByExampleExecutor</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">QueryByExampleExecutor</span>&lt;<span class="hljs-title">T</span>&gt; </span>{<font></font>
<font></font>
  &lt;S extends T&gt; <span class="hljs-function">S <span class="hljs-title">findOne</span><span class="hljs-params">(Example&lt;S&gt; example)</span></span>;<font></font>
<font></font>
  &lt;S extends T&gt; <span class="hljs-function">Iterable&lt;S&gt; <span class="hljs-title">findAll</span><span class="hljs-params">(Example&lt;S&gt; example)</span></span>;<font></font>
<font></font>
  <span class="hljs-comment">// … more functionality omitted.</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="query-by-example.matchers"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example.matchers"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例匹配器</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例不限于默认设置。</font><font style="vertical-align: inherit;">您可以使用 为字符串匹配、空值处理和特定于属性的设置指定自己的默认值</font></font><code>ExampleMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 103. 具有自定义匹配的示例匹配器</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Person person = <span class="hljs-keyword">new</span> Person();                          <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
person.setFirstname(<span class="hljs-string">"Dave"</span>);                           <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
ExampleMatcher matcher = ExampleMatcher.matching()     <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
  .withIgnorePaths(<span class="hljs-string">"lastname"</span>)                         <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b>
  .withIncludeNullValues()                             <i class="conum" data-value="5"></i><b>(<span class="hljs-number">5</span>)</b>
  .withStringMatcher(StringMatcher.ENDING);            <i class="conum" data-value="6"></i><b>(<span class="hljs-number">6</span>)</b><font></font>
<font></font>
Example&lt;Person&gt; example = Example.of(person, matcher); <i class="conum" data-value="7"></i><b>(<span class="hljs-number">7</span>)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建域对象的新实例。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置属性。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个</font></font><code>ExampleMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以期望所有值匹配。</font><font style="vertical-align: inherit;">即使没有进一步的配置，它也可以在这个阶段使用。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造一个新</font></font><code>ExampleMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的忽略</font></font><code>lastname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性路径。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造一个 new</font></font><code>ExampleMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以忽略</font></font><code>lastname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性路径并包含空值。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造一个 new</font></font><code>ExampleMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来忽略</font></font><code>lastname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性路径，包含空值，并执行后缀字符串匹配。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个新的</font></font><code>Example</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于域对象和配置上</font></font><code>ExampleMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，</font></font><code>ExampleMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">期望在探测器上设置的所有值都匹配。</font><font style="vertical-align: inherit;">如果要获得与任何隐式定义的谓词匹配的结果，请使用</font></font><code>ExampleMatcher.matchingAny()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以为单个属性指定行为（例如“名字”和“姓氏”，或者对于嵌套属性，“address.city”）。</font><font style="vertical-align: inherit;">您可以使用匹配选项和区分大小写来调整它，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 104. 配置匹配器选项</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">ExampleMatcher matcher = ExampleMatcher.matching()<font></font>
  .withMatcher(<span class="hljs-string">"firstname"</span>, endsWith())<font></font>
  .withMatcher(<span class="hljs-string">"lastname"</span>, startsWith().ignoreCase());<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一种配置匹配器选项的方法是使用 lambdas（在 Java 8 中引入）。</font><font style="vertical-align: inherit;">这种方法创建了一个回调，要求实现者修改匹配器。</font><font style="vertical-align: inherit;">您不需要返回匹配器，因为配置选项保存在匹配器实例中。</font><font style="vertical-align: inherit;">以下示例显示了使用 lambda 的匹配器：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 105. 使用 lambda 配置匹配器选项</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">ExampleMatcher matcher = ExampleMatcher.matching()<font></font>
  .withMatcher(<span class="hljs-string">"firstname"</span>, match -&gt; match.endsWith())<font></font>
  .withMatcher(<span class="hljs-string">"firstname"</span>, match -&gt; match.startsWith());<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>Example</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用配置的合并视图</font><font style="vertical-align: inherit;">创建的查询</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认匹配设置可以在</font></font><code>ExampleMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别设置，而单独的设置可以应用于特定的属性路径。</font><font style="vertical-align: inherit;">已设置上的设置</font></font><code>ExampleMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由属性路径设置继承，除非它们被明确定义。</font><font style="vertical-align: inherit;">属性补丁上的设置比默认设置具有更高的优先级。</font><font style="vertical-align: inherit;">下表描述了各种</font></font><code>ExampleMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">的范围</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 4.</font></font><code>ExampleMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">范围</font></font></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">环境</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空处理</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExampleMatcher</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串匹配</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExampleMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 和财产路径</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">忽略属性</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性路径</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">区分大小写</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExampleMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 和财产路径</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价值转化</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性路径</font></font></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="query-by-example.running"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#query-by-example.running"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行示例</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Spring Data JPA 中，您可以将 Query by Example 与 Repositories 一起使用，如下例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 106. 使用存储库按示例查询</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">String</span>&gt; </span>{ … }<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonService</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Autowired</span> PersonRepository personRepository;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Person&gt; <span class="hljs-title">findPeople</span><span class="hljs-params">(Person probe)</span> </span>{
    <span class="hljs-keyword">return</span> personRepository.findAll(Example.of(probe));<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目前，只有</font></font><code>SingularAttribute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性可以用于属性匹配。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性说明符接受属性名称（例如</font></font><code>firstname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>lastname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">您可以通过将属性与点 ( </font></font><code>address.city</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font><font style="vertical-align: inherit;">链接在一起进行导航</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您还可以使用匹配选项和区分大小写来调整它。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下表显示了</font></font><code>StringMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用</font><font style="vertical-align: inherit;">的各种</font><font style="vertical-align: inherit;">选项以及在名为 的字段上使用它们的结果</font></font><code>firstname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 5.</font></font><code>StringMatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font></font></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逻辑结果</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFAULT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （区分大小写）</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname = ?0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFAULT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （不区分大小写）</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER(firstname) = LOWER(?0)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXACT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （区分大小写）</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname = ?0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXACT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （不区分大小写）</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER(firstname) = LOWER(?0)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STARTING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （区分大小写）</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname like ?0 + '%'</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STARTING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （不区分大小写）</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER(firstname) like LOWER(?0) + '%'</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENDING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （区分大小写）</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname like '%' + ?0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENDING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （不区分大小写）</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER(firstname) like '%' + LOWER(?0)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONTAINING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （区分大小写）</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname like '%' + ?0 + '%'</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONTAINING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （不区分大小写）</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER(firstname) like '%' + LOWER(?0) + '%'</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="transactions"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#transactions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.7. </font><font style="vertical-align: inherit;">交易性</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，从存储库实例继承的 CRUD 方法</font></font><a href="https://docs.spring.io/spring-data/data-jpa/docs/current/api/org/springframework/data/jpa/repository/support/SimpleJpaRepository.html"><code>SimpleJpaRepository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是事务性的。</font><font style="vertical-align: inherit;">对于读取操作，事务配置</font></font><code>readOnly</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志设置为</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所有其他人都使用普通配置，</font></font><code>@Transactional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以便应用默认事务配置。</font><font style="vertical-align: inherit;">由事务存储库片段支持的存储库方法从实际片段方法继承事务属性。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您需要为存储库中声明的方法之一调整事务配置，请在存储库接口中重新声明该方法，如下所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 107. CRUD 的自定义事务配置</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-meta">@Transactional(timeout = 10)</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
  <span class="hljs-comment">// Further query method declarations</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样做会导致</font></font><code>findAll()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法以 10 秒的超时时间运行并且没有</font></font><code>readOnly</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志。</font></font></p>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改变事务行为的另一种方法是使用（通常）覆盖多个存储库的外观或服务实现。</font><font style="vertical-align: inherit;">其目的是为非 CRUD 操作定义事务边界。</font><font style="vertical-align: inherit;">以下示例展示了如何将这样的外观用于多个存储库：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 108. 使用 Facade 为多个存储库调用定义事务</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserManagementImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserManagement</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserRepository userRepository;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RoleRepository roleRepository;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserManagementImpl</span><span class="hljs-params">(UserRepository userRepository,
    RoleRepository roleRepository)</span> </span>{
    <span class="hljs-keyword">this</span>.userRepository = userRepository;
    <span class="hljs-keyword">this</span>.roleRepository = roleRepository;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@Transactional</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addRoleToAllUsers</span><span class="hljs-params">(String roleName)</span> </span>{<font></font>
<font></font>
    Role role = roleRepository.findByName(roleName);<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (User user : userRepository.findAll()) {<font></font>
      user.addRole(role);<font></font>
      userRepository.save(user);<font></font>
    }<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例导致调用</font></font><code>addRoleToAllUsers(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在事务内运行（参与现有事务或创建新事务，如果尚未运行）。</font><font style="vertical-align: inherit;">然后忽略存储库中的事务配置，因为外部事务配置决定了实际使用的事务配置。</font><font style="vertical-align: inherit;">请注意，您必须</font><font style="vertical-align: inherit;">显式</font><font style="vertical-align: inherit;">激活</font></font><code>&lt;tx:annotation-driven /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或使用</font></font><code>@EnableTransactionManagement</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">才能使外观的基于注释的配置工作。</font><font style="vertical-align: inherit;">此示例假定您使用组件扫描。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，</font></font><code>save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 JPA 的角度来看，</font><font style="vertical-align: inherit;">调用 to</font><font style="vertical-align: inherit;">并不是绝对必要的，但仍应存在以与 Spring Data 提供的存储库抽象保持一致。</font></font></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="transactional-query-methods"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#transactional-query-methods"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事务查询方法</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要让您的查询方法具有事务性，请</font></font><code>@Transactional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在您定义的存储库接口处</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 109.在查询方法中使用 @Transactional</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Transactional(readOnly = true)</span>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
<font></font>
  <span class="hljs-meta">@Modifying</span>
  <span class="hljs-meta">@Transactional</span>
  <span class="hljs-meta">@Query("delete from User u where u.active = false")</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteInactiveUsers</span><span class="hljs-params">()</span></span>;<font></font>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常，您希望将该</font></font><code>readOnly</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志设置为</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为大多数查询方法只读取数据。</font><font style="vertical-align: inherit;">与此相反，</font></font><code>deleteInactiveUsers()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>@Modifying</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释并覆盖事务配置。</font><font style="vertical-align: inherit;">因此，该方法在</font></font><code>readOnly</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志设置为 的情况下</font><font style="vertical-align: inherit;">运行</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以将事务用于只读查询，并通过设置</font></font><code>readOnly</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志来</font><font style="vertical-align: inherit;">标记它们</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，这样做并不能检查您是否不会触发操纵查询（尽管某些数据库拒绝</font></font><code>INSERT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>UPDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只读事务中的语句）。</font><font style="vertical-align: inherit;">该</font></font><code>readOnly</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志会作为对底层 JDBC 驱动程序的提示进行传播，以进行性能优化。</font><font style="vertical-align: inherit;">此外，Spring 对底层 JPA 提供程序执行了一些优化。</font><font style="vertical-align: inherit;">例如，当与 Hibernate 一起使用时，刷新模式</font></font><code>NEVER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在您将事务配置</font><font style="vertical-align: inherit;">为</font><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为</font></font><code>readOnly</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这会导致 Hibernate 跳过脏检查（对大型对象树的显着改进）。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="locking"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#locking"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.8. </font><font style="vertical-align: inherit;">锁定</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要指定要使用的锁定模式，您可以</font></font><code>@Lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在查询方法上</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">注释，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 110.在查询方法上定义锁元数据</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-comment">// Plain query method</span>
  <span class="hljs-meta">@Lock(LockModeType.READ)</span>
  <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此方法声明导致被触发的查询配备一个</font></font><code>LockModeType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">of </font></font><code>READ</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您还可以通过在存储库接口中重新声明 CRUD 方法并添加</font></font><code>@Lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">来为 CRUD 方法定义锁定</font><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 111.在 CRUD 方法上定义锁元数据</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-comment">// Redeclaration of a CRUD method</span>
  <span class="hljs-meta">@Lock(LockModeType.READ)</span>
  <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="auditing"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#auditing"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.9. </font><font style="vertical-align: inherit;">审计</font></font></h4>
<div class="sect4">
<h5 id="auditing.basics"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#auditing.basics"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data 提供了复杂的支持，以透明地跟踪谁创建或更改了实体以及更改发生的时间。</font><font style="vertical-align: inherit;">要从该功能中受益，您必须为实体类配备审计元数据，这些元数据可以使用注释或通过实现接口来定义。</font><font style="vertical-align: inherit;">此外，必须通过 Annotation 配置或 XML 配置启用审计以注册所需的基础架构组件。</font><font style="vertical-align: inherit;">有关配置示例，请参阅特定于商店的部分。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅跟踪创建和修改日期的应用程序不需要指定</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#auditing.auditor-aware"><code>AuditorAware</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect5">
<h6 id="auditing.annotations"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#auditing.annotations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于注释的审计元数据</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们提供</font></font><code>@CreatedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>@LastModifiedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">捕获创建或修改实体的用户，</font></font><code>@CreatedDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>@LastModifiedDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">捕获更改发生的时间。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 112. 一个被审计的实体</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Customer</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@CreatedBy</span>
  <span class="hljs-keyword">private</span> User user;<font></font>
<font></font>
  <span class="hljs-meta">@CreatedDate</span>
  <span class="hljs-keyword">private</span> Instant createdDate;<font></font>
<font></font>
  <span class="hljs-comment">// … further properties omitted</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如您所见，可以有选择地应用注释，具体取决于您要捕获的信息。</font><font style="vertical-align: inherit;">进行更改时捕获的注释可用于 Joda-Time </font></font><code>DateTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、旧版 Java</font></font><code>Date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Calendar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、JDK8 日期和时间类型以及</font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>Long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计元数据不一定需要存在于根级实体中，但可以添加到嵌入式实体中（取决于实际使用的存储），如下面的截图所示。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 113. 审计嵌入实体中的元数据</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Customer</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">private</span> AuditMetadata auditingMetadata;<font></font>
<font></font>
  <span class="hljs-comment">// … further properties omitted</span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AuditMetadata</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@CreatedBy</span>
  <span class="hljs-keyword">private</span> User user;<font></font>
<font></font>
  <span class="hljs-meta">@CreatedDate</span>
  <span class="hljs-keyword">private</span> Instant createdDate;<font></font>
<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="auditing.interfaces"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#auditing.interfaces"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于接口的审计元数据</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您不想使用注释来定义审计元数据，您可以让您的域类实现该</font></font><code>Auditable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口。</font><font style="vertical-align: inherit;">它公开了所有审计属性的 setter 方法。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还有一个方便的基类 ，</font></font><code>AbstractAuditable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以对其进行扩展以避免需要手动实现接口方法。</font><font style="vertical-align: inherit;">这样做会增加域类与 Spring Data 的耦合，这可能是您想要避免的。</font><font style="vertical-align: inherit;">通常，定义审计元数据的基于注释的方法是首选，因为它侵入性更小且更灵活。</font></font></p>
</div>
</div>
<div class="sect5">
<h6 id="auditing.auditor-aware"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#auditing.auditor-aware"></a><code>AuditorAware</code></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您使用</font></font><code>@CreatedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>@LastModifiedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，审计基础结构需要以某种方式了解当前主体。</font><font style="vertical-align: inherit;">为此，我们提供了一个</font></font><code>AuditorAware&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPI 接口，您必须实现</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">接口以告知基础设施当前与应用程序交互的用户或系统是谁。</font><font style="vertical-align: inherit;">泛型类型</font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义了用什么类型注释的属性</font></font><code>@CreatedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>@LastModifiedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须是</font><font style="vertical-align: inherit;">什么类型</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了使用 Spring Security</font></font><code>Authentication</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font><font style="vertical-align: inherit;">的接口的实现</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example 114.</font></font><code>AuditorAware</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 Spring Security 的实现</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringSecurityAuditorAware</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AuditorAware</span>&lt;<span class="hljs-title">User</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> Optional&lt;User&gt; <span class="hljs-title">getCurrentAuditor</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">return</span> Optional.ofNullable(SecurityContextHolder.getContext())<font></font>
            .map(SecurityContext::getAuthentication)<font></font>
            .filter(Authentication::isAuthenticated)<font></font>
            .map(Authentication::getPrincipal)<font></font>
            .map(User.class::cast);<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该实现访问</font></font><code>Authentication</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Security 提供</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">对象并查找</font></font><code>UserDetails</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您在</font></font><code>UserDetailsService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现中</font><font style="vertical-align: inherit;">创建</font><font style="vertical-align: inherit;">的自定义</font><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们在这里假设您通过</font></font><code>UserDetails</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现</font><font style="vertical-align: inherit;">公开域用户，</font><font style="vertical-align: inherit;">但根据</font></font><code>Authentication</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发现，您也可以从任何地方查找它。</font></font></p>
</div>
</div>
<div class="sect5">
<h6 id="auditing.reactive-auditor-aware"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#auditing.reactive-auditor-aware"></a><code>ReactiveAuditorAware</code></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用反应式基础架构时，您可能希望使用上下文信息来提供</font></font><code>@CreatedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">提供</font></font><code>@LastModifiedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息。</font><font style="vertical-align: inherit;">我们提供了一个</font></font><code>ReactiveAuditorAware&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPI 接口，您必须实现</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">接口才能告诉基础设施当前与应用程序交互的用户或系统是谁。</font><font style="vertical-align: inherit;">泛型类型</font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义了用什么类型注释的属性</font></font><code>@CreatedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>@LastModifiedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须是</font><font style="vertical-align: inherit;">什么类型</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了使用响应式 Spring Security</font></font><code>Authentication</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font><font style="vertical-align: inherit;">的接口的实现</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example 115.</font></font><code>ReactiveAuditorAware</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 Spring Security 的实现</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringSecurityAuditorAware</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ReactiveAuditorAware</span>&lt;<span class="hljs-title">User</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title">getCurrentAuditor</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">return</span> ReactiveSecurityContextHolder.getContext()<font></font>
                .map(SecurityContext::getAuthentication)<font></font>
                .filter(Authentication::isAuthenticated)<font></font>
                .map(Authentication::getPrincipal)<font></font>
                .map(User.class::cast);<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该实现访问</font></font><code>Authentication</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Security 提供</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">对象并查找</font></font><code>UserDetails</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您在</font></font><code>UserDetailsService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现中</font><font style="vertical-align: inherit;">创建</font><font style="vertical-align: inherit;">的自定义</font><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们在这里假设您通过</font></font><code>UserDetails</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现</font><font style="vertical-align: inherit;">公开域用户，</font><font style="vertical-align: inherit;">但根据</font></font><code>Authentication</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发现，您也可以从任何地方查找它。</font><font style="vertical-align: inherit;">:leveloffset: -1</font></font></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jpa.auditing"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.auditing"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPA审计</font></font></h5>
<div class="sect5">
<h6 id="jpa.auditing.configuration"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.auditing.configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常规审计配置</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data JPA 附带一个实体侦听器，可用于触发审计信息的捕获。</font><font style="vertical-align: inherit;">首先，您必须</font></font><code>AuditingEntityListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>orm.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">内的持久性上下文中</font><font style="vertical-align: inherit;">注册</font><font style="vertical-align: inherit;">要用于所有实体的</font><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 116.审计配置 orm.xml</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">persistence-unit-metadata</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">persistence-unit-defaults</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">entity-listeners</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">entity-listener</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"….data.jpa.domain.support.AuditingEntityListener"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">entity-listeners</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">persistence-unit-defaults</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">persistence-unit-metadata</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您还可以</font></font><code>AuditingEntityListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>@EntityListeners</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">在每个实体的基础上</font><font style="vertical-align: inherit;">启用</font><font style="vertical-align: inherit;">，如下所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@EntityListeners(AuditingEntityListener.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyEntity</span> </span>{<font></font>
<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
审计功能需要</font></font><code>spring-aspects.jar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在类路径上。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font></font><code>orm.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适当修改并</font></font><code>spring-aspects.jar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在类路径上，激活审计功能是将 Spring Data JPA</font></font><code>auditing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名空间元素添加到您的配置的问题，如下所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 117. 使用 XML 配置激活审计</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">jpa:auditing</span> <span class="hljs-attr">auditor-aware-ref</span>=<span class="hljs-string">"yourAuditorAwareBean"</span> /&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 Spring Data JPA 1.5 开始，您可以通过使用注释对配置类进行</font></font><code>@EnableJpaAuditing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">来启用审计</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您仍然必须修改</font></font><code>orm.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件并</font></font><code>spring-aspects.jar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在类路径上有。</font><font style="vertical-align: inherit;">以下示例显示了如何使用</font></font><code>@EnableJpaAuditing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 118. 使用 Java 配置激活审计</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableJpaAuditing</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Bean</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> AuditorAware&lt;AuditableUser&gt; <span class="hljs-title">auditorProvider</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AuditorAwareImpl();<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您向 公开类型</font></font><code>AuditorAware</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为 的</font><font style="vertical-align: inherit;">bean </font></font><code>ApplicationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，审计基础结构会自动选取它并使用它来确定要在域类型上设置的当前用户。</font><font style="vertical-align: inherit;">如果您在 中注册了多个实现，则</font></font><code>ApplicationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过显式设置 的</font></font><code>auditorAwareRef</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">来选择要使用的一个</font></font><code>@EnableJpaAuditing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jpa.misc"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.misc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.10. </font><font style="vertical-align: inherit;">其他注意事项</font></font></h4>
<div class="sect4">
<h5 id="jpa.misc.jpa-context"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.misc.jpa-context"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>JpaContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在自定义实现</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当使用多个</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例和</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.custom-implementations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自定义存储库实现时</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您需要将正确的连接</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到存储库实现类中。</font><font style="vertical-align: inherit;">您可以通过</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>@PersistenceContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释中</font><font style="vertical-align: inherit;">显式命名 来实现</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">或者，如果</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><code>@Autowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则使用</font></font><code>@Qualifier</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 Spring Data JPA 1.9 开始，Spring Data JPA 包含一个名为的</font><font style="vertical-align: inherit;">类，假设它仅</font><font style="vertical-align: inherit;">由应用程序中的</font><font style="vertical-align: inherit;">一个</font><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">管理，</font></font><code>JpaContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过该类</font><font style="vertical-align: inherit;">获取</font><font style="vertical-align: inherit;">受管理的域类</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下示例显示了如何</font></font><code>JpaContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在自定义存储库中使用：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 119.</font></font><code>JpaContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在自定义存储库实现中使用</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserRepositoryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserRepositoryCustom</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> EntityManager em;<font></font>
<font></font>
  <span class="hljs-meta">@Autowired</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserRepositoryImpl</span><span class="hljs-params">(JpaContext context)</span> </span>{
    <span class="hljs-keyword">this</span>.em = context.getEntityManagerByManagedType(User.class);<font></font>
  }<font></font>
<font></font>
  …<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种方法的优点是，如果域类型被分配给不同的持久性单元，则不必接触存储库来更改对持久性单元的引用。</font></font></p>
</div>
</div>
<div class="sect4">
<h5 id="jpa.misc.merging-persistence-units"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.misc.merging-persistence-units"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合并持久化单元</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring 支持拥有多个持久化单元。</font><font style="vertical-align: inherit;">然而，有时您可能希望对应用程序进行模块化，但仍要确保所有这些模块都在单个持久性单元中运行。</font><font style="vertical-align: inherit;">为了实现这种行为，Spring Data JPA 提供了一个</font></font><code>PersistenceUnitManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现，它根据名称自动合并持久性单元，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 120.使用 MergingPersistenceUnitmanager</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"….LocalContainerEntityManagerFactoryBean"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"persistenceUnitManager"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"….MergingPersistenceUnitManager"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="jpa.misc.entity-scanning"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpa.misc.entity-scanning"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Entity 类和 JPA 映射文件的类路径扫描</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个普通的 JPA 设置需要在</font></font><code>orm.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">这同样适用于 XML 映射文件。</font><font style="vertical-align: inherit;">Spring Data JPA 提供了一个</font></font><code>ClasspathScanningPersistenceUnitPostProcessor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以配置基本包并可选地采用映射文件名模式的方法。</font><font style="vertical-align: inherit;">然后它扫描给定包中用</font></font><code>@Entity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or</font><font style="vertical-align: inherit;">注释的类</font></font><code>@MappedSuperclass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，加载与文件名模式匹配的配置文件，并将它们交给 JPA 配置。</font><font style="vertical-align: inherit;">后处理器必须配置如下：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 121.使用 ClasspathScanningPersistenceUnitPostProcessor</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"….LocalContainerEntityManagerFactoryBean"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"persistenceUnitPostProcessors"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.data.jpa.support.ClasspathScanningPersistenceUnitPostProcessor"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"com.acme.domain"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"mappingFileNamePattern"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"**/*Mapping.xml"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从 Spring 3.1 开始，可以</font></font><code>LocalContainerEntityManagerFactoryBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接</font><font style="vertical-align: inherit;">在 上配置要扫描的包，</font><font style="vertical-align: inherit;">以启用实体类的类路径扫描。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息，</font><font style="vertical-align: inherit;">请参阅</font></font><a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/orm/jpa/LocalContainerEntityManagerFactoryBean.html#setPackagesToScan(java.lang.String...)"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaDoc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jpd.misc.cdi-integration"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#jpd.misc.cdi-integration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CDI集成</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库接口的实例通常由容器创建，因此在使用 Spring Data 时，Spring 是最自然的选择。</font><font style="vertical-align: inherit;">Spring 为创建 bean 实例提供了复杂的支持，如</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建存储库实例中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从 version 1.1.0 开始，Spring Data JPA 附带了一个自定义 CDI 扩展，允许在 CDI 环境中使用存储库抽象。</font><font style="vertical-align: inherit;">该扩展是 JAR 的一部分。</font><font style="vertical-align: inherit;">要激活它，请在类路径中包含 Spring Data JPA JAR。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您现在可以通过为</font></font><code>EntityManagerFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font><font style="vertical-align: inherit;">实现 CDI Producer 来设置基础结构</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EntityManagerFactoryProducer</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Produces</span>
  <span class="hljs-meta">@ApplicationScoped</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> EntityManagerFactory <span class="hljs-title">createEntityManagerFactory</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> Persistence.createEntityManagerFactory(<span class="hljs-string">"my-persistence-unit"</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">(<span class="hljs-meta">@Disposes</span> EntityManagerFactory entityManagerFactory)</span> </span>{<font></font>
    entityManagerFactory.close();<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@Produces</span>
  <span class="hljs-meta">@RequestScoped</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> EntityManager <span class="hljs-title">createEntityManager</span><span class="hljs-params">(EntityManagerFactory entityManagerFactory)</span> </span>{
    <span class="hljs-keyword">return</span> entityManagerFactory.createEntityManager();<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">(<span class="hljs-meta">@Disposes</span> EntityManager entityManager)</span> </span>{<font></font>
    entityManager.close();<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要的设置可能因 JavaEE 环境而异。</font><font style="vertical-align: inherit;">您可能只需要将 a 重新声明</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为 CDI bean，如下所示：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CdiConfig</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Produces</span>
  <span class="hljs-meta">@RequestScoped</span>
  <span class="hljs-meta">@PersistenceContext</span>
  <span class="hljs-keyword">public</span> EntityManager entityManager;<font></font>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在前面的示例中，容器必须能够</font></font><code>EntityManagers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自己</font><font style="vertical-align: inherit;">创建 JPA </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所有配置所做的就是将 JPA 重新导出</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为 CDI bean。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data JPA CDI 扩展将所有可用</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例作为 CDI bean</font><font style="vertical-align: inherit;">选取，</font><font style="vertical-align: inherit;">并在容器请求存储库类型的 bean 时为 Spring Data 存储库创建代理。</font><font style="vertical-align: inherit;">因此，获取 Spring Data 存储库的实例是声明</font></font><code>@Injected</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性的问题，如以下示例所示：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RepositoryClient</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Inject</span><font></font>
  PersonRepository repository;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">businessMethod</span><span class="hljs-params">()</span> </span>{<font></font>
    List&lt;Person&gt; people = repository.findAll();<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#appendix"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. 附录</font></font></h2>
<div class="sectionbody">
</div>
</div>
<div class="sect1">
<h2 id="repositories.namespace-reference"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.namespace-reference"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 A：命名空间参考</font></font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="populator.namespace-dao-config"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#populator.namespace-dao-config"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>&lt;repositories /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>&lt;repositories /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素触发 Spring Data 存储库基础结构的设置。</font><font style="vertical-align: inherit;">最重要的属性是</font></font><code>base-package</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它定义了要扫描 Spring Data 存储库接口的包。</font><font style="vertical-align: inherit;">请参阅“ </font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances.spring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML 配置</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”。</font><font style="vertical-align: inherit;">下表描述了</font></font><code>&lt;repositories /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">的属性</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 6. 属性</font></font></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">姓名</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>base-package</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义要扫描的包以</font></font><code>*Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动检测模式</font><font style="vertical-align: inherit;">扩展的存储库接口</font><font style="vertical-align: inherit;">（实际接口由特定的 Spring Data 模块确定）。</font><font style="vertical-align: inherit;">配置包下面的所有包也被扫描。</font><font style="vertical-align: inherit;">允许使用通配符。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repository-impl-postfix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义后缀以自动检测自定义存储库实现。</font><font style="vertical-align: inherit;">名称以配置的后缀结尾的类被视为候选。</font><font style="vertical-align: inherit;">默认为</font></font><code>Impl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>query-lookup-strategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定用于创建查找器查询的策略。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息，</font><font style="vertical-align: inherit;">请参阅“</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.query-methods.query-lookup-strategies"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询查找策略</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”。</font><font style="vertical-align: inherit;">默认为</font></font><code>create-if-not-found</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>named-queries-location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义搜索包含外部定义查询的属性文件的位置。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>consider-nested-repositories</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是否应考虑嵌套存储库接口定义。</font><font style="vertical-align: inherit;">默认为</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="populator.namespace-reference"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#populator.namespace-reference"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 B：Populators 命名空间参考</font></font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="namespace-dao-config"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#namespace-dao-config"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;populator /&gt; 元素</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>&lt;populator /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素允许通过 Spring Data 存储库基础结构填充数据存储。</font></font><sup class="footnote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><a id="_footnoteref_1" class="footnote" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#_footnotedef_1" title="查看脚注。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></sup></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 7. 属性</font></font></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">姓名</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>locations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应填充从存储库中读取对象的文件的位置。</font></font></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repository-query-keywords"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repository-query-keywords"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 C：存储库查询关键字</font></font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="appendix.query.method.subject"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#appendix.query.method.subject"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的查询方法主题关键字</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下表列出了 Spring Data 存储库查询派生机制普遍支持的主题关键字来表达谓词。</font><font style="vertical-align: inherit;">有关受支持关键字的确切列表，请参阅特定于商店的文档，因为此处列出的某些关键字可能在特定商店中不受支持。</font></font></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 8. 查询主题关键字</font></font></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键词</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>find…By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>read…By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>get…By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>query…By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>search…By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>stream…By</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通用查询方法通常返回存储库类型、</font></font><code>Collection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子类型或结果包装器，例如</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>GeoResults</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或任何其他特定于商店的结果包装器。</font><font style="vertical-align: inherit;">可用作</font></font><code>findBy…</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>findMyDomainTypeBy…</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或与其他关键字结合使用。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exists…By</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存在投影，通常返回</font></font><code>boolean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>count…By</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计数投影返回数字结果。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delete…By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>remove…By</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除查询方法返回无结果 ( </font></font><code>void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) 或删除计数。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>…First&lt;number&gt;…</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>…Top&lt;number&gt;…</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将查询结果限制为第一个</font></font><code>&lt;number&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果。</font><font style="vertical-align: inherit;">此关键字可以出现在主题的</font></font><code>find</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（和其他关键字）和</font><font style="vertical-align: inherit;">之间的任何位置</font></font><code>by</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>…Distinct…</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用不同的查询仅返回唯一的结果。</font><font style="vertical-align: inherit;">查阅特定于商店的文档是否支持该功能。</font><font style="vertical-align: inherit;">此关键字可以出现在主题的</font></font><code>find</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（和其他关键字）和</font><font style="vertical-align: inherit;">之间的任何位置</font></font><code>by</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="appendix.query.method.predicate"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#appendix.query.method.predicate"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的查询方法谓词关键字和修饰符</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下表列出了 Spring Data 存储库查询派生机制普遍支持的谓词关键字。</font><font style="vertical-align: inherit;">但是，请查阅特定于商店的文档以获取受支持关键字的确切列表，因为此处列出的某些关键字在特定商店中可能不受支持。</font></font></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 9. 查询谓词关键字</font></font></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逻辑关键字</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键字表达</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AND</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>And</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Or</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AFTER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>After</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsAfter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BEFORE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Before</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsBefore</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONTAINING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Containing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsContaining</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>Contains</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BETWEEN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Between</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsBetween</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENDING_WITH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EndingWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsEndingWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>EndsWith</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXISTS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Exists</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FALSE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>False</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsFalse</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GREATER_THAN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsGreaterThan</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GREATER_THAN_EQUALS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThanEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsGreaterThanEqual</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>In</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsIn</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Is</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Equals</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, （或没有关键字）</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_EMPTY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsEmpty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Empty</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_NOT_EMPTY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNotEmpty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>NotEmpty</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_NOT_NULL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsNotNull</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_NULL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsNull</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LESS_THAN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsLessThan</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LESS_THAN_EQUAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThanEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsLessThanEqual</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIKE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Like</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsLike</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Near</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsNear</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Not</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsNot</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT_IN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotIn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsNotIn</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT_LIKE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotLike</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsNotLike</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REGEX</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Regex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>MatchesRegex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>Matches</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STARTING_WITH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StartingWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsStartingWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>StartsWith</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRUE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>True</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsTrue</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WITHIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Within</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsWithin</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了过滤谓词之外，还支持以下修饰符列表：</font></font></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 10. 查询谓词修饰符关键字</font></font></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键词</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IgnoreCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IgnoringCase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与谓词关键字一起用于不区分大小写的比较。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AllIgnoreCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>AllIgnoringCase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">忽略所有合适属性的大小写。</font><font style="vertical-align: inherit;">在查询方法谓词的某处使用。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OrderBy…</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定静态排序顺序，然后是属性路径和方向（例如</font></font><code>OrderByFirstnameAscLastnameDesc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repository-query-return-types"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repository-query-return-types"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 D：存储库查询返回类型</font></font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="appendix.query.return.types"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#appendix.query.return.types"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的查询返回类型</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下表列出了 Spring Data 存储库通常支持的返回类型。</font><font style="vertical-align: inherit;">但是，请查阅特定于商店的文档以获取支持的返回类型的确切列表，因为此处列出的某些类型可能在特定商店中不受支持。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
地理空间类型（如</font></font><code>GeoResult</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>GeoResults</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code>GeoPage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）是仅适用于支持地理空间查询的数据存储。</font><font style="vertical-align: inherit;">一些存储模块可以定义它们自己的结果包装器类型。
</font></font></td>
</tr>
</tbody></table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 11. 查询返回类型</font></font></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回类型</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示没有返回值。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原语</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java 原语。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包装类型</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java 包装器类型。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个独特的实体。</font><font style="vertical-align: inherit;">期望查询方法最多返回一个结果。</font><font style="vertical-align: inherit;">如果未找到结果，</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则返回。</font><font style="vertical-align: inherit;">不止一个结果会触发</font></font><code>IncorrectResultSizeDataAccessException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Iterator&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code>Iterator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Collection&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code>Collection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Optional&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 Java 8 或 Guava </font></font><code>Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">期望查询方法最多返回一个结果。</font><font style="vertical-align: inherit;">如果没有找到结果，</font></font><code>Optional.empty()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>Optional.absent()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回。</font><font style="vertical-align: inherit;">不止一个结果会触发</font></font><code>IncorrectResultSizeDataAccessException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Option&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scala 或 Vavr</font></font><code>Option</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型。</font><font style="vertical-align: inherit;">在语义上与</font></font><code>Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前描述的</font><font style="vertical-align: inherit;">Java 8 的行为相同</font><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Stream&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 Java 8 </font></font><code>Stream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Streamable&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该直接的便利扩展</font></font><code>Iterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公开了流、映射和过滤结果、连接它们等的方法。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并接受</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造函数或工厂方法参数的类型</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公开</font><font style="vertical-align: inherit;">以 a</font><font style="vertical-align: inherit;">作为参数</font><font style="vertical-align: inherit;">的构造函数或</font></font><code>….of(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font><code>….valueOf(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工厂方法的</font><font style="vertical-align: inherit;">类型</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息，</font><font style="vertical-align: inherit;">请参阅</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.collections-and-iterables.streamable-wrapper"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回自定义 Streamable Wrapper 类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vavr </font></font><code>Seq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>Set</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vavr 集合类型。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息，</font><font style="vertical-align: inherit;">请参阅</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.collections-and-iterables.vavr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对 Vavr 集合的支持</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Future&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code>Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">期望一个方法被注解</font></font><code>@Async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并需要启用 Spring 的异步方法执行功能。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompletableFuture&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 Java 8 </font></font><code>CompletableFuture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">期望一个方法被注解</font></font><code>@Async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并需要启用 Spring 的异步方法执行功能。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ListenableFuture</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code>org.springframework.util.concurrent.ListenableFuture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">期望一个方法被注解</font></font><code>@Async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并需要启用 Spring 的异步方法执行功能。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Slice&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个指定大小的数据块，指示是否有更多可用数据。</font><font style="vertical-align: inherit;">需要一个</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法参数。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Page&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"></font><code>Slice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有附加信息的</font><font style="vertical-align: inherit;">A </font><font style="vertical-align: inherit;">，例如结果总数。</font><font style="vertical-align: inherit;">需要一个</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法参数。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GeoResult&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有附加信息的结果条目，例如到参考位置的距离。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GeoResults&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"></font><code>GeoResult&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含附加信息的</font><font style="vertical-align: inherit;">列表</font><font style="vertical-align: inherit;">，例如到参考位置的平均距离。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GeoPage&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">甲</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带</font></font><code>GeoResult&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如到参考位置的平均距离。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Mono&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"></font><code>Mono</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用反应式存储库发出零个或一个元素的</font><font style="vertical-align: inherit;">Project Reactor </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">期望查询方法最多返回一个结果。</font><font style="vertical-align: inherit;">如果未找到结果，</font></font><code>Mono.empty()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则返回。</font><font style="vertical-align: inherit;">不止一个结果会触发</font></font><code>IncorrectResultSizeDataAccessException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flux&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project Reactor</font></font><code>Flux</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用反应式存储库发出零个、一个或多个元素。</font><font style="vertical-align: inherit;">返回的查询</font></font><code>Flux</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以发出无限数量的元素。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Single&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 RxJava</font></font><code>Single</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用反应式存储库发出单个元素。</font><font style="vertical-align: inherit;">期望查询方法最多返回一个结果。</font><font style="vertical-align: inherit;">如果未找到结果，</font></font><code>Mono.empty()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则返回。</font><font style="vertical-align: inherit;">不止一个结果会触发</font></font><code>IncorrectResultSizeDataAccessException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Maybe&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 RxJava</font></font><code>Maybe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用反应式存储库发出零个或一个元素。</font><font style="vertical-align: inherit;">期望查询方法最多返回一个结果。</font><font style="vertical-align: inherit;">如果未找到结果，</font></font><code>Mono.empty()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则返回。</font><font style="vertical-align: inherit;">不止一个结果会触发</font></font><code>IncorrectResultSizeDataAccessException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 RxJava</font></font><code>Flowable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用反应式存储库发出零个、一个或多个元素。</font><font style="vertical-align: inherit;">返回的查询</font></font><code>Flowable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以发出无限数量的元素。</font></font></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="faq"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#faq"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 E：常见问题</font></font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="faq.common"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#faq.common"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常见的</font></font></h3>
<div class="qlist qanda">
<ol>
<li>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，我想获得有关内部调用哪些方法的更详细的日志信息</font></font><code>JpaRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我怎样才能获得它们？</font></font></em></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用</font></font><code>CustomizableTraceInterceptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring 提供的，如下例所示：</font></font></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"customizableTraceInterceptor"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"
  org.springframework.aop.interceptor.CustomizableTraceInterceptor"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"enterMessage"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Entering $[methodName]($[arguments])"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"exitMessage"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Leaving $[methodName](): $[returnValue]"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span> <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">"customizableTraceInterceptor"</span>
    <span class="hljs-attr">pointcut</span>=<span class="hljs-string">"execution(public * org.springframework.data.jpa.repository.JpaRepository+.*(..))"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="faq.infrastructure"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#faq.infrastructure"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基础设施</font></font></h3>
<div class="qlist qanda">
<ol>
<li>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目前我已经实现了一个基于</font></font><code>HibernateDaoSupport</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">我</font></font><code>SessionFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Spring 的</font></font><code>AnnotationSessionFactoryBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">如何让 Spring Data 存储库在此环境中工作？</font></font></em></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您必须替换</font></font><code>AnnotationSessionFactoryBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><code>HibernateJpaSessionFactoryBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：</font></font></p>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 122.</font></font><code>SessionFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 a 中</font><font style="vertical-align: inherit;">查找</font><font style="vertical-align: inherit;">a</font></font><code>HibernateEntityManagerFactory</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sessionFactory"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.orm.jpa.vendor.HibernateJpaSessionFactoryBean"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"entityManagerFactory"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"entityManagerFactory"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="faq.auditing"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#faq.auditing"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计</font></font></h3>
<div class="qlist qanda">
<ol>
<li>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我想使用 Spring Data JPA 审计功能，但我的数据库已经配置为在实体上设置修改和创建日期。</font><font style="vertical-align: inherit;">如何防止 Spring Data 以编程方式设置日期？</font></font></em></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font><font style="vertical-align: inherit;">命名空间元素</font><font style="vertical-align: inherit;">的</font></font><code>set-dates</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">设置</font></font><code>auditing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="glossary"><a class="anchor" href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#glossary"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 F：词汇表</font></font></h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AOP </font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">面向方面的编程</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">共享数据库 </font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Commons DataBase Connection Pools - 来自 Apache 基金会的一个库，提供 DataSource 接口的池化实现。</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRUD </font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建、读取、更新、删除 - 基本的持久性操作。</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">道 </font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据访问对象 - 将持久化逻辑与要持久化的对象分开的模式</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依赖注入 </font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从外部将组件的依赖项传递给组件的模式，释放组件以查找依赖项本身。</font><font style="vertical-align: inherit;">有关更多信息，请参阅</font></font><a href="https://en.wikipedia.org/wiki/Dependency_Injection"></a><a href="https://en.wikipedia.org/wiki/Dependency_Injection" class="bare"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://en.wikipedia.org/wiki/Dependency_Injection</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eclipse链接 </font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现 JPA 的对象关系映射器 - </font></font><a href="https://www.eclipse.org/eclipselink/"></a><a href="https://www.eclipse.org/eclipselink/" class="bare"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.eclipse.org/eclipselink/</font></font></a></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">休眠 </font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现 JPA 的对象关系映射器 - </font></font><a href="https://hibernate.org/"></a><a href="https://hibernate.org/" class="bare"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://hibernate.org/</font></font></a></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日本特许经营协会 </font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java 持久化 API</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">春天 </font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java应用框架—— </font></font><a href="https://projects.spring.io/spring-framework"></a><a href="https://projects.spring.io/spring-framework" class="bare"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://projects.spring.io/spring-framework</font></font></a></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#_footnoteref_1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">见</font></font><a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#repositories.create-instances.spring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML 配置</font></font></a>
</div>
</div>
<div id="footer">
<div id="footer-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
版本 2.5.4</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后更新 2021-08-12 11:41:06 +0200
</font></font></div>
</div>
<link rel="stylesheet" href="./jpa_files/github.min.css">
<script async="" src="./jpa_files/analytics.js"></script><script src="./jpa_files/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
<script type="text/javascript" src="./jpa_files/tocbot.min.js"></script>
<script type="text/javascript" src="./jpa_files/toc.js"></script>
<script>if (window.parent == window) {(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-2728886-23', 'auto', {'siteSpeedSampleRate': 100});ga('send', 'pageview');}</script><script defer="" src="./jpa_files/beacon.min.js" data-cf-beacon="{&quot;rayId&quot;:&quot;68d11c1a9812ed37&quot;,&quot;token&quot;:&quot;bffcb8a918ae4755926f76178bfbd26b&quot;,&quot;version&quot;:&quot;2021.8.1&quot;,&quot;si&quot;:10}"></script><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./jpa_files/translate_24dp.png" width="20" height="20" alt="Google 翻译"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div>

<div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div></body></html>