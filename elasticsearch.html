<!DOCTYPE html>
<!-- saved from url=(0085)https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#reference -->
<html lang="zh-CN" class="translated-ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.2">
<meta name="author" content="BioMed Central Development Team, Oliver Drotbohm, Greg Turnquist, Christoph Strobl, Peter-Josef Meisch">
<title>Spring Data Elasticsearch - 参考文档</title>
<link rel="stylesheet" href="./elasticsearch_files/spring.css">
<link rel="stylesheet" href="./elasticsearch_files/font-awesome.min.css">
<link type="text/css" rel="stylesheet" charset="UTF-8" href="./elasticsearch_files/translateelement.css"></head>
<body class="book toc2 toc-left is-position-fixed"><div><div id="header-spring">
<h1>
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0" y="0" viewBox="0 0 245.8 45.3" style="enable-background:new 0 0 245.8 45.3;" xml:space="preserve">
<g id="logos">
<g>
<path class="st0" d="M39.4,3.7c-0.6,1.5-1.4,2.8-2.3,4c-3.9-4-9.3-6.4-15.2-6.4c-11.7,0-21.3,9.5-21.3,21.3
c0,6.2,2.6,11.7,6.8,15.6l0.8,0.7c3.7,3.1,8.5,5,13.7,5c11.2,0,20.4-8.7,21.2-19.8C43.7,18.7,42.1,11.8,39.4,3.7z M10.5,38.3
c-0.6,0.8-1.8,0.9-2.6,0.3C7.1,37.9,7,36.8,7.6,36c0.6-0.8,1.8-0.9,2.6-0.3C11,36.4,11.1,37.5,10.5,38.3z M39.3,31.9
c-5.2,7-16.5,4.6-23.6,5c0,0-1.3,0.1-2.6,0.3c0,0,0.5-0.2,1.1-0.4c5-1.7,7.4-2.1,10.5-3.7c5.8-3,11.5-9.4,12.7-16.1
c-2.2,6.4-8.9,12-14.9,14.2c-4.2,1.5-11.7,3-11.7,3c0,0-0.3-0.2-0.3-0.2c-5.1-2.5-5.3-13.6,4-17.1c4.1-1.6,8-0.7,12.4-1.8
C31.6,14.1,37,10.6,39.2,6C41.7,13.3,44.7,24.8,39.3,31.9z"></path>
<g>
<path class="st0" d="M55.2,30.9c-0.5-0.3-0.9-0.9-0.9-1.6c0-1.1,0.8-1.9,1.9-1.9c0.4,0,0.7,0.1,1,0.3c2,1.3,4.1,2,5.9,2
c2,0,3.2-0.9,3.2-2.2v-0.1c0-1.6-2.2-2.2-4.6-2.9c-3-0.9-6.5-2.1-6.5-6.1v-0.1c0-3.9,3.2-6.3,7.4-6.3c2.2,0,4.5,0.6,6.5,1.7
c0.7,0.4,1.1,1,1.1,1.8c0,1.1-0.9,1.9-2,1.9c-0.4,0-0.6-0.1-0.9-0.2c-1.7-0.9-3.4-1.4-4.9-1.4c-1.8,0-2.9,0.9-2.9,2v0.1
c0,1.5,2.2,2.2,4.7,2.9c3,0.9,6.4,2.3,6.4,6v0.1c0,4.3-3.4,6.5-7.7,6.5C60.4,33.3,57.6,32.5,55.2,30.9z"></path>
<path class="st0" d="M72.5,14.3c0-1.3,1-2.4,2.3-2.4c1.3,0,2.4,1.1,2.4,2.4v1.4c1.5-2.2,3.7-3.9,7-3.9c4.8,0,9.6,3.8,9.6,10.7
v0.1c0,6.8-4.7,10.7-9.6,10.7c-3.4,0-5.6-1.7-7-3.6V37c0,1.3-1.1,2.4-2.4,2.4c-1.3,0-2.3-1-2.3-2.4V14.3z M89.1,22.7L89.1,22.7
c0-4.1-2.7-6.7-5.9-6.7c-3.2,0-6,2.7-6,6.6v0.1c0,4,2.8,6.6,6,6.6C86.4,29.3,89.1,26.7,89.1,22.7z"></path>
<path class="st0" d="M95.7,14.3c0-1.3,1-2.4,2.3-2.4c1.3,0,2.4,1.1,2.4,2.4v1.1c0.2-1.8,3.1-3.5,5.2-3.5c1.5,0,2.3,1,2.3,2.3
c0,1.3-0.8,2.1-1.9,2.3c-3.4,0.6-5.7,3.5-5.7,7.6V31c0,1.3-1.1,2.3-2.4,2.3c-1.3,0-2.3-1-2.3-2.3V14.3z"></path>
<path class="st0" d="M109.7,14.3c0-1.3,1-2.4,2.3-2.4c1.3,0,2.4,1.1,2.4,2.4V31c0,1.3-1.1,2.3-2.4,2.3c-1.3,0-2.3-1-2.3-2.3V14.3
z"></path>
<path class="st0" d="M116.9,14.3c0-1.3,1-2.4,2.3-2.4c1.3,0,2.4,1.1,2.4,2.4v1c1.3-1.9,3.2-3.4,6.5-3.4c4.7,0,7.4,3.1,7.4,7.9V31
c0,1.3-1,2.3-2.3,2.3c-1.3,0-2.4-1-2.4-2.3v-9.7c0-3.2-1.6-5-4.4-5c-2.7,0-4.7,1.9-4.7,5.1V31c0,1.3-1.1,2.3-2.4,2.3
c-1.3,0-2.3-1-2.3-2.3V14.3z"></path>
<path class="st0" d="M156.2,11.9c-1.3,0-2.4,1.1-2.4,2.4v1.4c-1.5-2.2-3.7-3.9-7-3.9c-4.9,0-9.6,3.8-9.6,10.7v0.1
c0,6.8,4.7,10.7,9.6,10.7c3.4,0,5.6-1.7,7-3.6c-0.2,3.7-2.5,5.7-6.5,5.7c-2.4,0-4.5-0.6-6.3-1.6c-0.2-0.1-0.5-0.2-0.9-0.2
c-1.1,0-2,0.9-2,2c0,0.9,0.5,1.6,1.3,1.9c2.5,1.2,5.1,1.8,8,1.8c3.7,0,6.6-0.9,8.5-2.8c1.7-1.7,2.7-4.3,2.7-7.8V14.3
C158.5,13,157.5,11.9,156.2,11.9z M147.9,29.2c-3.2,0-5.9-2.5-5.9-6.6v-0.1c0-4,2.7-6.6,5.9-6.6c3.2,0,6,2.7,6,6.6v0.1
C153.9,26.6,151.1,29.2,147.9,29.2z"></path>
<path class="st0" d="M114.5,6.3c0,1.3-1.1,2.4-2.4,2.4c-1.3,0-2.4-1.1-2.4-2.4c0-1.3,1.1-2.4,2.4-2.4
C113.4,3.9,114.5,4.9,114.5,6.3z"></path>
</g>
</g>
<g class="st1">
<g>
<g>
<g>
<path class="st2" d="M200.1,21.1H198V19h2.1V21.1z M200.1,32.9H198V22.6h2.1V32.9z"></path>
</g>
<g>
<g>
<path class="st2" d="M212.5,22.6l-3,8.9c-0.5,1.5-1.4,1.6-2.2,1.6c-1.1,0-1.8-0.5-2.2-1.6l-2.5-7.4h-1v-1.5h2.6l2.6,8.3
c0.1,0.4,0.2,0.6,0.5,0.6c0.3,0,0.4-0.2,0.5-0.6l2.6-8.3H212.5z"></path>
<path class="st2" d="M217.8,22.6c2.8,0,4.7,1.8,4.7,4.5v1.6c0,2.6-1.9,4.5-4.7,4.5c-2.8,0-4.7-1.8-4.7-4.5v-1.6
C213,24.4,215,22.6,217.8,22.6 M217.8,31.4c1.7,0,2.7-1.3,2.7-2.8v-1.6c0-1.5-1-2.8-2.7-2.8c-1.8,0-2.7,1.3-2.7,2.8v1.6
C215.1,30.2,216,31.4,217.8,31.4"></path>
<path class="st2" d="M239.6,22.9c-1.1-0.3-2.7-0.5-4-0.5c-2.8,0-4.6,1.8-4.6,4.6v1.1c0,2.9,1.7,4.7,4.6,4.7c0.1,0,0.6,0,0.8,0
v-1.7c-0.1,0-0.7,0-0.8,0c-1.5,0-2.6-1.2-2.6-2.9v-1.1c0-1.8,1-2.9,2.6-2.9c0.7,0,1.7,0.1,2.1,0.1l0.1,0l0,8.6h2.1v-9.6
C240,23.1,240,23,239.6,22.9"></path>
<rect x="242.1" y="19" class="st2" width="2.1" height="13.9"></rect>
<path class="st2" d="M190.5,19h-3.8v13.9h2.2V20.9h1.3c0.3,0,0.5,0,0.8,0c1.9,0,2.9,0.8,2.9,2.3c0,0.1,0,0.1,0,0.2
c0,1.4-0.8,2.3-2.9,2.3c-0.2,0-0.4,0-0.6,0c0,0.5,0,1.5,0,1.9c0.2,0,0.4,0,0.6,0c3,0,5.2-1.2,5.2-4.2c0-0.1,0-0.1,0-0.2
C196.2,20.2,193.9,19,190.5,19"></path>
<path class="st2" d="M226.3,20.4v2.2h3.5v1.7h-3.5v6c0,0.9,0.6,1,1.5,1h2v1.7H227c-2,0-2.9-0.8-2.9-2.6v-9.6L226.3,20.4z"></path>
</g>
</g>
</g>
</g>
<g>
<path class="st2" d="M167.7,32.9v-10h1.1v3.8c0.6-0.8,1.5-1.3,2.4-1.3c1.9,0,3.2,1.5,3.2,3.8c0,2.4-1.3,3.8-3.2,3.8
c-1,0-1.9-0.5-2.4-1.3v1.1H167.7z M171,32.1c1.5,0,2.3-1.2,2.3-2.8c0-1.6-0.9-2.8-2.3-2.8c-0.9,0-1.8,0.5-2.2,1.2v3.3
C169.2,31.6,170.1,32.1,171,32.1z"></path>
<path class="st2" d="M175.9,34.7c0.2,0.1,0.4,0.1,0.6,0.1c0.5,0,0.8-0.2,1.1-0.8l0.5-1.1l-3-7.3h1.2l2.4,5.9l2.4-5.9h1.2
l-3.6,8.7c-0.4,1-1.2,1.5-2.1,1.5c-0.2,0-0.6,0-0.8-0.1L175.9,34.7z"></path>
</g>
</g>
</g>
</svg>

</h1>
</div></div>
<div id="header">
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Elasticsearch - 参考文档</font></font></h1>
<div class="details">
<span id="author" class="author"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BioMed 中央开发团队</font></font></span><br>
<span id="author2" class="author"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">奥利弗·德罗博姆</font></font></span><br>
<span id="author3" class="author"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格雷格·特奎斯特</font></font></span><br>
<span id="author4" class="author"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">克里斯托夫·斯特罗布尔</font></font></span><br>
<span id="author5" class="author"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">彼得-约瑟夫·梅施</font></font></span><br>
<span id="revnumber"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本 4.2.4，</font></font></span>
<span id="revdate"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2021-08-12</font></font></span>
</div>
<div id="toc" class="toc2">
<div id="toctitle"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录</font></font></div>
<ul class="mobile-toc">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#preface"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前言</font></font></a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#new-features"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 有什么新鲜事</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#new-features.4-2-0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1. </font><font style="vertical-align: inherit;">Spring Data Elasticsearch 4.2 中的新功能</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#new-features.4-1-0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2. </font><font style="vertical-align: inherit;">Spring Data Elasticsearch 4.1 中的新功能</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#new-features.4-0-0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3. </font><font style="vertical-align: inherit;">Spring Data Elasticsearch 4.0 中的新功能</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#new-features.3-2-0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4. </font><font style="vertical-align: inherit;">Spring Data Elasticsearch 3.2 中的新功能</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#preface.metadata"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 项目元数据</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#preface.requirements"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">三、要求</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#preface.versions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1. </font><font style="vertical-align: inherit;">版本</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 使用 Spring Data Repositories</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.core-concepts"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1. </font><font style="vertical-align: inherit;">核心概念</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2. </font><font style="vertical-align: inherit;">查询方法</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.definition"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3. </font><font style="vertical-align: inherit;">定义存储库接口</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.definition-tuning"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3.1. </font><font style="vertical-align: inherit;">微调存储库定义</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.multiple-modules"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3.2. </font><font style="vertical-align: inherit;">使用具有多个 Spring 数据模块的存储库</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods.details"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4. </font><font style="vertical-align: inherit;">定义查询方法</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods.query-lookup-strategies"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.1. </font><font style="vertical-align: inherit;">查询查找策略</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods.query-creation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.2. </font><font style="vertical-align: inherit;">查询创建</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods.query-property-expressions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.3. </font><font style="vertical-align: inherit;">属性表达式</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.special-parameters"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.4. </font><font style="vertical-align: inherit;">特殊参数处理</font></font></a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.paging-and-sorting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分页和排序</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.limit-query-result"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.5. </font><font style="vertical-align: inherit;">限制查询结果</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.collections-and-iterables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.6. </font><font style="vertical-align: inherit;">返回集合或可迭代对象的存储库方法</font></font></a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.collections-and-iterables.streamable"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Streamable 作为查询方法返回类型</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.collections-and-iterables.streamable-wrapper"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回自定义流包装器类型</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.collections-and-iterables.vavr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持 Vavr 集合</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.nullability"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.7. </font><font style="vertical-align: inherit;">存储库方法的空处理</font></font></a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.nullability.annotations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可空性注释</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.nullability.kotlin"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 Kotlin 的存储库中的可空性</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-streaming"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.8. </font><font style="vertical-align: inherit;">流式查询结果</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-async"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.9. </font><font style="vertical-align: inherit;">异步查询结果</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5. </font><font style="vertical-align: inherit;">创建存储库实例</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances.spring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5.1. </font><font style="vertical-align: inherit;">XML 配置</font></font></a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.using-filters"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用过滤器</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances.java-config"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5.2. </font><font style="vertical-align: inherit;">Java配置</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances.standalone"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5.3. </font><font style="vertical-align: inherit;">独立使用</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.custom-implementations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6. </font><font style="vertical-align: inherit;">Spring Data Repositories 的自定义实现</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.single-repository-behavior"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6.1. </font><font style="vertical-align: inherit;">自定义单个存储库</font></font></a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.configuration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.customize-base-repository"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6.2. </font><font style="vertical-align: inherit;">自定义基础存储库</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.domain-events"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.7. </font><font style="vertical-align: inherit;">从聚合根发布事件</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.extensions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8. </font><font style="vertical-align: inherit;">Spring 数据扩展</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.extensions.querydsl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8.1. </font><font style="vertical-align: inherit;">Querydsl 扩展</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8.2. </font><font style="vertical-align: inherit;">网络支持</font></font></a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.basic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本网络支持</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.pageables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对可分页的超媒体支持</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.basic.jackson-mappers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Jackson 模块</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.binding"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网页数据绑定支持</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.type-safe"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Querydsl 网络支持</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.repository-populators"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8.3. </font><font style="vertical-align: inherit;">存储库填充器</font></font></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#reference"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文档</font></font></a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Elasticsearch 客户端</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.transport"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1. </font><font style="vertical-align: inherit;">运输客户端</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.rest"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2. </font><font style="vertical-align: inherit;">高级 REST 客户端</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.reactive"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3. </font><font style="vertical-align: inherit;">反应式客户端</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.configuration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4. </font><font style="vertical-align: inherit;">客户端配置</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.logging"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.5. </font><font style="vertical-align: inherit;">客户端日志</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Elasticsearch 对象映射</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1. </font><font style="vertical-align: inherit;">元模型对象映射</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model.annotations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.1. </font><font style="vertical-align: inherit;">映射注释概述</font></font></a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model.date-formats"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期格式映射</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射的字段名称</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model.rules"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2. </font><font style="vertical-align: inherit;">映射规则</font></font></a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型提示</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地理空间类型</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GeoJson 类型</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收藏</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地图</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model.conversions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.3. </font><font style="vertical-align: inherit;">自定义转化</font></font></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. Elasticsearch 操作</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.template"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1. </font><font style="vertical-align: inherit;">弹性搜索模板</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.resttemplate"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2. </font><font style="vertical-align: inherit;">弹性搜索休息模板</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.usage"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3. </font><font style="vertical-align: inherit;">使用示例</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.operations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4. </font><font style="vertical-align: inherit;">反应式 Elasticsearch 操作</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.template"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.1. </font><font style="vertical-align: inherit;">反应式 Elasticsearch 模板</font></font></a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.template.configuration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反应式模板配置</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.template.usage"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反应式模板使用</font></font></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.searchresulttypes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.5. </font><font style="vertical-align: inherit;">搜索结果类型</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.queries"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6. </font><font style="vertical-align: inherit;">查询</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.criteriaquery"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.1. </font><font style="vertical-align: inherit;">条件查询</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.stringquery"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.2. </font><font style="vertical-align: inherit;">字符串查询</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.nativesearchquery"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.3. </font><font style="vertical-align: inherit;">本地搜索查询</font></font></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.repositories"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. Elasticsearch 存储库</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.repositories.autocreation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1. </font><font style="vertical-align: inherit;">使用相应的映射自动创建索引</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.query-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2. </font><font style="vertical-align: inherit;">查询方法</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.query-methods.finders"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1. </font><font style="vertical-align: inherit;">查询查找策略</font></font></a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明的查询</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.query-methods.criterions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.2. </font><font style="vertical-align: inherit;">查询创建</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.3. </font><font style="vertical-align: inherit;">方法返回类型</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.query-methods.at-query"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.4. </font><font style="vertical-align: inherit;">使用@Query 注解</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.repositories"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3. </font><font style="vertical-align: inherit;">反应式 Elasticsearch 存储库</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.repositories.usage"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.1. </font><font style="vertical-align: inherit;">用法</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.repositories.configuration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.2. </font><font style="vertical-align: inherit;">配置</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.repositories.annotations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4. </font><font style="vertical-align: inherit;">存储库方法的注释</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.1. </font><font style="vertical-align: inherit;">@强调</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.annotation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5. </font><font style="vertical-align: inherit;">基于注解的配置</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.cdi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.6. </font><font style="vertical-align: inherit;">使用 CDI 的 Elasticsearch 存储库</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.namespace"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.7. </font><font style="vertical-align: inherit;">Spring 命名空间</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9. 审计</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing.basics"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1. </font><font style="vertical-align: inherit;">基本</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing.annotations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1.1. </font><font style="vertical-align: inherit;">基于注释的审计元数据</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing.interfaces"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1.2. </font><font style="vertical-align: inherit;">基于接口的审计元数据</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing.auditor-aware"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1.3. </font></font><code>AuditorAware</code></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing.reactive-auditor-aware"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1.4. </font></font><code>ReactiveAuditorAware</code></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.auditing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2. </font><font style="vertical-align: inherit;">弹性搜索审计</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.1. </font><font style="vertical-align: inherit;">准备实体</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.2. </font><font style="vertical-align: inherit;">激活审计</font></font></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#entity-callbacks"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10. 实体回调</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#entity-callbacks.implement"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1. </font><font style="vertical-align: inherit;">实现实体回调</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#entity-callbacks.register"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2. </font><font style="vertical-align: inherit;">注册实体回调</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.entity-callbacks"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.3. </font><font style="vertical-align: inherit;">Elasticsearch EntityCallbacks</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.jointype"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11. Join-Type 实现</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.1. </font><font style="vertical-align: inherit;">设置数据</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2. </font><font style="vertical-align: inherit;">存储数据</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.3. </font><font style="vertical-align: inherit;">检索数据</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.routing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12. 路由值</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.1. </font><font style="vertical-align: inherit;">连接类型的路由</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.2. </font><font style="vertical-align: inherit;">自定义路由值</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.misc"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13. 杂项 Elasticsearch 操作支持</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearc.misc.index.settings"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.1. </font><font style="vertical-align: inherit;">索引设置</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.misc.filter"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.2. </font><font style="vertical-align: inherit;">过滤器生成器</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.scroll"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.3. </font><font style="vertical-align: inherit;">使用滚动获取大结果集</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.misc.sorts"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.4. </font><font style="vertical-align: inherit;">排序选项</font></font></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#appendix"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录</font></font></a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.namespace-reference"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 A：命名空间参考</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#populator.namespace-dao-config"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>&lt;repositories /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#populator.namespace-reference"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 B：Populators 命名空间参考</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#namespace-dao-config"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;populator /&gt; 元素</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repository-query-keywords"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 C：存储库查询关键字</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#appendix.query.method.subject"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的查询方法主题关键字</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#appendix.query.method.predicate"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的查询方法谓词关键字和修饰符</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repository-query-return-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 D：存储库查询返回类型</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#appendix.query.return.types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的查询返回类型</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.migration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 E：迁移指南</font></font></a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 3.2.x 升级到 4.0.x</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0.jackson-removal"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移除使用过的 Jackson Mapper</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0.implicit-index-name"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从查询对象中删除隐式索引名称</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0.new-operations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新的操作界面</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0.deprecations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font></a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法和类</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch 弃用</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0.removal"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移除</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.0-4.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 4.0.x 升级到 4.1.x</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.0-4.1.deprecations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.0-4.1.removal"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移除</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.0-4.1.breaking-changes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重大变化</font></font></a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReactiveElasticsearchClient.Indices 方法的返回类型</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DocumentOperations.bulkIndex 方法的返回类型</font></font></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.1-4.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 4.1.x 升级到 4.2.x</font></font></a>
<ul class="sectlevel3">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.1-4.2.deprecations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font></a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Document 参数</font></font></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.1-4.2.removal"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移除</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.1-4.2.breaking-changes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重大变化</font></font></a>
<ul class="sectlevel4">
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">刷新策略</font></font></a></li>
<li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法返回类型</font></font></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div id="tocbot" class="js-toc desktop-toc"><ol class="toc-list "><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#preface" class="toc-link node-name--H1 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前言</font></font></a><ol class="toc-list "><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#new-features" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 有什么新鲜事</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#new-features.4-2-0" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1. </font><font style="vertical-align: inherit;">Spring Data Elasticsearch 4.2 中的新功能</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#new-features.4-1-0" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2. </font><font style="vertical-align: inherit;">Spring Data Elasticsearch 4.1 中的新功能</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#new-features.4-0-0" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3. </font><font style="vertical-align: inherit;">Spring Data Elasticsearch 4.0 中的新功能</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#new-features.3-2-0" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4. </font><font style="vertical-align: inherit;">Spring Data Elasticsearch 3.2 中的新功能</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#preface.metadata" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 项目元数据</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#preface.requirements" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">三、要求</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#preface.versions" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1. </font><font style="vertical-align: inherit;">版本</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 使用 Spring Data Repositories</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.core-concepts" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1. </font><font style="vertical-align: inherit;">核心概念</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2. </font><font style="vertical-align: inherit;">查询方法</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.definition" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3. </font><font style="vertical-align: inherit;">定义存储库接口</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.definition-tuning" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3.1. </font><font style="vertical-align: inherit;">微调存储库定义</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.multiple-modules" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3.2. </font><font style="vertical-align: inherit;">使用具有多个 Spring 数据模块的存储库</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods.details" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4. </font><font style="vertical-align: inherit;">定义查询方法</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods.query-lookup-strategies" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.1. </font><font style="vertical-align: inherit;">查询查找策略</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods.query-creation" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.2. </font><font style="vertical-align: inherit;">查询创建</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods.query-property-expressions" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.3. </font><font style="vertical-align: inherit;">属性表达式</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.special-parameters" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.4. </font><font style="vertical-align: inherit;">特殊参数处理</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.paging-and-sorting" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分页和排序</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.limit-query-result" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.5. </font><font style="vertical-align: inherit;">限制查询结果</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.collections-and-iterables" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.6. </font><font style="vertical-align: inherit;">返回集合或可迭代对象的存储库方法</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.collections-and-iterables.streamable" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Streamable 作为查询方法返回类型</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.collections-and-iterables.streamable-wrapper" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回自定义流包装器类型</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.collections-and-iterables.vavr" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持 Vavr 集合</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.nullability" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.7. </font><font style="vertical-align: inherit;">存储库方法的空处理</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.nullability.annotations" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可空性注释</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.nullability.kotlin" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 Kotlin 的存储库中的可空性</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-streaming" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.8. </font><font style="vertical-align: inherit;">流式查询结果</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-async" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.9. </font><font style="vertical-align: inherit;">异步查询结果</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5. </font><font style="vertical-align: inherit;">创建存储库实例</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances.spring" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5.1. </font><font style="vertical-align: inherit;">XML 配置</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.using-filters" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用过滤器</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances.java-config" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5.2. </font><font style="vertical-align: inherit;">Java配置</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances.standalone" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5.3. </font><font style="vertical-align: inherit;">独立使用</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.custom-implementations" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6. </font><font style="vertical-align: inherit;">Spring Data Repositories 的自定义实现</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.single-repository-behavior" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6.1. </font><font style="vertical-align: inherit;">自定义单个存储库</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.configuration" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.customize-base-repository" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6.2. </font><font style="vertical-align: inherit;">自定义基础存储库</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.domain-events" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.7. </font><font style="vertical-align: inherit;">从聚合根发布事件</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.extensions" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8. </font><font style="vertical-align: inherit;">Spring 数据扩展</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.extensions.querydsl" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8.1. </font><font style="vertical-align: inherit;">Querydsl 扩展</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8.2. </font><font style="vertical-align: inherit;">网络支持</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.basic" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本网络支持</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.pageables" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对可分页的超媒体支持</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.basic.jackson-mappers" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Jackson 模块</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.binding" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网页数据绑定支持</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.type-safe" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Querydsl 网络支持</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.repository-populators" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8.3. </font><font style="vertical-align: inherit;">存储库填充器</font></font></a></li></ol></li></ol></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#reference" class="toc-link node-name--H1 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文档</font></font></a><ol class="toc-list "><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Elasticsearch 客户端</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.transport" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1. </font><font style="vertical-align: inherit;">运输客户端</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.rest" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2. </font><font style="vertical-align: inherit;">高级 REST 客户端</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.reactive" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3. </font><font style="vertical-align: inherit;">反应式客户端</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.configuration" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4. </font><font style="vertical-align: inherit;">客户端配置</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.logging" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.5. </font><font style="vertical-align: inherit;">客户端日志</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Elasticsearch 对象映射</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1. </font><font style="vertical-align: inherit;">元模型对象映射</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model.annotations" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.1. </font><font style="vertical-align: inherit;">映射注释概述</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model.date-formats" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期格式映射</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射的字段名称</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model.rules" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2. </font><font style="vertical-align: inherit;">映射规则</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型提示</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地理空间类型</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GeoJson 类型</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收藏</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地图</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model.conversions" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.3. </font><font style="vertical-align: inherit;">自定义转化</font></font></a></li></ol></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. Elasticsearch 操作</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.template" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1. </font><font style="vertical-align: inherit;">弹性搜索模板</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.resttemplate" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2. </font><font style="vertical-align: inherit;">弹性搜索休息模板</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.usage" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3. </font><font style="vertical-align: inherit;">使用示例</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.operations" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4. </font><font style="vertical-align: inherit;">反应式 Elasticsearch 操作</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.template" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.1. </font><font style="vertical-align: inherit;">反应式 Elasticsearch 模板</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.template.configuration" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反应式模板配置</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.template.usage" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反应式模板使用</font></font></a></li></ol></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.searchresulttypes" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.5. </font><font style="vertical-align: inherit;">搜索结果类型</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.queries" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6. </font><font style="vertical-align: inherit;">查询</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.criteriaquery" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.1. </font><font style="vertical-align: inherit;">条件查询</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.stringquery" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.2. </font><font style="vertical-align: inherit;">字符串查询</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.nativesearchquery" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.3. </font><font style="vertical-align: inherit;">本地搜索查询</font></font></a></li></ol></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.repositories" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. Elasticsearch 存储库</font></font></a><ol class="toc-list  is-collapsible"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.repositories.autocreation" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1. </font><font style="vertical-align: inherit;">使用相应的映射自动创建索引</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.query-methods" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2. </font><font style="vertical-align: inherit;">查询方法</font></font></a><ol class="toc-list  is-collapsible"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.query-methods.finders" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1. </font><font style="vertical-align: inherit;">查询查找策略</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明的查询</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.query-methods.criterions" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.2. </font><font style="vertical-align: inherit;">查询创建</font></font></a></li><li class="toc-list-item is-active-li"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H4  is-active-link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.3. </font><font style="vertical-align: inherit;">方法返回类型</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.query-methods.at-query" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.4. </font><font style="vertical-align: inherit;">使用@Query 注解</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.repositories" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3. </font><font style="vertical-align: inherit;">反应式 Elasticsearch 存储库</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.repositories.usage" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.1. </font><font style="vertical-align: inherit;">用法</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.repositories.configuration" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.2. </font><font style="vertical-align: inherit;">配置</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.repositories.annotations" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4. </font><font style="vertical-align: inherit;">存储库方法的注释</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.1. </font><font style="vertical-align: inherit;">@强调</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.annotation" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5. </font><font style="vertical-align: inherit;">基于注解的配置</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.cdi" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.6. </font><font style="vertical-align: inherit;">使用 CDI 的 Elasticsearch 存储库</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.namespace" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.7. </font><font style="vertical-align: inherit;">Spring 命名空间</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9. 审计</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing.basics" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1. </font><font style="vertical-align: inherit;">基本</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing.annotations" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1.1. </font><font style="vertical-align: inherit;">基于注释的审计元数据</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing.interfaces" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1.2. </font><font style="vertical-align: inherit;">基于接口的审计元数据</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing.auditor-aware" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1.3. </font><font style="vertical-align: inherit;">审计员意识</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing.reactive-auditor-aware" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1.4. </font><font style="vertical-align: inherit;">反应式审计员</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.auditing" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2. </font><font style="vertical-align: inherit;">弹性搜索审计</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.1. </font><font style="vertical-align: inherit;">准备实体</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.2. </font><font style="vertical-align: inherit;">激活审计</font></font></a></li></ol></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#entity-callbacks" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10. 实体回调</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#entity-callbacks.implement" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1. </font><font style="vertical-align: inherit;">实现实体回调</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#entity-callbacks.register" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2. </font><font style="vertical-align: inherit;">注册实体回调</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.entity-callbacks" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.3. </font><font style="vertical-align: inherit;">Elasticsearch EntityCallbacks</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.jointype" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11. Join-Type 实现</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.1. </font><font style="vertical-align: inherit;">设置数据</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2. </font><font style="vertical-align: inherit;">存储数据</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.3. </font><font style="vertical-align: inherit;">检索数据</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.routing" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12. 路由值</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.1. </font><font style="vertical-align: inherit;">连接类型的路由</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.2. </font><font style="vertical-align: inherit;">自定义路由值</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.misc" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13. 杂项 Elasticsearch 操作支持</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearc.misc.index.settings" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.1. </font><font style="vertical-align: inherit;">索引设置</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.misc.filter" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.2. </font><font style="vertical-align: inherit;">过滤器生成器</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.scroll" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.3. </font><font style="vertical-align: inherit;">使用滚动获取大结果集</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.misc.sorts" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.4. </font><font style="vertical-align: inherit;">排序选项</font></font></a></li></ol></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#appendix" class="toc-link node-name--H1 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录</font></font></a><ol class="toc-list "><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.namespace-reference" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 A：命名空间参考</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#populator.namespace-dao-config" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;repositories /&gt; 元素</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#populator.namespace-reference" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 B：Populators 命名空间参考</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#namespace-dao-config" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;populator /&gt; 元素</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repository-query-keywords" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 C：存储库查询关键字</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#appendix.query.method.subject" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的查询方法主题关键字</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#appendix.query.method.predicate" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的查询方法谓词关键字和修饰符</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repository-query-return-types" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 D：存储库查询返回类型</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#appendix.query.return.types" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的查询返回类型</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.migration" class="toc-link node-name--H2 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 E：迁移指南</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 3.2.x 升级到 4.0.x</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0.jackson-removal" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移除使用过的 Jackson Mapper</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0.implicit-index-name" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从查询对象中删除隐式索引名称</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0.new-operations" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新的操作界面</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0.deprecations" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法和类</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch 弃用</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0.removal" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移除</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.0-4.1" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 4.0.x 升级到 4.1.x</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.0-4.1.deprecations" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.0-4.1.removal" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移除</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.0-4.1.breaking-changes" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重大变化</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReactiveElasticsearchClient.Indices 方法的返回类型</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DocumentOperations.bulkIndex 方法的返回类型</font></font></a></li></ol></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.1-4.2" class="toc-link node-name--H3 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 4.1.x 升级到 4.2.x</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.1-4.2.deprecations" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Document 参数</font></font></a></li></ol></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.1-4.2.removal" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移除</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.1-4.2.breaking-changes" class="toc-link node-name--H4 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重大变化</font></font></a><ol class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">刷新策略</font></font></a></li><li class="toc-list-item"><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#" class="toc-link node-name--H5 "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法返回类型</font></font></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">© 2013-2021 原作者。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本文档的副本可以供您自己使用和分发给他人，前提是您不对此类副本收取任何费用，并且每份副本均包含本版权声明，无论是印刷版还是电子版。
</font></font></td>
</tr>
</tbody></table>
</div>

</div>
</div>
<h1 id="preface" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#preface"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前言</font></font></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Elasticsearch 项目将核心 Spring 概念应用于使用 Elasticsearch 搜索引擎的解决方案开发。</font><font style="vertical-align: inherit;">它提供：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模板</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为用于存储、搜索、排序文档和构建聚合的高级抽象。</font></font></p>
</li>
<li>
<p><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，</font><em><font style="vertical-align: inherit;">存储库</font></em><font style="vertical-align: inherit;">使用户能够通过定义具有自定义方法名称的接口来表达查询（有关存储库的基本信息，请参阅</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Spring Data Repositories</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您会注意到与 Spring 框架中的 Spring 数据 solr 和 mongodb 支持的相似之处。</font></font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="new-features"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#new-features"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 有什么新鲜事</font></font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="new-features.4-2-0"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#new-features.4-2-0"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1. </font><font style="vertical-align: inherit;">Spring Data Elasticsearch 4.2 中的新功能</font></font></h3>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升级到 Elasticsearch 7.10.0。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持自定义路由值</font></font></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="new-features.4-1-0"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#new-features.4-1-0"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2. </font><font style="vertical-align: inherit;">Spring Data Elasticsearch 4.1 中的新功能</font></font></h3>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Spring 5.3。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升级到 Elasticsearch 7.9.3。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改进了别名管理的 API。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"></font><code>ReactiveIndexOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for 索引管理的</font><font style="vertical-align: inherit;">介绍</font><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引模板支持。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 GeoJson 支持地理形状数据。</font></font></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="new-features.4-0-0"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#new-features.4-0-0"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3. </font><font style="vertical-align: inherit;">Spring Data Elasticsearch 4.0 中的新功能</font></font></h3>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Spring 5.2。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升级到 Elasticsearch 7.6.2。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font><code>TransportClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现大多数可用于索引映射的映射类型。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移除 Jackson </font></font><code>ObjectMapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，现在使用</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MappingElasticsearchConverter</font></font></a></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清理</font></font><code>*Operations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font><font style="vertical-align: inherit;">中的 API，对</font><font style="vertical-align: inherit;">方法进行分组和重命名，以便它们与 Elasticsearch API 相匹配，弃用旧方法，与其他 Spring Data 模块保持一致。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引入</font></font><code>SearchHit&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类来表示找到的文档以及该文档的相关结果元数据（即</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sortValues</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引入</font></font><code>SearchHits&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类来表示整个搜索结果以及完整搜索结果的元数据（即</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">max_score</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引入</font></font><code>SearchPage&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类来表示包含</font></font><code>SearchHits&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">的分页结果</font><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"></font><code>GeoDistanceOrder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">能够按地理距离创建排序</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">类的</font><font style="vertical-align: inherit;">介绍</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计支持的实施</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生命周期实体回调的实现</font></font></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="new-features.3-2-0"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#new-features.3-2-0"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4. </font><font style="vertical-align: inherit;">Spring Data Elasticsearch 3.2 中的新功能</font></font></h3>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过基本身份验证和 SSL 传输提供安全的 Elasticsearch 集群支持。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升级到 Elasticsearch 6.8.1。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反应式编程支持</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.operations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反应式 Elasticsearch 操作</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.repositories"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反应式 Elasticsearch 存储库</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引入</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ElasticsearchEntityMapper</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为 Jackson 的替代品</font></font><code>ObjectMapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的字段名称自定义</font></font><code>@Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持按查询删除。</font></font></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preface.metadata"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#preface.metadata"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 项目元数据</font></font></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本控制 - </font></font><a href="https://github.com/spring-projects/spring-data-elasticsearch" class="bare"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/spring-projects/spring-data-elasticsearch</font></font></a></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API 文档 - </font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/current/api/" class="bare"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://docs.spring.io/spring-data/elasticsearch/docs/current/api/</font></font></a></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bugtracker - </font></font><a href="https://github.com/spring-projects/spring-data-elasticsearch/issues" class="bare"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/spring-projects/spring-data-elasticsearch/issues</font></font></a></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布存储库 - </font></font><a href="https://repo.spring.io/libs-release" class="bare"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://repo.spring.io/libs-release</font></font></a></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">里程碑存储库 - </font></font><a href="https://repo.spring.io/libs-milestone" class="bare"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://repo.spring.io/libs-milestone</font></font></a></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快照存储库 - </font></font><a href="https://repo.spring.io/libs-snapshot" class="bare"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://repo.spring.io/libs-snapshot</font></font></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preface.requirements"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#preface.requirements"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">三、要求</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要安装</font></font><a href="https://www.elastic.co/products/elasticsearch"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect2">
<h3 id="preface.versions"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#preface.versions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1. </font><font style="vertical-align: inherit;">版本</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下表显示了 Spring Data 版本系列使用的 Elasticsearch 版本和其中包含的 Spring Data Elasticsearch 版本，以及引用该特定 Spring Data 版本系列的 Spring Boot 版本：</font></font></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring 数据发布火车</font></font></th>
<th class="tableblock halign-center valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Elasticsearch</font></font></th>
<th class="tableblock halign-center valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弹性搜索</font></font></th>
<th class="tableblock halign-center valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弹簧框架</font></font></th>
<th class="tableblock halign-center valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弹簧靴</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2021.0 (帕斯卡)</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2.1</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.12.1</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3.7</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.5.x</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2020.0（奥卡姆）</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1.x</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.9.3</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3.2</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.4.x</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">诺依曼</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.0.x</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.2</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.12</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3.x</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">摩尔</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2.x</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.8.12</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.12</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2.x</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拉夫莱斯</font></font><sup class="footnote" id="_footnote_oom"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><a id="_footnoteref_1" class="footnote" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#_footnotedef_1" title="查看脚注。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1.x </font></font><sup class="footnoteref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><a class="footnote" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#_footnotedef_1" title="查看脚注。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.2</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.19</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.x</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">凯</font></font><sup class="footnoteref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><a class="footnote" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#_footnotedef_1" title="查看脚注。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.0.x </font></font><sup class="footnoteref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><a class="footnote" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#_footnotedef_1" title="查看脚注。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.5.0</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.0.13</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.0.x</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">英格尔斯</font></font><sup class="footnoteref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><a class="footnote" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#_footnotedef_1" title="查看脚注。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.x </font></font><sup class="footnoteref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><a class="footnote" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#_footnotedef_1" title="查看脚注。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.4.0</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3.25</font></font></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5.x</font></font></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在跟踪对即将推出的 Elasticsearch 版本的支持，假设使用</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.rest"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高级 REST 客户端，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该提供一般兼容性</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repositories"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 使用 Spring Data Repositories</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data repository 抽象的目标是显着减少为各种持久性存储实现数据访问层所需的样板代码量。</font></font></p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要的"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data 存储库文档和您的模块</font></font></em></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本章解释了 Spring Data 存储库的核心概念和接口。</font><font style="vertical-align: inherit;">本章中的信息来自 Spring Data Commons 模块。</font><font style="vertical-align: inherit;">它使用 Java Persistence API (JPA) 模块的配置和代码示例。</font><font style="vertical-align: inherit;">您应该将 XML 命名空间声明和要扩展的类型调整为您使用的特定模块的等效项。</font><font style="vertical-align: inherit;">“</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.namespace-reference"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名空间参考</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”涵盖了所有支持存储库 API 的 Spring Data 模块都支持的 XML 配置。</font><font style="vertical-align: inherit;">“</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repository-query-keywords"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库查询关键字</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”涵盖了存储库抽象支持的查询方法关键字。</font><font style="vertical-align: inherit;">有关模块特定功能的详细信息，请参阅本文档中有关该模块的章节。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="repositories.core-concepts"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.core-concepts"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1. </font><font style="vertical-align: inherit;">核心概念</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data 存储库抽象中的中心接口是</font></font><code>Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">它需要域类来管理以及域类的 ID 类型作为类型参数。</font><font style="vertical-align: inherit;">此接口主要用作标记接口，以捕获要使用的类型并帮助您发现扩展此接口的接口。</font><font style="vertical-align: inherit;">该</font></font><a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/CrudRepository.html"><code>CrudRepository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口为正在管理的实体类提供复杂的 CRUD 功能。</font></font></p>
</div>
<div id="repositories.repository" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 1.</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{<font></font>
<font></font>
  &lt;S extends T&gt; <span class="hljs-function">S <span class="hljs-title">save</span><span class="hljs-params">(S entity)</span></span>;      <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
<font></font>
  <span class="hljs-function">Optional&lt;T&gt; <span class="hljs-title">findById</span><span class="hljs-params">(ID primaryKey)</span></span>; <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
  <span class="hljs-function">Iterable&lt;T&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;               <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">count</span><span class="hljs-params">()</span></span>;                        <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(T entity)</span></span>;               <i class="conum" data-value="5"></i><b>(<span class="hljs-number">5</span>)</b><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">existsById</span><span class="hljs-params">(ID primaryKey)</span></span>;   <i class="conum" data-value="6"></i><b>(<span class="hljs-number">6</span>)</b><font></font>
<font></font>
  <span class="hljs-comment">// … more functionality omitted.</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存给定的实体。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回由给定 ID 标识的实体。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回所有实体。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回实体的数量。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除给定的实体。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示具有给定 ID 的实体是否存在。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们还提供特定于持久性技术的抽象，例如</font></font><code>JpaRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>MongoRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些接口扩展</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并露出下面的持久化技术在另外的能力，以比较通用的持久性与技术无关的接口，如</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 之上</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，有一个</font></font><a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/PagingAndSortingRepository.html"><code>PagingAndSortingRepository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">抽象，它添加了额外的方法来简化对实体的分页访问：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 2.</font></font><code>PagingAndSortingRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">界面</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PagingAndSortingRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function">Iterable&lt;T&gt; <span class="hljs-title">findAll</span><span class="hljs-params">(Sort sort)</span></span>;<font></font>
<font></font>
  <span class="hljs-function">Page&lt;T&gt; <span class="hljs-title">findAll</span><span class="hljs-params">(Pageable pageable)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要访问</font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">页面大小为 20</font><font style="vertical-align: inherit;">的第二页</font><font style="vertical-align: inherit;">，您可以执行以下操作：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">PagingAndSortingRepository&lt;User, Long&gt; repository = <span class="hljs-comment">// … get access to a bean</span>
Page&lt;User&gt; users = repository.findAll(PageRequest.of(<span class="hljs-number">1</span>, <span class="hljs-number">20</span>));</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了查询方法，计数和删除查询的查询派生也是可用的。</font><font style="vertical-align: inherit;">以下列表显示了派生计数查询的接口定义：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 3. 派生计数查询</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">countByLastname</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下清单显示了派生删除查询的接口定义：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 4. 派生删除查询</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">deleteByLastname</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
<font></font>
  <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">removeByLastname</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories.query-methods"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2. </font><font style="vertical-align: inherit;">查询方法</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准 CRUD 功能存储库通常对底层数据存储进行查询。</font><font style="vertical-align: inherit;">使用 Spring Data，声明这些查询变成了一个四步过程：</font></font></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明一个扩展 Repository 或其子接口之一的接口，并将其键入它应该处理的域类和 ID 类型，如以下示例所示：</font></font></p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在接口上声明查询方法。</font></font></p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 Spring 以使用</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances.java-config"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaConfig</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML 配置</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为这些接口创建代理实例</font><font style="vertical-align: inherit;">。</font></font></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用 Java 配置，请创建一个类似于以下内容的类：</font></font></p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.config.EnableJpaRepositories;<font></font>
<font></font>
<span class="hljs-meta">@EnableJpaRepositories</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{ … }</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用 XML 配置，请定义一个类似于以下内容的 bean：</font></font></p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
   <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
   <span class="hljs-attr">xmlns:jpa</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/jpa"</span>
   <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
     https://www.springframework.org/schema/beans/spring-beans.xsd
     http://www.springframework.org/schema/data/jpa
     https://www.springframework.org/schema/data/jpa/spring-jpa.xsd"</span>&gt;</span><font></font>
<font></font>
   <span class="hljs-tag">&lt;<span class="hljs-name">jpa:repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repositories"</span>/&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本示例中使用了 JPA 命名空间。</font><font style="vertical-align: inherit;">如果您对任何其他商店使用存储库抽象，则需要将其更改为商店模块的适当命名空间声明。</font><font style="vertical-align: inherit;">换句话说，您应该交换</font></font><code>jpa</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以支持，例如</font></font><code>mongodb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另请注意，JavaConfig 变体并未显式配置包，因为默认情况下使用带注释的类的包。</font><font style="vertical-align: inherit;">要自定义要扫描的包，请使用</font></font><code>basePackage…</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定于数据存储的存储库的 -</font></font><code>@Enable${store}Repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">属性之一</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注入存储库实例并使用它，如以下示例所示：</font></font></p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeClient</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> PersonRepository repository;<font></font>
<font></font>
  SomeClient(PersonRepository repository) {<font></font>
    <span class="hljs-keyword">this</span>.repository = repository;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span> </span>{<font></font>
    List&lt;Person&gt; persons = repository.findByLastname(<span class="hljs-string">"Matthews"</span>);<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下部分详细解释了每个步骤：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.definition"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义存储库接口</font></font></a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods.details"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义查询方法</font></font></a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建存储库实例</font></font></a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.custom-implementations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Repositories 的自定义实现</font></font></a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="repositories.definition"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.definition"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3. </font><font style="vertical-align: inherit;">定义存储库接口</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要定义存储库接口，首先需要定义特定于域类的存储库接口。</font><font style="vertical-align: inherit;">接口必须扩展</font></font><code>Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并键入域类和 ID 类型。</font><font style="vertical-align: inherit;">如果要公开该域类型的 CRUD 方法，请使用扩展</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是</font></font><code>Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
<div class="sect3">
<h4 id="repositories.definition-tuning"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.definition-tuning"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3.1. </font><font style="vertical-align: inherit;">微调存储库定义</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常情况下，你的资料库接口扩展</font></font><code>Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>PagingAndSortingRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">或者，如果您不想扩展 Spring Data 接口，也可以使用</font></font><code>@RepositoryDefinition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">扩展</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公开了一套完整的方法来操作您的实体。</font><font style="vertical-align: inherit;">如果您更愿意选择公开的方法，请将要公开的方法复制</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到域存储库中。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这样做可以让您在提供的 Spring Data Repositories 功能之上定义自己的抽象。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的示例示出了如何以选择性地露出CRUD方法（</font></font><code>findById</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在这种情况下）：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 5. 有选择地公开 CRUD 方法</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@NoRepositoryBean</span>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function">Optional&lt;T&gt; <span class="hljs-title">findById</span><span class="hljs-params">(ID id)</span></span>;<font></font>
<font></font>
  &lt;S extends T&gt; <span class="hljs-function">S <span class="hljs-title">save</span><span class="hljs-params">(S entity)</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{
  <span class="hljs-function">User <span class="hljs-title">findByEmailAddress</span><span class="hljs-params">(EmailAddress emailAddress)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在前面的例子，你定义为所有站点库一个共同的基础界面和暴露</font></font><code>findById(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以及</font></font><code>save(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这些方法被发送到基础信息库实现你所选择的由Spring提供的数据（例如，如果使用JPA商店，实现是</font></font><code>SimpleJpaRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)，因为它们匹配 中的方法签名</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所以</font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在可以保存用户，通过 ID 查找单个用户，并触发查询以</font></font><code>Users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过电子邮件地址</font><font style="vertical-align: inherit;">查找</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
中间存储库接口用</font></font><code>@NoRepositoryBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">确保将该注释添加到 Spring Data 不应在运行时为其创建实例的所有存储库接口。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="repositories.multiple-modules"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.multiple-modules"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3.2. </font><font style="vertical-align: inherit;">使用具有多个 Spring 数据模块的存储库</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在您的应用程序中使用唯一的 Spring Data 模块会使事情变得简单，因为定义范围内的所有存储库接口都绑定到 Spring Data 模块。</font><font style="vertical-align: inherit;">有时，应用程序需要使用多个 Spring Data 模块。</font><font style="vertical-align: inherit;">在这种情况下，存储库定义必须区分持久性技术。</font><font style="vertical-align: inherit;">当在类路径上检测到多个存储库工厂时，Spring Data 进入严格的存储库配置模式。</font><font style="vertical-align: inherit;">严格配置使用存储库或域类的详细信息来决定存储库定义的 Spring Data 模块绑定：</font></font></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果存储库定义</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.multiple-modules.types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展了特定于模块的存储库</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则它是特定 Spring Data 模块的有效候选者。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果域类</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.multiple-modules.annotations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用特定于模块的类型注释进行注释</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则它是特定 Spring Data 模块的有效候选者。</font><font style="vertical-align: inherit;">Spring Data 模块接受第三方注解（例如 JPA's </font></font><code>@Entity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）或提供自己的注解（例如</font></font><code>@Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data MongoDB 和 Spring Data Elasticsearch）。</font></font></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了使用特定于模块的接口（在本例中为 JPA）的存储库：</font></font></p>
</div>
<div id="repositories.multiple-modules.types" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 6. 使用模块特定接口的存储库定义</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{ }<font></font>
<font></font>
<span class="hljs-meta">@NoRepositoryBean</span>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{ … }<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>MyRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font><font style="vertical-align: inherit;">在它们的类型层次结构中</font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展</font></font><code>JpaRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它们是 Spring Data JPA 模块的有效候选者。</font></font></p>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了使用通用接口的存储库：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 7. 使用通用接口的存储库定义</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AmbiguousRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }<font></font>
<font></font>
<span class="hljs-meta">@NoRepositoryBean</span>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{ … }<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AmbiguousUserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MyBaseRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>AmbiguousRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>AmbiguousUserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅延伸</font></font><code>Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在他们的类型层次。</font><font style="vertical-align: inherit;">虽然这在使用唯一的 Spring Data 模块时很好，但多个模块无法区分这些存储库应该绑定到哪个特定的 Spring Data。</font></font></p>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了使用带注释的域类的存储库：</font></font></p>
</div>
<div id="repositories.multiple-modules.annotations" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 8. 使用带注释的域类的存储库定义</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }<font></font>
<font></font>
<span class="hljs-meta">@Entity</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{ … }<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }<font></font>
<font></font>
<span class="hljs-meta">@Document</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{ … }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>PersonRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">References </font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它用 JPA</font></font><code>@Entity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">进行了</font><font style="vertical-align: inherit;">注释，所以这个存储库显然属于 Spring Data JPA。</font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">References </font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使用 Spring Data MongoDB 的</font></font><code>@Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注解进行注解。</font></font></p>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下错误示例显示了使用具有混合注释的域类的存储库：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 9. 使用具有混合注释的域类的存储库定义</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">JpaPersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MongoDBPersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{ … }<font></font>
<font></font>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Document</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{ … }</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例显示使用 JPA 和 Spring Data MongoDB 注释的域类。</font><font style="vertical-align: inherit;">它定义了两个存储库，</font></font><code>JpaPersonRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><code>MongoDBPersonRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">一个用于 JPA，另一个用于 MongoDB。</font><font style="vertical-align: inherit;">Spring Data 不再能够区分存储库，这会导致未定义的行为。</font></font></p>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.multiple-modules.types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库类型详细信息</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.multiple-modules.annotations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">区分域类注释</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于严格的存储库配置，以识别特定 Spring Data 模块的存储库候选者。</font><font style="vertical-align: inherit;">在同一域类型上使用多个特定于持久性技术的注释是可能的，并且允许跨多个持久性技术重用域类型。</font><font style="vertical-align: inherit;">但是，Spring Data 无法再确定与存储库绑定的唯一模块。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">区分存储库的最后一种方法是确定存储库基础包的范围。</font><font style="vertical-align: inherit;">基础包定义了扫描存储库接口定义的起点，这意味着存储库定义位于适当的包中。</font><font style="vertical-align: inherit;">默认情况下，注解驱动的配置使用配置类的包。</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances.spring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 XML 的配置中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances.spring"><font style="vertical-align: inherit;">基本包</font></a><font style="vertical-align: inherit;">是必需的。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了基础包的注释驱动配置：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 10. 基础包的注解驱动配置</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@EnableJpaRepositories(basePackages = "com.acme.repositories.jpa")</span>
<span class="hljs-meta">@EnableMongoRepositories(basePackages = "com.acme.repositories.mongo")</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Configuration</span> </span>{ … }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories.query-methods.details"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods.details"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4. </font><font style="vertical-align: inherit;">定义查询方法</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库代理有两种方法可以从方法名称派生特定于商店的查询：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过直接从方法名称派生查询。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过使用手动定义的查询。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用选项取决于实际商店。</font><font style="vertical-align: inherit;">但是，必须有一个策略来决定创建什么实际查询。</font><font style="vertical-align: inherit;">下一节描述了可用的选项。</font></font></p>
</div>
<div class="sect3">
<h4 id="repositories.query-methods.query-lookup-strategies"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods.query-lookup-strategies"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.1. </font><font style="vertical-align: inherit;">查询查找策略</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下策略可用于存储库基础结构来解析查询。</font><font style="vertical-align: inherit;">通过 XML 配置，您可以通过</font></font><code>query-lookup-strategy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">在命名空间配置策略</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于 Java 配置，您可以使用</font><font style="vertical-align: inherit;">注解</font><font style="vertical-align: inherit;">的</font></font><code>queryLookupStrategy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font><code>Enable${store}Repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">特定数据存储可能不支持某些策略。</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CREATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试从查询方法名称构造特定于商店的查询。</font><font style="vertical-align: inherit;">一般的方法是从方法名称中删除一组给定的众所周知的前缀并解析方法的其余部分。</font><font style="vertical-align: inherit;">您可以在“</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods.query-creation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询创建</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”中</font><font style="vertical-align: inherit;">阅读有关查询构造的更多信息</font><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><code>USE_DECLARED_QUERY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试查找已声明的查询，如果找不到则抛出异常。</font><font style="vertical-align: inherit;">查询可以由某个地方的注释定义或通过其他方式声明。</font><font style="vertical-align: inherit;">请参阅特定商店的文档以查找该商店​​的可用选项。</font><font style="vertical-align: inherit;">如果存储库基础结构在引导时未找到该方法的声明查询，则它会失败。</font></font></p>
</li>
<li>
<p><code>CREATE_IF_NOT_FOUND</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认）结合</font></font><code>CREATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>USE_DECLARED_QUERY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它首先查找声明的查询，如果没有找到声明的查询，它会创建一个自定义的基于方法名称的查询。</font><font style="vertical-align: inherit;">这是默认的查找策略，因此，如果您没有明确配置任何内容，就会使用它。</font><font style="vertical-align: inherit;">它允许按方法名称快速定义查询，还允许通过根据需要引入声明的查询来自定义这些查询。</font></font></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="repositories.query-methods.query-creation"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods.query-creation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.2. </font><font style="vertical-align: inherit;">查询创建</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data 存储库基础结构中内置的查询构建器机制对于构建对存储库实体的约束查询非常有用。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了如何创建多个查询：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 11. 根据方法名称创建查询</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByEmailAddressAndLastname</span><span class="hljs-params">(EmailAddress emailAddress, String lastname)</span></span>;<font></font>
<font></font>
  <span class="hljs-comment">// Enables the distinct flag for the query</span>
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findDistinctPeopleByLastnameOrFirstname</span><span class="hljs-params">(String lastname, String firstname)</span></span>;
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findPeopleDistinctByLastnameOrFirstname</span><span class="hljs-params">(String lastname, String firstname)</span></span>;<font></font>
<font></font>
  <span class="hljs-comment">// Enabling ignoring case for an individual property</span>
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByLastnameIgnoreCase</span><span class="hljs-params">(String lastname)</span></span>;
  <span class="hljs-comment">// Enabling ignoring case for all suitable properties</span>
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByLastnameAndFirstnameAllIgnoreCase</span><span class="hljs-params">(String lastname, String firstname)</span></span>;<font></font>
<font></font>
  <span class="hljs-comment">// Enabling static ORDER BY for a query</span>
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByLastnameOrderByFirstnameAsc</span><span class="hljs-params">(String lastname)</span></span>;
  <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByLastnameOrderByFirstnameDesc</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析查询方法名称分为主语和谓语。</font><font style="vertical-align: inherit;">第一部分 ( </font></font><code>find…By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>exists…By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) 定义查询的主题，第二部分构成谓词。</font><font style="vertical-align: inherit;">介绍从句（主语）可以包含进一步的表达。</font></font><code>find</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或其他引入关键字）和</font><font style="vertical-align: inherit;">之间的任何文本都</font></font><code>By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被认为是描述性的，除非使用结果限制关键字之一，例如</font></font><code>Distinct</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在要创建的查询上设置不同的标志或</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.limit-query-result"><code>Top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font><code>First</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以限制查询结果</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录包含</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#appendix.query.method.subject"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询方法主题关键字</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#appendix.query.method.predicate"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询方法谓词关键字</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#appendix.query.method.subject"><font style="vertical-align: inherit;">完整列表，</font></a><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#appendix.query.method.predicate"><font style="vertical-align: inherit;">包括排序和字母大小写修饰符</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，第一个</font></font><code>By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">充当分隔符以指示实际条件谓词的开始。</font><font style="vertical-align: inherit;">在非常基础的层面上，您可以定义实体属性的条件并将它们与</font></font><code>And</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">连接起来</font></font><code>Or</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析方法的实际结果取决于您为其创建查询的持久性存储。</font><font style="vertical-align: inherit;">但是，有一些一般的事情需要注意：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式通常是与可以连接的运算符相结合的属性遍历。</font><font style="vertical-align: inherit;">您可以将属性表达式与</font></font><code>AND</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">结合使用</font></font><code>OR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您还可以得到这样的运营商为支撑</font></font><code>Between</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>LessThan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>GreaterThan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code>Like</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该属性的表达式。</font><font style="vertical-align: inherit;">受支持的运算符可能因数据存储而异，因此请参阅参考文档的相应部分。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法解析器支持</font></font><code>IgnoreCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为单个属性（例如</font></font><code>findByLastnameIgnoreCase(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）或支持忽略大小写的类型（通常是</font></font><code>String</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例，例如</font></font><code>findByLastnameAndFirstnameAllIgnoreCase(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">所有属性</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">标志</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">是否支持忽略大小写可能因商店而异，因此请参阅参考文档中的相关部分以了解商店特定的查询方法。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以通过将</font></font><code>OrderBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">附加</font><font style="vertical-align: inherit;">到引用属性的查询方法并提供排序方向（</font></font><code>Asc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>Desc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">来应用静态排序</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要创建支持动态排序的查询方法，请参阅“</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.special-parameters"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特殊参数处理</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”。</font></font></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="repositories.query-methods.query-property-expressions"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods.query-property-expressions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.3. </font><font style="vertical-align: inherit;">属性表达式</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性表达式只能引用托管实体的直接属性，如前面的示例所示。</font><font style="vertical-align: inherit;">在创建查询时，您已经确保解析的属性是托管域类的属性。</font><font style="vertical-align: inherit;">但是，您也可以通过遍历嵌套属性来定义约束。</font><font style="vertical-align: inherit;">考虑以下方法签名：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByAddressZipCode</span><span class="hljs-params">(ZipCode zipCode)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设 a</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有</font></font><code>Address</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code>ZipCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，该方法会创建</font></font><code>x.address.zipCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性遍历。</font><font style="vertical-align: inherit;">解析算法首先将整个部分 ( </font></font><code>AddressZipCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font><font style="vertical-align: inherit;">解释</font><font style="vertical-align: inherit;">为属性并检查具有该名称（未大写）的属性的域类。</font><font style="vertical-align: inherit;">如果算法成功，它将使用该属性。</font><font style="vertical-align: inherit;">如果不是，则算法将来自右侧的驼峰式部分的源分成头部和尾部，并尝试找到相应的属性 - 在我们的示例中，</font></font><code>AddressZip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Code</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果算法找到具有该头部的属性，它会取尾部并继续从那里向下构建树，以刚才描述的方式将尾部拆分。</font><font style="vertical-align: inherit;">如果第一个分割不匹配，算法将分割点向左移动 ( </font></font><code>Address</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>ZipCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) 并继续。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管这应该适用于大多数情况，但算法可能会选择错误的属性。</font><font style="vertical-align: inherit;">假设这个</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类也有一个</font></font><code>addressZip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性。</font><font style="vertical-align: inherit;">该算法将在第一个分割轮中匹配，选择错误的属性，并失败（因为 的类型</font></font><code>addressZip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能没有</font></font><code>code</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性）。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要解决这种歧义，您可以</font></font><code>_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在方法名称中使用手动定义遍历点。</font><font style="vertical-align: inherit;">所以我们的方法名称如下：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">findByAddress_ZipCode</span><span class="hljs-params">(ZipCode zipCode)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为我们将下划线字符视为保留字符，所以我们强烈建议遵循标准的 Java 命名约定（即，不要在属性名称中使用下划线，而是使用驼峰式大小写）。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="repositories.special-parameters"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.special-parameters"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.4. </font><font style="vertical-align: inherit;">特殊参数处理</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要处理查询中的参数，请定义方法参数，如前面示例中所示。</font><font style="vertical-align: inherit;">除此之外，基础设施识别某些特定类型，如</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以动态地将分页和排序应用于您的查询。</font><font style="vertical-align: inherit;">以下示例演示了这些功能：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 12.</font><font style="vertical-align: inherit;">在查询方法中</font><font style="vertical-align: inherit;">使用</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>Slice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Sort</code><font style="vertical-align: inherit;"></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">Page&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;<font></font>
<font></font>
<span class="hljs-function">Slice&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;<font></font>
<font></font>
<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Sort sort)</span></span>;<font></font>
<font></font>
<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要的"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
API 接受</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">期望将非</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值传递给方法。</font><font style="vertical-align: inherit;">如果您不想应用任何排序或分页，请使用</font></font><code>Sort.unsorted()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Pageable.unpaged()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一种方法允许您将</font></font><code>org.springframework.data.domain.Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">传递</font><font style="vertical-align: inherit;">给查询方法，以将分页动态添加到静态定义的查询中。</font><font style="vertical-align: inherit;">A</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知道可用的元素和页面的总数。</font><font style="vertical-align: inherit;">它通过基础结构触发计数查询来计算总数。</font><font style="vertical-align: inherit;">由于这可能很昂贵（取决于使用的商店），您可以改为返回</font></font><code>Slice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">A</font></font><code>Slice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只知道下一个</font></font><code>Slice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是否可用，这在遍历更大的结果集时可能就足够了。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">排序选项也通过</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">处理</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您只需要排序，请</font></font><code>org.springframework.data.domain.Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在您的方法中</font><font style="vertical-align: inherit;">添加一个</font><font style="vertical-align: inherit;">参数。</font><font style="vertical-align: inherit;">如您所见，返回 a</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也是可能的。</font><font style="vertical-align: inherit;">在这种情况下，</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会创建</font><font style="vertical-align: inherit;">构建实际</font><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">所需的额外元数据</font><font style="vertical-align: inherit;">（这意味着不会发出本来需要的额外计数查询）。</font><font style="vertical-align: inherit;">相反，它限制查询仅查找给定范围的实体。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要了解整个查询获得了多少页，您必须触发额外的计数查询。</font><font style="vertical-align: inherit;">默认情况下，此查询源自您实际触发的查询。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="repositories.paging-and-sorting"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.paging-and-sorting"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分页和排序</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用属性名称定义简单的排序表达式。</font><font style="vertical-align: inherit;">您可以连接表达式以将多个条件收集到一个表达式中。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 13. 定义排序表达式</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Sort sort = Sort.by(<span class="hljs-string">"firstname"</span>).ascending()<font></font>
  .and(Sort.by(<span class="hljs-string">"lastname"</span>).descending());</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于定义排序表达式的更类型安全的方法，从定义排序表达式的类型开始，并使用方法引用来定义排序的属性。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 14. 使用类型安全 API 定义排序表达式</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">TypedSort&lt;Person&gt; person = Sort.sort(Person.class);<font></font>
<font></font>
Sort sort = person.by(Person::getFirstname).ascending()<font></font>
  .and(person.by(Person::getLastname).descending());</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content">
<code>TypedSort.by(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 通过（通常）使用 CGlib 来使用运行时代理，这可能会在使用 Graal VM Native 等工具时干扰本机映像编译。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您的商店实现支持 Querydsl，您还可以使用生成的元模型类型来定义排序表达式：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 15. 使用 Querydsl API 定义排序表达式</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">QSort sort = QSort.by(QPerson.firstname.asc())<font></font>
  .and(QSort.by(QPerson.lastname.desc()));</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.limit-query-result"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.limit-query-result"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.5. </font><font style="vertical-align: inherit;">限制查询结果</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用</font></font><code>first</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键字</font><font style="vertical-align: inherit;">来限制查询方法的结果</font><font style="vertical-align: inherit;">，这两个关键字可以互换使用。</font><font style="vertical-align: inherit;">您可以将一个可选的数值附加到</font></font><code>top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>first</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定要返回的最大结果大小。</font><font style="vertical-align: inherit;">如果忽略该数字，则假定结果大小为 1。</font><font style="vertical-align: inherit;">以下示例显示了如何限制查询大小：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 16. 使用</font></font><code>Top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">限制查询的结果大小</font></font><code>First</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">User <span class="hljs-title">findFirstByOrderByLastnameAsc</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
<span class="hljs-function">User <span class="hljs-title">findTopByOrderByAgeDesc</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
<span class="hljs-function">Page&lt;User&gt; <span class="hljs-title">queryFirst10ByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;<font></font>
<font></font>
<span class="hljs-function">Slice&lt;User&gt; <span class="hljs-title">findTop3ByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;<font></font>
<font></font>
<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findFirst10ByLastname</span><span class="hljs-params">(String lastname, Sort sort)</span></span>;<font></font>
<font></font>
<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findTop10ByLastname</span><span class="hljs-params">(String lastname, Pageable pageable)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制表达式还支持</font></font><code>Distinct</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持不同查询的数据存储</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">关键字。</font><font style="vertical-align: inherit;">此外，对于将结果集限制为一个实例的查询，</font></font><code>Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持</font><font style="vertical-align: inherit;">将结果用</font><font style="vertical-align: inherit;">关键字</font><font style="vertical-align: inherit;">包装</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果分页或切片应用于限制查询分页（以及可用页数的计算），则在受限结果内应用。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过使用</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">限制结果与动态排序相结合，</font><font style="vertical-align: inherit;">您可以表达“K”最小元素和“K”最大元素的查询方法。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="repositories.collections-and-iterables"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.collections-and-iterables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.6. </font><font style="vertical-align: inherit;">返回集合或可迭代对象的存储库方法</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询方法，返回多个结果可以使用标准的Java </font></font><code>Iterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除此之外，我们还支持返回 Spring Data 的</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、 的自定义扩展</font></font><code>Iterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><a href="https://www.vavr.io/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vavr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供的集合类型</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅解释所有可能的</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#appendix.query.return.types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询方法返回类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的附录</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect4">
<h5 id="repositories.collections-and-iterables.streamable"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.collections-and-iterables.streamable"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Streamable 作为查询方法返回类型</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用</font><font style="vertical-align: inherit;">任何集合类型的</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">替代</font></font><code>Iterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">品。</font><font style="vertical-align: inherit;">它提供了访问非并行</font></font><code>Stream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（缺少 from </font></font><code>Iterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">便捷方法，</font><font style="vertical-align: inherit;">以及直接</font></font><code>….filter(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>….map(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">覆盖元素并将其连接</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到其他</font><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">的能力</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 17. 使用 Streamable 组合查询方法结果</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt; </span>{
  <span class="hljs-function">Streamable&lt;Person&gt; <span class="hljs-title">findByFirstnameContaining</span><span class="hljs-params">(String firstname)</span></span>;
  <span class="hljs-function">Streamable&lt;Person&gt; <span class="hljs-title">findByLastnameContaining</span><span class="hljs-params">(String lastname)</span></span>;<font></font>
}<font></font>
<font></font>
Streamable&lt;Person&gt; result = repository.findByFirstnameContaining(<span class="hljs-string">"av"</span>)<font></font>
  .and(repository.findByLastnameContaining(<span class="hljs-string">"ea"</span>));</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="repositories.collections-and-iterables.streamable-wrapper"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.collections-and-iterables.streamable-wrapper"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回自定义流包装器类型</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为集合提供专用包装器类型是一种常用模式，用于为返回多个元素的查询结果提供 API。</font><font style="vertical-align: inherit;">通常，通过调用存储库方法返回类集合类型并手动创建包装器类型的实例来使用这些类型。</font><font style="vertical-align: inherit;">您可以避免该额外步骤，因为 Spring Data 允许您将这些包装器类型用作查询方法返回类型，前提是它们满足以下条件：</font></font></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型实现</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的类型公开任一个构造或命名静态工厂法</font></font><code>of(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>valueOf(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该取</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为参数。</font></font></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下清单显示了一个示例：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Product</span> </span>{                                         <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
  <span class="hljs-function">MonetaryAmount <span class="hljs-title">getPrice</span><span class="hljs-params">()</span> </span>{ … }<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@RequiredArgsConstructor(staticName = "of")</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Products</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Streamable</span>&lt;<span class="hljs-title">Product</span>&gt; </span>{         <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Streamable&lt;Product&gt; streamable;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> MonetaryAmount <span class="hljs-title">getTotal</span><span class="hljs-params">()</span> </span>{                    <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
    <span class="hljs-keyword">return</span> streamable.stream()<font></font>
      .map(Priced::getPrice)<font></font>
      .reduce(Money.of(<span class="hljs-number">0</span>), MonetaryAmount::add);<font></font>
  }<font></font>
<font></font>
<font></font>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> Iterator&lt;Product&gt; <span class="hljs-title">iterator</span><span class="hljs-params">()</span> </span>{                 <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b>
    <span class="hljs-keyword">return</span> streamable.iterator();<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ProductRepository</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Product</span>, <span class="hljs-title">Long</span>&gt; </span>{
  <span class="hljs-function">Products <span class="hljs-title">findAllByDescriptionContaining</span><span class="hljs-params">(String text)</span></span>; <i class="conum" data-value="5"></i><b>(<span class="hljs-number">5</span>)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code>Product</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">暴露的API来访问产品的价格实体。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"></font><code>Streamable&lt;Product&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过使用</font></font><code>Products.of(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（使用 Lombok 注释创建的工厂方法）</font><font style="vertical-align: inherit;">构造的</font><font style="vertical-align: inherit;">的包装器类型</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">采用</font></font><code>Streamable&lt;Product&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will 的</font><font style="vertical-align: inherit;">标准构造函数</font><font style="vertical-align: inherit;">也可以。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包装器类型公开了一个额外的 API，在</font></font><code>Streamable&lt;Product&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口并委托给实际结果。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该包装器类型</font></font><code>Products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以直接用作查询方法返回类型。</font><font style="vertical-align: inherit;">您不需要</font></font><code>Streamable&lt;Product&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在存储库客户端中的查询之后</font><font style="vertical-align: inherit;">返回</font><font style="vertical-align: inherit;">并手动包装它。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="repositories.collections-and-iterables.vavr"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.collections-and-iterables.vavr"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持 Vavr 集合</font></font></h5>
<div class="paragraph">
<p><a href="https://www.vavr.io/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vavr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个包含 Java 函数式编程概念的库。</font><font style="vertical-align: inherit;">它附带一组自定义集合类型，您可以将其用作查询方法返回类型，如下表所示：</font></font></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vavr 集合类型</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用的 Vavr 实现类型</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效的 Java 源类型</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.Seq</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Iterable</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.Set</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.LinkedHashSet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Iterable</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.Map</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vavr.collection.LinkedHashMap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Map</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用第一列（或其子类型）中的类型作为查询方法返回类型，并根据实际查询结果（第三列）的 Java 类型获取第二列中的类型作为实现类型。</font><font style="vertical-align: inherit;">或者，您可以声明</font></font><code>Traversable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><code>Iterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相当于</font><font style="vertical-align: inherit;">Vavr </font><font style="vertical-align: inherit;">），然后我们从实际返回值派生实现类。</font><font style="vertical-align: inherit;">也就是说， a</font></font><code>java.util.List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变成了 Vavr</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>Seq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">， a</font></font><code>java.util.Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变成了 Vavr </font></font><code>LinkedHashSet</code> <code>Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，依此类推。</font></font></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.nullability"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.nullability"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.7. </font><font style="vertical-align: inherit;">存储库方法的空处理</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 Spring Data 2.0 开始，返回单个聚合实例的存储库 CRUD 方法使用 Java 8</font></font><code>Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来指示可能缺少值。</font><font style="vertical-align: inherit;">除此之外，Spring Data 支持在查询方法上返回以下包装器类型：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>com.google.common.base.Optional</code></p>
</li>
<li>
<p><code>scala.Option</code></p>
</li>
<li>
<p><code>io.vavr.control.Option</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，查询方法可以选择根本不使用包装器类型。</font><font style="vertical-align: inherit;">然后通过返回来指示不存在查询结果</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">返回集合、集合替代、包装器和流的存储库方法保证永远不会返回</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而是</font><font style="vertical-align: inherit;">返回</font><font style="vertical-align: inherit;">相应的空表示。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息，</font><font style="vertical-align: inherit;">请参阅“</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repository-query-return-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库查询返回类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”。</font></font></p>
</div>
<div class="sect4">
<h5 id="repositories.nullability.annotations"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.nullability.annotations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可空性注释</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用</font></font><a href="https://docs.spring.io/spring-framework/docs/5.3.9/reference/html/core.html#null-safety"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Framework 的可空性注释</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来表达存储库方法的可空性约束</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它们</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在运行时</font><font style="vertical-align: inherit;">提供了一种工具友好的方法和选择加入</font><font style="vertical-align: inherit;">检查，如下所示：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.9/javadoc-api/org/springframework/lang/NonNullApi.html"><code>@NonNullApi</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 在包级别上用于声明参数和返回值的默认行为分别是既不接受也不产生</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。</font></font></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.9/javadoc-api/org/springframework/lang/NonNull.html"><code>@NonNull</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 用于不得为的参数或返回值</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在</font></font><code>@NonNullApi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用</font><font style="vertical-align: inherit;">的参数和返回值上不需要</font><font style="vertical-align: inherit;">）。</font></font></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.3.9/javadoc-api/org/springframework/lang/Nullable.html"><code>@Nullable</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 用于可以是的参数或返回值</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring 注释使用</font></font><a href="https://jcp.org/en/jsr/detail?id=305"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 305</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释（一种休眠但广泛使用的 JSR）</font><font style="vertical-align: inherit;">进行元注释</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">JSR 305 元注释让工具供应商（例如</font></font><a href="https://www.jetbrains.com/help/idea/nullable-and-notnull-annotations.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDEA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://help.eclipse.org/oxygen/index.jsp?topic=/org.eclipse.jdt.doc.user/tasks/task-using_external_null_annotations.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eclipse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://kotlinlang.org/docs/reference/java-interop.html#null-safety-and-platform-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kotlin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）以通用方式提供空安全支持，而无需对 Spring 注释进行硬编码支持。</font><font style="vertical-align: inherit;">要为查询方法启用可空性约束的运行时检查，您需要使用 Spring 的</font></font><code>@NonNullApi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in</font><font style="vertical-align: inherit;">在包级别激活非可空性</font></font><code>package-info.java</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 18. 在 </font></font><code>package-info.java</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@org</span>.springframework.lang.NonNullApi
<span class="hljs-keyword">package</span> com.acme;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦非空默认设置到位，存储库查询方法调用将在运行时验证为可空性约束。</font><font style="vertical-align: inherit;">如果查询结果违反了定义的约束，则抛出异常。</font><font style="vertical-align: inherit;">当该方法将返回</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但被声明为不可为空时（在存储库所在的包上定义的默认注释），</font><font style="vertical-align: inherit;">就会发生这种情况</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您想再次选择可空结果，请有选择地使用</font></font><code>@Nullable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单个方法。</font><font style="vertical-align: inherit;">使用本节开头提到的结果包装器类型继续按预期工作：空结果被转换为表示不存在的值。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了刚刚描述的许多技术：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 19. 使用不同的可空性约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">package</span> com.acme;                                                       <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
<font></font>
<span class="hljs-keyword">import</span> org.springframework.lang.Nullable;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function">User <span class="hljs-title">getByEmailAddress</span><span class="hljs-params">(EmailAddress emailAddress)</span></span>;                    <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
  <span class="hljs-meta">@Nullable</span>
  <span class="hljs-function">User <span class="hljs-title">findByEmailAddress</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> EmailAddress emailAdress)</span></span>;          <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b><font></font>
<font></font>
  <span class="hljs-function">Optional&lt;User&gt; <span class="hljs-title">findOptionalByEmailAddress</span><span class="hljs-params">(EmailAddress emailAddress)</span></span>; <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库驻留在我们定义了非空行为的包（或子包）中。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"></font><code>EmptyResultDataAccessException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当查询未产生结果时</font><font style="vertical-align: inherit;">抛出</font><font style="vertical-align: inherit;">。</font></font><code>IllegalArgumentException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当</font></font><code>emailAddress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递给方法是</font><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">抛出</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当查询未产生结果时</font><font style="vertical-align: inherit;">返回</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">也接受</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为 的值</font></font><code>emailAddress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></b></td>
<td><font style="vertical-align: inherit;"></font><code>Optional.empty()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当查询未产生结果时</font><font style="vertical-align: inherit;">返回</font><font style="vertical-align: inherit;">。</font></font><code>IllegalArgumentException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当</font></font><code>emailAddress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递给方法是</font><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">抛出</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="repositories.nullability.kotlin"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.nullability.kotlin"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 Kotlin 的存储库中的可空性</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kotlin</font><font style="vertical-align: inherit;">在语言中</font><font style="vertical-align: inherit;">定义了可</font></font><a href="https://kotlinlang.org/docs/reference/null-safety.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空性约束</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Kotlin 代码编译为字节码，它不通过方法签名而是通过编译元数据来表达可空性约束。</font><font style="vertical-align: inherit;">确保</font></font><code>kotlin-reflect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在您的项目中</font><font style="vertical-align: inherit;">包含</font><font style="vertical-align: inherit;">JAR 以启用对 Kotlin 的可空性约束的内省。</font><font style="vertical-align: inherit;">Spring Data 存储库使用语言机制来定义这些约束以应用相同的运行时检查，如下所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 20.在 Kotlin 存储库上使用可空性约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> : <span class="hljs-type">Repository</span>&lt;<span class="hljs-type">User, String</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">findByUsername</span><span class="hljs-params">(username: <span class="hljs-type">String</span>)</span></span>: User     <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">findByFirstname</span><span class="hljs-params">(firstname: <span class="hljs-type">String</span>?)</span></span>: User? <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该方法将参数和结果都定义为不可为空（Kotlin 默认值）。</font><font style="vertical-align: inherit;">Kotlin 编译器拒绝传递</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给方法的</font><font style="vertical-align: inherit;">方法调用</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果查询产生空结果，</font></font><code>EmptyResultDataAccessException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则抛出</font><font style="vertical-align: inherit;">an </font><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该方法接受</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>firstname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数，并返回</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果查询不产生结果。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.query-streaming"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-streaming"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.8. </font><font style="vertical-align: inherit;">流式查询结果</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用 Java 8</font></font><code>Stream&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为返回类型以</font><font style="vertical-align: inherit;">增量方式处理查询方法的结果</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">不是将查询结果包装在 a 中</font></font><code>Stream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而是使用数据存储特定的方法来执行流式传输，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 21. 使用 Java 8 流式传输查询结果 </font></font><code>Stream&lt;T&gt;</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Query("select u from User u")</span>
<span class="hljs-function">Stream&lt;User&gt; <span class="hljs-title">findAllByCustomQueryAndStream</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
<span class="hljs-function">Stream&lt;User&gt; <span class="hljs-title">readAllByFirstnameNotNull</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
<span class="hljs-meta">@Query("select u from User u")</span>
<span class="hljs-function">Stream&lt;User&gt; <span class="hljs-title">streamAllPaged</span><span class="hljs-params">(Pageable pageable)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A</font></font><code>Stream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">潜在地包装了底层数据存储特定的资源，因此必须在使用后关闭。</font><font style="vertical-align: inherit;">您可以</font></font><code>Stream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>close()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法或使用 Java 7</font></font><code>try-with-resources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块</font><font style="vertical-align: inherit;">手动关闭</font><font style="vertical-align: inherit;">，如以下示例所示：
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 22.</font></font><code>Stream&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>try-with-resources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块中处理</font><font style="vertical-align: inherit;">结果</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">try</span> (Stream&lt;User&gt; stream = repository.findAllByCustomQueryAndStream()) {<font></font>
  stream.forEach(…);<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
并非所有 Spring Data 模块当前都支持</font></font><code>Stream&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为返回类型。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="repositories.query-async"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-async"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.9. </font><font style="vertical-align: inherit;">异步查询结果</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用</font></font><a href="https://docs.spring.io/spring-framework/docs/5.3.9/reference/html/integration.html#scheduling"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring 的异步方法运行能力异步</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行存储库查询</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这意味着该方法在调用时立即返回，而实际查询发生在已提交给 Spring 的任务中</font></font><code>TaskExecutor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">异步查询不同于反应式查询，不应混合使用。</font><font style="vertical-align: inherit;">有关反应式支持的更多详细信息，请参阅商店特定的文档。</font><font style="vertical-align: inherit;">以下示例显示了一些异步查询：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Async</span>
<span class="hljs-function">Future&lt;User&gt; <span class="hljs-title">findByFirstname</span><span class="hljs-params">(String firstname)</span></span>;               <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
<font></font>
<span class="hljs-meta">@Async</span>
<span class="hljs-function">CompletableFuture&lt;User&gt; <span class="hljs-title">findOneByFirstname</span><span class="hljs-params">(String firstname)</span></span>; <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
<span class="hljs-meta">@Async</span>
<span class="hljs-function">ListenableFuture&lt;User&gt; <span class="hljs-title">findOneByLastname</span><span class="hljs-params">(String lastname)</span></span>;    <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>java.util.concurrent.Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为返回类型。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Java 8</font></font><code>java.util.concurrent.CompletableFuture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为返回类型。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 a</font></font><code>org.springframework.util.concurrent.ListenableFuture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为返回类型。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories.create-instances"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5. </font><font style="vertical-align: inherit;">创建存储库实例</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节介绍如何为定义的存储库接口创建实例和 bean 定义。一种方法是使用支持存储库机制的每个 Spring Data 模块附带的 Spring 命名空间，尽管我们通常建议使用 Java 配置。</font></font></p>
</div>
<div class="sect3">
<h4 id="repositories.create-instances.spring"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances.spring"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5.1. </font><font style="vertical-align: inherit;">XML 配置</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个 Spring Data 模块都包含一个</font></font><code>repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素，可让您定义 Spring 为您扫描的基本包，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 23. 通过 XML 启用 Spring Data 存储库</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans:beans</span> <span class="hljs-attr">xmlns:beans</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/jpa"</span>
  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/jpa
    https://www.springframework.org/schema/data/jpa/spring-jpa.xsd"</span>&gt;</span><font></font>
<font></font>
  <span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repositories"</span> /&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans:beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在前面的示例中，指示 Spring 扫描</font></font><code>com.acme.repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">及其所有子包以查找扩展</font></font><code>Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的接口或其子接口之一。</font><font style="vertical-align: inherit;">对于找到的每个接口，基础结构注册特定</font></font><code>FactoryBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">于</font><font style="vertical-align: inherit;">持久性技术</font><font style="vertical-align: inherit;">以创建处理查询方法调用的适当代理。</font><font style="vertical-align: inherit;">每个 bean 都在从接口名称派生的 bean 名称下注册，因此 的接口</font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将在 下注册</font></font><code>userRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">嵌套存储库接口的 Bean 名称以其封闭的类型名称为前缀。</font><font style="vertical-align: inherit;">该</font></font><code>base-package</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性允许使用通配符，以便您可以定义扫描包的模式。</font></font></p>
</div>
<div class="sect4">
<h5 id="repositories.using-filters"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.using-filters"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用过滤器</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，基础设施会选择每个接口，这些接口扩展</font></font><code>Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于配置的基本包下的</font><font style="vertical-align: inherit;">持久性技术特定的</font><font style="vertical-align: inherit;">子接口，并为其创建一个 bean 实例。</font><font style="vertical-align: inherit;">但是，您可能希望更精细地控制哪些接口为其创建了 bean 实例。</font><font style="vertical-align: inherit;">为此，请</font><font style="vertical-align: inherit;">在元素内</font><font style="vertical-align: inherit;">使用</font></font><code>&lt;include-filter /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>&lt;exclude-filter /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font></font><code>&lt;repositories /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">语义完全等同于 Spring 上下文命名空间中的元素。</font><font style="vertical-align: inherit;">有关详细信息，请参阅</font><font style="vertical-align: inherit;">这些元素</font><font style="vertical-align: inherit;">的</font></font><a href="https://docs.spring.io/spring-framework/docs/5.3.9/reference/html/core.html#beans-scanning-filters"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring 参考文档</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，要将某些接口从实例化中排除为存储库 bean，您可以使用以下配置：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 24. 使用 exclude-filter 元素</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repositories"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">context:exclude-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"regex"</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">".*SomeRepository"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面的示例排除了所有以</font></font><code>SomeRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例化</font><font style="vertical-align: inherit;">结尾的接口</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.create-instances.java-config"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances.java-config"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5.2. </font><font style="vertical-align: inherit;">Java配置</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您还可以通过</font></font><code>@Enable${store}Repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Java 配置类上</font><font style="vertical-align: inherit;">使用特定</font><font style="vertical-align: inherit;">于</font><font style="vertical-align: inherit;">商店的</font><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">来触发存储库基础</font><font style="vertical-align: inherit;">结构。有关 Spring 容器的基于 Java 的配置的介绍，请参阅</font></font><a href="https://docs.spring.io/spring-framework/docs/5.3.9/reference/html/core.html#beans-java"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring 参考文档中的 JavaConfig</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用 Spring Data 存储库的示例配置类似于以下内容：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 25. 基于注解的存储库配置示例</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableJpaRepositories("com.acme.repositories")</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfiguration</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Bean</span>
  <span class="hljs-function">EntityManagerFactory <span class="hljs-title">entityManagerFactory</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// …</span><font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前面的示例使用特定于 JPA 的注释，您可以根据实际使用的商店模块对其进行更改。这同样适用于</font></font><code>EntityManagerFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bean 的</font><font style="vertical-align: inherit;">定义。请</font><font style="vertical-align: inherit;">参阅涵盖商店特定配置的部分。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="repositories.create-instances.standalone"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances.standalone"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5.3. </font><font style="vertical-align: inherit;">独立使用</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您还可以在 Spring 容器之外使用存储库基础结构 — 例如，在 CDI 环境中。您的类路径中仍然需要一些 Spring 库，但是，通常，您也可以通过编程方式设置存储库。提供存储库的 Spring Data 模块支持附带</font></font><code>RepositoryFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用</font><font style="vertical-align: inherit;">的特定</font><font style="vertical-align: inherit;">于</font><font style="vertical-align: inherit;">持久性技术的技术</font><font style="vertical-align: inherit;">，如下所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 26. 存储库工厂的独立使用</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">RepositoryFactorySupport factory = … <span class="hljs-comment">// Instantiate factory here</span>
UserRepository repository = factory.getRepository(UserRepository.class);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories.custom-implementations"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.custom-implementations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6. </font><font style="vertical-align: inherit;">Spring Data Repositories 的自定义实现</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data 提供了各种选项来创建只需很少编码的查询方法。</font><font style="vertical-align: inherit;">但是当这些选项不符合您的需求时，您还可以为存储库方法提供您自己的自定义实现。</font><font style="vertical-align: inherit;">本节介绍如何做到这一点。</font></font></p>
</div>
<div class="sect3">
<h4 id="repositories.single-repository-behavior"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.single-repository-behavior"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6.1. </font><font style="vertical-align: inherit;">自定义单个存储库</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用自定义功能丰富存储库，您必须首先定义片段接口和自定义功能的实现，如下所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 27. 自定义存储库功能的接口</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CustomizedUserRepository</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">someCustomMethod</span><span class="hljs-params">(User user)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 28. 自定义存储库功能的实现</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomizedUserRepositoryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CustomizedUserRepository</span> </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">someCustomMethod</span><span class="hljs-params">(User user)</span> </span>{
    <span class="hljs-comment">// Your custom implementation</span><font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与片段接口对应的类名中最重要的部分是</font></font><code>Impl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后缀。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现本身不依赖于Spring Data，可以是一个普通的Spring bean。因此，你可以使用标准的依赖注入行为来注入对其他bean（例如a </font></font><code>JdbcTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">引用</font><font style="vertical-align: inherit;">，参与方面等等。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后你可以让你的repository接口扩展fragment接口，如下：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 29. 对存储库界面的更改</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt;, <span class="hljs-title">CustomizedUserRepository</span> </span>{<font></font>
<font></font>
  <span class="hljs-comment">// Declare query methods here</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用您的存储库接口扩展片段接口结合了 CRUD 和自定义功能，并使其可供客户端使用。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data 存储库是通过使用形成存储库组合的片段来实现的。片段是基础存储库、功能方面（例如</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.extensions.querydsl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QueryDsl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）和自定义接口及其实现。</font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.extensions.querydsl"><font style="vertical-align: inherit;">每次</font></a><font style="vertical-align: inherit;">向存储库接口添加接口时，您都可以增强通过添加片段来组合。基本存储库和存储库方面实现由每个 Spring Data 模块提供。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了自定义接口及其实现：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 30. 片段及其实现</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">HumanRepository</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">someHumanMethod</span><span class="hljs-params">(User user)</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HumanRepositoryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HumanRepository</span> </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">someHumanMethod</span><span class="hljs-params">(User user)</span> </span>{
    <span class="hljs-comment">// Your custom implementation</span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ContactRepository</span> </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">someContactMethod</span><span class="hljs-params">(User user)</span></span>;<font></font>
<font></font>
  <span class="hljs-function">User <span class="hljs-title">anotherContactMethod</span><span class="hljs-params">(User user)</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContactRepositoryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ContactRepository</span> </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">someContactMethod</span><span class="hljs-params">(User user)</span> </span>{
    <span class="hljs-comment">// Your custom implementation</span><font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">anotherContactMethod</span><span class="hljs-params">(User user)</span> </span>{
    <span class="hljs-comment">// Your custom implementation</span><font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了扩展的自定义存储库的界面</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 31. 对存储库界面的更改</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt;, <span class="hljs-title">HumanRepository</span>, <span class="hljs-title">ContactRepository</span> </span>{<font></font>
<font></font>
  <span class="hljs-comment">// Declare query methods here</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库可能由按声明顺序导入的多个自定义实现组成。自定义实现比基本实现和存储库方面具有更高的优先级。此顺序允许您覆盖基本存储库和方面方法，并在两个片段贡献相同的方法签名。存储库片段不限于在单个存储库接口中使用。多个存储库可以使用片段接口，让您可以跨不同存储库重用自定义。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了存储库片段及其实现：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 32. 片段覆盖 </font></font><code>save(…)</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CustomizedSave</span>&lt;<span class="hljs-title">T</span>&gt; </span>{<font></font>
  &lt;S extends T&gt; <span class="hljs-function">S <span class="hljs-title">save</span><span class="hljs-params">(S entity)</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomizedSaveImpl</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">CustomizedSave</span>&lt;<span class="hljs-title">T</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-keyword">public</span> &lt;S extends T&gt; <span class="hljs-function">S <span class="hljs-title">save</span><span class="hljs-params">(S entity)</span> </span>{
    <span class="hljs-comment">// Your custom implementation</span><font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了使用上述存储库片段的存储库：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 33. 自定义存储库接口</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt;, <span class="hljs-title">CustomizedSave</span>&lt;<span class="hljs-title">User</span>&gt; </span>{<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">Long</span>&gt;, <span class="hljs-title">CustomizedSave</span>&lt;<span class="hljs-title">Person</span>&gt; </span>{<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="repositories.configuration"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您使用命名空间配置，存储库基础结构会尝试通过扫描它在其中找到存储库的包下的类来自动检测自定义实现片段。</font><font style="vertical-align: inherit;">这些类需要遵循将命名空间元素的</font></font><code>repository-impl-postfix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">附加</font><font style="vertical-align: inherit;">到片段接口名称</font><font style="vertical-align: inherit;">的命名约定</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此后缀默认为</font></font><code>Impl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">以下示例显示了一个使用默认后缀的存储库和一个为后缀设置自定义值的存储库：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 34. 配置示例</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repository"</span> /&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repository"</span> <span class="hljs-attr">repository-impl-postfix</span>=<span class="hljs-string">"MyPostfix"</span> /&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面示例中的第一个配置尝试查找一个称为</font></font><code>com.acme.repository.CustomizedUserRepositoryImpl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为自定义存储库实现的类。</font><font style="vertical-align: inherit;">第二个示例尝试查找</font></font><code>com.acme.repository.CustomizedUserRepositoryMyPostfix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
<div class="sect5">
<h6 id="repositories.single-repository-behaviour.ambiguity"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.single-repository-behaviour.ambiguity"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解决歧义</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果在不同的包中找到多个具有匹配类名的实现，Spring Data 使用 bean 名称来标识使用哪个。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鉴于</font></font><code>CustomizedUserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面显示</font><font style="vertical-align: inherit;">的以下两个自定义实现</font><font style="vertical-align: inherit;">，使用第一个实现。</font><font style="vertical-align: inherit;">它的 bean 名称是</font></font><code>customizedUserRepositoryImpl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它与片段 interface( </font></font><code>CustomizedUserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) 加上后缀的</font><font style="vertical-align: inherit;">名称</font><font style="vertical-align: inherit;">相匹配</font></font><code>Impl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 35. 解决不明确的实现</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">package</span> com.acme.impl.one;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomizedUserRepositoryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CustomizedUserRepository</span> </span>{<font></font>
<font></font>
  <span class="hljs-comment">// Your custom implementation</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">package</span> com.acme.impl.two;<font></font>
<font></font>
<span class="hljs-meta">@Component("specialCustomImpl")</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomizedUserRepositoryImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CustomizedUserRepository</span> </span>{<font></font>
<font></font>
  <span class="hljs-comment">// Your custom implementation</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您使用 注释</font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font></font><code>@Component("specialCustom")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么 bean 名称加号</font></font><code>Impl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与 中为存储库实现定义的</font><font style="vertical-align: inherit;">名称</font><font style="vertical-align: inherit;">相匹配</font></font><code>com.acme.impl.two</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并使用它代替第一个名称。</font></font></p>
</div>
</div>
<div class="sect5">
<h6 id="repositories.manual-wiring"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.manual-wiring"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动接线</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您的自定义实现仅使用基于注解的配置和自动装配，则前面显示的方法效果很好，因为它被视为任何其他 Spring bean。</font><font style="vertical-align: inherit;">如果您的实现片段 bean 需要特殊连接，您可以根据上</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.single-repository-behaviour.ambiguity"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一节中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的约定声明 bean 并为其命名</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后，基础结构按名称引用手动定义的 bean 定义，而不是自己创建一个。</font><font style="vertical-align: inherit;">以下示例显示了如何手动连接自定义实现：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 36. 自定义实现的手动接线</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repository"</span> /&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">beans:bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userRepositoryImpl"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"…"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- further configuration --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans:bean</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="repositories.customize-base-repository"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.customize-base-repository"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6.2. </font><font style="vertical-align: inherit;">自定义基础存储库</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当您想要自定义基本存储库行为以便影响所有存储库时</font><font style="vertical-align: inherit;">，上</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.manual-wiring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一节中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的方法</font><font style="vertical-align: inherit;">需要自定义每个存储库接口。</font><font style="vertical-align: inherit;">要改为更改所有存储库的行为，您可以创建一个扩展持久性技术特定存储库基类的实现。</font><font style="vertical-align: inherit;">然后，此类充当存储库代理的自定义基类，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 37.自定义存储库基类</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyRepositoryImpl</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt;
  <span class="hljs-keyword">extends</span> <span class="hljs-title">SimpleJpaRepository</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">ID</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> EntityManager entityManager;<font></font>
<font></font>
  MyRepositoryImpl(JpaEntityInformation entityInformation,<font></font>
                          EntityManager entityManager) {<font></font>
    <span class="hljs-keyword">super</span>(entityInformation, entityManager);<font></font>
<font></font>
    <span class="hljs-comment">// Keep the EntityManager around to used from the newly introduced methods.</span>
    <span class="hljs-keyword">this</span>.entityManager = entityManager;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@Transactional</span>
  <span class="hljs-keyword">public</span> &lt;S extends T&gt; <span class="hljs-function">S <span class="hljs-title">save</span><span class="hljs-params">(S entity)</span> </span>{
    <span class="hljs-comment">// implementation goes here</span><font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="警告"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该类需要具有特定于商店的存储库工厂实现使用的超类的构造函数。</font><font style="vertical-align: inherit;">如果存储库基类有多个构造函数，则覆盖一个</font></font><code>EntityInformation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加上存储特定基础结构对象（例如一个</font></font><code>EntityManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或模板类）的</font><font style="vertical-align: inherit;">构造函数</font><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后一步是让 Spring Data 基础设施知道定制的存储库基类。</font><font style="vertical-align: inherit;">在 Java 配置中，您可以使用</font><font style="vertical-align: inherit;">注解</font><font style="vertical-align: inherit;">的</font></font><code>repositoryBaseClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性来实现</font></font><code>@Enable${store}Repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 38. 使用 JavaConfig 配置自定义存储库基类</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableJpaRepositories(repositoryBaseClass = MyRepositoryImpl.class)</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfiguration</span> </span>{ … }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML 命名空间中提供了相应的属性，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 39. 使用 XML 配置自定义存储库基类</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repository"</span>
     <span class="hljs-attr">base-class</span>=<span class="hljs-string">"….MyRepositoryImpl"</span> /&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="core.domain-events"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.domain-events"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.7. </font><font style="vertical-align: inherit;">从聚合根发布事件</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库管理的实体是聚合根。</font><font style="vertical-align: inherit;">在域驱动设计应用程序中，这些聚合根通常发布域事件。</font><font style="vertical-align: inherit;">Spring Data 提供了一个名为的注释</font></font><code>@DomainEvents</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以在聚合根的方法上使用</font><font style="vertical-align: inherit;">该注释</font><font style="vertical-align: inherit;">，以使该发布尽可能简单，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 40. 从聚合根公开域事件</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnAggregateRoot</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@DomainEvents</span> <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
    <span class="hljs-function">Collection&lt;Object&gt; <span class="hljs-title">domainEvents</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// … return events you want to get published here</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@AfterDomainEventPublication</span> <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">callbackMethod</span><span class="hljs-params">()</span> </span>{
       <span class="hljs-comment">// … potentially clean up domain events list</span><font></font>
    }<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用的方法</font></font><code>@DomainEvents</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以返回单个事件实例或事件集合。</font><font style="vertical-align: inherit;">它不能接受任何论据。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布所有事件后，我们就有了一个用</font></font><code>@AfterDomainEventPublication</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">您可以使用它潜在地清理要发布的事件列表（以及其他用途）。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该方法被称为一个Spring数据存储库的每一次一个</font></font><code>save(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>saveAll(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>delete(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>deleteAll(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法被调用。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="core.extensions"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.extensions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8. </font><font style="vertical-align: inherit;">Spring 数据扩展</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节记录了一组 Spring Data 扩展，这些扩展支持在各种上下文中使用 Spring Data。</font><font style="vertical-align: inherit;">目前，大部分集成都针对 Spring MVC。</font></font></p>
</div>
<div class="sect3">
<h4 id="core.extensions.querydsl"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.extensions.querydsl"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8.1. </font><font style="vertical-align: inherit;">Querydsl 扩展</font></font></h4>
<div class="paragraph">
<p><a href="http://www.querydsl.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Querydsl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个框架，可以通过其流畅的 API 构建静态类型的 SQL 类查询。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">几个 Spring Data 模块通过 提供与 Querydsl 的集成</font></font><code>QuerydslPredicateExecutor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例 41.QuerydslPredicateExecutor 接口</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">QuerydslPredicateExecutor</span>&lt;<span class="hljs-title">T</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-function">Optional&lt;T&gt; <span class="hljs-title">findById</span><span class="hljs-params">(Predicate predicate)</span></span>;  <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
<font></font>
  <span class="hljs-function">Iterable&lt;T&gt; <span class="hljs-title">findAll</span><span class="hljs-params">(Predicate predicate)</span></span>;   <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">count</span><span class="hljs-params">(Predicate predicate)</span></span>;            <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">exists</span><span class="hljs-params">(Predicate predicate)</span></span>;        <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b><font></font>
<font></font>
  <span class="hljs-comment">// … more functionality omitted.</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查找并返回与 匹配的单个实体</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查找并返回与 匹配的所有实体</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回与 匹配的实体数</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回匹配的实体是否</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存在。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用 Querydsl 支持，请扩展</font></font><code>QuerydslPredicateExecutor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的存储库界面，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 42. 存储库上的 Querydsl 集成</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt;, <span class="hljs-title">QuerydslPredicateExecutor</span>&lt;<span class="hljs-title">User</span>&gt; </span>{<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面的示例允许您使用 Querydsl</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">编写类型安全的查询</font><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Predicate predicate = user.firstname.equalsIgnoreCase(<span class="hljs-string">"dave"</span>)<font></font>
	.and(user.lastname.startsWithIgnoreCase(<span class="hljs-string">"mathews"</span>));<font></font>
<font></font>
userRepository.findAll(predicate);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="core.web"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8.2. </font><font style="vertical-align: inherit;">网络支持</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持存储库编程模型的 Spring Data 模块附带了各种 Web 支持。</font><font style="vertical-align: inherit;">Web 相关组件要求 Spring MVC JAR 位于类路径上。</font><font style="vertical-align: inherit;">其中一些甚至提供与</font></font><a href="https://github.com/spring-projects/spring-hateoas"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring HATEOAS 的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集成</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通常，通过使用</font></font><code>@EnableSpringDataWebSupport</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaConfig 配置类中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">来启用集成支持</font><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 43.启用 Spring Data Web 支持</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebMvc</span>
<span class="hljs-meta">@EnableSpringDataWebSupport</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfiguration</span> </span>{}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>@EnableSpringDataWebSupport</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">批注注册几个组件。</font><font style="vertical-align: inherit;">我们将在本节后面讨论这些。</font><font style="vertical-align: inherit;">它还检测类路径上的 Spring HATEOAS 并为其注册集成组件（如果存在）。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，如果您使用 XML 配置，请注册</font></font><code>SpringDataWebConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>HateoasAwareSpringDataWebConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为 Spring bean，如以下示例所示（对于</font></font><code>SpringDataWebConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 44. 在 XML 中启用 Spring Data Web 支持</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.data.web.config.SpringDataWebConfiguration"</span> /&gt;</span><font></font>
<font></font>
<span class="hljs-comment">&lt;!-- If you use Spring HATEOAS, register this one *instead* of the former --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.data.web.config.HateoasAwareSpringDataWebConfiguration"</span> /&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="core.web.basic"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.basic"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本网络支持</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一节中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示的配置</font><font style="vertical-align: inherit;">注册了一些基本组件：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.basic.domain-class-converter"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>DomainClassConverter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让 Spring MVC 从请求参数或路径变量解析存储库管理的域类的实例。</font></font></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.basic.paging-and-sorting"><code>HandlerMethodArgumentResolver</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让 Spring MVC</font><font style="vertical-align: inherit;">从请求参数</font><font style="vertical-align: inherit;">解析</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例的</font><font style="vertical-align: inherit;">实现</font><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.basic.jackson-mappers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jackson Modules</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于反/序列化</font></font><code>Point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和 等</font><font style="vertical-align: inherit;">类型</font></font><code>Distance</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或存储特定</font><font style="vertical-align: inherit;">类型</font><font style="vertical-align: inherit;">，具体取决于所使用的 Spring 数据模块。</font></font></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="core.web.basic.domain-class-converter"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.basic.domain-class-converter"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>DomainClassConverter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本</font></font><code>DomainClassConverter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类让你在Spring MVC中的控制器方法签名使用域类型直接使您不必手动通过资源库查找的情况下，如下例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 45. 在方法签名中使用域类型的 Spring MVC 控制器</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping("/users")</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@RequestMapping("/{id}")</span>
  <span class="hljs-function">String <span class="hljs-title">showUserForm</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable("id")</span> User user, Model model)</span> </span>{<font></font>
<font></font>
    model.addAttribute(<span class="hljs-string">"user"</span>, user);
    <span class="hljs-keyword">return</span> <span class="hljs-string">"userForm"</span>;<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该方法</font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接</font><font style="vertical-align: inherit;">接收一个</font><font style="vertical-align: inherit;">实例，不需要进一步查找。</font><font style="vertical-align: inherit;">可以通过让 Spring MVC</font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">先将</font><font style="vertical-align: inherit;">路径变量转换为</font><font style="vertical-align: inherit;">域类</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">类型，最终通过调用</font></font><code>findById(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为域类型注册的存储库实例来</font><font style="vertical-align: inherit;">访问</font><font style="vertical-align: inherit;">实例来解析</font><font style="vertical-align: inherit;">实例。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目前，存储库必须实现</font></font><code>CrudRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">才能被发现进行转换。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="core.web.basic.paging-and-sorting"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.basic.paging-and-sorting"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于可分页和排序的 HandlerMethodArgumentResolvers</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的配置片段中，在示出</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.basic.domain-class-converter"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前一节</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还注册一个</font></font><code>PageableHandlerMethodArgumentResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以及实例</font></font><code>SortHandlerMethodArgumentResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">注册启用</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为有效的控制器方法参数，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 46.使用 Pageable 作为控制器方法参数</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping("/users")</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserRepository repository;<font></font>
<font></font>
  UserController(UserRepository repository) {<font></font>
    <span class="hljs-keyword">this</span>.repository = repository;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@RequestMapping</span>
  <span class="hljs-function">String <span class="hljs-title">showUsers</span><span class="hljs-params">(Model model, Pageable pageable)</span> </span>{<font></font>
<font></font>
    model.addAttribute(<span class="hljs-string">"users"</span>, repository.findAll(pageable));
    <span class="hljs-keyword">return</span> <span class="hljs-string">"users"</span>;<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面的方法签名导致 Spring MVC 尝试</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以下默认配置从请求参数</font><font style="vertical-align: inherit;">派生</font><font style="vertical-align: inherit;">实例：</font></font></p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 1. 为</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">评估的请求参数</font></font></caption>
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>page</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您要检索的页面。</font><font style="vertical-align: inherit;">0 索引，默认为 0。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要检索的页面大小。</font><font style="vertical-align: inherit;">默认为 20。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应按格式排序的属性</font></font><code>property,property(,ASC|DESC)(,IgnoreCase)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认排序方向是区分大小写的升序。</font></font><code>sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果要切换方向或区分大小写，</font><font style="vertical-align: inherit;">请使用多个</font><font style="vertical-align: inherit;">参数 - 例如，</font></font><code>?sort=firstname&amp;sort=lastname,asc&amp;sort=city,ignorecase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要自定义此行为，请分别注册一个实现</font></font><code>PageableHandlerMethodArgumentResolverCustomizer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口或</font></font><code>SortHandlerMethodArgumentResolverCustomizer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font><font style="vertical-align: inherit;">的 bean </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它的</font></font><code>customize()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法被调用，让您更改设置，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Bean</span> <span class="hljs-function">SortHandlerMethodArgumentResolverCustomizer <span class="hljs-title">sortCustomizer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> s -&gt; s.setPropertyDelimiter(<span class="hljs-string">"&lt;--&gt;"</span>);<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果设置现有的属性</font></font><code>MethodArgumentResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不足以满足您的目的，请扩展</font></font><code>SpringDataWebConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或启用 HATEOAS 的等效项，覆盖</font></font><code>pageableResolver()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>sortResolver()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法，并导入您的自定义配置文件而不是使用</font></font><code>@Enable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您需要</font><font style="vertical-align: inherit;">从请求中解析</font><font style="vertical-align: inherit;">多个</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">多个</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例（例如，对于多个表），您可以使用 Spring 的</font></font><code>@Qualifier</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注解来区分一个和另一个。</font><font style="vertical-align: inherit;">请求参数必须以 为前缀</font></font><code>${qualifier}_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下示例显示了生成的方法签名：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">String <span class="hljs-title">showUsers</span><span class="hljs-params">(Model model,
      <span class="hljs-meta">@Qualifier("thing1")</span> Pageable first,
      <span class="hljs-meta">@Qualifier("thing2")</span> Pageable second)</span> </span>{ … }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您必须填充</font></font><code>thing1_page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>thing2_page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递给方法</font><font style="vertical-align: inherit;">的默认值</font><font style="vertical-align: inherit;">等效于 a </font></font><code>PageRequest.of(0, 20)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但您可以使用</font><font style="vertical-align: inherit;">参数</font></font><code>@PageableDefault</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上的注释</font><font style="vertical-align: inherit;">对其进行自定义</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="core.web.pageables"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.pageables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对可分页的超媒体支持</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring HATEOAS 附带了一个表示模型类 ( </font></font><code>PagedResources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)，它允许</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用必要的</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元数据和链接来</font><font style="vertical-align: inherit;">丰富</font><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">的内容，</font><font style="vertical-align: inherit;">让客户端轻松导航页面。</font><font style="vertical-align: inherit;">a</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到 a</font><font style="vertical-align: inherit;">的转换</font></font><code>PagedResources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是由 Spring HATEOAS</font></font><code>ResourceAssembler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font><font style="vertical-align: inherit;">的实现完成的</font><font style="vertical-align: inherit;">，称为</font></font><code>PagedResourcesAssembler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">以下示例显示了如何使用 a</font></font><code>PagedResourcesAssembler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为控制器方法参数：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 47.使用 PagedResourcesAssembler 作为控制器方法参数</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Controller</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonController</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Autowired</span> PersonRepository repository;<font></font>
<font></font>
  <span class="hljs-meta">@RequestMapping(value = "/persons", method = RequestMethod.GET)</span><font></font>
  HttpEntity&lt;PagedResources&lt;Person&gt;&gt; persons(Pageable pageable,<font></font>
    PagedResourcesAssembler assembler) {<font></font>
<font></font>
    Page&lt;Person&gt; persons = repository.findAll(pageable);<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseEntity&lt;&gt;(assembler.toResources(persons), HttpStatus.OK);<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用配置，如前面的示例所示，可以</font></font><code>PagedResourcesAssembler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将 用作控制器方法参数。</font><font style="vertical-align: inherit;">调用</font></font><code>toResources(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它有以下效果：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的内容</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成为</font></font><code>PagedResources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">的内容</font><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>PagedResources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font></font><code>PageMetadata</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附加</font><font style="vertical-align: inherit;">了一个</font><font style="vertical-align: inherit;">实例，并填充了来自</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和底层 的信息</font></font><code>PageRequest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><code>PagedResources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会</font></font><code>prev</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>next</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接链路，根据页面的状态。</font><font style="vertical-align: inherit;">链接指向方法映射到的 URI。</font><font style="vertical-align: inherit;">添加到该方法的分页参数与 的设置相匹配，</font></font><code>PageableHandlerMethodArgumentResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以确保稍后可以解析链接。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设我们</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在数据库中</font><font style="vertical-align: inherit;">有 30 个</font><font style="vertical-align: inherit;">实例。</font><font style="vertical-align: inherit;">您现在可以触发请求 ( </font><font style="vertical-align: inherit;">) 并看到类似于以下内容的输出：</font></font><code>GET <a href="http://localhost:8080/persons" class="bare">http://localhost:8080/persons</a></code><font style="vertical-align: inherit;"></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">{ <span class="hljs-string">"links"</span> : [ { <span class="hljs-string">"rel"</span> : <span class="hljs-string">"next"</span>,
                <span class="hljs-string">"href"</span> : <span class="hljs-string">"http://localhost:8080/persons?page=1&amp;size=20"</span> }<font></font>
  ],<font></font>
  <span class="hljs-string">"content"</span> : [<font></font>
     … <span class="hljs-comment">// 20 Person instances rendered here</span><font></font>
  ],<font></font>
  <span class="hljs-string">"pageMetadata"</span> : {
    <span class="hljs-string">"size"</span> : <span class="hljs-number">20</span>,
    <span class="hljs-string">"totalElements"</span> : <span class="hljs-number">30</span>,
    <span class="hljs-string">"totalPages"</span> : <span class="hljs-number">2</span>,
    <span class="hljs-string">"number"</span> : <span class="hljs-number">0</span><font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组装器生成了正确的 URI 并选择了默认配置，以将参数解析</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为即将到来的请求。</font><font style="vertical-align: inherit;">这意味着，如果您更改该配置，链接将自动遵守更改。</font><font style="vertical-align: inherit;">默认情况下，汇编器指向调用它的控制器方法，但您可以通过传递一个自定义</font></font><code>Link</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自</font><font style="vertical-align: inherit;">定义它，该自定义</font><font style="vertical-align: inherit;">用作构建分页链接的基础，这会重载该</font></font><code>PagedResourcesAssembler.toResource(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法。</font></font></p>
</div>
</div>
<div class="sect4">
<h5 id="core.web.basic.jackson-mappers"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.basic.jackson-mappers"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Jackson 模块</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心模块和一些特定于商店的模块附带一组 Jackson 模块</font><font style="vertical-align: inherit;">，用于 Spring Data 域使用的</font><font style="vertical-align: inherit;">类型，例如</font></font><code>org.springframework.data.geo.Distance</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>org.springframework.data.geo.Point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一旦</font><font style="vertical-align: inherit;">启用</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web 支持</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并可用，</font></font><code>com.fasterxml.jackson.databind.ObjectMapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就会</font><font style="vertical-align: inherit;">导入这些模块</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在初始化期间</font></font><code>SpringDataJacksonModules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，像 一样</font></font><code>SpringDataJacksonConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，被基础设施接收，以便声明的</font></font><code>com.fasterxml.jackson.databind.Module</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s 可供 Jackson 使用</font></font><code>ObjectMapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下域类型的数据绑定混合由公共基础结构注册。</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">org.springframework.data.geo.Distance</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
org.springframework.data.geo.Point</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
org.springframework.data.geo.Box</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
org.springframework.data.geo.Circle</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
org.springframework.data.geo.Polygon</font></font></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单个模块可能会提供额外的</font></font><code>SpringDataJacksonModules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有关更多详细信息，请参阅商店特定部分。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="core.web.binding"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.binding"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网页数据绑定支持</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用 Spring Data 投影（在</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#projections"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[projections] 中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font><font style="vertical-align: inherit;">）通过使用</font></font><a href="https://goessner.net/articles/JsonPath/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSONPath</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式（需要</font></font><a href="https://github.com/json-path/JsonPath"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jayway JsonPath</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a href="https://www.w3.org/TR/xpath-31/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XPath</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式（需要</font></font><a href="https://xmlbeam.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XmlBeam</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">来绑定传入的请求有效负载</font><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 48.使用 JSONPath 或 XPath 表达式的 HTTP 负载绑定</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@ProjectedPayload</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserPayload</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@XBRead("//firstname")</span>
  <span class="hljs-meta">@JsonPath("$..firstname")</span>
  <span class="hljs-function">String <span class="hljs-title">getFirstname</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
  <span class="hljs-meta">@XBRead("/lastname")</span>
  <span class="hljs-meta">@JsonPath({ "$.lastname", "$.user.lastname" })</span>
  <span class="hljs-function">String <span class="hljs-title">getLastname</span><span class="hljs-params">()</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用在前面的例子中为一个Spring MVC处理程序方法参数或通过使用所示类型</font></font><code>ParameterizedTypeReference</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上的方法之一</font></font><code>RestTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">前面的方法声明将尝试查找</font></font><code>firstname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给定文档中的任何位置。</font><font style="vertical-align: inherit;">该</font></font><code>lastname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML查询是对输入文档的顶层进行。</font><font style="vertical-align: inherit;">其 JSON 变体</font></font><code>lastname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先</font><font style="vertical-align: inherit;">尝试顶级，</font><font style="vertical-align: inherit;">但</font><font style="vertical-align: inherit;">如果前者不返回值，</font><font style="vertical-align: inherit;">也会尝试</font></font><code>lastname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嵌套在</font></font><code>user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子文档中。</font><font style="vertical-align: inherit;">这样，无需客户端调用公开的方法（通常是基于类的有效负载绑定的缺点）即可轻松缓解源文档结构的更改。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#projections"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[projections] 中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述，支持嵌套投影</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果该方法返回复杂的非接口类型，</font></font><code>ObjectMapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则使用</font><font style="vertical-align: inherit;">Jackson</font><font style="vertical-align: inherit;">来映射最终值。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于 Spring MVC，必要的转换器一旦</font></font><code>@EnableSpringDataWebSupport</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处于活动状态</font><font style="vertical-align: inherit;">就会自动注册，</font><font style="vertical-align: inherit;">并且所需的依赖项在类路径上可用。</font><font style="vertical-align: inherit;">对于使用</font></font><code>RestTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，注册</font></font><code>ProjectingJackson2HttpMessageConverter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON）或</font></font><code>XmlBeamHttpMessageConverter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关更多信息，请参阅</font><font style="vertical-align: inherit;">规范</font><a href="https://github.com/spring-projects/spring-data-examples"><font style="vertical-align: inherit;">Spring 数据示例存储库中</font></a><font style="vertical-align: inherit;">的</font></font><a href="https://github.com/spring-projects/spring-data-examples/tree/master/web/projection"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web 投影示例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><a href="https://github.com/spring-projects/spring-data-examples"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</div>
</div>
<div class="sect4">
<h5 id="core.web.type-safe"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.web.type-safe"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Querydsl 网络支持</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于那些具有</font></font><a href="http://www.querydsl.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QueryDSL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集成的</font><font style="vertical-align: inherit;">商店</font><font style="vertical-align: inherit;">，您可以从</font></font><code>Request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询字符串中</font><font style="vertical-align: inherit;">包含的属性派生查询</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑以下查询字符串：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs plaintext">?firstname=Dave&amp;lastname=Matthews</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给定</font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面示例中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">对象，您可以使用 将查询字符串解析为以下值</font></font><code>QuerydslPredicateArgumentResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs plaintext">QUser.user.firstname.eq("Dave").and(QUser.user.lastname.eq("Matthews"))</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"></font><code>@EnableSpringDataWebSupport</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当在类路径上找到 Querydsl 时</font><font style="vertical-align: inherit;">
，会自动启用该功能以及</font><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将 a 添加</font></font><code>@QuerydslPredicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到方法签名提供了一个随时可用的</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以使用</font></font><code>QuerydslPredicateExecutor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="提示"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
类型信息通常从方法的返回类型解析。</font><font style="vertical-align: inherit;">由于该信息不一定与域类型匹配，因此使用 的</font></font><code>root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">可能是一个好主意</font></font><code>QuerydslPredicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了如何</font></font><code>@QuerydslPredicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在方法签名中使用：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Controller</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Autowired</span> UserRepository repository;<font></font>
<font></font>
  <span class="hljs-meta">@RequestMapping(value = "/", method = RequestMethod.GET)</span>
  <span class="hljs-function">String <span class="hljs-title">index</span><span class="hljs-params">(Model model, <span class="hljs-meta">@QuerydslPredicate(root = User.class)</span> Predicate predicate,    </span></span><i class="conum" data-value="1"></i><b><span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">1</span>)</span></span></b><span class="hljs-function">
          Pageable pageable, @RequestParam MultiValueMap&lt;String, String&gt; parameters) </span>{<font></font>
<font></font>
    model.addAttribute(<span class="hljs-string">"users"</span>, repository.findAll(predicate, pageable));<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"index"</span>;<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将查询字符串参数解析为匹配</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认绑定如下：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在简单的属性上</font></font><code>eq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在像属性一样的集合上</font></font><code>contains</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><code>Collection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在简单的属性上</font></font><code>in</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以通过</font><font style="vertical-align: inherit;">Java 8</font><font style="vertical-align: inherit;">的</font></font><code>bindings</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font><code>@QuerydslPredicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或通过使用 Java 8</font></font><code>default methods</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并将</font></font><code>QuerydslBinderCustomizer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">添加</font><font style="vertical-align: inherit;">到存储库接口来自</font><font style="vertical-align: inherit;">定义这些绑定</font><font style="vertical-align: inherit;">，如下所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">String</span>&gt;,
                                 <span class="hljs-title">QuerydslPredicateExecutor</span>&lt;<span class="hljs-title">User</span>&gt;,                </span><i class="conum" data-value="1"></i><b><span class="hljs-class">(1)</span></b><span class="hljs-class">
                                 <span class="hljs-title">QuerydslBinderCustomizer</span>&lt;<span class="hljs-title">QUser</span>&gt; </span>{               <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title">customize</span><span class="hljs-params">(QuerydslBindings bindings, QUser user)</span> </span>{<font></font>
<font></font>
    bindings.bind(user.username).first((path, value) -&gt; path.contains(value))    <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b><font></font>
    bindings.bind(String.class)<font></font>
      .first((StringPath path, String value) -&gt; path.containsIgnoreCase(value)); <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b>
    bindings.excluding(user.password);                                           <i class="conum" data-value="5"></i><b>(<span class="hljs-number">5</span>)</b><font></font>
  }<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><code>QuerydslPredicateExecutor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供对特定 finder 方法的访问</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><code>QuerydslBinderCustomizer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库界面上定义的自动拾取和快捷方式</font></font><code>@QuerydslPredicate(bindings=…​)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><code>username</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">的绑定定义为</font><font style="vertical-align: inherit;">简单</font></font><code>contains</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绑定。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><code>String</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">的默认绑定定义为</font><font style="vertical-align: inherit;">不区分大小写的</font></font><code>contains</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></b></td>
<td><font style="vertical-align: inherit;"></font><code>password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><code>Predicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析中</font><font style="vertical-align: inherit;">排除该</font><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="提示"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
你可以注册一个</font></font><code>QuerydslBinderCustomizerDefaults</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从资源库或应用特定的绑定之前豆保持默认Querydsl绑定</font></font><code>@QuerydslPredicate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="core.repository-populators"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#core.repository-populators"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8.3. </font><font style="vertical-align: inherit;">存储库填充器</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您使用 Spring JDBC 模块，您可能熟悉</font></font><code>DataSource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 SQL 脚本</font><font style="vertical-align: inherit;">填充 a 的支持</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">类似的抽象在存储库级别可用，尽管它不使用 SQL 作为数据定义语言，因为它必须与存储无关。</font><font style="vertical-align: inherit;">因此，填充器支持 XML（通过 Spring 的 OXM 抽象）和 JSON（通过 Jackson）来定义用于填充存储库的数据。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设您有一个包含</font></font><code>data.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下内容</font><font style="vertical-align: inherit;">的文件</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 49. JSON 中定义的数据</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">[ { <span class="hljs-string">"_class"</span> : <span class="hljs-string">"com.acme.Person"</span>,
 <span class="hljs-string">"firstname"</span> : <span class="hljs-string">"Dave"</span>,
  <span class="hljs-string">"lastname"</span> : <span class="hljs-string">"Matthews"</span> },<font></font>
  { <span class="hljs-string">"_class"</span> : <span class="hljs-string">"com.acme.Person"</span>,
 <span class="hljs-string">"firstname"</span> : <span class="hljs-string">"Carter"</span>,
  <span class="hljs-string">"lastname"</span> : <span class="hljs-string">"Beauford"</span> } ]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用 Spring Data Commons 中提供的存储库命名空间的 populator 元素来填充存储库。</font><font style="vertical-align: inherit;">要将前面的数据填充到您的</font></font><code>PersonRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请声明一个类似于以下内容的</font><font style="vertical-align: inherit;">填充器</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 50. 声明 Jackson 存储库填充器</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hljs-attr">xmlns:repository</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/repository"</span>
  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/repository
    https://www.springframework.org/schema/data/repository/spring-repository.xsd"</span>&gt;</span><font></font>
<font></font>
  <span class="hljs-tag">&lt;<span class="hljs-name">repository:jackson2-populator</span> <span class="hljs-attr">locations</span>=<span class="hljs-string">"classpath:data.json"</span> /&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面的声明导致</font></font><code>data.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件被 Jackson 读取和反序列化</font></font><code>ObjectMapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON 对象解组的类型是通过检查</font></font><code>_class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON 文档</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">来确定的</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">基础架构最终会选择合适的存储库来处理反序列化的对象。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要改为使用 XML 定义应填充存储库的数据，您可以使用该</font></font><code>unmarshaller-populator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素。</font><font style="vertical-align: inherit;">您将其配置为使用 Spring OXM 中可用的 XML marshaller 选项之一。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息，</font><font style="vertical-align: inherit;">请参阅</font></font><a href="https://docs.spring.io/spring-framework/docs/5.3.9/reference/html/data-access.html#oxm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring 参考文档</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下示例显示如何使用 JAXB 解组存储库填充器：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 51. 声明解组存储库填充器（使用 JAXB）</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hljs-attr">xmlns:repository</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/repository"</span>
  <span class="hljs-attr">xmlns:oxm</span>=<span class="hljs-string">"http://www.springframework.org/schema/oxm"</span>
  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/repository
    https://www.springframework.org/schema/data/repository/spring-repository.xsd
    http://www.springframework.org/schema/oxm
    https://www.springframework.org/schema/oxm/spring-oxm.xsd"</span>&gt;</span><font></font>
<font></font>
  <span class="hljs-tag">&lt;<span class="hljs-name">repository:unmarshaller-populator</span> <span class="hljs-attr">locations</span>=<span class="hljs-string">"classpath:data.json"</span>
    <span class="hljs-attr">unmarshaller-ref</span>=<span class="hljs-string">"unmarshaller"</span> /&gt;</span><font></font>
<font></font>
  <span class="hljs-tag">&lt;<span class="hljs-name">oxm:jaxb2-marshaller</span> <span class="hljs-attr">contextPath</span>=<span class="hljs-string">"com.acme"</span> /&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="reference" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#reference"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文档</font></font></h1>
<div class="sect1">
<h2 id="elasticsearch.clients"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Elasticsearch 客户端</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本章说明了支持的 Elasticsearch 客户端实现的配置和使用。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Elasticsearch 在连接到单个 Elasticsearch 节点或集群的 Elasticsearch 客户端上运行。</font><font style="vertical-align: inherit;">尽管 Elasticsearch Client 可用于与集群一起工作，但使用 Spring Data Elasticsearch 的应用程序通常使用</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch Operations</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.repositories"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch Repositories</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的更高级别的抽象</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect2">
<h3 id="elasticsearch.clients.transport"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.transport"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1. </font><font style="vertical-align: inherit;">运输客户端</font></font></h3>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将</font></font><code>TransportClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被弃用Elasticsearch 7的，并会在Elasticsearch 8被移除（</font></font><a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api/current/transport-client.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">见Elasticsearch文档</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><code>TransportClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只要在使用的 Elasticsearch</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.versions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用，</font><font style="vertical-align: inherit;">Spring Data Elasticsearch 就会支持</font><font style="vertical-align: inherit;">它，</font><font style="vertical-align: inherit;">但自 4.0 版以来已弃用使用它的类。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们强烈建议使用</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.rest"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高级 REST 客户端</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是</font></font><code>TransportClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 52. 传输客户端</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TransportClientConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ElasticsearchConfigurationSupport</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Client <span class="hljs-title">elasticsearchClient</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> UnknownHostException </span>{<font></font>
        Settings settings = Settings.builder().put(<span class="hljs-string">"cluster.name"</span>, <span class="hljs-string">"elasticsearch"</span>).build();        <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
        TransportClient client = <span class="hljs-keyword">new</span> PreBuiltTransportClient(settings);<font></font>
        client.addTransportAddress(<span class="hljs-keyword">new</span> TransportAddress(InetAddress.getByName(<span class="hljs-string">"127.0.0.1"</span>), <span class="hljs-number">9300</span>)); <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
        <span class="hljs-keyword">return</span> client;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean(name = { "elasticsearchOperations", "elasticsearchTemplate" })</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ElasticsearchTemplate <span class="hljs-title">elasticsearchTemplate</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> UnknownHostException </span>{<font></font>
<font></font>
		ElasticsearchTemplate template = <span class="hljs-keyword">new</span> ElasticsearchTemplate(elasticsearchClient, elasticsearchConverter);<font></font>
		template.setRefreshPolicy(refreshPolicy());                                                 <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b><font></font>
<font></font>
		<span class="hljs-keyword">return</span> template;<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// ...</span><font></font>
<font></font>
IndexRequest request = <span class="hljs-keyword">new</span> IndexRequest(<span class="hljs-string">"spring-data"</span>)<font></font>
 .id(randomID())<font></font>
 .source(someObject);<font></font>
<font></font>
IndexResponse response = client.index(request);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>TransportClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须与群集名称进行配置。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将客户端连接到的主机和端口。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RefreshPolicy 必须设置在</font></font><code>ElasticsearchTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（覆盖</font></font><code>refreshPolicy()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不使用默认值）</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.clients.rest"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.rest"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2. </font><font style="vertical-align: inherit;">高级 REST 客户端</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java 高级 REST 客户端是 Elasticsearch 的默认客户端，它提供了一个直接的替代方案，</font></font><code>TransportClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为它接受并返回完全相同的请求/响应对象，因此依赖于 Elasticsearch 核心项目。</font><font style="vertical-align: inherit;">异步调用在客户端管理的线程池上进行操作，并且需要在请求完成时通知回调。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 53. 高级 REST 客户端</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RestClientConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractElasticsearchConfiguration</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RestHighLevelClient <span class="hljs-title">elasticsearchClient</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
        <span class="hljs-keyword">final</span> ClientConfiguration clientConfiguration = ClientConfiguration.builder()  <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
            .connectedTo(<span class="hljs-string">"localhost:9200"</span>)<font></font>
            .build();<font></font>
<font></font>
        <span class="hljs-keyword">return</span> RestClients.create(clientConfiguration).rest();                         <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// ...</span><font></font>
<font></font>
  <span class="hljs-meta">@Autowired</span><font></font>
  RestHighLevelClient highLevelClient;<font></font>
<font></font>
  RestClient lowLevelClient = highLevelClient.lowLevelClient();                        <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b><font></font>
<font></font>
<span class="hljs-comment">// ...</span><font></font>
<font></font>
IndexRequest request = <span class="hljs-keyword">new</span> IndexRequest(<span class="hljs-string">"spring-data"</span>)<font></font>
  .id(randomID())<font></font>
  .source(singletonMap(<span class="hljs-string">"feature"</span>, <span class="hljs-string">"high-level-rest-client"</span>))<font></font>
  .setRefreshPolicy(IMMEDIATE);<font></font>
<font></font>
IndexResponse response = highLevelClient.index(request,RequestOptions.DEFAULT);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用构建器提供集群地址、设置默认值</font></font><code>HttpHeaders</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或启用 SSL。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建 RestHighLevelClient。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以获取</font></font><code>lowLevelRest()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.clients.reactive"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.reactive"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3. </font><font style="vertical-align: inherit;">反应式客户端</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>ReactiveElasticsearchClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是基于非官方驱动</font></font><code>WebClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它使用 Elasticsearch 核心项目提供的请求/响应对象。</font><font style="vertical-align: inherit;">调用直接在反应式堆栈上操作，</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将异步（线程池绑定）响应包装到反应式类型中。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 54. 反应式 REST 客户端</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReactiveRestClientConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractReactiveElasticsearchConfiguration</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ReactiveElasticsearchClient <span class="hljs-title">reactiveElasticsearchClient</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">final</span> ClientConfiguration clientConfiguration = ClientConfiguration.builder() <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
            .connectedTo(<span class="hljs-string">"localhost:9200"</span>) <span class="hljs-comment">//</span><font></font>
            .build();<font></font>
        <span class="hljs-keyword">return</span> ReactiveRestClients.create(clientConfiguration);<font></font>
<font></font>
    }<font></font>
}<font></font>
<span class="hljs-comment">// ...</span><font></font>
<font></font>
Mono&lt;IndexResponse&gt; response = client.index(request -&gt;<font></font>
<font></font>
  request.index(<span class="hljs-string">"spring-data"</span>)<font></font>
    .id(randomID())<font></font>
    .source(singletonMap(<span class="hljs-string">"feature"</span>, <span class="hljs-string">"reactive-client"</span>));<font></font>
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用构建器提供集群地址、设置默认值</font></font><code>HttpHeaders</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或启用 SSL。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ReactiveClient 响应，特别是对于搜索操作，绑定到请求的</font></font><code>from</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(offset) &amp; </font></font><code>size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(limit) 选项。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.clients.configuration"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4. </font><font style="vertical-align: inherit;">客户端配置</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过</font></font><code>ClientConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许设置 SSL、连接和套接字超时、标头和其他参数的选项</font><font style="vertical-align: inherit;">来更改客户端行为</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 55. 客户端配置</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">HttpHeaders httpHeaders = <span class="hljs-keyword">new</span> HttpHeaders();<font></font>
httpHeaders.add(<span class="hljs-string">"some-header"</span>, <span class="hljs-string">"on every request"</span>)                      <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
<font></font>
ClientConfiguration clientConfiguration = ClientConfiguration.builder()<font></font>
  .connectedTo(<span class="hljs-string">"localhost:9200"</span>, <span class="hljs-string">"localhost:9291"</span>)                      <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
  .usingSsl()                                                           <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
  .withProxy(<span class="hljs-string">"localhost:8888"</span>)                                          <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b>
  .withPathPrefix(<span class="hljs-string">"ela"</span>)                                                <i class="conum" data-value="5"></i><b>(<span class="hljs-number">5</span>)</b>
  .withConnectTimeout(Duration.ofSeconds(<span class="hljs-number">5</span>))                            <i class="conum" data-value="6"></i><b>(<span class="hljs-number">6</span>)</b>
  .withSocketTimeout(Duration.ofSeconds(<span class="hljs-number">3</span>))                             <i class="conum" data-value="7"></i><b>(<span class="hljs-number">7</span>)</b>
  .withDefaultHeaders(defaultHeaders)                                   <i class="conum" data-value="8"></i><b>(<span class="hljs-number">8</span>)</b>
  .withBasicAuth(username, password)                                    <i class="conum" data-value="9"></i><b>(<span class="hljs-number">9</span>)</b>
  .withHeaders(() -&gt; {                                                  <i class="conum" data-value="10"></i><b>(<span class="hljs-number">10</span>)</b>
    HttpHeaders headers = <span class="hljs-keyword">new</span> HttpHeaders();<font></font>
    headers.add(<span class="hljs-string">"currentTime"</span>, LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME));
    <span class="hljs-keyword">return</span> headers;<font></font>
  })<font></font>
  .withWebClientConfigurer(webClient -&gt; {                               <i class="conum" data-value="11"></i><b>(<span class="hljs-number">11</span>)</b>
    <span class="hljs-comment">//...</span>
    <span class="hljs-keyword">return</span> webClient;<font></font>
  })<font></font>
  .withHttpClientConfigurer(clientBuilder -&gt; {                          <i class="conum" data-value="12"></i><b>(<span class="hljs-number">12</span>)</b>
      <span class="hljs-comment">//...</span>
      <span class="hljs-keyword">return</span> clientBuilder;<font></font>
  })<font></font>
  . <span class="hljs-comment">// ... other options</span>
  .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义默认标题，如果需要自定义</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用构建器提供集群地址、设置默认值</font></font><code>HttpHeaders</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或启用 SSL。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（可选）启用 SSL。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（可选）设置代理。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可选地设置路径前缀，主要用于在某个反向代理后面的不同集群时。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置连接超时。</font><font style="vertical-align: inherit;">默认值为 10 秒。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置套接字超时。</font><font style="vertical-align: inherit;">默认为 5 秒。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可选地设置标题。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加基本​​身份验证。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></b></td>
<td><font style="vertical-align: inherit;"></font><code>Supplier&lt;Header&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以指定</font><font style="vertical-align: inherit;">一个</font><font style="vertical-align: inherit;">函数，每次在将请求发送到 Elasticsearch 之前都会调用</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">函数 - 例如，当前时间写入标头中。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于反应式设置的功能配置 </font></font><code>WebClient</code></td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于非反应式设置，配置 REST 客户端的功能</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要的"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
添加如上例所示的 Header 供应商允许注入可能随时间变化的标头，例如身份验证 JWT 令牌。</font><font style="vertical-align: inherit;">如果在反应式设置中使用它，则供应商功能</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不得</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阻塞！
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.clients.logging"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.logging"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.5. </font><font style="vertical-align: inherit;">客户端日志</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要查看实际发送到服务器和从服务器接收的内容</font></font><code>Request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font><code>Response</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传输级别的日志记录需要打开，如下面的代码段所述。</font></font></p>
</div>
<div class="listingblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用传输层日志记录</font></font></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"org.springframework.data.elasticsearch.client.WIRE"</span> <span class="hljs-attr">level</span>=<span class="hljs-string">"trace"</span>/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以上分别适用于</font></font><code>RestHighLevelClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>ReactiveElasticsearchClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当通过</font></font><code>RestClients</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别</font><font style="vertical-align: inherit;">获得时</font></font><code>ReactiveRestClients</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，不适用于</font></font><code>TransportClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="elasticsearch.mapping"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Elasticsearch 对象映射</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Elasticsearch 对象映射是将 Java 对象（域实体）映射到存储在 Elasticsearch 中并返回的 JSON 表示的过程。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Elasticsearch 的早期版本使用基于 Jackson 的转换，Spring Data Elasticsearch 3.2.x 引入了</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meta Model Object Mapping</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从 4.0 版开始，仅使用元对象映射，基于 Jackson 的映射器不再可用，</font></font><code>MappingElasticsearchConverter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而是使用了。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移除基于 Jackson 的映射器的主要原因是：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段的自定义映射需要使用</font></font><code>@JsonFormat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或 之类的</font><font style="vertical-align: inherit;">注释来完成</font></font><code>@JsonInclude</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当在不同的基于 JSON 的数据存储中使用相同的对象或通过基于 JSON 的 API 发送时，这通常会导致问题。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自定义字段类型和格式也需要存储到 Elasticsearch 索引映射中。</font><font style="vertical-align: inherit;">基于 Jackson 的注释没有完全提供表示 Elasticsearch 类型所需的所有信息。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段不仅在从实体转换到实体时都必须映射，而且在查询参数、返回数据和其他地方也必须映射。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>MappingElasticsearchConverter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">now 涵盖了所有这些情况。</font></font></p>
</div>
<div class="sect2">
<h3 id="elasticsearch.mapping.meta-model"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1. </font><font style="vertical-align: inherit;">元模型对象映射</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于元模型的方法使用域类型信息从/向 Elasticsearch 读取/写入。</font><font style="vertical-align: inherit;">这允许</font></font><code>Converter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为特定域类型映射</font><font style="vertical-align: inherit;">注册</font><font style="vertical-align: inherit;">实例。</font></font></p>
</div>
<div class="sect3">
<h4 id="elasticsearch.mapping.meta-model.annotations"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model.annotations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.1. </font><font style="vertical-align: inherit;">映射注释概述</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>MappingElasticsearchConverter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用元数据驱动的对象的映射文件。</font><font style="vertical-align: inherit;">元数据取自可以注释的实体属性。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下注释可用：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 应用于类级别，表示该类是映射到数据库的候选。</font><font style="vertical-align: inherit;">最重要的属性是：</font></font></p>
<div class="ulist">
<ul>
<li>
<p><code>indexName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：存储该实体的索引名称。这可以包含一个 SpEL 模板表达式，如 </font></font><code>"log-#{T(java.time.LocalDate).now().toString()}"</code></p>
</li>
<li>
<p><code>type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><span class="line-through"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射类型。</font><font style="vertical-align: inherit;">如果未设置，则使用类的小写简单名称。</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（自 4.0 版起已弃用）</font></font></p>
</li>
<li>
<p><code>createIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 标记是否在存储库引导时创建索引。</font><font style="vertical-align: inherit;">默认值为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.repositories.autocreation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用相应映射自动创建索引</font></font></a></p>
</li>
<li>
<p><code>versionType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 版本管理的配置。</font><font style="vertical-align: inherit;">默认值为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXTERNAL</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>@Id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：应用于字段级别以标记用于标识目的的字段。</font></font></p>
</li>
<li>
<p><code>@Transient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 默认情况下，所有字段在存储或检索时都映射到文档，此注释不包括该字段。</font></font></p>
</li>
<li>
<p><code>@PersistenceConstructor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 标记给定的构造函数 - 即使是受包保护的构造函数 - 在从数据库实例化对象时使用。</font><font style="vertical-align: inherit;">构造函数参数按名称映射到检索到的文档中的键值。</font></font></p>
</li>
<li>
<p><code>@Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：应用于字段级别，定义字段的属性，大部分属性映射到各自的</font></font><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch Mapping</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义（以下列表不完整，完整参考Javadoc注解）：</font></font></p>
<div class="ulist">
<ul>
<li>
<p><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 字段名称，因为它将在 Elasticsearch 文档中表示，如果未设置，则使用 Java 字段名称。</font></font></p>
</li>
<li>
<p><code>type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：字段类型，可以是</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Text、Keyword、Long、Integer、Short、Byte、Double、Float、Half_Float、Scaled_Float、Date、Date_Nanos、Boolean、Binary、Integer_Range、Float_Range、Long_Range、Double_Range、Date_Range、Ip_Range、Object之一, 嵌套, Ip, TokenCount, Percolator, Flattened, Search_As_You_Type</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">查看</font></font><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch 映射类型</font></font></a></p>
</li>
<li>
<p><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：一种或多种内置日期格式，请参阅下一节</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model.date-formats"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期格式映射</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><code>pattern</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：一种或多种自定义日期格式，请参阅下一节</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model.date-formats"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期格式映射</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><code>store</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 标志是否应将原始字段值存储在 Elasticsearch 中，默认值为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><code>analyzer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>searchAnalyzer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>normalizer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于指定自定义分析器和规范器。</font></font></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>@GeoPoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 将字段标记为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geo_point</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据类型。</font><font style="vertical-align: inherit;">如果字段是</font></font><code>GeoPoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">的实例，则可以省略</font><font style="vertical-align: inherit;">。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射元数据基础设施在一个独立的 spring-data-commons 项目中定义，该项目与技术无关。</font></font></p>
</div>
<div class="sect4">
<h5 id="elasticsearch.mapping.meta-model.date-formats"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model.date-formats"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期格式映射</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">派生自</font></font><code>TemporalAccessor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或属于类型的</font><font style="vertical-align: inherit;">属性</font></font><code>java.util.Date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须具有</font></font><code>@Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型注释，</font></font><code>FieldType.Date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者必须为此类型注册自定义转换器。</font><font style="vertical-align: inherit;">本段描述了
</font></font><code>FieldType.Date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>@Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释的</font><font style="vertical-align: inherit;">两个属性</font><font style="vertical-align: inherit;">定义了将哪种日期格式信息写入映射（另请参阅</font></font><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-date-format.html#built-in-date-formats"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch 内置格式</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-date-format.html#custom-date-formats"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch 自定义日期格式</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性是用来定义预定义的格式中的至少之一。</font><font style="vertical-align: inherit;">如果未定义，则使用默认值</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_date_optional_time</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">epoch_millis</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>pattern</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性可用于添加其他自定义格式字符串。</font><font style="vertical-align: inherit;">如果只想使用自定义日期格式，则必须将该</font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为 empty </font></font><code>{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下表显示了不同的属性以及从它们的值创建的映射：</font></font></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注解</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch 映射中的格式字符串</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Field(type=FieldType.Date)</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"date_optional_time||epoch_millis",</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Field(type=FieldType.Date, format=DateFormat.basic_date)</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“基本日期”</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Field(type=FieldType.Date, format={DateFormat.basic_date, DateFormat.basic_time})</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“基本日期||基本时间”</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Field(type=FieldType.Date, pattern="dd.MM.uuuu")</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"date_optional_time||epoch_millis||dd.MM.uuuu",</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Field(type=FieldType.Date, format={}, pattern="dd.MM.uuuu")</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“dd.MM.uuuu”</font></font></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您使用自定义日期格式，则需要对</font><font style="vertical-align: inherit;">年份</font><font style="vertical-align: inherit;">使用</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uuuu</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yyyy</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是由于</font></font><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/migrate-to-java-time.html#java-time-migration-incompatible-date-formats"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch 7 中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/migrate-to-java-time.html#java-time-migration-incompatible-date-formats"><font style="vertical-align: inherit;">更改</font></a><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射的字段名称</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无需进一步配置，Spring Data Elasticsearch 将使用对象的属性名称作为 Elasticsearch 中的字段名称。</font><font style="vertical-align: inherit;">这可以通过使用该</font></font><code>@Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性上</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">来更改单个字段</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以</font></font><code>FieldNamingStrategy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在客户端（</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch Clients</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的配置中</font><font style="vertical-align: inherit;">定义一个</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如</font></font><code>SnakeCaseFieldNamingStrategy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">如果</font><font style="vertical-align: inherit;">配置了</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则对象</font><font style="vertical-align: inherit;">的属性</font><em><font style="vertical-align: inherit;">sampleProperty</font></em><font style="vertical-align: inherit;">将映射到</font><font style="vertical-align: inherit;">Elasticsearch 中的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sample_property</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">A</font></font><code>FieldNamingStrategy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于所有实体；</font><font style="vertical-align: inherit;">它可以通过</font></font><code>@Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在属性上</font><font style="vertical-align: inherit;">设置特定名称来覆盖</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="elasticsearch.mapping.meta-model.rules"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model.rules"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2. </font><font style="vertical-align: inherit;">映射规则</font></font></h4>
<div class="sect4">
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型提示</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射使用</font><font style="vertical-align: inherit;">嵌入在发送到服务器的文档中的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型提示</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来允许通用类型映射。</font><font style="vertical-align: inherit;">这些类型提示</font></font><code>_class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在文档</font><font style="vertical-align: inherit;">中表示为</font><font style="vertical-align: inherit;">属性，并为每个聚合根编写。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 56. 类型提示</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{              <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
<font></font>
  <span class="hljs-meta">@Id</span> String id;<font></font>
  String firstname;<font></font>
  String lastname;<font></font>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  <span class="hljs-attr">"_class"</span> : <span class="hljs-string">"com.example.Person"</span>, <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="hljs-attr">"id"</span> : <span class="hljs-string">"cb7bef"</span>,
  <span class="hljs-attr">"firstname"</span> : <span class="hljs-string">"Sarah"</span>,
  <span class="hljs-attr">"lastname"</span> : <span class="hljs-string">"Connor"</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，域类型类名用于类型提示。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以配置类型提示以保存自定义信息。</font><font style="vertical-align: inherit;">使用</font></font><code>@TypeAlias</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释来做到这一点。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
确保</font></font><code>@TypeAlias</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在初始实体集 ( </font></font><code>AbstractElasticsearchConfiguration#getInitialEntitySet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) 中</font><font style="vertical-align: inherit;">添加类型，</font><font style="vertical-align: inherit;">以便在首次</font><font style="vertical-align: inherit;">从存储中读取数据时已有可用的实体信息。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 57. 带别名的类型提示</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@TypeAlias("human")</span>                <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Id</span> String id;
  <span class="hljs-comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  <span class="hljs-attr">"_class"</span> : <span class="hljs-string">"human"</span>,              <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="hljs-attr">"id"</span> : ...<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写入实体时使用配置的别名。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
除非属性类型为</font></font><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、接口或实际值类型与属性声明不匹配，</font><font style="vertical-align: inherit;">否则不会为嵌套对象编写类型提示</font><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地理空间类型</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">像</font></font><code>Point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&amp;</font><font style="vertical-align: inherit;">这样的地理空间类型</font></font><code>GeoPoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被转换成</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纬度/经度</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 58.地理空间类型</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span> </span>{<font></font>
<font></font>
  String city, street;<font></font>
  Point location;<font></font>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  <span class="hljs-attr">"city"</span> : <span class="hljs-string">"Los Angeles"</span>,
  <span class="hljs-attr">"street"</span> : <span class="hljs-string">"2800 East Observatory Road"</span>,
  <span class="hljs-attr">"location"</span> : { <span class="hljs-attr">"lat"</span> : <span class="hljs-number">34.118347</span>, <span class="hljs-attr">"lon"</span> : <span class="hljs-number">-118.3026284</span> }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GeoJson 类型</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Elasticsearch 通过为</font></font><code>GeoJson</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同的几何图形</font><font style="vertical-align: inherit;">提供接口</font><font style="vertical-align: inherit;">和实现来</font><font style="vertical-align: inherit;">支持 GeoJson 类型</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它们根据 GeoJson 规范映射到 Elasticsearch 文档。</font><font style="vertical-align: inherit;">实体的相应属性在索引映射中指定，</font></font><code>geo_shape</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当索引映射被写入时。</font><font style="vertical-align: inherit;">（也请查看</font></font><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/geo-shape.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch 文档</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 59. GeoJson 类型</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span> </span>{<font></font>
<font></font>
  String city, street;<font></font>
  GeoJsonPoint location;<font></font>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  <span class="hljs-attr">"city"</span>: <span class="hljs-string">"Los Angeles"</span>,
  <span class="hljs-attr">"street"</span>: <span class="hljs-string">"2800 East Observatory Road"</span>,
  <span class="hljs-attr">"location"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Point"</span>,
    <span class="hljs-attr">"coordinates"</span>: [<span class="hljs-number">-118.3026284</span>, <span class="hljs-number">34.118347</span>]<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现了以下 GeoJson 类型：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GeoJsonPoint</code></p>
</li>
<li>
<p><code>GeoJsonMultiPoint</code></p>
</li>
<li>
<p><code>GeoJsonLineString</code></p>
</li>
<li>
<p><code>GeoJsonMultiLineString</code></p>
</li>
<li>
<p><code>GeoJsonPolygon</code></p>
</li>
<li>
<p><code>GeoJsonMultiPolygon</code></p>
</li>
<li>
<p><code>GeoJsonGeometryCollection</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收藏</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型提示</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model.conversions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自定义转换</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，集合中的值应用与聚合根相同的映射规则</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 60. 集合</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{<font></font>
<font></font>
  <span class="hljs-comment">// ...</span><font></font>
<font></font>
  List&lt;Person&gt; friends;<font></font>
<font></font>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  <span class="hljs-comment">// ...</span><font></font>
<font></font>
  <span class="hljs-attr">"friends"</span> : [ { <span class="hljs-attr">"firstname"</span> : <span class="hljs-string">"Kyle"</span>, <span class="hljs-attr">"lastname"</span> : <span class="hljs-string">"Reese"</span> } ]<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地图</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当涉及到</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型提示</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model.conversions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自定义转换</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，对于 Maps 中的值应用与聚合根相同的映射规则</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是 Map 键需要一个字符串才能被 Elasticsearch 处理。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 61. 集合</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{<font></font>
<font></font>
  <span class="hljs-comment">// ...</span><font></font>
<font></font>
  Map&lt;String, Address&gt; knownLocations;<font></font>
<font></font>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  <span class="hljs-comment">// ...</span><font></font>
<font></font>
  <span class="hljs-attr">"knownLocations"</span> : {
    <span class="hljs-attr">"arrivedAt"</span> : {
       <span class="hljs-attr">"city"</span> : <span class="hljs-string">"Los Angeles"</span>,
       <span class="hljs-attr">"street"</span> : <span class="hljs-string">"2800 East Observatory Road"</span>,
       <span class="hljs-attr">"location"</span> : { <span class="hljs-attr">"lat"</span> : <span class="hljs-number">34.118347</span>, <span class="hljs-attr">"lon"</span> : <span class="hljs-number">-118.3026284</span> }<font></font>
     }<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="elasticsearch.mapping.meta-model.conversions"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model.conversions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.3. </font><font style="vertical-align: inherit;">自定义转化</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">望着</font></font><code>Configuration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一节</font></font></a> <code>ElasticsearchCustomConversions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许注册映射域和简单类型的具体规则。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 62.元模型对象映射配置</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractElasticsearchConfiguration</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> RestHighLevelClient <span class="hljs-title">elasticsearchClient</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> RestClients.create(ClientConfiguration.create(<span class="hljs-string">"localhost:9200"</span>)).rest();<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@Bean</span>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> ElasticsearchCustomConversions <span class="hljs-title">elasticsearchCustomConversions</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ElasticsearchCustomConversions(<font></font>
      Arrays.asList(<span class="hljs-keyword">new</span> AddressToMap(), <span class="hljs-keyword">new</span> MapToAddress()));       <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@WritingConverter</span>                                                 <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
  <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AddressToMap</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Converter</span>&lt;<span class="hljs-title">Address</span>, <span class="hljs-title">Map</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">Object</span>&gt;&gt; </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">convert</span><span class="hljs-params">(Address source)</span> </span>{<font></font>
<font></font>
      LinkedHashMap&lt;String, Object&gt; target = <span class="hljs-keyword">new</span> LinkedHashMap&lt;&gt;();<font></font>
      target.put(<span class="hljs-string">"ciudad"</span>, source.getCity());
      <span class="hljs-comment">// ...</span><font></font>
<font></font>
      <span class="hljs-keyword">return</span> target;<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@ReadingConverter</span>                                                 <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
  <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MapToAddress</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Converter</span>&lt;<span class="hljs-title">Map</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">Object</span>&gt;, <span class="hljs-title">Address</span>&gt; </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Address <span class="hljs-title">convert</span><span class="hljs-params">(Map&lt;String, Object&gt; source)</span> </span>{<font></font>
<font></font>
      <span class="hljs-comment">// ...</span>
      <span class="hljs-keyword">return</span> address;<font></font>
    }<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  <span class="hljs-attr">"ciudad"</span> : <span class="hljs-string">"Los Angeles"</span>,
  <span class="hljs-attr">"calle"</span> : <span class="hljs-string">"2800 East Observatory Road"</span>,
  <span class="hljs-attr">"localidad"</span> : { <span class="hljs-attr">"lat"</span> : <span class="hljs-number">34.118347</span>, <span class="hljs-attr">"lon"</span> : <span class="hljs-number">-118.3026284</span> }<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加</font></font><code>Converter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font></font><code>Converter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于写入</font></font><code>DomainType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font></font><code>Converter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于</font></font><code>DomainType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从搜索结果中</font><font style="vertical-align: inherit;">读取</font><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="elasticsearch.operations"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. Elasticsearch 操作</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Elasticsearch 使用多个接口来定义可以针对 Elasticsearch 索引调用的操作（有关反应式接口的描述，请参阅</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.operations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反应式 Elasticsearch 操作</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IndexOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 定义索引级别的操作，例如创建或删除索引。</font></font></p>
</li>
<li>
<p><code>DocumentOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 定义基于 id 存储、更新和检索实体的操作。</font></font></p>
</li>
<li>
<p><code>SearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 定义使用查询搜索多个实体的操作</font></font></p>
</li>
<li>
<p><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结合了</font></font><code>DocumentOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>SearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些接口对应于</font></font><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/rest-apis.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的结构</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口的默认实现提供：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引管理功能。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域类型的读/写映射支持。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">丰富的查询和条件 api。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源管理和异常翻译。</font></font></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content">
<div class="paragraph">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引管理和自动创建索引和映射。</font></font></div>
<p><font style="vertical-align: inherit;"></font><code>IndexOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以从</font></font><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例中</font><font style="vertical-align: inherit;">获取</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">接口和提供的实现</font><font style="vertical-align: inherit;">（例如通过调用</font></font><code>operations.indexOps(clazz)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）使用户能够在 Elasticsearch 集群中创建索引、放置映射或存储模板和别名信息。</font><font style="vertical-align: inherit;">可以使用</font></font><code>@Setting</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">设置将创建的索引的详细信息，有关详细信息</font><font style="vertical-align: inherit;">，请参阅</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearc.misc.index.settings"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引设置</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些操作都不是</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由</font></font><code>IndexOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">的实现</font><strong><font style="vertical-align: inherit;">自动完成</font></strong><font style="vertical-align: inherit;">的</font></font><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">调用方法是用户的责任。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Spring Data Elasticsearch 存储库时支持自动创建索引和编写映射，请参阅</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.repositories.autocreation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用相应映射自动创建索引</font></font></a></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="elasticsearch.operations.template"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.template"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1. </font><font style="vertical-align: inherit;">弹性搜索模板</font></font></h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从版本 4.0 起不推荐使用 ElasticsearchTemplate，请改用 ElasticsearchRestTemplate。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这</font></font><code>ElasticsearchTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.transport"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传输客户端</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">接口</font><font style="vertical-align: inherit;">的实现</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 63. ElasticsearchTemplate 配置</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TransportClientConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ElasticsearchConfigurationSupport</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Bean</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> Client <span class="hljs-title">elasticsearchClient</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> UnknownHostException </span>{                 <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
    Settings settings = Settings.builder().put(<span class="hljs-string">"cluster.name"</span>, <span class="hljs-string">"elasticsearch"</span>).build();<font></font>
    TransportClient client = <span class="hljs-keyword">new</span> PreBuiltTransportClient(settings);<font></font>
    client.addTransportAddress(<span class="hljs-keyword">new</span> TransportAddress(InetAddress.getByName(<span class="hljs-string">"127.0.0.1"</span>), <span class="hljs-number">9300</span>));
    <span class="hljs-keyword">return</span> client;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@Bean(name = {"elasticsearchOperations", "elasticsearchTemplate"})</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> ElasticsearchTemplate <span class="hljs-title">elasticsearchTemplate</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> UnknownHostException </span>{ <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
  	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ElasticsearchTemplate(elasticsearchClient());<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.transport"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传输客户端</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">自 4.0 版起弃用。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建</font></font><code>ElasticsearchTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bean，提供两个名称，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elasticsearchOperations</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elasticsearchTemplate</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.operations.resttemplate"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.resttemplate"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2. </font><font style="vertical-align: inherit;">弹性搜索休息模板</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这</font></font><code>ElasticsearchRestTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.rest"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高级 REST 客户端</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">接口</font><font style="vertical-align: inherit;">的实现</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 64. ElasticsearchRestTemplate 配置</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RestClientConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractElasticsearchConfiguration</span> </span>{
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> RestHighLevelClient <span class="hljs-title">elasticsearchClient</span><span class="hljs-params">()</span> </span>{       <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
    <span class="hljs-keyword">return</span> RestClients.create(ClientConfiguration.localhost()).rest();<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// no special bean creation needed                       </span><i class="conum" data-value="2"></i><b><span class="hljs-comment">(2)</span></b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.rest"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高级 REST 客户端</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基类</font></font><code>AbstractElasticsearchConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经提供了</font></font><code>elasticsearchTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bean。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.operations.usage"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3. </font><font style="vertical-align: inherit;">使用示例</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于两个</font></font><code>ElasticsearchTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>ElasticsearchRestTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现</font></font><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口，使用它们的代码是没有不同的。</font><font style="vertical-align: inherit;">该示例展示了如何</font></font><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Spring REST 控制器中</font><font style="vertical-align: inherit;">使用注入的</font><font style="vertical-align: inherit;">实例。</font><font style="vertical-align: inherit;">通过为相应的 Bean 提供上面显示的配置之一来</font><font style="vertical-align: inherit;">决定是否使用</font></font><code>TransportClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>RestClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 65. ElasticsearchOperations 用法</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/")</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestController</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">private</span>  ElasticsearchOperations elasticsearchOperations;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TestController</span><span class="hljs-params">(ElasticsearchOperations elasticsearchOperations)</span> </span>{ <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
    <span class="hljs-keyword">this</span>.elasticsearchOperations = elasticsearchOperations;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@PostMapping("/person")</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Person person)</span> </span>{                         <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
    IndexQuery indexQuery = <span class="hljs-keyword">new</span> IndexQueryBuilder()<font></font>
      .withId(person.getId().toString())<font></font>
      .withObject(person)<font></font>
      .build();<font></font>
    String documentId = elasticsearchOperations.index(indexQuery);<font></font>
    <span class="hljs-keyword">return</span> documentId;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@GetMapping("/person/{id}")</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> Person <span class="hljs-title">findById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable("id")</span>  Long id)</span> </span>{                   <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b><font></font>
    Person person = elasticsearchOperations<font></font>
      .queryForObject(GetQuery.getById(id.toString()), Person.class);<font></font>
    <span class="hljs-keyword">return</span> person;<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让 Spring</font></font><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在构造函数中</font><font style="vertical-align: inherit;">注入提供的</font><font style="vertical-align: inherit;">bean。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Elasticsearch 集群中存储一些实体。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 id 查询检索实体。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要查看 的全部可能性，</font></font><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参阅 API 文档。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.reactive.operations"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.operations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4. </font><font style="vertical-align: inherit;">反应式 Elasticsearch 操作</font></font></h3>
<div class="paragraph">
<p><code>ReactiveElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是使用</font></font><code>ReactiveElasticsearchClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>ReactiveElasticsearchTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是默认的实现</font></font><code>ReactiveElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect3">
<h4 id="elasticsearch.reactive.template"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.template"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.1. </font><font style="vertical-align: inherit;">反应式 Elasticsearch 模板</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始</font></font><code>ReactiveElasticsearchTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要了解要与之合作的实际客户。</font><font style="vertical-align: inherit;">有关</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.reactive"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的详细信息，</font><font style="vertical-align: inherit;">请参阅</font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.reactive"><font style="vertical-align: inherit;">Reactive Client</font></a><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect4">
<h5 id="elasticsearch.reactive.template.configuration"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.template.configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反应式模板配置</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 的最简单方法</font></font><code>ReactiveElasticsearchTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是通过</font></font><code>AbstractReactiveElasticsearchConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><code>base package</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>initial entity set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等</font><font style="vertical-align: inherit;">提供专用的配置方法挂钩</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例 66. AbstractReactiveElasticsearchConfiguration</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractReactiveElasticsearchConfiguration</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Bean</span> <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> ReactiveElasticsearchClient <span class="hljs-title">reactiveElasticsearchClient</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-comment">// ...</span><font></font>
  }<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置要使用的客户端。</font><font style="vertical-align: inherit;">这可以通过</font></font><code>ReactiveRestClients</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或直接通过</font></font><code>DefaultReactiveElasticsearchClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果适用的默认设置</font></font><code>HttpHeaders</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font></font><code>ClientConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>ReactiveElasticsearchClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.configuration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端配置</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="提示"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果需要的话</font></font><code>ReactiveElasticsearchTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以用默认的配置</font></font><code>RefreshPolicy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并</font></font><code>IndicesOptions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是那些获得通过覆盖的默认应用到相关请求</font></font><code>refreshPolicy()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>indicesOptions()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然而，人们可能希望更多地控制实际组件并使用更详细的方法。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 67.配置 ReactiveElasticsearchTemplate</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Bean</span> <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
  <span class="hljs-function"><span class="hljs-keyword">public</span> ReactiveElasticsearchClient <span class="hljs-title">reactiveElasticsearchClient</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// ...</span><font></font>
  }<font></font>
  <span class="hljs-meta">@Bean</span> <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
  <span class="hljs-function"><span class="hljs-keyword">public</span> ElasticsearchConverter <span class="hljs-title">elasticsearchConverter</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MappingElasticsearchConverter(elasticsearchMappingContext());<font></font>
  }<font></font>
  <span class="hljs-meta">@Bean</span> <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
  <span class="hljs-function"><span class="hljs-keyword">public</span> SimpleElasticsearchMappingContext <span class="hljs-title">elasticsearchMappingContext</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SimpleElasticsearchMappingContext();<font></font>
  }<font></font>
  <span class="hljs-meta">@Bean</span> <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b>
  <span class="hljs-function"><span class="hljs-keyword">public</span> ReactiveElasticsearchOperations <span class="hljs-title">reactiveElasticsearchOperations</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ReactiveElasticsearchTemplate(reactiveElasticsearchClient(), elasticsearchConverter());<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置要使用的客户端。</font><font style="vertical-align: inherit;">这可以通过</font></font><code>ReactiveRestClients</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或直接通过</font></font><code>DefaultReactiveElasticsearchClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置了</font></font><code>ElasticsearchConverter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于利用由映射上下文提供的元数据域类型映射。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域类型元数据的 Elasticsearch 特定映射上下文。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于客户端和转换基础结构的实际模板。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="elasticsearch.reactive.template.usage"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.template.usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反应式模板使用</font></font></h5>
<div class="paragraph">
<p><code>ReactiveElasticsearchTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 允许您保存、查找和删除域对象并将这些对象映射到存储在 Elasticsearch 中的文档。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑以下：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 68. 使用 ReactiveElasticsearchTemplate</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Document(indexName = "marvel")</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-meta">@Id</span> String id;
  <span class="hljs-keyword">private</span> String name;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> age;
  <span class="hljs-comment">// Getter/Setter omitted...</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">template.save(<span class="hljs-keyword">new</span> Person(<span class="hljs-string">"Bruce Banner"</span>, <span class="hljs-number">42</span>))                    <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
  .doOnNext(System.out::println)<font></font>
  .flatMap(person -&gt; template.findById(person.id, Person.class)) <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
  .doOnNext(System.out::println)<font></font>
  .flatMap(person -&gt; template.delete(person))                    <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b><font></font>
  .doOnNext(System.out::println)<font></font>
  .flatMap(id -&gt; template.count(Person.class))                   <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b><font></font>
  .doOnNext(System.out::println)<font></font>
  .subscribe(); <i class="conum" data-value="5"></i><b>(<span class="hljs-number">5</span>)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以上在控制台输出如下序列。</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs plaintext">&gt; Person(id=QjWCWWcBXiLAnp77ksfR, name=Bruce Banner, age=42)<font></font>
&gt; Person(id=QjWCWWcBXiLAnp77ksfR, name=Bruce Banner, age=42)<font></font>
&gt; QjWCWWcBXiLAnp77ksfR<font></font>
&gt; 0</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将新</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档插入到</font><font style="vertical-align: inherit;">类型</font><em><font style="vertical-align: inherit;">字符</font></em><font style="vertical-align: inherit;">下</font><font style="vertical-align: inherit;">的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">奇迹</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引中</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">是在服务器端和一套生成到返回的实例。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><code>id</code><font style="vertical-align: inherit;"></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在类型</font><em><font style="vertical-align: inherit;">字符</font></em><font style="vertical-align: inherit;">下</font><font style="vertical-align: inherit;">的</font><em><font style="vertical-align: inherit;">奇迹</font></em><font style="vertical-align: inherit;">索引中</font><font style="vertical-align: inherit;">查找</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与匹配</font><font style="vertical-align: inherit;">。</font></font><code>id</code><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在类型</font><em><font style="vertical-align: inherit;">characters</font></em><font style="vertical-align: inherit;">下</font><font style="vertical-align: inherit;">的</font><em><font style="vertical-align: inherit;">marvel</font></em><font style="vertical-align: inherit;">索引中</font><font style="vertical-align: inherit;">删除</font><font style="vertical-align: inherit;">从给定实例中提取</font><font style="vertical-align: inherit;">的</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with 匹配</font><font style="vertical-align: inherit;">。</font></font><code>id</code><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算</font><font style="vertical-align: inherit;">类型</font><em><font style="vertical-align: inherit;">字符</font></em><font style="vertical-align: inherit;">下</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">奇迹</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引中</font><font style="vertical-align: inherit;">的文档总数</font><font style="vertical-align: inherit;">。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不要忘记</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">subscribe()</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.operations.searchresulttypes"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.searchresulttypes"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.5. </font><font style="vertical-align: inherit;">搜索结果类型</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当使用</font></font><code>DocumentOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font><font style="vertical-align: inherit;">的方法检索文档时</font><font style="vertical-align: inherit;">，只会返回找到的实体。</font><font style="vertical-align: inherit;">使用</font></font><code>SearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font><font style="vertical-align: inherit;">的方法进行搜索时</font><font style="vertical-align: inherit;">，每个实体都可以使用附加信息，例如</font><font style="vertical-align: inherit;">找到的实体</font><font style="vertical-align: inherit;">的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分数</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sortValues</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了返回此信息，每个实体都被包装在一个</font></font><code>SearchHit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含此实体特定附加信息</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">对象中。</font><font style="vertical-align: inherit;">这些</font></font><code>SearchHit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象本身在一个</font></font><code>SearchHits</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font><font style="vertical-align: inherit;">中返回，该</font><font style="vertical-align: inherit;">对象还包含有关整个搜索的信息，如</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maxScore</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或请求的聚合。</font><font style="vertical-align: inherit;">现在可以使用以下类和接口：</font></font></p>
</div>
<div class="paragraph">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索命中&lt;T&gt;</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含以下信息：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分数</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">排序值</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">突出显示字段</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部命中（这是一个</font></font><code>SearchHits</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含最终返回的内部命中</font><font style="vertical-align: inherit;">的嵌入</font><font style="vertical-align: inherit;">对象）</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检索到的 &lt;T&gt; 类型的实体</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SearchHits&lt;T&gt;</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含以下信息：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总命中数</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总点击数关系</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最高分</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"></font><code>SearchHit&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font><font style="vertical-align: inherit;">列表</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回的聚合</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索页面&lt;T&gt;</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义一个</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含</font></font><code>SearchHits&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">的 Spring Data </font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">可用于使用存储库方法进行分页访问。</font></font></p>
</div>
<div class="paragraph">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SearchScrollHits&lt;T&gt;</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由 中的低级滚动 API 函数返回</font></font><code>ElasticsearchRestTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它</font></font><code>SearchHits&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用 Elasticsearch 滚动 ID</font><font style="vertical-align: inherit;">丰富了 a </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SearchHitsIterator&lt;T&gt;</font></font></div>
<p><font style="vertical-align: inherit;"></font><code>SearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font><font style="vertical-align: inherit;">的流函数返回的迭代器</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.operations.queries"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.queries"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6. </font><font style="vertical-align: inherit;">查询</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>SearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>ReactiveSearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口中</font><font style="vertical-align: inherit;">定义的几乎所有方法都</font><font style="vertical-align: inherit;">采用一个</font></font><code>Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数来定义要执行的查询以进行搜索。</font></font><code>Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个接口，Spring Data Elasticsearch 提供了三种实现：</font></font><code>CriteriaQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>StringQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>NativeSearchQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
<div class="sect3">
<h4 id="elasticsearch.operations.criteriaquery"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.criteriaquery"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.1. </font><font style="vertical-align: inherit;">条件查询</font></font></h4>
<div class="paragraph">
<p><code>CriteriaQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于查询允许创建查询来搜索数据，而无需了解 Elasticsearch 查询的语法或基础知识。</font><font style="vertical-align: inherit;">它们允许用户通过简单地链接和组合</font></font><code>Criteria</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定搜索文档必须满足的条件的对象</font><font style="vertical-align: inherit;">来构建查询</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在讨论 AND 或 OR 时，请记住，在 Elasticsearch 中，AND 转换为</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件，而 OR 转换为</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该</font></font></strong>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><code>Criteria</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它们的用法最好通过示例来解释（假设我们有一个</font></font><code>Book</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有</font></font><code>price</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">实体</font><font style="vertical-align: inherit;">）：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 69. 获取给定价格的书籍</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Criteria criteria = <span class="hljs-keyword">new</span> Criteria(<span class="hljs-string">"price"</span>).is(<span class="hljs-number">42.0</span>);<font></font>
Query query = <span class="hljs-keyword">new</span> CriteriaQuery(criteria);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以链接同一字段的条件，它们将与逻辑 AND 组合：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 70. 获取给定价格的书籍</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Criteria criteria = <span class="hljs-keyword">new</span> Criteria(<span class="hljs-string">"price"</span>).greaterThan(<span class="hljs-number">42.0</span>).lessThan(<span class="hljs-number">34.0L</span>);<font></font>
Query query = <span class="hljs-keyword">new</span> CriteriaQuery(criteria);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接时</font></font><code>Criteria</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，默认使用 AND 逻辑：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 71. 获取所有名字为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">James</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和姓氏为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Miller 的人</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Criteria criteria = <span class="hljs-keyword">new</span> Criteria(<span class="hljs-string">"lastname"</span>).is(<span class="hljs-string">"Miller"</span>) <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
  .and(<span class="hljs-string">"firstname"</span>).is(<span class="hljs-string">"James"</span>)                           <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
Query query = <span class="hljs-keyword">new</span> CriteriaQuery(criteria);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先 </font></font><code>Criteria</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and() 创建一个新的</font></font><code>Criteria</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并将其链接到第一个。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果要创建嵌套查询，则需要为此使用子查询。</font><font style="vertical-align: inherit;">假设我们要查找姓氏为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Miller</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">且名字为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jack</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">John 的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有人</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 72. 嵌套子查询</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Criteria miller = <span class="hljs-keyword">new</span> Criteria(<span class="hljs-string">"lastName"</span>).is(<span class="hljs-string">"Miller"</span>)  <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
  .subCriteria(                                          <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
    <span class="hljs-keyword">new</span> Criteria().or(<span class="hljs-string">"firstName"</span>).is(<span class="hljs-string">"John"</span>)            <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
      .or(<span class="hljs-string">"firstName"</span>).is(<span class="hljs-string">"Jack"</span>)                        <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b><font></font>
  );<font></font>
Query query = <span class="hljs-keyword">new</span> CriteriaQuery(criteria);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"></font><code>Criteria</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为姓氏</font><font style="vertical-align: inherit;">创建一个</font><font style="vertical-align: inherit;">名字</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这与 AND 结合到子标准</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此子标准是名字</font><em><font style="vertical-align: inherit;">John</font></em><font style="vertical-align: inherit;">的 OR 组合</font></font><em><font style="vertical-align: inherit;"></font></em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和名字杰克</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>Criteria</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关不同可用操作的完整概述，</font><font style="vertical-align: inherit;">请参阅</font><font style="vertical-align: inherit;">该类</font><font style="vertical-align: inherit;">的 API 文档</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="elasticsearch.operations.stringquery"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.stringquery"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.2. </font><font style="vertical-align: inherit;">字符串查询</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此类将 Elasticsearch 查询作为 JSON 字符串。</font><font style="vertical-align: inherit;">以下代码显示了一个搜索名字为“Jack”的人的查询：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Query query = <span class="hljs-keyword">new</span> SearchQuery(<span class="hljs-string">"{ \"match\": { \"firstname\": { \"query\": \"Jack\" } } } "</span>);<font></font>
SearchHits&lt;Person&gt; searchHits = operations.search(query, Person.class);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>StringQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您已经有一个要使用的 Elasticsearch 查询，则</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">可能是合适的。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="elasticsearch.operations.nativesearchquery"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.nativesearchquery"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.3. </font><font style="vertical-align: inherit;">本地搜索查询</font></font></h4>
<div class="paragraph">
<p><code>NativeSearchQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是当您有复杂查询或无法使用</font></font><code>Criteria</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API</font><font style="vertical-align: inherit;">表达的</font><font style="vertical-align: inherit;">查询时</font><font style="vertical-align: inherit;">使用的类</font><font style="vertical-align: inherit;">，例如在构建查询和使用聚合时。</font><font style="vertical-align: inherit;">它允许使用</font></font><code>QueryBuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自 Elasticsearch 库的</font><font style="vertical-align: inherit;">所有不同</font><font style="vertical-align: inherit;">实现，因此命名为“native”。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下代码显示了如何搜索具有给定名字的人，并且找到的文档具有计算这些人姓氏出现次数的术语聚合：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Query query = <span class="hljs-keyword">new</span> NativeSearchQueryBuilder()<font></font>
    .addAggregation(terms(<span class="hljs-string">"lastnames"</span>).field(<span class="hljs-string">"lastname"</span>).size(<span class="hljs-number">10</span>)) <span class="hljs-comment">//</span>
    .withQuery(QueryBuilders.matchQuery(<span class="hljs-string">"firstname"</span>, firstName))<font></font>
    .build();<font></font>
<font></font>
SearchHits&lt;Person&gt; searchHits = operations.search(query, Person.class);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="elasticsearch.repositories"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.repositories"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. Elasticsearch 存储库</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本章包含 Elasticsearch 存储库实现的详细信息。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例 73. 样本</font></font><code>Book</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实体</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Document(indexName="books")</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>{
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> String id;<font></font>
<font></font>
    <span class="hljs-meta">@Field(type = FieldType.text)</span>
    <span class="hljs-keyword">private</span> String name;<font></font>
<font></font>
    <span class="hljs-meta">@Field(type = FieldType.text)</span>
    <span class="hljs-keyword">private</span> String summary;<font></font>
<font></font>
    <span class="hljs-meta">@Field(type = FieldType.Integer)</span>
    <span class="hljs-keyword">private</span> Integer price;<font></font>
<font></font>
	<span class="hljs-comment">// getter/setter ...</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.repositories.autocreation"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.repositories.autocreation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1. </font><font style="vertical-align: inherit;">使用相应的映射自动创建索引</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>@Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标注有一个参数</font></font><code>createIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果此参数设置为 true - 这是默认值 - Spring Data Elasticsearch 将在应用程序启动时引导存储库支持期间检查</font></font><code>@Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">定义的索引是否</font><font style="vertical-align: inherit;">存在。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果它不存在，将创建索引，并将从实体的注释（请参阅</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch 对象映射</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">派生的映射</font><font style="vertical-align: inherit;">写入新创建的索引。</font><font style="vertical-align: inherit;">可以使用</font></font><code>@Setting</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">设置将创建的索引的详细信息，有关详细信息</font><font style="vertical-align: inherit;">，请参阅</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearc.misc.index.settings"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引设置</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.query-methods"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.query-methods"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2. </font><font style="vertical-align: inherit;">查询方法</font></font></h3>
<div class="sect3">
<h4 id="elasticsearch.query-methods.finders"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.query-methods.finders"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1. </font><font style="vertical-align: inherit;">查询查找策略</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch 模块支持所有基本查询构建功能，如字符串查询、本地搜索查询、基于条件的查询或从方法名称派生的查询。</font></font></p>
</div>
<div class="sect4">
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明的查询</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从方法名称派生查询并不总是足够的和/或可能导致不可读的方法名称。</font><font style="vertical-align: inherit;">在这种情况下，可以使用</font></font><code>@Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释（请参阅</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.query-methods.at-query"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 @Query 注释</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="elasticsearch.query-methods.criterions"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.query-methods.criterions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.2. </font><font style="vertical-align: inherit;">查询创建</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常，Elasticsearch 的查询创建机制按照</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Query Methods 中的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述工作</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下是 Elasticsearch 查询方法转换为的简短示例：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 74. 根据方法名称创建查询</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Book</span>, <span class="hljs-title">String</span>&gt; </span>{
  <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">findByNameAndPrice</span><span class="hljs-params">(String name, Integer price)</span></span>;<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上面的方法名会被翻译成下面的 Elasticsearch json 查询</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{<font></font>
    "query": {<font></font>
        "bool" : {<font></font>
            "must" : [<font></font>
                { "query_string" : { "query" : "?", "fields" : [ "name" ] } },<font></font>
                { "query_string" : { "query" : "?", "fields" : [ "price" ] } }<font></font>
            ]<font></font>
        }<font></font>
    }<font></font>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch 支持的关键字列表如下所示。</font></font></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 2. 方法名称中支持的关键字</font></font></caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键词</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">样本</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch 查询字符串</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>And</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByNameAndPrice</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{ "query_string" : { "query" : "?", "fields" : [ "name" ] } },
{ "query_string" : { "query" : "?", "fields" : [ "price" ] } }
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Or</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByNameOrPrice</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"should" : [
{ "query_string" : { "query" : "?", "fields" : [ "name" ] } },
{ "query_string" : { "query" : "?", "fields" : [ "price" ] } }
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Is</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{ "query_string" : { "query" : "?", "fields" : [ "name" ] } }
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Not</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByNameNot</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must_not" : [
{ "query_string" : { "query" : "?", "fields" : [ "name" ] } }
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Between</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByPriceBetween</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{"range" : {"price" : {"from" : ?, "to" : ?, "include_lower" : true, "include_upper" : true } } }
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByPriceLessThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{"range" : {"price" : {"from" : null, "to" : ?, "include_lower" : true, "include_upper" : false } } }
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThanEqual</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByPriceLessThanEqual</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{"range" : {"price" : {"from" : null, "to" : ?, "include_lower" : true, "include_upper" : true } } }
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByPriceGreaterThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{"range" : {"price" : {"from" : ?, "to" : null, "include_lower" : false, "include_upper" : true } } }
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThanEqual</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByPriceGreaterThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{"range" : {"price" : {"from" : ?, "to" : null, "include_lower" : true, "include_upper" : true } } }
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Before</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByPriceBefore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{"range" : {"price" : {"from" : null, "to" : ?, "include_lower" : true, "include_upper" : true } } }
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>After</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByPriceAfter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{"range" : {"price" : {"from" : ?, "to" : null, "include_lower" : true, "include_upper" : true } } }
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Like</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByNameLike</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{ "query_string" : { "query" : "?*", "fields" : [ "name" ] }, "analyze_wildcard": true }
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StartingWith</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByNameStartingWith</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{ "query_string" : { "query" : "?*", "fields" : [ "name" ] }, "analyze_wildcard": true }
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EndingWith</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByNameEndingWith</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{ "query_string" : { "query" : "*?", "fields" : [ "name" ] }, "analyze_wildcard": true }
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Contains/Containing</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByNameContaining</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{ "query_string" : { "query" : "*?*", "fields" : [ "name" ] }, "analyze_wildcard": true }
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>In</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （当注释为 FieldType.Keyword 时）</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByNameIn(Collection&lt;String&gt;names)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{"bool" : {"must" : [
{"terms" : {"name" : ["?","?"]}}
]
}
}
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>In</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByNameIn(Collection&lt;String&gt;names)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query": {"bool": {"must": [{"query_string":{"query": "\"?\" \"?\"", "fields": ["name"]}}]}}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotIn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （当注释为 FieldType.Keyword 时）</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByNameNotIn(Collection&lt;String&gt;names)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{"bool" : {"must_not" : [
{"terms" : {"name" : ["?","?"]}}
]
}
}
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotIn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByNameNotIn(Collection&lt;String&gt;names)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{"query": {"bool": {"must": [{"query_string": {"query": "NOT(\"?\" \"?\")", "fields": ["name"]}}]}}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Near</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByStoreNear</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Not Supported Yet !</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>True</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAvailableTrue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{ "query_string" : { "query" : "true", "fields" : [ "available" ] } }
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>False</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAvailableFalse</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{ "query_string" : { "query" : "false", "fields" : [ "available" ] } }
]
}
}}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OrderBy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAvailableTrueOrderByNameDesc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ "query" : {
"bool" : {
"must" : [
{ "query_string" : { "query" : "true", "fields" : [ "available" ] } }
]
}
}, "sort":[{"name":{"order":"desc"}}]
}</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"></font><code>GeoJson</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不支持使用参数</font><font style="vertical-align: inherit;">
构建地理形状查询的方法名称</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您需要在存储库中具有此类功能，</font><font style="vertical-align: inherit;">请</font><font style="vertical-align: inherit;">在自定义存储库实现中</font><font style="vertical-align: inherit;">使用</font></font><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><code>CriteriaQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.3. </font><font style="vertical-align: inherit;">方法返回类型</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库方法可以定义为具有以下返回类型以返回多个元素：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>List&lt;T&gt;</code></p>
</li>
<li>
<p><code>Stream&lt;T&gt;</code></p>
</li>
<li>
<p><code>SearchHits&lt;T&gt;</code></p>
</li>
<li>
<p><code>List&lt;SearchHit&lt;T&gt;&gt;</code></p>
</li>
<li>
<p><code>Stream&lt;SearchHit&lt;T&gt;&gt;</code></p>
</li>
<li>
<p><code>SearchPage&lt;T&gt;</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="elasticsearch.query-methods.at-query"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.query-methods.at-query"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.4. </font><font style="vertical-align: inherit;">使用@Query 注解</font></font></h4>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 75. 使用</font></font><code>@Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">在方法中声明查询</font><font style="vertical-align: inherit;">。</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ElasticsearchRepository</span>&lt;<span class="hljs-title">Book</span>, <span class="hljs-title">String</span>&gt; </span>{
    <span class="hljs-meta">@Query("{\"match\": {\"name\": {\"query\": \"?0\"}}}")</span>
    <span class="hljs-function">Page&lt;Book&gt; <span class="hljs-title">findByName</span><span class="hljs-params">(String name,Pageable pageable)</span></span>;<font></font>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为注释参数的字符串必须是有效的 Elasticsearch JSON 查询。</font><font style="vertical-align: inherit;">它将作为查询元素的值发送到 Easticsearch；</font><font style="vertical-align: inherit;">例如，如果使用参数</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">John</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用该函数</font><font style="vertical-align: inherit;">，则会生成以下查询正文：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  <span class="hljs-attr">"query"</span>: {
    <span class="hljs-attr">"match"</span>: {
      <span class="hljs-attr">"name"</span>: {
        <span class="hljs-attr">"query"</span>: <span class="hljs-string">"John"</span><font></font>
      }<font></font>
    }<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.reactive.repositories"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.repositories"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3. </font><font style="vertical-align: inherit;">反应式 Elasticsearch 存储库</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">响应式 Elasticsearch 存储库支持建立在核心存储库支持的基础上，在</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Spring Data Repositories</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中</font><font style="vertical-align: inherit;">解释了</font><font style="vertical-align: inherit;">利用通过</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.operations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">响应</font></font></a><font style="vertical-align: inherit;"></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients.reactive"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式客户端</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行的</font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.operations"><font style="vertical-align: inherit;">响应式 Elasticsearch</font></a><font style="vertical-align: inherit;">操作提供的</font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.operations"><font style="vertical-align: inherit;">操作</font></a><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Elasticsearch 反应式存储库支持使用</font></font><a href="https://projectreactor.io/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project Reactor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为其选择的反应式组合库。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有3个主要接口可供使用：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ReactiveRepository</code></p>
</li>
<li>
<p><code>ReactiveCrudRepository</code></p>
</li>
<li>
<p><code>ReactiveSortingRepository</code></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="elasticsearch.reactive.repositories.usage"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.repositories.usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.1. </font><font style="vertical-align: inherit;">用法</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用 访问存储在 Elasticsearch 中的域对象</font></font><code>Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，只需为其创建一个接口。</font><font style="vertical-align: inherit;">在您真正继续这样做之前，您需要一个实体。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 76. 示例</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实体</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Id</span>
  <span class="hljs-keyword">private</span> String id;
  <span class="hljs-keyword">private</span> String firstname;
  <span class="hljs-keyword">private</span> String lastname;
  <span class="hljs-keyword">private</span> Address address;<font></font>
<font></font>
  <span class="hljs-comment">// … getters and setters omitted</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请注意，该</font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性必须为 类型</font></font><code>String</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 77. 用于持久化 Person 实体的基本存储库接口</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">interface ReactivePersonRepository extends ReactiveSortingRepository&lt;Person, String&gt; {<font></font>
<font></font>
  Flux&lt;Person&gt; findByFirstname(String firstname);                                   <i class="conum" data-value="1"></i><b>(1)</b><font></font>
<font></font>
  Flux&lt;Person&gt; findByFirstname(Publisher&lt;String&gt; firstname);                        <i class="conum" data-value="2"></i><b>(2)</b><font></font>
<font></font>
  Flux&lt;Person&gt; findByFirstnameOrderByLastname(String firstname);                    <i class="conum" data-value="3"></i><b>(3)</b><font></font>
<font></font>
  Flux&lt;Person&gt; findByFirstname(String firstname, Sort sort);                        <i class="conum" data-value="4"></i><b>(4)</b><font></font>
<font></font>
  Flux&lt;Person&gt; findByFirstname(String firstname, Pageable page);                    <i class="conum" data-value="5"></i><b>(5)</b><font></font>
<font></font>
  Mono&lt;Person&gt; findByFirstnameAndLastname(String firstname, String lastname);       <i class="conum" data-value="6"></i><b>(6)</b><font></font>
<font></font>
  Mono&lt;Person&gt; findFirstByLastname(String lastname);                                <i class="conum" data-value="7"></i><b>(7)</b><font></font>
<font></font>
  @Query("{ \"bool\" : { \"must\" : { \"term\" : { \"lastname\" : \"?0\" } } } }")<font></font>
  Flux&lt;Person&gt; findByLastname(String lastname);                                     <i class="conum" data-value="8"></i><b>(8)</b><font></font>
<font></font>
  Mono&lt;Long&gt; countByFirstname(String firstname)                                     <i class="conum" data-value="9"></i><b>(9)</b><font></font>
<font></font>
  Mono&lt;Boolean&gt; existsByFirstname(String firstname)                                 <i class="conum" data-value="10"></i><b>(10)</b><font></font>
<font></font>
  Mono&lt;Long&gt; deleteByFirstname(String firstname)                                    <i class="conum" data-value="11"></i><b>(11)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该方法显示对所有具有给定 的人的查询</font></font><code>lastname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finder 方法正在等待输入</font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以绑定 的参数值</font></font><code>firstname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finder 方法按 对匹配文档进行排序</font></font><code>lastname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finder 方法通过</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">定义的表达式对匹配的文档进行排序</font><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来抵消和排序参数传递到数据库。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finder 方法使用</font></font><code>And</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font><code>Or</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键字</font><font style="vertical-align: inherit;">连接条件</font><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到第一个匹配的实体。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该方法</font></font><code>lastname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过运行</font></font><code>@Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有给定参数</font><font style="vertical-align: inherit;">的注释</font><font style="vertical-align: inherit;">来</font><font style="vertical-align: inherit;">显示对所有具有给定</font><font style="vertical-align: inherit;">查找的</font><font style="vertical-align: inherit;">人的查询</font><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算所有匹配的实体</font></font><code>firstname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查是否</font></font><code>firstname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存在</font><font style="vertical-align: inherit;">至少一个匹配的实体</font><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除所有匹配的实体</font></font><code>firstname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="elasticsearch.reactive.repositories.configuration"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.reactive.repositories.configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.2. </font><font style="vertical-align: inherit;">配置</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于 Java 配置，请使用</font></font><code>@EnableReactiveElasticsearchRepositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释。</font><font style="vertical-align: inherit;">如果没有配置基本包，基础设施会扫描带注释的配置类的包。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下清单显示了如何为存储库使用 Java 配置：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 78. 存储库的 Java 配置</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableReactiveElasticsearchRepositories</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractReactiveElasticsearchConfiguration</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> ReactiveElasticsearchClient <span class="hljs-title">reactiveElasticsearchClient</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> ReactiveRestClients.create(ClientConfiguration.localhost());<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于上一个示例中的存储库扩展了</font></font><code>ReactiveSortingRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此所有 CRUD 操作以及对实体进行排序访问的方法都可用。</font><font style="vertical-align: inherit;">使用存储库实例是将其依赖注入客户端的问题，如以下示例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 79. 对 Person 实体的排序访问</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonRepositoryTests</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Autowired</span> ReactivePersonRepository repository;<font></font>
<font></font>
  <span class="hljs-meta">@Test</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sortsElementsCorrectly</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
    Flux&lt;Person&gt; persons = repository.findAll(Sort.by(<span class="hljs-keyword">new</span> Order(ASC, <span class="hljs-string">"lastname"</span>)));<font></font>
<font></font>
    <span class="hljs-comment">// ...</span><font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.repositories.annotations"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.repositories.annotations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4. </font><font style="vertical-align: inherit;">存储库方法的注释</font></font></h3>
<div class="sect3">
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.1. </font><font style="vertical-align: inherit;">@强调</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>@Highlight</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库方法上</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">注释定义应包括返回的实体突出显示的哪些字段。</font><font style="vertical-align: inherit;">要在 a</font></font><code>Book</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的名称或摘要中</font><font style="vertical-align: inherit;">搜索某些文本</font><font style="vertical-align: inherit;">并突出显示找到的数据，可以使用以下存储库方法：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">Book</span>, <span class="hljs-title">String</span>&gt; </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Highlight(fields = {
        @HighlightField(name = "name"),
        @HighlightField(name = "summary")
    })</span><font></font>
    List&lt;SearchHit&lt;Book&gt;&gt; findByNameOrSummary(String text, String summary);<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以像上面一样定义多个要突出显示的字段，并且可以</font></font><code>@Highlight</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>@HighlightField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释进一步自定义</font></font><code>@HighlightParameters</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">注释。</font><font style="vertical-align: inherit;">检查 Javadoc 以获得可能的配置选项。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在搜索结果中，可以从</font></font><code>SearchHit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类中</font><font style="vertical-align: inherit;">检索突出显示数据</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.annotation"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.annotation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5. </font><font style="vertical-align: inherit;">基于注解的配置</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过 JavaConfig 使用注释激活 Spring Data Elasticsearch 存储库支持。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 80.使用 JavaConfig 的 Spring Data Elasticsearch 存储库</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableElasticsearchRepositories(                             </span><i class="conum" data-value="1"></i><b><span class="hljs-meta">(1)</span></b><span class="hljs-meta">
  basePackages = "org.springframework.data.elasticsearch.repositories"
  )</span>
<span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Bean</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> ElasticsearchOperations <span class="hljs-title">elasticsearchTemplate</span><span class="hljs-params">()</span> </span>{    <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
      <span class="hljs-comment">// ...</span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProductService</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">private</span> ProductRepository repository;                       <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ProductService</span><span class="hljs-params">(ProductRepository repository)</span> </span>{
    <span class="hljs-keyword">this</span>.repository = repository;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> Page&lt;Product&gt; <span class="hljs-title">findAvailableBookByName</span><span class="hljs-params">(String name, Pageable pageable)</span> </span>{
    <span class="hljs-keyword">return</span> repository.findByAvailableTrueAndNameStartingWith(name, pageable);<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>EnableElasticsearchRepositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释激活库支持。</font><font style="vertical-align: inherit;">如果没有配置基础包，它将使用它所放置的配置类之一。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations"><font style="vertical-align: inherit;">Elasticsearch 操作</font></a><font style="vertical-align: inherit;">一章中</font><font style="vertical-align: inherit;">显示的配置之一</font><font style="vertical-align: inherit;">提供一个名为</font></font><code>elasticsearchTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">type</font><font style="vertical-align: inherit;">的 Bean </font><font style="vertical-align: inherit;">。</font></font><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让 Spring 将 Repository bean 注入到您的类中。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.cdi"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.cdi"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.6. </font><font style="vertical-align: inherit;">使用 CDI 的 Elasticsearch 存储库</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Elasticsearch 存储库也可以使用 CDI 功能进行设置。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 81.使用 CDI 的 Spring Data Elasticsearch 存储库</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ElasticsearchTemplateProducer</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Produces</span>
  <span class="hljs-meta">@ApplicationScoped</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> ElasticsearchOperations <span class="hljs-title">createElasticsearchTemplate</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// ...                               </span><i class="conum" data-value="1"></i><b><span class="hljs-comment">(1)</span></b><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProductService</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">private</span> ProductRepository repository;  <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
  <span class="hljs-function"><span class="hljs-keyword">public</span> Page&lt;Product&gt; <span class="hljs-title">findAvailableBookByName</span><span class="hljs-params">(String name, Pageable pageable)</span> </span>{
    <span class="hljs-keyword">return</span> repository.findByAvailableTrueAndNameStartingWith(name, pageable);<font></font>
  }<font></font>
  <span class="hljs-meta">@Inject</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setRepository</span><span class="hljs-params">(ProductRepository repository)</span> </span>{
    <span class="hljs-keyword">this</span>.repository = repository;<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用与</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch 操作</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一章中</font><font style="vertical-align: inherit;">使用的相同的调用来创建组件</font><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让 CDI 框架将 Repository 注入到您的类中。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.namespace"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.namespace"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.7. </font><font style="vertical-align: inherit;">Spring 命名空间</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Elasticsearch 模块包含一个自定义命名空间，允许定义存储库 bean 以及用于实例化</font></font><code>ElasticsearchServer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用该</font></font><code>repositories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素查找 Spring Data 存储库，如</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建存储库实例中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 82.使用命名空间设置 Elasticsearch 存储库</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hljs-attr">xmlns:elasticsearch</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/elasticsearch"</span>
       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
       https://www.springframework.org/schema/beans/spring-beans-3.1.xsd
       http://www.springframework.org/schema/data/elasticsearch
       https://www.springframework.org/schema/data/elasticsearch/spring-elasticsearch-1.0.xsd"</span>&gt;</span><font></font>
<font></font>
  <span class="hljs-tag">&lt;<span class="hljs-name">elasticsearch:repositories</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.acme.repositories"</span> /&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>Transport Client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or</font></font><code>Rest Client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font></font><code>Elasticsearch Server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在上下文中</font><font style="vertical-align: inherit;">注册一个实例</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 83. 使用命名空间的传输客户端</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hljs-attr">xmlns:elasticsearch</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/elasticsearch"</span>
       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
       https://www.springframework.org/schema/beans/spring-beans-3.1.xsd
       http://www.springframework.org/schema/data/elasticsearch
       https://www.springframework.org/schema/data/elasticsearch/spring-elasticsearch-1.0.xsd"</span>&gt;</span><font></font>
<font></font>
  <span class="hljs-tag">&lt;<span class="hljs-name">elasticsearch:transport-client</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"client"</span> <span class="hljs-attr">cluster-nodes</span>=<span class="hljs-string">"localhost:9300,someip:9300"</span> /&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 84. 使用命名空间的 Rest Client</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hljs-attr">xmlns:elasticsearch</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/elasticsearch"</span>
       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/data/elasticsearch
       https://www.springframework.org/schema/data/elasticsearch/spring-elasticsearch.xsd
       http://www.springframework.org/schema/beans
       https://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span><font></font>
<font></font>
  <span class="hljs-tag">&lt;<span class="hljs-name">elasticsearch:rest-client</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"restClient"</span> <span class="hljs-attr">hosts</span>=<span class="hljs-string">"http://localhost:9200"</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="auditing"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9. 审计</font></font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="auditing.basics"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing.basics"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1. </font><font style="vertical-align: inherit;">基本</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data 提供了复杂的支持，以透明地跟踪谁创建或更改了实体以及更改发生的时间。</font><font style="vertical-align: inherit;">要从该功能中受益，您必须为实体类配备审计元数据，这些元数据可以使用注释或通过实现接口来定义。</font><font style="vertical-align: inherit;">此外，必须通过 Annotation 配置或 XML 配置启用审计以注册所需的基础架构组件。</font><font style="vertical-align: inherit;">有关配置示例，请参阅特定于商店的部分。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅跟踪创建和修改日期的应用程序不需要指定</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing.auditor-aware"><code>AuditorAware</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="auditing.annotations"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing.annotations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1.1. </font><font style="vertical-align: inherit;">基于注释的审计元数据</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们提供</font></font><code>@CreatedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>@LastModifiedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">捕获创建或修改实体的用户，</font></font><code>@CreatedDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>@LastModifiedDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">捕获更改发生的时间。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 85. 一个被审计的实体</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Customer</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@CreatedBy</span>
  <span class="hljs-keyword">private</span> User user;<font></font>
<font></font>
  <span class="hljs-meta">@CreatedDate</span>
  <span class="hljs-keyword">private</span> Instant createdDate;<font></font>
<font></font>
  <span class="hljs-comment">// … further properties omitted</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如您所见，可以有选择地应用注释，具体取决于您要捕获的信息。</font><font style="vertical-align: inherit;">进行更改时捕获的注释可用于 Joda-Time </font></font><code>DateTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、旧版 Java</font></font><code>Date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Calendar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、JDK8 日期和时间类型以及</font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>Long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计元数据不一定需要存在于根级实体中，但可以添加到嵌入式实体中（取决于实际使用的存储），如下面的截图所示。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 86. 审计嵌入实体中的元数据</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Customer</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">private</span> AuditMetadata auditingMetadata;<font></font>
<font></font>
  <span class="hljs-comment">// … further properties omitted</span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AuditMetadata</span> </span>{<font></font>
<font></font>
  <span class="hljs-meta">@CreatedBy</span>
  <span class="hljs-keyword">private</span> User user;<font></font>
<font></font>
  <span class="hljs-meta">@CreatedDate</span>
  <span class="hljs-keyword">private</span> Instant createdDate;<font></font>
<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="auditing.interfaces"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing.interfaces"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1.2. </font><font style="vertical-align: inherit;">基于接口的审计元数据</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您不想使用注释来定义审计元数据，您可以让您的域类实现该</font></font><code>Auditable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口。</font><font style="vertical-align: inherit;">它公开了所有审计属性的 setter 方法。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还有一个方便的基类 ，</font></font><code>AbstractAuditable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以对其进行扩展以避免需要手动实现接口方法。</font><font style="vertical-align: inherit;">这样做会增加域类与 Spring Data 的耦合，这可能是您想要避免的。</font><font style="vertical-align: inherit;">通常，定义审计元数据的基于注释的方法是首选，因为它侵入性更小且更灵活。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="auditing.auditor-aware"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing.auditor-aware"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1.3. </font></font><code>AuditorAware</code></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您使用</font></font><code>@CreatedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>@LastModifiedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，审计基础结构需要以某种方式了解当前主体。</font><font style="vertical-align: inherit;">为此，我们提供了一个</font></font><code>AuditorAware&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPI 接口，您必须实现</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">接口以告知基础设施当前与应用程序交互的用户或系统是谁。</font><font style="vertical-align: inherit;">泛型类型</font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义了用什么类型注释的属性</font></font><code>@CreatedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>@LastModifiedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须是</font><font style="vertical-align: inherit;">什么类型</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了使用 Spring Security</font></font><code>Authentication</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font><font style="vertical-align: inherit;">的接口的实现</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example 87.</font></font><code>AuditorAware</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 Spring Security 的实现</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringSecurityAuditorAware</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AuditorAware</span>&lt;<span class="hljs-title">User</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> Optional&lt;User&gt; <span class="hljs-title">getCurrentAuditor</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">return</span> Optional.ofNullable(SecurityContextHolder.getContext())<font></font>
            .map(SecurityContext::getAuthentication)<font></font>
            .filter(Authentication::isAuthenticated)<font></font>
            .map(Authentication::getPrincipal)<font></font>
            .map(User.class::cast);<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该实现访问</font></font><code>Authentication</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Security 提供</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">对象并查找</font></font><code>UserDetails</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您在</font></font><code>UserDetailsService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现中</font><font style="vertical-align: inherit;">创建</font><font style="vertical-align: inherit;">的自定义</font><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们在这里假设您通过</font></font><code>UserDetails</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现</font><font style="vertical-align: inherit;">公开域用户，</font><font style="vertical-align: inherit;">但根据</font></font><code>Authentication</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发现，您也可以从任何地方查找它。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="auditing.reactive-auditor-aware"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#auditing.reactive-auditor-aware"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1.4. </font></font><code>ReactiveAuditorAware</code></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用反应式基础架构时，您可能希望使用上下文信息来提供</font></font><code>@CreatedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">提供</font></font><code>@LastModifiedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息。</font><font style="vertical-align: inherit;">我们提供了一个</font></font><code>ReactiveAuditorAware&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPI 接口，您必须实现</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">接口才能告诉基础设施当前与应用程序交互的用户或系统是谁。</font><font style="vertical-align: inherit;">泛型类型</font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义了用什么类型注释的属性</font></font><code>@CreatedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>@LastModifiedBy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须是</font><font style="vertical-align: inherit;">什么类型</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了使用响应式 Spring Security</font></font><code>Authentication</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font><font style="vertical-align: inherit;">的接口的实现</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example 88.</font></font><code>ReactiveAuditorAware</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 Spring Security 的实现</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringSecurityAuditorAware</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ReactiveAuditorAware</span>&lt;<span class="hljs-title">User</span>&gt; </span>{<font></font>
<font></font>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title">getCurrentAuditor</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">return</span> ReactiveSecurityContextHolder.getContext()<font></font>
                .map(SecurityContext::getAuthentication)<font></font>
                .filter(Authentication::isAuthenticated)<font></font>
                .map(Authentication::getPrincipal)<font></font>
                .map(User.class::cast);<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该实现访问</font></font><code>Authentication</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Security 提供</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">对象并查找</font></font><code>UserDetails</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您在</font></font><code>UserDetailsService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现中</font><font style="vertical-align: inherit;">创建</font><font style="vertical-align: inherit;">的自定义</font><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们在这里假设您通过</font></font><code>UserDetails</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现</font><font style="vertical-align: inherit;">公开域用户，</font><font style="vertical-align: inherit;">但根据</font></font><code>Authentication</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发现，您也可以从任何地方查找它。</font></font></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.auditing"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.auditing"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2. </font><font style="vertical-align: inherit;">弹性搜索审计</font></font></h3>
<div class="sect3">
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.1. </font><font style="vertical-align: inherit;">准备实体</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了让审计代码能够决定实体实例是否是新的，实体必须实现</font></font><code>Persistable&lt;ID&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下定义</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">接口：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">package</span> org.springframework.data.domain;<font></font>
<font></font>
<span class="hljs-keyword">import</span> org.springframework.lang.Nullable;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Persistable</span>&lt;<span class="hljs-title">ID</span>&gt; </span>{
    <span class="hljs-meta">@Nullable</span>
    <span class="hljs-function">ID <span class="hljs-title">getId</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isNew</span><span class="hljs-params">()</span></span>;<font></font>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 Id 的存在不足以确定实体是否是 Elasticsearch 中的新实体，因此需要附加信息。</font><font style="vertical-align: inherit;">一种方法是使用与创建相关的审计字段来做这个决定：</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实体可能如下-省略为简洁的getter和setter方法：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Document(indexName = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Persistable</span>&lt;<span class="hljs-title">Long</span>&gt; </span>{
    <span class="hljs-meta">@Id</span> <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String lastName;
    <span class="hljs-keyword">private</span> String firstName;
    <span class="hljs-meta">@CreatedDate</span>
    <span class="hljs-meta">@Field(type = FieldType.Date, format = DateFormat.basic_date_time)</span>
    <span class="hljs-keyword">private</span> Instant createdDate;
    <span class="hljs-meta">@CreatedBy</span>
    <span class="hljs-keyword">private</span> String createdBy
    <span class="hljs-meta">@Field(type = FieldType.Date, format = DateFormat.basic_date_time)</span>
    <span class="hljs-meta">@LastModifiedDate</span>
    <span class="hljs-keyword">private</span> Instant lastModifiedDate;
    <span class="hljs-meta">@LastModifiedBy</span>
    <span class="hljs-keyword">private</span> String lastModifiedBy;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Long <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>{                                                 <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
        <span class="hljs-keyword">return</span> id;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isNew</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> id == <span class="hljs-keyword">null</span> || (createdDate == <span class="hljs-keyword">null</span> &amp;&amp; createdBy == <span class="hljs-keyword">null</span>);  <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
    }<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getter 是接口所需的实现</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果一个对象没有</font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或没有设置包含创建属性的字段，</font><font style="vertical-align: inherit;">则该对象是新的</font><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.2. </font><font style="vertical-align: inherit;">激活审计</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在设置实体并提供</font></font><code>AuditorAware</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 或</font></font><code>ReactiveAuditorAware</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 必须通过</font></font><code>@EnableElasticsearchAuditing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在配置类上</font><font style="vertical-align: inherit;">设置来激活审计</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableElasticsearchRepositories</span>
<span class="hljs-meta">@EnableElasticsearchAuditing</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfiguration</span> </span>{
   <span class="hljs-comment">// configuration code</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用反应式堆栈时，这必须是：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableReactiveElasticsearchRepositories</span>
<span class="hljs-meta">@EnableReactiveElasticsearchAuditing</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfiguration</span> </span>{
   <span class="hljs-comment">// configuration code</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您的代码包含多个</font></font><code>AuditorAware</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同类型的 bean，您必须提供 bean 的名称以用作</font><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">的参数的</font></font><code>auditorAwareRef</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数
</font></font><code>@EnableElasticsearchAuditing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="entity-callbacks"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#entity-callbacks"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10. 实体回调</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data 基础设施提供了在调用某些方法之前和之后修改实体的钩子。</font><font style="vertical-align: inherit;">那些所谓的</font></font><code>EntityCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例提供了一种方便的方法来检查和潜在地以回调风格修改实体。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An</font></font><code>EntityCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看起来很像一个专门的</font></font><code>ApplicationListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">一些 Spring Data 模块发布</font></font><code>BeforeSaveEvent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许修改给定实体的</font><font style="vertical-align: inherit;">存储特定事件（例如</font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">在某些情况下，例如使用不可变类型时，这些事件可能会导致麻烦。</font><font style="vertical-align: inherit;">此外，事件发布依赖于</font></font><code>ApplicationEventMulticaster</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">如果使用异步配置</font></font><code>TaskExecutor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它可能会导致不可预测的结果，因为事件处理可以分叉到线程上。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实体回调提供了同步和反应式 API 的集成点，以保证在处理链中定义明确的检查点按顺序执行，返回可能修改的实体或反应式包装器类型。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实体回调通常按 API 类型分隔。</font><font style="vertical-align: inherit;">这种分离意味着同步 API 仅考虑同步实体回调，而反应式实现仅考虑反应式实体回调。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Commons 2.2 引入了实体回调 API。</font><font style="vertical-align: inherit;">这是应用实体修改的推荐方式。</font><font style="vertical-align: inherit;">在调用可能已注册的</font><font style="vertical-align: inherit;">实例</font><strong><font style="vertical-align: inherit;">之前</font></strong><font style="vertical-align: inherit;">，</font></font><code>ApplicationEvents</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仍会发布</font><font style="vertical-align: inherit;">特定于现有商店的信息</font><font style="vertical-align: inherit;">。</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><code>EntityCallback</code><font style="vertical-align: inherit;"></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="entity-callbacks.implement"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#entity-callbacks.implement"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1. </font><font style="vertical-align: inherit;">实现实体回调</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An</font></font><code>EntityCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过其泛型类型参数直接与其域类型相关联。</font><font style="vertical-align: inherit;">每个 Spring Data 模块通常带有一组</font></font><code>EntityCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">涵盖实体生命周期</font><font style="vertical-align: inherit;">的预定义</font><font style="vertical-align: inherit;">接口。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例 89. 解剖 </font></font><code>EntityCallback</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@FunctionalInterface</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BeforeSaveCallback</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">EntityCallback</span>&lt;<span class="hljs-title">T</span>&gt; </span>{<font></font>
<font></font>
	<span class="hljs-comment">/**
	 * Entity callback method invoked before a domain object is saved.
	 * Can return either the same or a modified instance.
	 *
	 * <span class="hljs-doctag">@return</span> the domain object to be persisted.
	 */</span>
	<span class="hljs-function">T <span class="hljs-title">onBeforeSave</span><span class="hljs-params">(T entity &lt;<span class="hljs-number">2</span>&gt;, String collection &lt;<span class="hljs-number">3</span>&gt;)</span></span>; <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><code>BeforeSaveCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在保存实体之前要调用的特定方法。</font><font style="vertical-align: inherit;">返回一个可能被修改的实例。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在持久化之前的实体。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">许多存储特定参数，例如</font><font style="vertical-align: inherit;">实体持久化到</font><font style="vertical-align: inherit;">的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例 90. 反应式的剖析 </font></font><code>EntityCallback</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@FunctionalInterface</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ReactiveBeforeSaveCallback</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">EntityCallback</span>&lt;<span class="hljs-title">T</span>&gt; </span>{<font></font>
<font></font>
	<span class="hljs-comment">/**
	 * Entity callback method invoked on subscription, before a domain object is saved.
	 * The returned Publisher can emit either the same or a modified instance.
	 *
	 * <span class="hljs-doctag">@return</span> Publisher emitting the domain object to be persisted.
	 */</span>
	<span class="hljs-function">Publisher&lt;T&gt; <span class="hljs-title">onBeforeSave</span><span class="hljs-params">(T entity &lt;<span class="hljs-number">2</span>&gt;, String collection &lt;<span class="hljs-number">3</span>&gt;)</span></span>; <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><code>BeforeSaveCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在保存实体之前，在订阅时调用的特定方法。</font><font style="vertical-align: inherit;">发出一个可能被修改的实例。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在持久化之前的实体。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">许多存储特定参数，例如</font><font style="vertical-align: inherit;">实体持久化到</font><font style="vertical-align: inherit;">的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可选的实体回调参数由实现 Spring Data 模块定义并从</font></font><code>EntityCallback.callback()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现适合您的应用程序需求的接口，如下例所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 91. 示例 </font></font><code>BeforeSaveCallback</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DefaultingEntityCallback</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BeforeSaveCallback</span>&lt;<span class="hljs-title">Person</span>&gt;, <span class="hljs-title">Ordered</span> </span>{      <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
	<span class="hljs-meta">@Override</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">onBeforeSave</span><span class="hljs-params">(Person entity, String collection)</span> </span>{                   <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
<font></font>
		<span class="hljs-keyword">if</span>(collection == <span class="hljs-string">"user"</span>) {
		    <span class="hljs-keyword">return</span> <span class="hljs-comment">// ...</span><font></font>
		}<font></font>
<font></font>
		<span class="hljs-keyword">return</span> <span class="hljs-comment">// ...</span><font></font>
	}<font></font>
<font></font>
	<span class="hljs-meta">@Override</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getOrder</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">return</span> <span class="hljs-number">100</span>;                                                                  <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
	}<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据您的要求实现回调。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果存在多个相同域类型的实体回调，则可能对实体回调进行排序。</font><font style="vertical-align: inherit;">排序遵循最低优先级。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="entity-callbacks.register"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#entity-callbacks.register"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2. </font><font style="vertical-align: inherit;">注册实体回调</font></font></h3>
<div class="paragraph">
<p><code>EntityCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果 bean 在</font></font><code>ApplicationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">大多数模板 API 已经实现</font></font><code>ApplicationContextAware</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此可以访问</font></font><code>ApplicationContext</code></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例解释了一组有效的实体回调注册：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例 92. </font></font><code>EntityCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean 注册</font><font style="vertical-align: inherit;">示例</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Order(1)</span>                                                           <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
<span class="hljs-meta">@Component</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">First</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BeforeSaveCallback</span>&lt;<span class="hljs-title">Person</span>&gt; </span>{<font></font>
<font></font>
	<span class="hljs-meta">@Override</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> Person <span class="hljs-title">onBeforeSave</span><span class="hljs-params">(Person person)</span> </span>{
		<span class="hljs-keyword">return</span> <span class="hljs-comment">// ...</span><font></font>
	}<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@Component</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DefaultingEntityCallback</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BeforeSaveCallback</span>&lt;<span class="hljs-title">Person</span>&gt;,
                                                           <span class="hljs-title">Ordered</span> </span>{ <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
	<span class="hljs-meta">@Override</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">onBeforeSave</span><span class="hljs-params">(Person entity, String collection)</span> </span>{
		<span class="hljs-comment">// ...</span><font></font>
	}<font></font>
<font></font>
	<span class="hljs-meta">@Override</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getOrder</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">return</span> <span class="hljs-number">100</span>;                                                  <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
	}<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EntityCallbackConfiguration</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">BeforeSaveCallback&lt;Person&gt; <span class="hljs-title">unorderedLambdaReceiverCallback</span><span class="hljs-params">()</span> </span>{   <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
        <span class="hljs-keyword">return</span> (BeforeSaveCallback&lt;Person&gt;) it -&gt; <span class="hljs-comment">// ...</span><font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@Component</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserCallbacks</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BeforeConvertCallback</span>&lt;<span class="hljs-title">User</span>&gt;,
                                        <span class="hljs-title">BeforeSaveCallback</span>&lt;<span class="hljs-title">User</span>&gt; </span>{   <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b><font></font>
<font></font>
	<span class="hljs-meta">@Override</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> Person <span class="hljs-title">onBeforeConvert</span><span class="hljs-params">(User user)</span> </span>{
		<span class="hljs-keyword">return</span> <span class="hljs-comment">// ...</span><font></font>
	}<font></font>
<font></font>
	<span class="hljs-meta">@Override</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> Person <span class="hljs-title">onBeforeSave</span><span class="hljs-params">(User user)</span> </span>{
		<span class="hljs-keyword">return</span> <span class="hljs-comment">// ...</span><font></font>
	}<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><code>BeforeSaveCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><code>@Order</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释中</font><font style="vertical-align: inherit;">接收其命令</font><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><code>BeforeSaveCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font></font><code>Ordered</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口实现</font><font style="vertical-align: inherit;">接收其订单</font><font style="vertical-align: inherit;">。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><code>BeforeSaveCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 lambda 表达式。</font><font style="vertical-align: inherit;">默认情况下无序并最后调用。</font><font style="vertical-align: inherit;">请注意，由 lambda 表达式实现的回调不会公开类型信息，因此使用不可分配的实体调用这些会影响回调吞吐量。</font><font style="vertical-align: inherit;">使用</font></font><code>class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or</font></font><code>enum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为回调 bean 启用类型过滤。</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在单个实现类中组合多个实体回调接口。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.entity-callbacks"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.entity-callbacks"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.3. </font><font style="vertical-align: inherit;">Elasticsearch EntityCallbacks</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Elasticsearch 在</font></font><code>EntityCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">API 来提供审计支持，并对以下回调做出反应：</font></font></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 3. 支持的实体回调</font></font></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打回来</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反应式/BeforeConvertCallback</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onBeforeConvert(T entity, IndexCoordinates index)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在域对象转换为</font></font><code>org.springframework.data.elasticsearch.core.document.Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">可以返回</font></font><code>entity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或 一个修改后的实体，然后将被转换。</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Ordered.LOWEST_PRECEDENCE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反应式/AfterConvertCallback</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onAfterConvert(T entity, Document document, IndexCoordinates indexCoordinates)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>org.springframework.data.elasticsearch.core.document.Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 Elasticsearch 读取结果数据</font><font style="vertical-align: inherit;">转换域对象后调用</font><font style="vertical-align: inherit;">。</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Ordered.LOWEST_PRECEDENCE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反应式/审计实体回调</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onBeforeConvert(Object entity, IndexCoordinates index)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标记</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><em><font style="vertical-align: inherit;">修改</font></em><font style="vertical-align: inherit;">的可审计实体</font></font><em><font style="vertical-align: inherit;"></font></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反应式/AfterSaveCallback</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T onAfterSave(T entity, IndexCoordinates index)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在保存域对象后调用。</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Ordered.LOWEST_PRECEDENCE</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="elasticsearch.jointype"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.jointype"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11. Join-Type 实现</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Elasticsearch 支持</font></font><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/parent-join.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Join 数据类型，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于创建相应的索引映射和存储相关信息。</font></font></p>
</div>
<div class="sect2">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.1. </font><font style="vertical-align: inherit;">设置数据</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于要在父子连接关系中使用的实体，它必须具有</font></font><code>JoinField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须注释</font><font style="vertical-align: inherit;">的 type 属性</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">让我们假设一个</font></font><code>Statement</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实体，其中的语句可能是一个</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、一个</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">答案</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、一个</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评论</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或一个</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投票</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font><font style="vertical-align: inherit;">在这个例子中也显示了</font><font style="vertical-align: inherit;">一个</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Builder</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它不是必需的，但稍后在示例代码中使用）：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Document(indexName = "statements")</span>
<span class="hljs-meta">@Routing("routing")</span>                                                                       <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Statement</span> </span>{
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> String id;<font></font>
<font></font>
    <span class="hljs-meta">@Field(type = FieldType.Text)</span>
    <span class="hljs-keyword">private</span> String text;<font></font>
<font></font>
    <span class="hljs-meta">@Field(type = FieldType.Keyword)</span>
    <span class="hljs-keyword">private</span> String routing;<font></font>
<font></font>
    <span class="hljs-meta">@JoinTypeRelations(
        relations =
            {
                @JoinTypeRelation(parent = "question", children = {"answer", "comment"}), </span><i class="conum" data-value="2"></i><b><span class="hljs-meta">(2)</span></b><span class="hljs-meta">
                @JoinTypeRelation(parent = "answer", children = "vote")                   </span><i class="conum" data-value="3"></i><b><span class="hljs-meta">(3)</span></b><span class="hljs-meta">
            }
    )</span>
    <span class="hljs-keyword">private</span> JoinField&lt;String&gt; relation;                                                   <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Statement</span><span class="hljs-params">()</span> </span>{<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> StatementBuilder <span class="hljs-title">builder</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> StatementBuilder();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> id;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(String id)</span> </span>{
        <span class="hljs-keyword">this</span>.id = id;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getRouting</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> routing;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setRouting</span><span class="hljs-params">(Routing routing)</span> </span>{
        <span class="hljs-keyword">this</span>.routing = routing;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getText</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> text;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setText</span><span class="hljs-params">(String text)</span> </span>{
        <span class="hljs-keyword">this</span>.text = text;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> JoinField&lt;String&gt; <span class="hljs-title">getRelation</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> relation;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setRelation</span><span class="hljs-params">(JoinField&lt;String&gt; relation)</span> </span>{
        <span class="hljs-keyword">this</span>.relation = relation;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StatementBuilder</span> </span>{
        <span class="hljs-keyword">private</span> String id;
        <span class="hljs-keyword">private</span> String text;
        <span class="hljs-keyword">private</span> String routing;
        <span class="hljs-keyword">private</span> JoinField&lt;String&gt; relation;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">StatementBuilder</span><span class="hljs-params">()</span> </span>{<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> StatementBuilder <span class="hljs-title">withId</span><span class="hljs-params">(String id)</span> </span>{
            <span class="hljs-keyword">this</span>.id = id;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> StatementBuilder <span class="hljs-title">withRouting</span><span class="hljs-params">(String routing)</span> </span>{
            <span class="hljs-keyword">this</span>.routing = routing;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> StatementBuilder <span class="hljs-title">withText</span><span class="hljs-params">(String text)</span> </span>{
            <span class="hljs-keyword">this</span>.text = text;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> StatementBuilder <span class="hljs-title">withRelation</span><span class="hljs-params">(JoinField&lt;String&gt; relation)</span> </span>{
            <span class="hljs-keyword">this</span>.relation = relation;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Statement <span class="hljs-title">build</span><span class="hljs-params">()</span> </span>{<font></font>
            Statement statement = <span class="hljs-keyword">new</span> Statement();<font></font>
            statement.setId(id);<font></font>
            statement.setRouting(routing);<font></font>
            statement.setText(text);<font></font>
            statement.setRelation(relation);<font></font>
            <span class="hljs-keyword">return</span> statement;<font></font>
        }<font></font>
    }<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关路由相关信息，请参阅</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.routing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路由值</font></font></a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个问题可以有答案和评论</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个答案可以有票</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>JoinField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性用于将关系的名称（</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">答案</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评论</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投票</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）与父 ID 结合起来。</font><font style="vertical-align: inherit;">泛型类型必须与带</font></font><code>@Id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释的属性</font><font style="vertical-align: inherit;">相同</font><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Elasticsearch 将为此类构建以下映射：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  <span class="hljs-attr">"statements"</span>: {
    <span class="hljs-attr">"mappings"</span>: {
      <span class="hljs-attr">"properties"</span>: {
        <span class="hljs-attr">"_class"</span>: {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,
          <span class="hljs-attr">"fields"</span>: {
            <span class="hljs-attr">"keyword"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>,
              <span class="hljs-attr">"ignore_above"</span>: <span class="hljs-number">256</span><font></font>
            }<font></font>
          }<font></font>
        },<font></font>
        <span class="hljs-attr">"routing"</span>: {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span><font></font>
        },<font></font>
        <span class="hljs-attr">"relation"</span>: {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"join"</span>,
          <span class="hljs-attr">"eager_global_ordinals"</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">"relations"</span>: {
            <span class="hljs-attr">"question"</span>: [
              <span class="hljs-string">"answer"</span>,
              <span class="hljs-string">"comment"</span><font></font>
            ],<font></font>
            <span class="hljs-attr">"answer"</span>: <span class="hljs-string">"vote"</span><font></font>
          }<font></font>
        },<font></font>
        <span class="hljs-attr">"text"</span>: {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span><font></font>
        }<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2. </font><font style="vertical-align: inherit;">存储数据</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给定这个类的存储库，以下代码插入一个问题、两个答案、一个评论和一个投票：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>{<font></font>
    repository.deleteAll();<font></font>
<font></font>
    Statement savedWeather = repository.save(<font></font>
        Statement.builder()<font></font>
            .withText(<span class="hljs-string">"How is the weather?"</span>)<font></font>
            .withRelation(<span class="hljs-keyword">new</span> JoinField&lt;&gt;(<span class="hljs-string">"question"</span>))                          <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
            .build());<font></font>
<font></font>
    Statement sunnyAnswer = repository.save(<font></font>
        Statement.builder()<font></font>
            .withText(<span class="hljs-string">"sunny"</span>)<font></font>
            .withRelation(<span class="hljs-keyword">new</span> JoinField&lt;&gt;(<span class="hljs-string">"answer"</span>, savedWeather.getId()))      <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
            .build());<font></font>
<font></font>
    repository.save(<font></font>
        Statement.builder()<font></font>
            .withText(<span class="hljs-string">"rainy"</span>)<font></font>
            .withRelation(<span class="hljs-keyword">new</span> JoinField&lt;&gt;(<span class="hljs-string">"answer"</span>, savedWeather.getId()))      <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b><font></font>
            .build());<font></font>
<font></font>
    repository.save(<font></font>
        Statement.builder()<font></font>
            .withText(<span class="hljs-string">"I don't like the rain"</span>)<font></font>
            .withRelation(<span class="hljs-keyword">new</span> JoinField&lt;&gt;(<span class="hljs-string">"comment"</span>, savedWeather.getId()))     <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b><font></font>
            .build());<font></font>
<font></font>
    repository.save(<font></font>
        Statement.builder()<font></font>
            .withText(<span class="hljs-string">"+1 for the sun"</span>)<font></font>
            ,withRouting(savedWeather.getId())<font></font>
            .withRelation(<span class="hljs-keyword">new</span> JoinField&lt;&gt;(<span class="hljs-string">"vote"</span>, sunnyAnswer.getId()))         <i class="conum" data-value="5"></i><b>(<span class="hljs-number">5</span>)</b><font></font>
            .build());<font></font>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建问题陈述</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题的第一个答案</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二个答案</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对问题的评论</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为第一个答案投票，这需要将路由设置为天气文档，请参阅</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.routing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Routing values</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.3. </font><font style="vertical-align: inherit;">检索数据</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前必须使用本机搜索查询来查询数据，因此标准存储库方法不支持。</font><font style="vertical-align: inherit;">可以改用</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.custom-implementations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Repositories 的自定义实现</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下代码作为示例显示了如何使用实例检索所有有</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投票的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条目</font><font style="vertical-align: inherit;">（必须是</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">answers</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为只有答案才能有投票）</font></font><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-function">SearchHits&lt;Statement&gt; <span class="hljs-title">hasVotes</span><span class="hljs-params">()</span> </span>{<font></font>
    NativeSearchQuery query = <span class="hljs-keyword">new</span> NativeSearchQueryBuilder()<font></font>
        .withQuery(hasChildQuery(<span class="hljs-string">"vote"</span>, matchAllQuery(), ScoreMode.None))<font></font>
        .build();<font></font>
<font></font>
    <span class="hljs-keyword">return</span> operations.search(query, Statement.class);<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="elasticsearch.routing"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.routing"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12. 路由值</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当 Elasticsearch 将文档存储在具有多个分片的索引中时，它会根据</font><font style="vertical-align: inherit;">文档</font><font style="vertical-align: inherit;">的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">id</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定您使用</font><font style="vertical-align: inherit;">的分片。</font><font style="vertical-align: inherit;">有时需要预先定义多个文档应该在同一个分片上建立索引（连接类型，相关数据的更快搜索）。</font><font style="vertical-align: inherit;">为此，Elasticsearch 提供了定义路由的可能性，该值应该用于计算分片而不是</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">id</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Elasticsearch 支持通过以下方式存储和检索数据的路由定义：</font></font></p>
</div>
<div class="sect2">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.1. </font><font style="vertical-align: inherit;">连接类型的路由</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当使用 join-types（参见</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.jointype"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Join-Type implementation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）时，Spring Data Elasticsearch 会自动使用</font></font><code>parent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实体的</font></font><code>JoinField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性作为路由的值。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这对于父子关系只有一个级别的所有用例都是正确的。</font><font style="vertical-align: inherit;">如果它更深，比如孩子-父母-祖父母关系——就像上面的例子从</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投票</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">→</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回答</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">→</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">——那么路由需要使用下一节中描述的技术明确指定（</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投票</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">question.id</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为路由值）。</font></font></p>
</div>
</div>
<div class="sect2">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.2. </font><font style="vertical-align: inherit;">自定义路由值</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了为实体定义自定义路由，Spring Data Elasticsearch 提供了一个</font></font><code>@Routing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注解（重用</font></font><code>Statement</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上面</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">类）：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Document(indexName = "statements")</span>
<span class="hljs-meta">@Routing("routing")</span>                  <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Statement</span> </span>{
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> String id;<font></font>
<font></font>
    <span class="hljs-meta">@Field(type = FieldType.Text)</span>
    <span class="hljs-keyword">private</span> String text;<font></font>
<font></font>
    <span class="hljs-meta">@JoinTypeRelations(
        relations =
            {
                @JoinTypeRelation(parent = "question", children = {"answer", "comment"}),
                @JoinTypeRelation(parent = "answer", children = "vote")
            }
    )</span>
    <span class="hljs-keyword">private</span> JoinField&lt;String&gt; relation;<font></font>
<font></font>
    <span class="hljs-meta">@Nullable</span>
    <span class="hljs-meta">@Field(type = FieldType.Keyword)</span>
    <span class="hljs-keyword">private</span> String routing;          <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b><font></font>
<font></font>
    <span class="hljs-comment">// getter/setter...</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“路由”</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义</font><font style="vertical-align: inherit;">为路由规范</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称为</font><em><font style="vertical-align: inherit;">routing</font></em><font style="vertical-align: inherit;">的属性</font></font><em><font style="vertical-align: inherit;"></font></em></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code>routing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">规范是纯字符串而不是 SpEL 表达式，则它被解释为实体的属性名称，在示例中它是</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路由</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性。</font><font style="vertical-align: inherit;">然后，此属性的值将用作使用该实体的所有请求的路由值。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们也可以在</font></font><code>@Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释中</font><font style="vertical-align: inherit;">使用 SpEL 表达式，</font><font style="vertical-align: inherit;">如下所示：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Document(indexName = "statements")</span>
<span class="hljs-meta">@Routing("@myBean.getRouting(#entity)")</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Statement</span></span>{
    <span class="hljs-comment">// all the needed stuff</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，用户需要提供一个名为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myBean</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的 bean，该 bean</font><font style="vertical-align: inherit;">具有一个方法</font></font><code>String getRouting(Object)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要引用实体</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“#entity”</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须在 SpEL 表达式中使用，并且返回值必须是</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或路由值作为字符串。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果普通属性的名称和 SpEL 表达式不足以自定义路由定义，则可以定义提供</font></font><code>RoutingResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font><font style="vertical-align: inherit;">的实现</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后可以在</font></font><code>ElasticOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">上设置</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">RoutingResolver resolver = ...;<font></font>
<font></font>
ElasticsearchOperations customOperations= operations.withRouting(resolver);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些</font></font><code>withRouting()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数返回</font></font><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有自定义路由集</font><font style="vertical-align: inherit;">的原始</font><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">的副本</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当实体存储在 Elasticsearch 中时已在实体上定义了路由，则在执行</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">delete</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作</font><font style="vertical-align: inherit;">时必须提供相同的值</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于不使用实体</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">- 像</font></font><code>get(ID)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>delete(ID)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 该</font></font><code>ElasticsearchOperations.withRouting(RoutingResolver)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法可以这样使用：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">String id = <span class="hljs-string">"someId"</span>;<font></font>
String routing = <span class="hljs-string">"theRoutingValue"</span>;<font></font>
<font></font>
<span class="hljs-comment">// get an entity</span><font></font>
Statement s = operations<font></font>
                .withRouting(RoutingResolver.just(routing))       <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b><font></font>
                .get(id, Statement.class);<font></font>
<font></font>
<span class="hljs-comment">// delete an entity</span>
operations.withRouting(RoutingResolver.just(routing)).delete(id);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><code>RoutingResolver.just(s)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 返回一个只返回给定字符串的解析器。</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="elasticsearch.misc"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.misc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13. 杂项 Elasticsearch 操作支持</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本章涵盖了对无法通过存储库界面直接访问的 Elasticsearch 操作的额外支持。</font><font style="vertical-align: inherit;">建议将这些操作添加为自定义实现，如</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.custom-implementations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Repositories 的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自定义实现中所述</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect2">
<h3 id="elasticsearc.misc.index.settings"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearc.misc.index.settings"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.1. </font><font style="vertical-align: inherit;">索引设置</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Spring Data Elasticsearch 创建 Elasticsearch 索引时，可以使用</font></font><code>@Setting</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">定义不同的索引设置</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下参数可用：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>useServerConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 不发送任何设置参数，因此 Elasticsearch 服务器配置确定它们。</font></font></p>
</li>
<li>
<p><code>settingPath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 是指定义必须在类路径中解析的设置的 JSON 文件</font></font></p>
</li>
<li>
<p><code>shards</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用的分片数，默认为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></em></p>
</li>
<li>
<p><code>replicas</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">副本数，默认为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></em></p>
</li>
<li>
<p><code>refreshIntervall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, 默认为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“1s”</font></font></em></p>
</li>
<li>
<p><code>indexStoreType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, 默认为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"fs"</font></font></em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以定义</font></font><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.11/index-modules-index-sorting.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引排序</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（查看链接的 Elasticsearch 文档以了解可能的字段类型和值）：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Document(indexName = "entities")</span>
<span class="hljs-meta">@Setting(
  sortFields = { "secondField", "firstField" },                                  </span><i class="conum" data-value="1"></i><b><span class="hljs-meta">(1)</span></b><span class="hljs-meta">
  sortModes = { Setting.SortMode.max, Setting.SortMode.min },                    </span><i class="conum" data-value="2"></i><b><span class="hljs-meta">(2)</span></b><span class="hljs-meta">
  sortOrders = { Setting.SortOrder.desc, Setting.SortOrder.asc },
  sortMissingValues = { Setting.SortMissing._last, Setting.SortMissing._first })</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Entity</span> </span>{
    <span class="hljs-meta">@Nullable</span>
    <span class="hljs-meta">@Id</span> <span class="hljs-keyword">private</span> String id;<font></font>
<font></font>
    <span class="hljs-meta">@Nullable</span>
    <span class="hljs-meta">@Field(name = "first_field", type = FieldType.Keyword)</span>
    <span class="hljs-keyword">private</span> String firstField;<font></font>
<font></font>
    <span class="hljs-meta">@Nullable</span> <span class="hljs-meta">@Field(name = "second_field", type = FieldType.Keyword)</span>
    <span class="hljs-keyword">private</span> String secondField;<font></font>
<font></font>
    <span class="hljs-comment">// getter and setter...</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义排序字段时，使用 Java 属性的名称 ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">firstField</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，而不是可能为 Elasticsearch 定义的名称 ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first_field</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></td>
<td><code>sortModes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>sortOrders</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>sortMissingValues</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是可选的，但如果设置了它们，则条目数必须与</font></font><code>sortFields</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">数匹配</font></font></td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.misc.filter"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.misc.filter"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.2. </font><font style="vertical-align: inherit;">过滤器生成器</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filter Builder 提高了查询速度。</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-keyword">private</span> ElasticsearchOperations operations;<font></font>
<font></font>
IndexCoordinates index = IndexCoordinates.of(<span class="hljs-string">"sample-index"</span>);<font></font>
<font></font>
SearchQuery searchQuery = <span class="hljs-keyword">new</span> NativeSearchQueryBuilder()<font></font>
  .withQuery(matchAllQuery())<font></font>
  .withFilter(boolFilter().must(termFilter(<span class="hljs-string">"id"</span>, documentId)))<font></font>
  .build();<font></font>
<font></font>
Page&lt;SampleEntity&gt; sampleEntities = operations.searchForPage(searchQuery, SampleEntity.class, index);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.scroll"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.scroll"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.3. </font><font style="vertical-align: inherit;">使用滚动获取大结果集</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch 有一个滚动 API，用于以块的形式获取大结果集。</font><font style="vertical-align: inherit;">Spring Data Elasticsearch 在内部使用它来提供</font></font><code>&lt;T&gt; SearchHitsIterator&lt;T&gt; SearchOperations.searchForStream(Query query, Class&lt;T&gt; clazz, IndexCoordinates index)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">的实现</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">IndexCoordinates index = IndexCoordinates.of(<span class="hljs-string">"sample-index"</span>);<font></font>
<font></font>
SearchQuery searchQuery = <span class="hljs-keyword">new</span> NativeSearchQueryBuilder()<font></font>
  .withQuery(matchAllQuery())<font></font>
  .withFields(<span class="hljs-string">"message"</span>)<font></font>
  .withPageable(PageRequest.of(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>))<font></font>
  .build();<font></font>
<font></font>
SearchHitsIterator&lt;SampleEntity&gt; stream = elasticsearchTemplate.searchForStream(searchQuery, SampleEntity.class, index);<font></font>
<font></font>
List&lt;SampleEntity&gt; sampleEntities = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
<span class="hljs-keyword">while</span> (stream.hasNext()) {<font></font>
  sampleEntities.add(stream.next());<font></font>
}<font></font>
<font></font>
stream.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>SearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API</font><font style="vertical-align: inherit;">中没有</font><font style="vertical-align: inherit;">访问scroll id的方法，如果需要访问，</font></font><code>ElasticsearchRestTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用</font><font style="vertical-align: inherit;">以下方法</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Autowired</span> ElasticsearchRestTemplate template;<font></font>
<font></font>
IndexCoordinates index = IndexCoordinates.of(<span class="hljs-string">"sample-index"</span>);<font></font>
<font></font>
SearchQuery searchQuery = <span class="hljs-keyword">new</span> NativeSearchQueryBuilder()<font></font>
  .withQuery(matchAllQuery())<font></font>
  .withFields(<span class="hljs-string">"message"</span>)<font></font>
  .withPageable(PageRequest.of(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>))<font></font>
  .build();<font></font>
<font></font>
SearchScrollHits&lt;SampleEntity&gt; scroll = template.searchScrollStart(<span class="hljs-number">1000</span>, searchQuery, SampleEntity.class, index);<font></font>
<font></font>
String scrollId = scroll.getScrollId();<font></font>
List&lt;SampleEntity&gt; sampleEntities = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
<span class="hljs-keyword">while</span> (scroll.hasSearchHits()) {<font></font>
  sampleEntities.addAll(scroll.getSearchHits());<font></font>
  scrollId = scroll.getScrollId();<font></font>
  scroll = template.searchScrollContinue(scrollId, <span class="hljs-number">1000</span>, SampleEntity.class);<font></font>
}<font></font>
template.searchScrollClear(scrollId);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要将 Scroll API 与存储库方法一起使用，返回类型必须</font></font><code>Stream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Elasticsearch 存储库中</font><font style="vertical-align: inherit;">定义</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后该方法的实现将使用 ElasticsearchTemplate 中的滚动方法。</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SampleEntityRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">SampleEntity</span>, <span class="hljs-title">String</span>&gt; </span>{<font></font>
<font></font>
    <span class="hljs-function">Stream&lt;SampleEntity&gt; <span class="hljs-title">findBy</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch.misc.sorts"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.misc.sorts"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.4. </font><font style="vertical-align: inherit;">排序选项</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了描述的默认排序选项</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.paging-and-sorting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分页和排序</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Data Elasticsearch 有一个</font></font><code>GeoDistanceOrder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类，可用于按地理距离排序搜索操作的结果。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果要检索的类具有</font></font><code>GeoPoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">location</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">，则以下内容</font></font><code>Sort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将按到给定点的距离对结果进行排序：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Sort.by(<span class="hljs-keyword">new</span> GeoDistanceOrder(<span class="hljs-string">"location"</span>, <span class="hljs-keyword">new</span> GeoPoint(<span class="hljs-number">48.137154</span>, <span class="hljs-number">11.5761247</span>)))</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="appendix" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#appendix"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录</font></font></h1>
<div class="sect1">
<h2 id="repositories.namespace-reference"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.namespace-reference"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 A：命名空间参考</font></font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="populator.namespace-dao-config"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#populator.namespace-dao-config"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>&lt;repositories /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>&lt;repositories /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素触发 Spring Data 存储库基础结构的设置。</font><font style="vertical-align: inherit;">最重要的属性是</font></font><code>base-package</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它定义了要扫描 Spring Data 存储库接口的包。</font><font style="vertical-align: inherit;">请参阅“ </font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances.spring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML 配置</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”。</font><font style="vertical-align: inherit;">下表描述了</font></font><code>&lt;repositories /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">的属性</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 4. 属性</font></font></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">姓名</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>base-package</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义要扫描的包以</font></font><code>*Repository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动检测模式</font><font style="vertical-align: inherit;">扩展的存储库接口</font><font style="vertical-align: inherit;">（实际接口由特定的 Spring Data 模块确定）。</font><font style="vertical-align: inherit;">配置包下面的所有包也被扫描。</font><font style="vertical-align: inherit;">允许使用通配符。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repository-impl-postfix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义后缀以自动检测自定义存储库实现。</font><font style="vertical-align: inherit;">名称以配置的后缀结尾的类被视为候选。</font><font style="vertical-align: inherit;">默认为</font></font><code>Impl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>query-lookup-strategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定用于创建查找器查询的策略。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息，</font><font style="vertical-align: inherit;">请参阅“</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.query-methods.query-lookup-strategies"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询查找策略</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”。</font><font style="vertical-align: inherit;">默认为</font></font><code>create-if-not-found</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>named-queries-location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义搜索包含外部定义查询的属性文件的位置。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>consider-nested-repositories</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是否应考虑嵌套存储库接口定义。</font><font style="vertical-align: inherit;">默认为</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="populator.namespace-reference"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#populator.namespace-reference"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 B：Populators 命名空间参考</font></font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="namespace-dao-config"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#namespace-dao-config"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;populator /&gt; 元素</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>&lt;populator /&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素允许通过 Spring Data 存储库基础结构填充数据存储。</font></font><sup class="footnote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><a id="_footnoteref_2" class="footnote" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#_footnotedef_2" title="查看脚注。"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></sup></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 5. 属性</font></font></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">姓名</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>locations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应填充从存储库中读取对象的文件的位置。</font></font></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repository-query-keywords"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repository-query-keywords"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 C：存储库查询关键字</font></font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="appendix.query.method.subject"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#appendix.query.method.subject"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的查询方法主题关键字</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下表列出了 Spring Data 存储库查询派生机制普遍支持的主题关键字来表达谓词。</font><font style="vertical-align: inherit;">有关受支持关键字的确切列表，请参阅特定于商店的文档，因为此处列出的某些关键字可能在特定商店中不受支持。</font></font></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 6. 查询主题关键字</font></font></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键词</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>find…By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>read…By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>get…By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>query…By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>search…By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>stream…By</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通用查询方法通常返回存储库类型、</font></font><code>Collection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子类型或结果包装器，例如</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>GeoResults</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或任何其他特定于商店的结果包装器。</font><font style="vertical-align: inherit;">可用作</font></font><code>findBy…</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>findMyDomainTypeBy…</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或与其他关键字结合使用。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exists…By</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存在投影，通常返回</font></font><code>boolean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>count…By</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计数投影返回数字结果。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delete…By</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>remove…By</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除查询方法返回无结果 ( </font></font><code>void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) 或删除计数。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>…First&lt;number&gt;…</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>…Top&lt;number&gt;…</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将查询结果限制为第一个</font></font><code>&lt;number&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果。</font><font style="vertical-align: inherit;">此关键字可以出现在主题的</font></font><code>find</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（和其他关键字）和</font><font style="vertical-align: inherit;">之间的任何位置</font></font><code>by</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>…Distinct…</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用不同的查询仅返回唯一的结果。</font><font style="vertical-align: inherit;">查阅特定于商店的文档是否支持该功能。</font><font style="vertical-align: inherit;">此关键字可以出现在主题的</font></font><code>find</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（和其他关键字）和</font><font style="vertical-align: inherit;">之间的任何位置</font></font><code>by</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="appendix.query.method.predicate"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#appendix.query.method.predicate"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的查询方法谓词关键字和修饰符</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下表列出了 Spring Data 存储库查询派生机制普遍支持的谓词关键字。</font><font style="vertical-align: inherit;">但是，请查阅特定于商店的文档以获取受支持关键字的确切列表，因为此处列出的某些关键字在特定商店中可能不受支持。</font></font></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 7. 查询谓词关键字</font></font></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逻辑关键字</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键字表达</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AND</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>And</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Or</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AFTER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>After</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsAfter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BEFORE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Before</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsBefore</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONTAINING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Containing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsContaining</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>Contains</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BETWEEN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Between</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsBetween</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENDING_WITH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EndingWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsEndingWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>EndsWith</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXISTS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Exists</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FALSE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>False</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsFalse</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GREATER_THAN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsGreaterThan</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GREATER_THAN_EQUALS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThanEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsGreaterThanEqual</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>In</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsIn</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Is</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Equals</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, （或没有关键字）</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_EMPTY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsEmpty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Empty</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_NOT_EMPTY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNotEmpty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>NotEmpty</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_NOT_NULL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsNotNull</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_NULL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsNull</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LESS_THAN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsLessThan</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LESS_THAN_EQUAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThanEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsLessThanEqual</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIKE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Like</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsLike</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Near</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsNear</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Not</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsNot</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT_IN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotIn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsNotIn</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT_LIKE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotLike</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsNotLike</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REGEX</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Regex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>MatchesRegex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>Matches</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STARTING_WITH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StartingWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsStartingWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>StartsWith</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRUE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>True</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsTrue</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WITHIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Within</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IsWithin</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了过滤谓词之外，还支持以下修饰符列表：</font></font></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 8. 查询谓词修饰符关键字</font></font></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键词</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IgnoreCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>IgnoringCase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与谓词关键字一起用于不区分大小写的比较。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AllIgnoreCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>AllIgnoringCase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">忽略所有合适属性的大小写。</font><font style="vertical-align: inherit;">在查询方法谓词的某处使用。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OrderBy…</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定静态排序顺序，然后是属性路径和方向（例如</font></font><code>OrderByFirstnameAscLastnameDesc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repository-query-return-types"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repository-query-return-types"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 D：存储库查询返回类型</font></font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="appendix.query.return.types"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#appendix.query.return.types"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的查询返回类型</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下表列出了 Spring Data 存储库通常支持的返回类型。</font><font style="vertical-align: inherit;">但是，请查阅特定于商店的文档以获取支持的返回类型的确切列表，因为此处列出的某些类型可能在特定商店中不受支持。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
地理空间类型（如</font></font><code>GeoResult</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>GeoResults</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code>GeoPage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）是仅适用于支持地理空间查询的数据存储。</font><font style="vertical-align: inherit;">一些存储模块可以定义它们自己的结果包装器类型。
</font></font></td>
</tr>
</tbody></table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 9. 查询返回类型</font></font></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回类型</font></font></th>
<th class="tableblock halign-left valign-top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示没有返回值。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原语</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java 原语。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包装类型</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java 包装器类型。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个独特的实体。</font><font style="vertical-align: inherit;">期望查询方法最多返回一个结果。</font><font style="vertical-align: inherit;">如果未找到结果，</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则返回。</font><font style="vertical-align: inherit;">不止一个结果会触发</font></font><code>IncorrectResultSizeDataAccessException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Iterator&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code>Iterator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Collection&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code>Collection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Optional&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 Java 8 或 Guava </font></font><code>Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">期望查询方法最多返回一个结果。</font><font style="vertical-align: inherit;">如果没有找到结果，</font></font><code>Optional.empty()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>Optional.absent()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回。</font><font style="vertical-align: inherit;">不止一个结果会触发</font></font><code>IncorrectResultSizeDataAccessException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Option&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scala 或 Vavr</font></font><code>Option</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型。</font><font style="vertical-align: inherit;">在语义上与</font></font><code>Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前描述的</font><font style="vertical-align: inherit;">Java 8 的行为相同</font><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Stream&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 Java 8 </font></font><code>Stream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Streamable&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该直接的便利扩展</font></font><code>Iterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公开了流、映射和过滤结果、连接它们等的方法。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并接受</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造函数或工厂方法参数的类型</font></font></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公开</font><font style="vertical-align: inherit;">以 a</font><font style="vertical-align: inherit;">作为参数</font><font style="vertical-align: inherit;">的构造函数或</font></font><code>….of(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font><code>….valueOf(…)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工厂方法的</font><font style="vertical-align: inherit;">类型</font></font><code>Streamable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息，</font><font style="vertical-align: inherit;">请参阅</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.collections-and-iterables.streamable-wrapper"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回自定义 Streamable Wrapper 类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vavr </font></font><code>Seq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>Set</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vavr 集合类型。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息，</font><font style="vertical-align: inherit;">请参阅</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.collections-and-iterables.vavr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对 Vavr 集合的支持</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Future&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code>Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">期望一个方法被注解</font></font><code>@Async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并需要启用 Spring 的异步方法执行功能。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompletableFuture&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 Java 8 </font></font><code>CompletableFuture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">期望一个方法被注解</font></font><code>@Async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并需要启用 Spring 的异步方法执行功能。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ListenableFuture</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code>org.springframework.util.concurrent.ListenableFuture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">期望一个方法被注解</font></font><code>@Async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并需要启用 Spring 的异步方法执行功能。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Slice&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个指定大小的数据块，指示是否有更多可用数据。</font><font style="vertical-align: inherit;">需要一个</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法参数。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Page&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"></font><code>Slice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有附加信息的</font><font style="vertical-align: inherit;">A </font><font style="vertical-align: inherit;">，例如结果总数。</font><font style="vertical-align: inherit;">需要一个</font></font><code>Pageable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法参数。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GeoResult&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有附加信息的结果条目，例如到参考位置的距离。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GeoResults&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"></font><code>GeoResult&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含附加信息的</font><font style="vertical-align: inherit;">列表</font><font style="vertical-align: inherit;">，例如到参考位置的平均距离。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GeoPage&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">甲</font></font><code>Page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带</font></font><code>GeoResult&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如到参考位置的平均距离。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Mono&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"></font><code>Mono</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用反应式存储库发出零个或一个元素的</font><font style="vertical-align: inherit;">Project Reactor </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">期望查询方法最多返回一个结果。</font><font style="vertical-align: inherit;">如果未找到结果，</font></font><code>Mono.empty()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则返回。</font><font style="vertical-align: inherit;">不止一个结果会触发</font></font><code>IncorrectResultSizeDataAccessException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flux&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project Reactor</font></font><code>Flux</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用反应式存储库发出零个、一个或多个元素。</font><font style="vertical-align: inherit;">返回的查询</font></font><code>Flux</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以发出无限数量的元素。</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Single&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 RxJava</font></font><code>Single</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用反应式存储库发出单个元素。</font><font style="vertical-align: inherit;">期望查询方法最多返回一个结果。</font><font style="vertical-align: inherit;">如果未找到结果，</font></font><code>Mono.empty()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则返回。</font><font style="vertical-align: inherit;">不止一个结果会触发</font></font><code>IncorrectResultSizeDataAccessException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Maybe&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 RxJava</font></font><code>Maybe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用反应式存储库发出零个或一个元素。</font><font style="vertical-align: inherit;">期望查询方法最多返回一个结果。</font><font style="vertical-align: inherit;">如果未找到结果，</font></font><code>Mono.empty()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则返回。</font><font style="vertical-align: inherit;">不止一个结果会触发</font></font><code>IncorrectResultSizeDataAccessException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 RxJava</font></font><code>Flowable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用反应式存储库发出零个、一个或多个元素。</font><font style="vertical-align: inherit;">返回的查询</font></font><code>Flowable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以发出无限数量的元素。</font></font></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="elasticsearch.migration"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.migration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录 E：迁移指南</font></font></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="elasticsearch-migration-guide-3.2-4.0"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 3.2.x 升级到 4.0.x</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节介绍了从 3.2.x 版到 4.0.x 版的重大更改，以及如何用新引入的功能替换已删除的功能。</font></font></p>
</div>
<div class="sect3">
<h4 id="elasticsearch-migration-guide-3.2-4.0.jackson-removal"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0.jackson-removal"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移除使用过的 Jackson Mapper</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本 4.0.x 中的一项更改是 Spring Data Elasticsearch 不再使用 Jackson Mapper 将实体映射到 Elasticsearch 所需的 JSON 表示（请参阅</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch 对象映射</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">在 3.2.x 版中，杰克逊映射器是默认使用的。</font></font><code>ElasticsearchEntityMapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过显式配置它（</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元模型对象映射</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">，可以切换到基于元模型的转换器（命名</font><font style="vertical-align: inherit;">）。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在版本 4.0.x 中，基于元模型的转换器是唯一可用且不需要显式配置的转换器。</font><font style="vertical-align: inherit;">如果您有一个自定义配置来通过提供这样的 bean 来启用元模型转换器：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-meta">@Bean</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> EntityMapper <span class="hljs-title">entityMapper</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
  ElasticsearchEntityMapper entityMapper = <span class="hljs-keyword">new</span> ElasticsearchEntityMapper(<font></font>
    elasticsearchMappingContext(), <span class="hljs-keyword">new</span> DefaultConversionService()<font></font>
  );<font></font>
  entityMapper.setConversions(elasticsearchCustomConversions());<font></font>
<font></font>
  <span class="hljs-keyword">return</span> entityMapper;<font></font>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您现在必须删除此 bean，该</font></font><code>ElasticsearchEntityMapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口已被删除。</font></font></p>
</div>
<div class="paragraph">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实体配置</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一些用户在实体类上有自定义的 Jackson 注释，例如为了在 Elasticsearch 中为映射文档定义自定义名称或配置日期转换。</font><font style="vertical-align: inherit;">这些都不再考虑了。</font><font style="vertical-align: inherit;">Spring Data Elasticsearch 的</font></font><code>@Field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注解</font><font style="vertical-align: inherit;">现在提供了所需的功能</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关详细信息，</font><font style="vertical-align: inherit;">请参阅</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.mapping.meta-model.annotations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射注释概述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="elasticsearch-migration-guide-3.2-4.0.implicit-index-name"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0.implicit-index-name"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从查询对象中删除隐式索引名称</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 3.2.x 中，不同的查询类喜欢</font></font><code>IndexQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>SearchQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有采用它们正在操作的索引名称或索引名称的属性。</font><font style="vertical-align: inherit;">如果未设置这些，则检查传入的实体以检索在</font></font><code>@Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">中设置的索引名称</font><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在 4.0.x 中，现在必须在 type 的附加参数中提供索引名称</font></font><code>IndexCoordinates</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通过将其分开，现在可以针对不同的索引使用一个查询对象。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如下面的代码：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">IndexQuery indexQuery = <span class="hljs-keyword">new</span> IndexQueryBuilder()<font></font>
  .withId(person.getId().toString())<font></font>
  .withObject(person)<font></font>
  .build();<font></font>
<font></font>
String documentId = elasticsearchOperations.index(indexQuery);</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须改为：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">IndexCoordinates indexCoordinates = elasticsearchOperations.getIndexCoordinatesFor(person.getClass());<font></font>
<font></font>
IndexQuery indexQuery = <span class="hljs-keyword">new</span> IndexQueryBuilder()<font></font>
  .withId(person.getId().toString())<font></font>
  .withObject(person)<font></font>
  .build();<font></font>
<font></font>
String documentId = elasticsearchOperations.index(indexQuery, indexCoordinates);</code></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了更轻松地处理实体并使用包含在实体</font></font><code>@Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释中</font><font style="vertical-align: inherit;">的索引名称，</font><font style="vertical-align: inherit;">添加了新方法，例如</font></font><code>DocumentOperations.save(T entity)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">；</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="elasticsearch-migration-guide-3.2-4.0.new-operations"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0.new-operations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新的操作界面</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 3.2 版本中，有一个</font></font><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口定义了</font></font><code>ElasticsearchTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类的</font><font style="vertical-align: inherit;">所有方法</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在第 4 版中，功能被拆分为不同的接口，使这些接口与 Elasticsearch API 保持一致：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DocumentOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 是功能相关的文件，如保存或删除</font></font></p>
</li>
<li>
<p><code>SearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 包含在 Elasticsearch 中搜索的函数</font></font></p>
</li>
<li>
<p><code>IndexOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 定义对索引进行操作的函数，例如索引创建或映射创建。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在扩展</font></font><code>DocumentOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>SearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有方法可以访问</font></font><code>IndexOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="笔记"></i>
</td>
<td class="content"><font style="vertical-align: inherit;"></font><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在移至</font><font style="vertical-align: inherit;">
该</font><font style="vertical-align: inherit;">接口的版本 3.2 中的</font><font style="vertical-align: inherit;">所有功能</font></font><code>IndexOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仍然可用，它们被标记为已弃用，并具有委托给新实现的默认实现：
</font></font></td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-comment">/**
 * Create an index for given indexName.
 *
 * <span class="hljs-doctag">@param</span> indexName the name of the index
 * <span class="hljs-doctag">@return</span> {<span class="hljs-doctag">@literal</span> true} if the index was created
 * <span class="hljs-doctag">@deprecated</span> since 4.0, use {<span class="hljs-doctag">@link</span> IndexOperations#create()}
 */</span>
<span class="hljs-meta">@Deprecated</span>
<span class="hljs-function"><span class="hljs-keyword">default</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">createIndex</span><span class="hljs-params">(String indexName)</span> </span>{
	<span class="hljs-keyword">return</span> indexOps(IndexCoordinates.of(indexName)).create();<font></font>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="elasticsearch-migration-guide-3.2-4.0.deprecations"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0.deprecations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font></h4>
<div class="sect4">
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法和类</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">许多函数和类已被弃用。</font><font style="vertical-align: inherit;">这些函数仍然有效，但 Javadocs 显示了它们应该被替换的内容。</font></font></p>
</div>
<div class="listingblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自 ElasticsearchOperations 的示例</font></font></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs"><span class="hljs-comment">/*
 * Retrieves an object from an index.
 *
 * @param query the query defining the id of the object to get
 * @param clazz the type of the object to be returned
 * @return the found object
 * @deprecated since 4.0, use {@link #get(String, Class, IndexCoordinates)}
 */</span>
<span class="hljs-meta">@Deprecated</span>
<span class="hljs-meta">@Nullable</span>
&lt;T&gt; <span class="hljs-function">T <span class="hljs-title">queryForObject</span><span class="hljs-params">(GetQuery query, Class&lt;T&gt; clazz)</span></span>;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch 弃用</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于版本 7 Elasticsearch</font></font><code>TransportClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已弃用，它将随 Elasticsearch 版本 8 一起删除。 Spring Data Elasticsearch 弃用</font></font><code>ElasticsearchTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>TransportClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本 4.0 中的类。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射类型已从 Elasticsearch 7 中删除，它们仍然作为不推荐使用的值存在于 Spring Data</font></font><code>@Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释和</font></font><code>IndexCoordinates</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类中，但它们在内部不再使用。</font></font></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="elasticsearch-migration-guide-3.2-4.0.removal"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-3.2-4.0.removal"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移除</font></font></h4>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如前所述，该</font></font><code>ElasticsearchEntityMapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口已被删除。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>SearchQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口已合并到它的基本 interface 中</font></font><code>Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此它的出现可以替换为</font></font><code>Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font><code>org.springframework.data.elasticsearch.core.ElasticsearchOperations.query(SearchQuery query, ResultsExtractor&lt;T&gt; resultsExtractor);</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>org.springframework.data.elasticsearch.core.ResultsExtractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口已被删除。</font><font style="vertical-align: inherit;">对于使用基于 Jackson 的映射器完成的响应映射不够的情况，这些可用于解析 Elasticsearch 的结果。</font><font style="vertical-align: inherit;">从 4.0 版开始，有新的</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.operations.searchresulttypes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索结果类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以从 Elasticsearch 响应中返回信息，因此无需公开此低级功能。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低级别的方法</font></font><code>startScroll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>continueScroll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>clearScroll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经从删除</font></font><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口。</font><font style="vertical-align: inherit;">对于低级滚动 API 访问，</font><font style="vertical-align: inherit;">该类</font><font style="vertical-align: inherit;">现在有</font></font><code>searchScrollStart</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>searchScrollContinue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>searchScrollClear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font><code>ElasticsearchRestTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch-migration-guide-4.0-4.1"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.0-4.1"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 4.0.x 升级到 4.1.x</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节介绍了从 4.0.x 版到 4.1.x 版的重大更改，以及如何用新引入的功能替换已删除的功能。</font></font></p>
</div>
<div class="sect3">
<h4 id="elasticsearch-migration-guide-4.0-4.1.deprecations"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.0-4.1.deprecations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font></h4>
<div class="paragraph">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">id 属性的定义</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过命名为</font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">来将 en 实体的属性定义为 id 属性</font></font><code>document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此行为现​​已弃用，并将产生警告。</font><font style="vertical-align: inherit;">请给我们</font></font><code>@Id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释以将属性标记为 id 属性。</font></font></p>
</div>
<div class="paragraph">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引映射</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>ReactiveElasticsearchClient.Indices</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口中，</font></font><code>updateMapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不推荐使用方法以支持</font></font><code>putMapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法。</font><font style="vertical-align: inherit;">它们的作用相同，但</font></font><code>putMapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与 Elasticsearch API 中的命名一致：</font></font></p>
</div>
<div class="paragraph">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">别名处理</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>IndexOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口中的方法</font></font><code>addAlias(AliasQuery)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>removeAlias(AliasQuery)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>queryForAlias()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已被弃用。</font><font style="vertical-align: inherit;">新方法</font></font><code>alias(AliasAction)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>getAliases(String…​)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>getAliasesForIndex(String…​)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供更多功能和更简洁的 API。</font></font></p>
</div>
<div class="paragraph">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">父母身份证</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自版本 6 起，Elasticsearch 中已删除使用 parent-id。我们现在弃用相应的字段和方法。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="elasticsearch-migration-guide-4.0-4.1.removal"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.0-4.1.removal"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移除</font></font></h4>
<div class="paragraph">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型映射</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释和</font><font style="vertical-align: inherit;">对象</font><font style="vertical-align: inherit;">的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型映射</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">被删除。</font><font style="vertical-align: inherit;">它们在 Spring Data Elasticsearch 4.0 中已被弃用，并且不再使用它们的值。</font></font><code>@Document</code><font style="vertical-align: inherit;"></font><code>IndexCoordinates</code><font style="vertical-align: inherit;"></font></p>
</div>
</div>
<div class="sect3">
<h4 id="elasticsearch-migration-guide-4.0-4.1.breaking-changes"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.0-4.1.breaking-changes"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重大变化</font></font></h4>
<div class="sect4">
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReactiveElasticsearchClient.Indices 方法的返回类型</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的方法目前</font></font><code>ReactiveElasticsearchClient.Indices</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还没有使用。</font><font style="vertical-align: inherit;">随着 的引入，有</font></font><code>ReactiveIndexOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要更改一些返回类型：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>createIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变种现在返回</font></font><code>Mono&lt;Boolean&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而不是</font></font><code>Mono&lt;Void&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示成功创建索引。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>updateMapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变种现在返回</font></font><code>Mono&lt;Boolean&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而不是</font></font><code>Mono&lt;Void&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示成功映射存储。</font></font></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DocumentOperations.bulkIndex 方法的返回类型</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些方法正在返回一个</font></font><code>List&lt;String&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含新索引记录的 ID。</font><font style="vertical-align: inherit;">现在他们返回一个</font></font><code>List&lt;IndexedObjectInformation&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">这些对象包含有关乐观锁定的 id 和信息（seq_no 和 primary_term）</font></font></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elasticsearch-migration-guide-4.1-4.2"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.1-4.2"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 4.1.x 升级到 4.2.x</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节介绍了从 4.1.x 版到 4.2.x 版的重大更改，以及如何用新引入的功能替换已删除的功能。</font></font></p>
</div>
<div class="sect3">
<h4 id="elasticsearch-migration-guide-4.1-4.2.deprecations"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.1-4.2.deprecations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font></h4>
<div class="sect4">
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Document 参数</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该参数</font></font><code>@Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注解是相关的指数设置（</font></font><code>useServerConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>shards</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>replicas</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>refreshIntervall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>indexStoretype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）已经被移至</font></font><code>@Setting</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释。</font></font><code>@Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仍然可以</font><font style="vertical-align: inherit;">使用 in ，</font><font style="vertical-align: inherit;">但已弃用。</font></font></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="elasticsearch-migration-guide-4.1-4.2.removal"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.1-4.2.removal"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移除</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>@Score</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于在实体中设置分数返回值</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">注释在 4.0 版本中已被弃用并已被删除。</font><font style="vertical-align: inherit;">Scroe 值在</font></font><code>SearchHit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">封装返回实体</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">实例中返回。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>org.springframework.data.elasticsearch.ElasticsearchException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类已被删除。</font><font style="vertical-align: inherit;">其余用法已替换为</font></font><code>org.springframework.data.mapping.MappingException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>org.springframework.dao.InvalidDataAccessApiUsageException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不推荐使用</font></font><code>ScoredPage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>ScrolledPage</code> <code>@AggregatedPage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并实现已被删除。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已弃用</font></font><code>GetQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>DeleteQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已删除。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>find</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已从</font></font><code>ReactiveSearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>ReactiveDocumentOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中删除</font><font style="vertical-align: inherit;">不推荐使用的</font><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="elasticsearch-migration-guide-4.1-4.2.breaking-changes"><a class="anchor" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch-migration-guide-4.1-4.2.breaking-changes"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重大变化</font></font></h4>
<div class="sect4">
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">刷新策略</font></font></h5>
<div class="sect5">
<h6><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举包已更改</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 4.1 中可以</font></font><code>ReactiveElasticsearchTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过覆盖</font></font><code>AbstractReactiveElasticsearchConfiguration.refreshPolicy()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自定义配置类中</font><font style="vertical-align: inherit;">的方法</font><font style="vertical-align: inherit;">来配置刷新策略</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此方法的返回值是该类的一个实例</font></font><code>org.elasticsearch.action.support.WriteRequest.RefreshPolicy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在配置必须返回</font></font><code>org.springframework.data.elasticsearch.core.RefreshPolicy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">此枚举具有与以前相同的值并触发相同的行为，因此只需</font></font><code>import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调整语句。</font></font></p>
</div>
</div>
<div class="sect5">
<h6><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">刷新行为</font></font></h6>
<div class="paragraph">
<p><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果不为空</font><font style="vertical-align: inherit;">，</font></font><code>ReactiveElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在显式使用</font></font><code>RefreshPolicy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模板上</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">集合进行写入请求。</font><font style="vertical-align: inherit;">如果刷新策略为空，则不会执行任何特殊操作，因此使用集群默认值。</font></font><code>ElasticsearchOperations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此版本之前始终使用集群默认值。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当刷新策略为空时，</font><font style="vertical-align: inherit;">为</font></font><code>ElasticsearchRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">提供的实现</font></font><code>ReactiveElasticsearchRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将进行显式刷新。</font><font style="vertical-align: inherit;">这与以前版本中的行为相同。</font><font style="vertical-align: inherit;">如果设置了刷新策略，那么存储库也将使用它。</font></font></p>
</div>
</div>
<div class="sect5">
<h6><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">刷新配置</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当配置Spring数据Elasticsearch就像在描述</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#elasticsearch.clients"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elasticsearch客户端</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>ElasticsearchConfigurationSupport</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>AbstractElasticsearchConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>AbstractReactiveElasticsearchConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">刷新的政策将被初始化</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以前反应式代码将此初始化为</font></font><code>IMMEDIATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，现在反应式和非反应式代码显示相同的行为。</font></font></p>
</div>
</div>
</div>
<div class="sect4">
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法返回类型</font></font></h5>
<div class="sect5">
<h6><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除接受查询的方法</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反应式方法以前返回一个</font></font><code>Mono&lt;Long&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有已删除文档数的，非反应式版本是无效的。</font><font style="vertical-align: inherit;">它们现在返回一个</font></font><code>Mono&lt;ByQueryResponse&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中包含有关已删除文档和可能发生的错误的更多详细信息。</font></font></p>
</div>
</div>
<div class="sect5">
<h6><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多重获取方法</font></font></h6>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multiget</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> previousl</font><font style="vertical-align: inherit;">的实现</font><font style="vertical-align: inherit;">只返回在 a 中找到的实体，</font></font><code>List&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于非反应式实现，在 a 中</font></font><code>Flux&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于反应式实现。</font><font style="vertical-align: inherit;">如果请求包含未找到的 ID，则这些丢失的信息不可用。</font><font style="vertical-align: inherit;">用户需要将返回的 ID 与请求的 ID 进行比较，以找出丢失的 ID。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在这些</font></font><code>multiget</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font><code>MultiGetItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为每个请求的 id</font><font style="vertical-align: inherit;">返回一个</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这包含有关失败的信息（如不存在的索引）以及项目是否存在（然后它包含在`MultiGetItem 中）或不存在的信息。</font><font style="vertical-align: inherit;">:leveloffset:-1 :leveloffset:-1</font></font></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#_footnoteref_1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">停止维护
</font></font></div>
<div class="footnote" id="_footnotedef_2">
<a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#_footnoteref_2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">见</font></font><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.4/reference/html/#repositories.create-instances.spring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML 配置</font></font></a>
</div>
</div>
<div id="footer">
<div id="footer-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
版本 4.2.4</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后更新 2021-08-12 11:44:33 +0200
</font></font></div>
</div>
<link rel="stylesheet" href="./elasticsearch_files/github.min.css">
<script async="" src="./elasticsearch_files/analytics.js"></script><script src="./elasticsearch_files/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
<script type="text/javascript" src="./elasticsearch_files/tocbot.min.js"></script>
<script type="text/javascript" src="./elasticsearch_files/toc.js"></script>
<script>if (window.parent == window) {(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-2728886-23', 'auto', {'siteSpeedSampleRate': 100});ga('send', 'pageview');}</script><script defer="" src="./elasticsearch_files/beacon.min.js" data-cf-beacon="{&quot;rayId&quot;:&quot;68d14be49c271fb9&quot;,&quot;token&quot;:&quot;bffcb8a918ae4755926f76178bfbd26b&quot;,&quot;version&quot;:&quot;2021.8.1&quot;,&quot;si&quot;:10}"></script><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./elasticsearch_files/translate_24dp.png" width="20" height="20" alt="Google 翻译"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div>

<div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div></body></html>